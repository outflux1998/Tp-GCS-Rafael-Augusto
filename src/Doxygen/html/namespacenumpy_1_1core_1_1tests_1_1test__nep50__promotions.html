<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: numpy.core.tests.test_nep50_promotions Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacenumpy.html">numpy</a></li><li class="navelem"><a class="el" href="namespacenumpy_1_1core.html">core</a></li><li class="navelem"><a class="el" href="namespacenumpy_1_1core_1_1tests.html">tests</a></li><li class="navelem"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html">test_nep50_promotions</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">numpy.core.tests.test_nep50_promotions Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab7383896f8dd26c8687661ba96f0b574" id="r_ab7383896f8dd26c8687661ba96f0b574"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#ab7383896f8dd26c8687661ba96f0b574">_weak_promotion_enabled</a> ()</td></tr>
<tr class="separator:ab7383896f8dd26c8687661ba96f0b574"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd1b56aa23867c3d5986a17cfbdff59f" id="r_acd1b56aa23867c3d5986a17cfbdff59f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#acd1b56aa23867c3d5986a17cfbdff59f">test_nep50_examples</a> ()</td></tr>
<tr class="separator:acd1b56aa23867c3d5986a17cfbdff59f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97bc18bce118bba95cd683b765e5777" id="r_ae97bc18bce118bba95cd683b765e5777"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#ae97bc18bce118bba95cd683b765e5777">test_nep50_weak_integers</a> (dtype)</td></tr>
<tr class="separator:ae97bc18bce118bba95cd683b765e5777"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a024485efa6a5457f9c1c0e499c292b65" id="r_a024485efa6a5457f9c1c0e499c292b65"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#a024485efa6a5457f9c1c0e499c292b65">test_nep50_weak_integers_with_inexact</a> (dtype)</td></tr>
<tr class="separator:a024485efa6a5457f9c1c0e499c292b65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ecbeb3b7985e57eae1c90352661b8aa" id="r_a5ecbeb3b7985e57eae1c90352661b8aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#a5ecbeb3b7985e57eae1c90352661b8aa">test_weak_promotion_scalar_path</a> (op)</td></tr>
<tr class="separator:a5ecbeb3b7985e57eae1c90352661b8aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cf8b2d3426b7c73dc1d9352a865ab5a" id="r_a6cf8b2d3426b7c73dc1d9352a865ab5a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#a6cf8b2d3426b7c73dc1d9352a865ab5a">test_nep50_complex_promotion</a> ()</td></tr>
<tr class="separator:a6cf8b2d3426b7c73dc1d9352a865ab5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeada93003cb33f70400fd90a89ce5426" id="r_aeada93003cb33f70400fd90a89ce5426"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#aeada93003cb33f70400fd90a89ce5426">test_nep50_integer_conversion_errors</a> ()</td></tr>
<tr class="separator:aeada93003cb33f70400fd90a89ce5426"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a557b0456929b7f916917250d5ca9dee2" id="r_a557b0456929b7f916917250d5ca9dee2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenumpy_1_1core_1_1tests_1_1test__nep50__promotions.html#a557b0456929b7f916917250d5ca9dee2">test_nep50_integer_regression</a> ()</td></tr>
<tr class="separator:a557b0456929b7f916917250d5ca9dee2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">This file adds basic tests to test the NEP 50 style promotion compatibility
mode.  Most of these test are likely to be simply deleted again once NEP 50
is adopted in the main test suite.  A few may be moved elsewhere.
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="ab7383896f8dd26c8687661ba96f0b574" name="ab7383896f8dd26c8687661ba96f0b574"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7383896f8dd26c8687661ba96f0b574">&#9670;&#160;</a></span>_weak_promotion_enabled()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions._weak_promotion_enabled </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   16</span><span class="keyword">def </span>_weak_promotion_enabled():</div>
<div class="line"><span class="lineno">   17</span>    state = np._get_promotion_state()</div>
<div class="line"><span class="lineno">   18</span>    np._set_promotion_state(<span class="stringliteral">&quot;weak_and_warn&quot;</span>)</div>
<div class="line"><span class="lineno">   19</span>    <span class="keywordflow">yield</span></div>
<div class="line"><span class="lineno">   20</span>    np._set_promotion_state(state)</div>
<div class="line"><span class="lineno">   21</span> </div>
<div class="line"><span class="lineno">   22</span> </div>
<div class="line"><span class="lineno">   23</span><span class="preprocessor">@pytest.mark.skipif(IS_WASM, reason=&quot;wasm doesn&#39;t have support for fp errors&quot;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6cf8b2d3426b7c73dc1d9352a865ab5a" name="a6cf8b2d3426b7c73dc1d9352a865ab5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cf8b2d3426b7c73dc1d9352a865ab5a">&#9670;&#160;</a></span>test_nep50_complex_promotion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions.test_nep50_complex_promotion </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  151</span><span class="keyword">def </span>test_nep50_complex_promotion():</div>
<div class="line"><span class="lineno">  152</span>    np._set_promotion_state(<span class="stringliteral">&quot;weak&quot;</span>)</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>    <span class="keyword">with</span> pytest.warns(RuntimeWarning, match=<span class="stringliteral">&quot;.*overflow&quot;</span>):</div>
<div class="line"><span class="lineno">  155</span>        res = np.complex64(3) + complex(2**300)</div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span>    <span class="keyword">assert</span> type(res) == np.complex64</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="acd1b56aa23867c3d5986a17cfbdff59f" name="acd1b56aa23867c3d5986a17cfbdff59f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd1b56aa23867c3d5986a17cfbdff59f">&#9670;&#160;</a></span>test_nep50_examples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions.test_nep50_examples </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   24</span><span class="keyword">def </span>test_nep50_examples():</div>
<div class="line"><span class="lineno">   25</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;result dtype changed&quot;</span>):</div>
<div class="line"><span class="lineno">   26</span>        res = np.uint8(1) + 2</div>
<div class="line"><span class="lineno">   27</span>    <span class="keyword">assert</span> res.dtype == np.uint8</div>
<div class="line"><span class="lineno">   28</span> </div>
<div class="line"><span class="lineno">   29</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;result dtype changed&quot;</span>):</div>
<div class="line"><span class="lineno">   30</span>        res = np.array([1], np.uint8) + np.int64(1)</div>
<div class="line"><span class="lineno">   31</span>    <span class="keyword">assert</span> res.dtype == np.int64</div>
<div class="line"><span class="lineno">   32</span> </div>
<div class="line"><span class="lineno">   33</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;result dtype changed&quot;</span>):</div>
<div class="line"><span class="lineno">   34</span>        res = np.array([1], np.uint8) + np.array(1, dtype=np.int64)</div>
<div class="line"><span class="lineno">   35</span>    <span class="keyword">assert</span> res.dtype == np.int64</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;result dtype changed&quot;</span>):</div>
<div class="line"><span class="lineno">   38</span>        <span class="comment"># Note: For &quot;weak_and_warn&quot; promotion state the overflow warning is</span></div>
<div class="line"><span class="lineno">   39</span>        <span class="comment">#       unfortunately not given (because we use the full array path).</span></div>
<div class="line"><span class="lineno">   40</span>        <span class="keyword">with</span> np.errstate(over=<span class="stringliteral">&quot;raise&quot;</span>):</div>
<div class="line"><span class="lineno">   41</span>            res = np.uint8(100) + 200</div>
<div class="line"><span class="lineno">   42</span>    <span class="keyword">assert</span> res.dtype == np.uint8</div>
<div class="line"><span class="lineno">   43</span> </div>
<div class="line"><span class="lineno">   44</span>    <span class="keyword">with</span> pytest.warns(Warning) <span class="keyword">as</span> recwarn:</div>
<div class="line"><span class="lineno">   45</span>        res = np.float32(1) + 3e100</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    <span class="comment"># Check that both warnings were given in the one call:</span></div>
<div class="line"><span class="lineno">   48</span>    warning = str(recwarn.pop(UserWarning).message)</div>
<div class="line"><span class="lineno">   49</span>    <span class="keyword">assert</span> warning.startswith(<span class="stringliteral">&quot;result dtype changed&quot;</span>)</div>
<div class="line"><span class="lineno">   50</span>    warning = str(recwarn.pop(RuntimeWarning).message)</div>
<div class="line"><span class="lineno">   51</span>    <span class="keyword">assert</span> warning.startswith(<span class="stringliteral">&quot;overflow&quot;</span>)</div>
<div class="line"><span class="lineno">   52</span>    <span class="keyword">assert</span> len(recwarn) == 0  <span class="comment"># no further warnings</span></div>
<div class="line"><span class="lineno">   53</span>    <span class="keyword">assert</span> np.isinf(res)</div>
<div class="line"><span class="lineno">   54</span>    <span class="keyword">assert</span> res.dtype == np.float32</div>
<div class="line"><span class="lineno">   55</span> </div>
<div class="line"><span class="lineno">   56</span>    <span class="comment"># Changes, but we don&#39;t warn for it (too noisy)</span></div>
<div class="line"><span class="lineno">   57</span>    res = np.array([0.1], np.float32) == np.float64(0.1)</div>
<div class="line"><span class="lineno">   58</span>    <span class="keyword">assert</span> res[0] == <span class="keyword">False</span></div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>    <span class="comment"># Additional test, since the above silences the warning:</span></div>
<div class="line"><span class="lineno">   61</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;result dtype changed&quot;</span>):</div>
<div class="line"><span class="lineno">   62</span>        res = np.array([0.1], np.float32) + np.float64(0.1)</div>
<div class="line"><span class="lineno">   63</span>    <span class="keyword">assert</span> res.dtype == np.float64</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;result dtype changed&quot;</span>):</div>
<div class="line"><span class="lineno">   66</span>        res = np.array([1.], np.float32) + np.int64(3)</div>
<div class="line"><span class="lineno">   67</span>    <span class="keyword">assert</span> res.dtype == np.float64</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span><span class="preprocessor">@pytest.mark.parametrize(&quot;dtype&quot;, np.typecodes[&quot;AllInteger&quot;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeada93003cb33f70400fd90a89ce5426" name="aeada93003cb33f70400fd90a89ce5426"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeada93003cb33f70400fd90a89ce5426">&#9670;&#160;</a></span>test_nep50_integer_conversion_errors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions.test_nep50_integer_conversion_errors </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  160</span><span class="keyword">def </span>test_nep50_integer_conversion_errors():</div>
<div class="line"><span class="lineno">  161</span>    <span class="comment"># Do not worry about warnings here (auto-fixture will reset).</span></div>
<div class="line"><span class="lineno">  162</span>    np._set_promotion_state(<span class="stringliteral">&quot;weak&quot;</span>)</div>
<div class="line"><span class="lineno">  163</span>    <span class="comment"># Implementation for error paths is mostly missing (as of writing)</span></div>
<div class="line"><span class="lineno">  164</span>    <span class="keyword">with</span> pytest.raises(OverflowError, match=<span class="stringliteral">&quot;.*uint8&quot;</span>):</div>
<div class="line"><span class="lineno">  165</span>        np.array([1], np.uint8) + 300</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>    <span class="keyword">with</span> pytest.raises(OverflowError, match=<span class="stringliteral">&quot;.*uint8&quot;</span>):</div>
<div class="line"><span class="lineno">  168</span>        np.uint8(1) + 300</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>    <span class="comment"># Error message depends on platform (maybe unsigned int or unsigned long)</span></div>
<div class="line"><span class="lineno">  171</span>    <span class="keyword">with</span> pytest.raises(OverflowError,</div>
<div class="line"><span class="lineno">  172</span>            match=<span class="stringliteral">&quot;Python integer -1 out of bounds for uint8&quot;</span>):</div>
<div class="line"><span class="lineno">  173</span>        np.uint8(1) + -1</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a557b0456929b7f916917250d5ca9dee2" name="a557b0456929b7f916917250d5ca9dee2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a557b0456929b7f916917250d5ca9dee2">&#9670;&#160;</a></span>test_nep50_integer_regression()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions.test_nep50_integer_regression </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  176</span><span class="keyword">def </span>test_nep50_integer_regression():</div>
<div class="line"><span class="lineno">  177</span>    <span class="comment"># Test the old integer promotion rules.  When the integer is too large,</span></div>
<div class="line"><span class="lineno">  178</span>    <span class="comment"># we need to keep using the old-style promotion.</span></div>
<div class="line"><span class="lineno">  179</span>    np._set_promotion_state(<span class="stringliteral">&quot;legacy&quot;</span>)</div>
<div class="line"><span class="lineno">  180</span>    arr = np.array(1)</div>
<div class="line"><span class="lineno">  181</span>    <span class="keyword">assert</span> (arr + 2**63).dtype == np.float64</div>
<div class="line"><span class="lineno">  182</span>    <span class="keyword">assert</span> (arr[()] + 2**63).dtype == np.float64</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae97bc18bce118bba95cd683b765e5777" name="ae97bc18bce118bba95cd683b765e5777"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae97bc18bce118bba95cd683b765e5777">&#9670;&#160;</a></span>test_nep50_weak_integers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions.test_nep50_weak_integers </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dtype</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   71</span><span class="keyword">def </span>test_nep50_weak_integers(dtype):</div>
<div class="line"><span class="lineno">   72</span>    <span class="comment"># Avoids warning (different code path for scalars)</span></div>
<div class="line"><span class="lineno">   73</span>    np._set_promotion_state(<span class="stringliteral">&quot;weak&quot;</span>)</div>
<div class="line"><span class="lineno">   74</span>    scalar_type = np.dtype(dtype).type</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    maxint = int(np.iinfo(dtype).max)</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>    <span class="keyword">with</span> np.errstate(over=<span class="stringliteral">&quot;warn&quot;</span>):</div>
<div class="line"><span class="lineno">   79</span>        <span class="keyword">with</span> pytest.warns(RuntimeWarning):</div>
<div class="line"><span class="lineno">   80</span>            res = scalar_type(100) + maxint</div>
<div class="line"><span class="lineno">   81</span>    <span class="keyword">assert</span> res.dtype == dtype</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="comment"># Array operations are not expected to warn, but should give the same</span></div>
<div class="line"><span class="lineno">   84</span>    <span class="comment"># result dtype.</span></div>
<div class="line"><span class="lineno">   85</span>    res = np.array(100, dtype=dtype) + maxint</div>
<div class="line"><span class="lineno">   86</span>    <span class="keyword">assert</span> res.dtype == dtype</div>
<div class="line"><span class="lineno">   87</span> </div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span><span class="preprocessor">@pytest.mark.parametrize(&quot;dtype&quot;, np.typecodes[&quot;AllFloat&quot;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a024485efa6a5457f9c1c0e499c292b65" name="a024485efa6a5457f9c1c0e499c292b65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a024485efa6a5457f9c1c0e499c292b65">&#9670;&#160;</a></span>test_nep50_weak_integers_with_inexact()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions.test_nep50_weak_integers_with_inexact </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dtype</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   90</span><span class="keyword">def </span>test_nep50_weak_integers_with_inexact(dtype):</div>
<div class="line"><span class="lineno">   91</span>    <span class="comment"># Avoids warning (different code path for scalars)</span></div>
<div class="line"><span class="lineno">   92</span>    np._set_promotion_state(<span class="stringliteral">&quot;weak&quot;</span>)</div>
<div class="line"><span class="lineno">   93</span>    scalar_type = np.dtype(dtype).type</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>    too_big_int = int(np.finfo(dtype).max) * 2</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>    <span class="keywordflow">if</span> dtype <span class="keywordflow">in</span> <span class="stringliteral">&quot;dDG&quot;</span>:</div>
<div class="line"><span class="lineno">   98</span>        <span class="comment"># These dtypes currently convert to Python float internally, which</span></div>
<div class="line"><span class="lineno">   99</span>        <span class="comment"># raises an OverflowError, while the other dtypes overflow to inf.</span></div>
<div class="line"><span class="lineno">  100</span>        <span class="comment"># NOTE: It may make sense to normalize the behavior!</span></div>
<div class="line"><span class="lineno">  101</span>        <span class="keyword">with</span> pytest.raises(OverflowError):</div>
<div class="line"><span class="lineno">  102</span>            scalar_type(1) + too_big_int</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>        <span class="keyword">with</span> pytest.raises(OverflowError):</div>
<div class="line"><span class="lineno">  105</span>            np.array(1, dtype=dtype) + too_big_int</div>
<div class="line"><span class="lineno">  106</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  107</span>        <span class="comment"># NumPy uses (or used) `int -&gt; string -&gt; longdouble` for the</span></div>
<div class="line"><span class="lineno">  108</span>        <span class="comment"># conversion.  But Python may refuse `str(int)` for huge ints.</span></div>
<div class="line"><span class="lineno">  109</span>        <span class="comment"># In that case, RuntimeWarning would be correct, but conversion</span></div>
<div class="line"><span class="lineno">  110</span>        <span class="comment"># fails earlier (seems to happen on 32bit linux, possibly only debug).</span></div>
<div class="line"><span class="lineno">  111</span>        <span class="keywordflow">if</span> dtype <span class="keywordflow">in</span> <span class="stringliteral">&quot;gG&quot;</span>:</div>
<div class="line"><span class="lineno">  112</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  113</span>                str(too_big_int)</div>
<div class="line"><span class="lineno">  114</span>            <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><span class="lineno">  115</span>                pytest.skip(<span class="stringliteral">&quot;`huge_int -&gt; string -&gt; longdouble` failed&quot;</span>)</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>        <span class="comment"># Otherwise, we overflow to infinity:</span></div>
<div class="line"><span class="lineno">  118</span>        <span class="keyword">with</span> pytest.warns(RuntimeWarning):</div>
<div class="line"><span class="lineno">  119</span>            res = scalar_type(1) + too_big_int</div>
<div class="line"><span class="lineno">  120</span>        <span class="keyword">assert</span> res.dtype == dtype</div>
<div class="line"><span class="lineno">  121</span>        <span class="keyword">assert</span> res == np.inf</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>        <span class="keyword">with</span> pytest.warns(RuntimeWarning):</div>
<div class="line"><span class="lineno">  124</span>            <span class="comment"># We force the dtype here, since windows may otherwise pick the</span></div>
<div class="line"><span class="lineno">  125</span>            <span class="comment"># double instead of the longdouble loop.  That leads to slightly</span></div>
<div class="line"><span class="lineno">  126</span>            <span class="comment"># different results (conversion of the int fails as above).</span></div>
<div class="line"><span class="lineno">  127</span>            res = np.add(np.array(1, dtype=dtype), too_big_int, dtype=dtype)</div>
<div class="line"><span class="lineno">  128</span>        <span class="keyword">assert</span> res.dtype == dtype</div>
<div class="line"><span class="lineno">  129</span>        <span class="keyword">assert</span> res == np.inf</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span><span class="preprocessor">@pytest.mark.parametrize(&quot;op&quot;, [operator.add, operator.pow, operator.eq])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5ecbeb3b7985e57eae1c90352661b8aa" name="a5ecbeb3b7985e57eae1c90352661b8aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ecbeb3b7985e57eae1c90352661b8aa">&#9670;&#160;</a></span>test_weak_promotion_scalar_path()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">numpy.core.tests.test_nep50_promotions.test_weak_promotion_scalar_path </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>op</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  133</span><span class="keyword">def </span>test_weak_promotion_scalar_path(op):</div>
<div class="line"><span class="lineno">  134</span>    <span class="comment"># Some additional paths excercising the weak scalars.</span></div>
<div class="line"><span class="lineno">  135</span>    np._set_promotion_state(<span class="stringliteral">&quot;weak&quot;</span>)</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>    <span class="comment"># Integer path:</span></div>
<div class="line"><span class="lineno">  138</span>    res = op(np.uint8(3), 5)</div>
<div class="line"><span class="lineno">  139</span>    <span class="keyword">assert</span> res == op(3, 5)</div>
<div class="line"><span class="lineno">  140</span>    <span class="keyword">assert</span> res.dtype == np.uint8 <span class="keywordflow">or</span> res.dtype == bool</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    <span class="keyword">with</span> pytest.raises(OverflowError):</div>
<div class="line"><span class="lineno">  143</span>        op(np.uint8(3), 1000)</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>    <span class="comment"># Float path:</span></div>
<div class="line"><span class="lineno">  146</span>    res = op(np.float32(3), 5.)</div>
<div class="line"><span class="lineno">  147</span>    <span class="keyword">assert</span> res == op(3., 5.)</div>
<div class="line"><span class="lineno">  148</span>    <span class="keyword">assert</span> res.dtype == np.float32 <span class="keywordflow">or</span> res.dtype == bool</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span> </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
