<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: fontTools.ttLib.removeOverlaps Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacefont_tools.html">fontTools</a></li><li class="navelem"><a class="el" href="namespacefont_tools_1_1tt_lib.html">ttLib</a></li><li class="navelem"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html">removeOverlaps</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">fontTools.ttLib.removeOverlaps Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfont_tools_1_1tt_lib_1_1remove_overlaps_1_1_remove_overlaps_error.html">RemoveOverlapsError</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5204b977bec187314529510116d3e819" id="r_a5204b977bec187314529510116d3e819"><td class="memItemLeft" align="right" valign="top">pathops.Path&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a5204b977bec187314529510116d3e819">skPathFromGlyph</a> (str glyphName, <a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a> glyphSet)</td></tr>
<tr class="separator:a5204b977bec187314529510116d3e819"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41f2b200ceb07b1a28bd01349a717ba4" id="r_a41f2b200ceb07b1a28bd01349a717ba4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a41f2b200ceb07b1a28bd01349a717ba4">skPathFromGlyphComponent</a> (_g_l_y_f.GlyphComponent component, <a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a> glyphSet)</td></tr>
<tr class="separator:a41f2b200ceb07b1a28bd01349a717ba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b7702b14e553c744c150ee04dbc843d" id="r_a0b7702b14e553c744c150ee04dbc843d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a0b7702b14e553c744c150ee04dbc843d">componentsOverlap</a> (_g_l_y_f.Glyph glyph, <a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a> glyphSet)</td></tr>
<tr class="separator:a0b7702b14e553c744c150ee04dbc843d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e36110a454454b253be7abc849ea92e" id="r_a4e36110a454454b253be7abc849ea92e"><td class="memItemLeft" align="right" valign="top">_g_l_y_f.Glyph&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a4e36110a454454b253be7abc849ea92e">ttfGlyphFromSkPath</a> (pathops.Path path)</td></tr>
<tr class="separator:a4e36110a454454b253be7abc849ea92e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe544601b37242a28ad73212f672c1e0" id="r_abe544601b37242a28ad73212f672c1e0"><td class="memItemLeft" align="right" valign="top">pathops.Path&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#abe544601b37242a28ad73212f672c1e0">_round_path</a> (pathops.Path path, Callable[[float], float] round=otRound)</td></tr>
<tr class="separator:abe544601b37242a28ad73212f672c1e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a3420558e5ca4620792da9ae96c09e5" id="r_a7a3420558e5ca4620792da9ae96c09e5"><td class="memItemLeft" align="right" valign="top">pathops.Path&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a7a3420558e5ca4620792da9ae96c09e5">_simplify</a> (pathops.Path path, str debugGlyphName)</td></tr>
<tr class="separator:a7a3420558e5ca4620792da9ae96c09e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafc52fa06ec826aff4bc8b91d8aea4ba" id="r_aafc52fa06ec826aff4bc8b91d8aea4ba"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#aafc52fa06ec826aff4bc8b91d8aea4ba">removeTTGlyphOverlaps</a> (str glyphName, <a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a> glyphSet, _g_l_y_f.table__g_l_y_f glyfTable, _h_m_t_x.table__h_m_t_x hmtxTable, bool removeHinting=True)</td></tr>
<tr class="separator:aafc52fa06ec826aff4bc8b91d8aea4ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a226168ab6846ac4bdaca4d23eb229ed5" id="r_a226168ab6846ac4bdaca4d23eb229ed5"><td class="memItemLeft" align="right" valign="top">None&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a226168ab6846ac4bdaca4d23eb229ed5">removeOverlaps</a> (<a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">ttFont.TTFont</a> font, Optional[Iterable[str]] glyphNames=None, bool removeHinting=True, ignoreErrors=False)</td></tr>
<tr class="separator:a226168ab6846ac4bdaca4d23eb229ed5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c294cb9d074a32eef84b46aade97c37" id="r_a8c294cb9d074a32eef84b46aade97c37"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a8c294cb9d074a32eef84b46aade97c37">main</a> (args=None)</td></tr>
<tr class="separator:a8c294cb9d074a32eef84b46aade97c37"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab2aaa0d930b9aae7e4e8008e92ca94ff" id="r_ab2aaa0d930b9aae7e4e8008e92ca94ff"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#ab2aaa0d930b9aae7e4e8008e92ca94ff">log</a> = logging.getLogger(&quot;fontTools.ttLib.removeOverlaps&quot;)</td></tr>
<tr class="separator:ab2aaa0d930b9aae7e4e8008e92ca94ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a266440938b41c78ba30a2c25a00e943d" id="r_a266440938b41c78ba30a2c25a00e943d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a> = Mapping[str, <a class="el" href="classfont_tools_1_1tt_lib_1_1tt_glyph_set_1_1___t_t_glyph.html">ttFont._TTGlyph</a>]</td></tr>
<tr class="separator:a266440938b41c78ba30a2c25a00e943d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment"> Simplify TrueType glyphs by merging overlapping contours/components.

Requires https://github.com/fonttools/skia-pathops
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="abe544601b37242a28ad73212f672c1e0" name="abe544601b37242a28ad73212f672c1e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe544601b37242a28ad73212f672c1e0">&#9670;&#160;</a></span>_round_path()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"> pathops.Path fontTools.ttLib.removeOverlaps._round_path </td>
          <td>(</td>
          <td class="paramtype">pathops.Path&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Callable[[float], float] &#160;</td>
          <td class="paramname"><em>round</em> = <code>otRound</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   86</span>) -&gt; pathops.Path:</div>
<div class="line"><span class="lineno">   87</span>    rounded_path = pathops.Path()</div>
<div class="line"><span class="lineno">   88</span>    <span class="keywordflow">for</span> verb, points <span class="keywordflow">in</span> path:</div>
<div class="line"><span class="lineno">   89</span>        rounded_path.add(verb, *((round(p[0]), round(p[1])) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> points))</div>
<div class="line"><span class="lineno">   90</span>    <span class="keywordflow">return</span> rounded_path</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a3420558e5ca4620792da9ae96c09e5" name="a7a3420558e5ca4620792da9ae96c09e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a3420558e5ca4620792da9ae96c09e5">&#9670;&#160;</a></span>_simplify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"> pathops.Path fontTools.ttLib.removeOverlaps._simplify </td>
          <td>(</td>
          <td class="paramtype">pathops.Path&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>debugGlyphName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   93</span><span class="keyword">def </span>_simplify(path: pathops.Path, debugGlyphName: str) -&gt; pathops.Path:</div>
<div class="line"><span class="lineno">   94</span>    <span class="comment"># skia-pathops has a bug where it sometimes fails to simplify paths when there</span></div>
<div class="line"><span class="lineno">   95</span>    <span class="comment"># are float coordinates and control points are very close to one another.</span></div>
<div class="line"><span class="lineno">   96</span>    <span class="comment"># Rounding coordinates to integers works around the bug.</span></div>
<div class="line"><span class="lineno">   97</span>    <span class="comment"># Since we are going to round glyf coordinates later on anyway, here it is</span></div>
<div class="line"><span class="lineno">   98</span>    <span class="comment"># ok(-ish) to also round before simplify. Better than failing the whole process</span></div>
<div class="line"><span class="lineno">   99</span>    <span class="comment"># for the entire font.</span></div>
<div class="line"><span class="lineno">  100</span>    <span class="comment"># https://bugs.chromium.org/p/skia/issues/detail?id=11958</span></div>
<div class="line"><span class="lineno">  101</span>    <span class="comment"># https://github.com/google/fonts/issues/3365</span></div>
<div class="line"><span class="lineno">  102</span>    <span class="comment"># TODO(anthrotype): remove once this Skia bug is fixed</span></div>
<div class="line"><span class="lineno">  103</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  104</span>        <span class="keywordflow">return</span> pathops.simplify(path, clockwise=path.clockwise)</div>
<div class="line"><span class="lineno">  105</span>    <span class="keywordflow">except</span> pathops.PathOpsError:</div>
<div class="line"><span class="lineno">  106</span>        <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    path = _round_path(path)</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  110</span>        path = pathops.simplify(path, clockwise=path.clockwise)</div>
<div class="line"><span class="lineno">  111</span>        log.debug(</div>
<div class="line"><span class="lineno">  112</span>            <span class="stringliteral">&quot;skia-pathops failed to simplify &#39;%s&#39; with float coordinates, &quot;</span></div>
<div class="line"><span class="lineno">  113</span>            <span class="stringliteral">&quot;but succeded using rounded integer coordinates&quot;</span>,</div>
<div class="line"><span class="lineno">  114</span>            debugGlyphName,</div>
<div class="line"><span class="lineno">  115</span>        )</div>
<div class="line"><span class="lineno">  116</span>        <span class="keywordflow">return</span> path</div>
<div class="line"><span class="lineno">  117</span>    <span class="keywordflow">except</span> pathops.PathOpsError <span class="keyword">as</span> e:</div>
<div class="line"><span class="lineno">  118</span>        <span class="keywordflow">if</span> log.isEnabledFor(logging.DEBUG):</div>
<div class="line"><span class="lineno">  119</span>            path.dump()</div>
<div class="line"><span class="lineno">  120</span>        <span class="keywordflow">raise</span> RemoveOverlapsError(</div>
<div class="line"><span class="lineno">  121</span>            f<span class="stringliteral">&quot;Failed to remove overlaps from glyph {debugGlyphName!r}&quot;</span></div>
<div class="line"><span class="lineno">  122</span>        ) <span class="keyword">from</span> e</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">raise</span> AssertionError(<span class="stringliteral">&quot;Unreachable&quot;</span>)</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0b7702b14e553c744c150ee04dbc843d" name="a0b7702b14e553c744c150ee04dbc843d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b7702b14e553c744c150ee04dbc843d">&#9670;&#160;</a></span>componentsOverlap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> bool fontTools.ttLib.removeOverlaps.componentsOverlap </td>
          <td>(</td>
          <td class="paramtype">_g_l_y_f.Glyph&#160;</td>
          <td class="paramname"><em>glyph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a>&#160;</td>
          <td class="paramname"><em>glyphSet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   46</span><span class="keyword">def </span>componentsOverlap(glyph: _g_l_y_f.Glyph, glyphSet: _TTGlyphMapping) -&gt; bool:</div>
<div class="line"><span class="lineno">   47</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> glyph.isComposite():</div>
<div class="line"><span class="lineno">   48</span>        <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;This method only works with TrueType composite glyphs&quot;</span>)</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordflow">if</span> len(glyph.components) &lt; 2:</div>
<div class="line"><span class="lineno">   50</span>        <span class="keywordflow">return</span> <span class="keyword">False</span>  <span class="comment"># single component, no overlaps</span></div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>    component_paths = {}</div>
<div class="line"><span class="lineno">   53</span> </div>
<div class="line"><span class="lineno">   54</span>    <span class="keyword">def </span>_get_nth_component_path(index: int) -&gt; pathops.Path:</div>
<div class="line"><span class="lineno">   55</span>        <span class="keywordflow">if</span> index <span class="keywordflow">not</span> <span class="keywordflow">in</span> component_paths:</div>
<div class="line"><span class="lineno">   56</span>            component_paths[index] = skPathFromGlyphComponent(</div>
<div class="line"><span class="lineno">   57</span>                glyph.components[index], glyphSet</div>
<div class="line"><span class="lineno">   58</span>            )</div>
<div class="line"><span class="lineno">   59</span>        <span class="keywordflow">return</span> component_paths[index]</div>
<div class="line"><span class="lineno">   60</span> </div>
<div class="line"><span class="lineno">   61</span>    <span class="keywordflow">return</span> any(</div>
<div class="line"><span class="lineno">   62</span>        pathops.op(</div>
<div class="line"><span class="lineno">   63</span>            _get_nth_component_path(i),</div>
<div class="line"><span class="lineno">   64</span>            _get_nth_component_path(j),</div>
<div class="line"><span class="lineno">   65</span>            pathops.PathOp.INTERSECTION,</div>
<div class="line"><span class="lineno">   66</span>            fix_winding=<span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">   67</span>            keep_starting_points=<span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">   68</span>        )</div>
<div class="line"><span class="lineno">   69</span>        <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> itertools.combinations(range(len(glyph.components)), 2)</div>
<div class="line"><span class="lineno">   70</span>    )</div>
<div class="line"><span class="lineno">   71</span> </div>
<div class="line"><span class="lineno">   72</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a8c294cb9d074a32eef84b46aade97c37" name="a8c294cb9d074a32eef84b46aade97c37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c294cb9d074a32eef84b46aade97c37">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.ttLib.removeOverlaps.main </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>args</em> = <code>None</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  226</span><span class="keyword">def </span>main(args=None):</div>
<div class="line"><span class="lineno">  227</span>    <span class="keyword">import</span> sys</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>    <span class="keywordflow">if</span> args <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  230</span>        args = sys.argv[1:]</div>
<div class="line"><span class="lineno">  231</span> </div>
<div class="line"><span class="lineno">  232</span>    <span class="keywordflow">if</span> len(args) &lt; 2:</div>
<div class="line"><span class="lineno">  233</span>        print(</div>
<div class="line"><span class="lineno">  234</span>            f<span class="stringliteral">&quot;usage: fonttools ttLib.removeOverlaps INPUT.ttf OUTPUT.ttf [GLYPHS ...]&quot;</span></div>
<div class="line"><span class="lineno">  235</span>        )</div>
<div class="line"><span class="lineno">  236</span>        sys.exit(1)</div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span>    src = args[0]</div>
<div class="line"><span class="lineno">  239</span>    dst = args[1]</div>
<div class="line"><span class="lineno">  240</span>    glyphNames = args[2:] <span class="keywordflow">or</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>    <span class="keyword">with</span> ttFont.TTFont(src) <span class="keyword">as</span> f:</div>
<div class="line"><span class="lineno">  243</span>        removeOverlaps(f, glyphNames)</div>
<div class="line"><span class="lineno">  244</span>        f.save(dst)</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a226168ab6846ac4bdaca4d23eb229ed5" name="a226168ab6846ac4bdaca4d23eb229ed5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a226168ab6846ac4bdaca4d23eb229ed5">&#9670;&#160;</a></span>removeOverlaps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> None fontTools.ttLib.removeOverlaps.removeOverlaps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">ttFont.TTFont</a>&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Optional[Iterable[str]] &#160;</td>
          <td class="paramname"><em>glyphNames</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>removeHinting</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ignoreErrors</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Simplify glyphs in TTFont by merging overlapping contours.

Overlapping components are first decomposed to simple contours, then merged.

Currently this only works with TrueType fonts with 'glyf' table.
Raises NotImplementedError if 'glyf' table is absent.

Note that removing overlaps invalidates the hinting. By default we drop hinting
from all glyphs whether or not overlaps are removed from a given one, as it would
look weird if only some glyphs are left (un)hinted.

Args:
    font: input TTFont object, modified in place.
    glyphNames: optional iterable of glyph names (str) to remove overlaps from.
        By default, all glyphs in the font are processed.
    removeHinting (bool): set to False to keep hinting for unmodified glyphs.
    ignoreErrors (bool): set to True to ignore errors while removing overlaps,
        thus keeping the tricky glyphs unchanged (fonttools/fonttools#2363).
</pre> <div class="fragment"><div class="line"><span class="lineno">  167</span>) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  168</span>    <span class="stringliteral">&quot;&quot;&quot;Simplify glyphs in TTFont by merging overlapping contours.</span></div>
<div class="line"><span class="lineno">  169</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  170</span><span class="stringliteral">    Overlapping components are first decomposed to simple contours, then merged.</span></div>
<div class="line"><span class="lineno">  171</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  172</span><span class="stringliteral">    Currently this only works with TrueType fonts with &#39;glyf&#39; table.</span></div>
<div class="line"><span class="lineno">  173</span><span class="stringliteral">    Raises NotImplementedError if &#39;glyf&#39; table is absent.</span></div>
<div class="line"><span class="lineno">  174</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  175</span><span class="stringliteral">    Note that removing overlaps invalidates the hinting. By default we drop hinting</span></div>
<div class="line"><span class="lineno">  176</span><span class="stringliteral">    from all glyphs whether or not overlaps are removed from a given one, as it would</span></div>
<div class="line"><span class="lineno">  177</span><span class="stringliteral">    look weird if only some glyphs are left (un)hinted.</span></div>
<div class="line"><span class="lineno">  178</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  179</span><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="lineno">  180</span><span class="stringliteral">        font: input TTFont object, modified in place.</span></div>
<div class="line"><span class="lineno">  181</span><span class="stringliteral">        glyphNames: optional iterable of glyph names (str) to remove overlaps from.</span></div>
<div class="line"><span class="lineno">  182</span><span class="stringliteral">            By default, all glyphs in the font are processed.</span></div>
<div class="line"><span class="lineno">  183</span><span class="stringliteral">        removeHinting (bool): set to False to keep hinting for unmodified glyphs.</span></div>
<div class="line"><span class="lineno">  184</span><span class="stringliteral">        ignoreErrors (bool): set to True to ignore errors while removing overlaps,</span></div>
<div class="line"><span class="lineno">  185</span><span class="stringliteral">            thus keeping the tricky glyphs unchanged (fonttools/fonttools#2363).</span></div>
<div class="line"><span class="lineno">  186</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  188</span>        glyfTable = font[<span class="stringliteral">&quot;glyf&quot;</span>]</div>
<div class="line"><span class="lineno">  189</span>    <span class="keywordflow">except</span> KeyError:</div>
<div class="line"><span class="lineno">  190</span>        <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">&quot;removeOverlaps currently only works with TTFs&quot;</span>)</div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>    hmtxTable = font[<span class="stringliteral">&quot;hmtx&quot;</span>]</div>
<div class="line"><span class="lineno">  193</span>    <span class="comment"># wraps the underlying glyf Glyphs, takes care of interfacing with drawing pens</span></div>
<div class="line"><span class="lineno">  194</span>    glyphSet = font.getGlyphSet()</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>    <span class="keywordflow">if</span> glyphNames <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  197</span>        glyphNames = font.getGlyphOrder()</div>
<div class="line"><span class="lineno">  198</span> </div>
<div class="line"><span class="lineno">  199</span>    <span class="comment"># process all simple glyphs first, then composites with increasing component depth,</span></div>
<div class="line"><span class="lineno">  200</span>    <span class="comment"># so that by the time we test for component intersections the respective base glyphs</span></div>
<div class="line"><span class="lineno">  201</span>    <span class="comment"># have already been simplified</span></div>
<div class="line"><span class="lineno">  202</span>    glyphNames = sorted(</div>
<div class="line"><span class="lineno">  203</span>        glyphNames,</div>
<div class="line"><span class="lineno">  204</span>        key=<span class="keyword">lambda</span> name: (</div>
<div class="line"><span class="lineno">  205</span>            glyfTable[name].getCompositeMaxpValues(glyfTable).maxComponentDepth</div>
<div class="line"><span class="lineno">  206</span>            <span class="keywordflow">if</span> glyfTable[name].isComposite()</div>
<div class="line"><span class="lineno">  207</span>            <span class="keywordflow">else</span> 0,</div>
<div class="line"><span class="lineno">  208</span>            name,</div>
<div class="line"><span class="lineno">  209</span>        ),</div>
<div class="line"><span class="lineno">  210</span>    )</div>
<div class="line"><span class="lineno">  211</span>    modified = set()</div>
<div class="line"><span class="lineno">  212</span>    <span class="keywordflow">for</span> glyphName <span class="keywordflow">in</span> glyphNames:</div>
<div class="line"><span class="lineno">  213</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  214</span>            <span class="keywordflow">if</span> removeTTGlyphOverlaps(</div>
<div class="line"><span class="lineno">  215</span>                glyphName, glyphSet, glyfTable, hmtxTable, removeHinting</div>
<div class="line"><span class="lineno">  216</span>            ):</div>
<div class="line"><span class="lineno">  217</span>                modified.add(glyphName)</div>
<div class="line"><span class="lineno">  218</span>        <span class="keywordflow">except</span> RemoveOverlapsError:</div>
<div class="line"><span class="lineno">  219</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> ignoreErrors:</div>
<div class="line"><span class="lineno">  220</span>                <span class="keywordflow">raise</span></div>
<div class="line"><span class="lineno">  221</span>            log.error(<span class="stringliteral">&quot;Failed to remove overlaps for &#39;%s&#39;&quot;</span>, glyphName)</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>    log.debug(<span class="stringliteral">&quot;Removed overlaps for %s glyphs:\n%s&quot;</span>, len(modified), <span class="stringliteral">&quot; &quot;</span>.join(modified))</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aafc52fa06ec826aff4bc8b91d8aea4ba" name="aafc52fa06ec826aff4bc8b91d8aea4ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafc52fa06ec826aff4bc8b91d8aea4ba">&#9670;&#160;</a></span>removeTTGlyphOverlaps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> bool fontTools.ttLib.removeOverlaps.removeTTGlyphOverlaps </td>
          <td>(</td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>glyphName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a>&#160;</td>
          <td class="paramname"><em>glyphSet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_g_l_y_f.table__g_l_y_f&#160;</td>
          <td class="paramname"><em>glyfTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_h_m_t_x.table__h_m_t_x&#160;</td>
          <td class="paramname"><em>hmtxTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>removeHinting</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  133</span>) -&gt; bool:</div>
<div class="line"><span class="lineno">  134</span>    glyph = glyfTable[glyphName]</div>
<div class="line"><span class="lineno">  135</span>    <span class="comment"># decompose composite glyphs only if components overlap each other</span></div>
<div class="line"><span class="lineno">  136</span>    <span class="keywordflow">if</span> (</div>
<div class="line"><span class="lineno">  137</span>        glyph.numberOfContours &gt; 0</div>
<div class="line"><span class="lineno">  138</span>        <span class="keywordflow">or</span> glyph.isComposite()</div>
<div class="line"><span class="lineno">  139</span>        <span class="keywordflow">and</span> componentsOverlap(glyph, glyphSet)</div>
<div class="line"><span class="lineno">  140</span>    ):</div>
<div class="line"><span class="lineno">  141</span>        path = skPathFromGlyph(glyphName, glyphSet)</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>        <span class="comment"># remove overlaps</span></div>
<div class="line"><span class="lineno">  144</span>        path2 = _simplify(path, glyphName)</div>
<div class="line"><span class="lineno">  145</span> </div>
<div class="line"><span class="lineno">  146</span>        <span class="comment"># replace TTGlyph if simplified path is different (ignoring contour order)</span></div>
<div class="line"><span class="lineno">  147</span>        <span class="keywordflow">if</span> {tuple(c) <span class="keywordflow">for</span> c <span class="keywordflow">in</span> path.contours} != {tuple(c) <span class="keywordflow">for</span> c <span class="keywordflow">in</span> path2.contours}:</div>
<div class="line"><span class="lineno">  148</span>            glyfTable[glyphName] = glyph = ttfGlyphFromSkPath(path2)</div>
<div class="line"><span class="lineno">  149</span>            <span class="comment"># simplified glyph is always unhinted</span></div>
<div class="line"><span class="lineno">  150</span>            <span class="keyword">assert</span> <span class="keywordflow">not</span> glyph.program</div>
<div class="line"><span class="lineno">  151</span>            <span class="comment"># also ensure hmtx LSB == glyph.xMin so glyph origin is at x=0</span></div>
<div class="line"><span class="lineno">  152</span>            width, lsb = hmtxTable[glyphName]</div>
<div class="line"><span class="lineno">  153</span>            <span class="keywordflow">if</span> lsb != glyph.xMin:</div>
<div class="line"><span class="lineno">  154</span>                hmtxTable[glyphName] = (width, glyph.xMin)</div>
<div class="line"><span class="lineno">  155</span>            <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span>    <span class="keywordflow">if</span> removeHinting:</div>
<div class="line"><span class="lineno">  158</span>        glyph.removeHinting()</div>
<div class="line"><span class="lineno">  159</span>    <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a5204b977bec187314529510116d3e819" name="a5204b977bec187314529510116d3e819"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5204b977bec187314529510116d3e819">&#9670;&#160;</a></span>skPathFromGlyph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> pathops.Path fontTools.ttLib.removeOverlaps.skPathFromGlyph </td>
          <td>(</td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>glyphName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a>&#160;</td>
          <td class="paramname"><em>glyphSet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   31</span><span class="keyword">def </span>skPathFromGlyph(glyphName: str, glyphSet: _TTGlyphMapping) -&gt; pathops.Path:</div>
<div class="line"><span class="lineno">   32</span>    path = pathops.Path()</div>
<div class="line"><span class="lineno">   33</span>    pathPen = path.getPen(glyphSet=glyphSet)</div>
<div class="line"><span class="lineno">   34</span>    glyphSet[glyphName].draw(pathPen)</div>
<div class="line"><span class="lineno">   35</span>    <span class="keywordflow">return</span> path</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a41f2b200ceb07b1a28bd01349a717ba4" name="a41f2b200ceb07b1a28bd01349a717ba4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41f2b200ceb07b1a28bd01349a717ba4">&#9670;&#160;</a></span>skPathFromGlyphComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.ttLib.removeOverlaps.skPathFromGlyphComponent </td>
          <td>(</td>
          <td class="paramtype">_g_l_y_f.GlyphComponent&#160;</td>
          <td class="paramname"><em>component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefont_tools_1_1tt_lib_1_1remove_overlaps.html#a266440938b41c78ba30a2c25a00e943d">_TTGlyphMapping</a>
&#160;</td>
          <td class="paramname"><em>glyphSet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   40</span>):</div>
<div class="line"><span class="lineno">   41</span>    baseGlyphName, transformation = component.getComponentInfo()</div>
<div class="line"><span class="lineno">   42</span>    path = skPathFromGlyph(baseGlyphName, glyphSet)</div>
<div class="line"><span class="lineno">   43</span>    <span class="keywordflow">return</span> path.transform(*transformation)</div>
<div class="line"><span class="lineno">   44</span> </div>
<div class="line"><span class="lineno">   45</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a4e36110a454454b253be7abc849ea92e" name="a4e36110a454454b253be7abc849ea92e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e36110a454454b253be7abc849ea92e">&#9670;&#160;</a></span>ttfGlyphFromSkPath()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> _g_l_y_f.Glyph fontTools.ttLib.removeOverlaps.ttfGlyphFromSkPath </td>
          <td>(</td>
          <td class="paramtype">pathops.Path&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   73</span><span class="keyword">def </span>ttfGlyphFromSkPath(path: pathops.Path) -&gt; _g_l_y_f.Glyph:</div>
<div class="line"><span class="lineno">   74</span>    <span class="comment"># Skia paths have no &#39;components&#39;, no need for glyphSet</span></div>
<div class="line"><span class="lineno">   75</span>    ttPen = TTGlyphPen(glyphSet=<span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">   76</span>    path.draw(ttPen)</div>
<div class="line"><span class="lineno">   77</span>    glyph = ttPen.glyph()</div>
<div class="line"><span class="lineno">   78</span>    <span class="keyword">assert</span> <span class="keywordflow">not</span> glyph.isComposite()</div>
<div class="line"><span class="lineno">   79</span>    <span class="comment"># compute glyph.xMin (glyfTable parameter unused for non composites)</span></div>
<div class="line"><span class="lineno">   80</span>    glyph.recalcBounds(glyfTable=<span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">   81</span>    <span class="keywordflow">return</span> glyph</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a266440938b41c78ba30a2c25a00e943d" name="a266440938b41c78ba30a2c25a00e943d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a266440938b41c78ba30a2c25a00e943d">&#9670;&#160;</a></span>_TTGlyphMapping</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.ttLib.removeOverlaps._TTGlyphMapping = Mapping[str, <a class="el" href="classfont_tools_1_1tt_lib_1_1tt_glyph_set_1_1___t_t_glyph.html">ttFont._TTGlyph</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ab2aaa0d930b9aae7e4e8008e92ca94ff" name="ab2aaa0d930b9aae7e4e8008e92ca94ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2aaa0d930b9aae7e4e8008e92ca94ff">&#9670;&#160;</a></span>log</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.ttLib.removeOverlaps.log = logging.getLogger(&quot;fontTools.ttLib.removeOverlaps&quot;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
