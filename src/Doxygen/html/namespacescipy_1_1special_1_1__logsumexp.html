<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: scipy.special._logsumexp Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacescipy.html">scipy</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1special.html">special</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1special_1_1__logsumexp.html">_logsumexp</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">scipy.special._logsumexp Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa47ad843e49f493595379b7c18cd8bfd" id="r_aa47ad843e49f493595379b7c18cd8bfd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1special_1_1__logsumexp.html#aa47ad843e49f493595379b7c18cd8bfd">logsumexp</a> (<a class="el" href="__blas__subroutines_8h.html#a4da0a64c77789ca4c8115aef76120fd2">a</a>, axis=None, b=None, keepdims=False, return_sign=False)</td></tr>
<tr class="separator:aa47ad843e49f493595379b7c18cd8bfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f89d51f7a881ec9ecb760b7133a1e3b" id="r_a0f89d51f7a881ec9ecb760b7133a1e3b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1special_1_1__logsumexp.html#a0f89d51f7a881ec9ecb760b7133a1e3b">softmax</a> (x, axis=None)</td></tr>
<tr class="separator:a0f89d51f7a881ec9ecb760b7133a1e3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad5a77ca3002516553eb64d4f84a945c" id="r_aad5a77ca3002516553eb64d4f84a945c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1special_1_1__logsumexp.html#aad5a77ca3002516553eb64d4f84a945c">log_softmax</a> (x, axis=None)</td></tr>
<tr class="separator:aad5a77ca3002516553eb64d4f84a945c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aad5a77ca3002516553eb64d4f84a945c" name="aad5a77ca3002516553eb64d4f84a945c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad5a77ca3002516553eb64d4f84a945c">&#9670;&#160;</a></span>log_softmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.special._logsumexp.log_softmax </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>axis</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute the logarithm of the softmax function.

In principle::

    log_softmax(x) = log(softmax(x))

but using a more accurate implementation.

Parameters
----------
x : array_like
    Input array.
axis : int or tuple of ints, optional
    Axis to compute values along. Default is None and softmax will be
    computed over the entire array `x`.

Returns
-------
s : ndarray or scalar
    An array with the same shape as `x`. Exponential of the result will
    sum to 1 along the specified axis. If `x` is a scalar, a scalar is
    returned.

Notes
-----
`log_softmax` is more accurate than ``np.log(softmax(x))`` with inputs that
make `softmax` saturate (see examples below).

.. versionadded:: 1.5.0

Examples
--------
&gt;&gt;&gt; from scipy.special import log_softmax
&gt;&gt;&gt; from scipy.special import softmax
&gt;&gt;&gt; np.set_printoptions(precision=5)

&gt;&gt;&gt; x = np.array([1000.0, 1.0])

&gt;&gt;&gt; y = log_softmax(x)
&gt;&gt;&gt; y
array([   0., -999.])

&gt;&gt;&gt; with np.errstate(divide='ignore'):
...   y = np.log(softmax(x))
...
&gt;&gt;&gt; y
array([  0., -inf])</pre> <div class="fragment"><div class="line"><span class="lineno">  226</span><span class="keyword">def </span>log_softmax(x, axis=None):</div>
<div class="line"><span class="lineno">  227</span>    <span class="stringliteral">r&quot;&quot;&quot;Compute the logarithm of the softmax function.</span></div>
<div class="line"><span class="lineno">  228</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  229</span><span class="stringliteral">    In principle::</span></div>
<div class="line"><span class="lineno">  230</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  231</span><span class="stringliteral">        log_softmax(x) = log(softmax(x))</span></div>
<div class="line"><span class="lineno">  232</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  233</span><span class="stringliteral">    but using a more accurate implementation.</span></div>
<div class="line"><span class="lineno">  234</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  235</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  236</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  237</span><span class="stringliteral">    x : array_like</span></div>
<div class="line"><span class="lineno">  238</span><span class="stringliteral">        Input array.</span></div>
<div class="line"><span class="lineno">  239</span><span class="stringliteral">    axis : int or tuple of ints, optional</span></div>
<div class="line"><span class="lineno">  240</span><span class="stringliteral">        Axis to compute values along. Default is None and softmax will be</span></div>
<div class="line"><span class="lineno">  241</span><span class="stringliteral">        computed over the entire array `x`.</span></div>
<div class="line"><span class="lineno">  242</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  243</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  244</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  245</span><span class="stringliteral">    s : ndarray or scalar</span></div>
<div class="line"><span class="lineno">  246</span><span class="stringliteral">        An array with the same shape as `x`. Exponential of the result will</span></div>
<div class="line"><span class="lineno">  247</span><span class="stringliteral">        sum to 1 along the specified axis. If `x` is a scalar, a scalar is</span></div>
<div class="line"><span class="lineno">  248</span><span class="stringliteral">        returned.</span></div>
<div class="line"><span class="lineno">  249</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  250</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">  251</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">  252</span><span class="stringliteral">    `log_softmax` is more accurate than ``np.log(softmax(x))`` with inputs that</span></div>
<div class="line"><span class="lineno">  253</span><span class="stringliteral">    make `softmax` saturate (see examples below).</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral">    .. versionadded:: 1.5.0</span></div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  257</span><span class="stringliteral">    Examples</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral">    --------</span></div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral">    &gt;&gt;&gt; from scipy.special import log_softmax</span></div>
<div class="line"><span class="lineno">  260</span><span class="stringliteral">    &gt;&gt;&gt; from scipy.special import softmax</span></div>
<div class="line"><span class="lineno">  261</span><span class="stringliteral">    &gt;&gt;&gt; np.set_printoptions(precision=5)</span></div>
<div class="line"><span class="lineno">  262</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  263</span><span class="stringliteral">    &gt;&gt;&gt; x = np.array([1000.0, 1.0])</span></div>
<div class="line"><span class="lineno">  264</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  265</span><span class="stringliteral">    &gt;&gt;&gt; y = log_softmax(x)</span></div>
<div class="line"><span class="lineno">  266</span><span class="stringliteral">    &gt;&gt;&gt; y</span></div>
<div class="line"><span class="lineno">  267</span><span class="stringliteral">    array([   0., -999.])</span></div>
<div class="line"><span class="lineno">  268</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  269</span><span class="stringliteral">    &gt;&gt;&gt; with np.errstate(divide=&#39;ignore&#39;):</span></div>
<div class="line"><span class="lineno">  270</span><span class="stringliteral">    ...   y = np.log(softmax(x))</span></div>
<div class="line"><span class="lineno">  271</span><span class="stringliteral">    ...</span></div>
<div class="line"><span class="lineno">  272</span><span class="stringliteral">    &gt;&gt;&gt; y</span></div>
<div class="line"><span class="lineno">  273</span><span class="stringliteral">    array([  0., -inf])</span></div>
<div class="line"><span class="lineno">  274</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  275</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>    x = _asarray_validated(x, check_finite=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>    x_max = np.amax(x, axis=axis, keepdims=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">if</span> x_max.ndim &gt; 0:</div>
<div class="line"><span class="lineno">  282</span>        x_max[~np.isfinite(x_max)] = 0</div>
<div class="line"><span class="lineno">  283</span>    <span class="keywordflow">elif</span> <span class="keywordflow">not</span> np.isfinite(x_max):</div>
<div class="line"><span class="lineno">  284</span>        x_max = 0</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>    tmp = x - x_max</div>
<div class="line"><span class="lineno">  287</span>    exp_tmp = np.exp(tmp)</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>    <span class="comment"># suppress warnings about log of zero</span></div>
<div class="line"><span class="lineno">  290</span>    <span class="keyword">with</span> np.errstate(divide=<span class="stringliteral">&#39;ignore&#39;</span>):</div>
<div class="line"><span class="lineno">  291</span>        s = np.sum(exp_tmp, axis=axis, keepdims=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  292</span>        out = np.log(s)</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>    out = tmp - out</div>
<div class="line"><span class="lineno">  295</span>    <span class="keywordflow">return</span> out</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa47ad843e49f493595379b7c18cd8bfd" name="aa47ad843e49f493595379b7c18cd8bfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa47ad843e49f493595379b7c18cd8bfd">&#9670;&#160;</a></span>logsumexp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.special._logsumexp.logsumexp </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>axis</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>b</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>keepdims</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>return_sign</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute the log of the sum of exponentials of input elements.

Parameters
----------
a : array_like
    Input array.
axis : None or int or tuple of ints, optional
    Axis or axes over which the sum is taken. By default `axis` is None,
    and all elements are summed.

    .. versionadded:: 0.11.0
b : array-like, optional
    Scaling factor for exp(`a`) must be of the same shape as `a` or
    broadcastable to `a`. These values may be negative in order to
    implement subtraction.

    .. versionadded:: 0.12.0
keepdims : bool, optional
    If this is set to True, the axes which are reduced are left in the
    result as dimensions with size one. With this option, the result
    will broadcast correctly against the original array.

    .. versionadded:: 0.15.0
return_sign : bool, optional
    If this is set to True, the result will be a pair containing sign
    information; if False, results that are negative will be returned
    as NaN. Default is False (no sign information).

    .. versionadded:: 0.16.0

Returns
-------
res : ndarray
    The result, ``np.log(np.sum(np.exp(a)))`` calculated in a numerically
    more stable way. If `b` is given then ``np.log(np.sum(b*np.exp(a)))``
    is returned.
sgn : ndarray
    If return_sign is True, this will be an array of floating-point
    numbers matching res and +1, 0, or -1 depending on the sign
    of the result. If False, only one result is returned.

See Also
--------
numpy.logaddexp, numpy.logaddexp2

Notes
-----
NumPy has a logaddexp function which is very similar to `logsumexp`, but
only handles two arguments. `logaddexp.reduce` is similar to this
function, but may be less stable.

Examples
--------
&gt;&gt;&gt; from scipy.special import logsumexp
&gt;&gt;&gt; a = np.arange(10)
&gt;&gt;&gt; logsumexp(a)
9.4586297444267107
&gt;&gt;&gt; np.log(np.sum(np.exp(a)))
9.4586297444267107

With weights

&gt;&gt;&gt; a = np.arange(10)
&gt;&gt;&gt; b = np.arange(10, 0, -1)
&gt;&gt;&gt; logsumexp(a, b=b)
9.9170178533034665
&gt;&gt;&gt; np.log(np.sum(b*np.exp(a)))
9.9170178533034647

Returning a sign flag

&gt;&gt;&gt; logsumexp([1,2],b=[1,-1],return_sign=True)
(1.5413248546129181, -1.0)

Notice that `logsumexp` does not directly support masked arrays. To use it
on a masked array, convert the mask into zero weights:

&gt;&gt;&gt; a = np.ma.array([np.log(2), 2, np.log(3)],
...                  mask=[False, True, False])
&gt;&gt;&gt; b = (~a.mask).astype(int)
&gt;&gt;&gt; logsumexp(a.data, b=b), np.log(5)
1.6094379124341005, 1.6094379124341005</pre> <div class="fragment"><div class="line"><span class="lineno">    7</span><span class="keyword">def </span>logsumexp(a, axis=None, b=None, keepdims=False, return_sign=False):</div>
<div class="line"><span class="lineno">    8</span>    <span class="stringliteral">&quot;&quot;&quot;Compute the log of the sum of exponentials of input elements.</span></div>
<div class="line"><span class="lineno">    9</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   10</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">   11</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">   12</span><span class="stringliteral">    a : array_like</span></div>
<div class="line"><span class="lineno">   13</span><span class="stringliteral">        Input array.</span></div>
<div class="line"><span class="lineno">   14</span><span class="stringliteral">    axis : None or int or tuple of ints, optional</span></div>
<div class="line"><span class="lineno">   15</span><span class="stringliteral">        Axis or axes over which the sum is taken. By default `axis` is None,</span></div>
<div class="line"><span class="lineno">   16</span><span class="stringliteral">        and all elements are summed.</span></div>
<div class="line"><span class="lineno">   17</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   18</span><span class="stringliteral">        .. versionadded:: 0.11.0</span></div>
<div class="line"><span class="lineno">   19</span><span class="stringliteral">    b : array-like, optional</span></div>
<div class="line"><span class="lineno">   20</span><span class="stringliteral">        Scaling factor for exp(`a`) must be of the same shape as `a` or</span></div>
<div class="line"><span class="lineno">   21</span><span class="stringliteral">        broadcastable to `a`. These values may be negative in order to</span></div>
<div class="line"><span class="lineno">   22</span><span class="stringliteral">        implement subtraction.</span></div>
<div class="line"><span class="lineno">   23</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   24</span><span class="stringliteral">        .. versionadded:: 0.12.0</span></div>
<div class="line"><span class="lineno">   25</span><span class="stringliteral">    keepdims : bool, optional</span></div>
<div class="line"><span class="lineno">   26</span><span class="stringliteral">        If this is set to True, the axes which are reduced are left in the</span></div>
<div class="line"><span class="lineno">   27</span><span class="stringliteral">        result as dimensions with size one. With this option, the result</span></div>
<div class="line"><span class="lineno">   28</span><span class="stringliteral">        will broadcast correctly against the original array.</span></div>
<div class="line"><span class="lineno">   29</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   30</span><span class="stringliteral">        .. versionadded:: 0.15.0</span></div>
<div class="line"><span class="lineno">   31</span><span class="stringliteral">    return_sign : bool, optional</span></div>
<div class="line"><span class="lineno">   32</span><span class="stringliteral">        If this is set to True, the result will be a pair containing sign</span></div>
<div class="line"><span class="lineno">   33</span><span class="stringliteral">        information; if False, results that are negative will be returned</span></div>
<div class="line"><span class="lineno">   34</span><span class="stringliteral">        as NaN. Default is False (no sign information).</span></div>
<div class="line"><span class="lineno">   35</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   36</span><span class="stringliteral">        .. versionadded:: 0.16.0</span></div>
<div class="line"><span class="lineno">   37</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">   39</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">    res : ndarray</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral">        The result, ``np.log(np.sum(np.exp(a)))`` calculated in a numerically</span></div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral">        more stable way. If `b` is given then ``np.log(np.sum(b*np.exp(a)))``</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">        is returned.</span></div>
<div class="line"><span class="lineno">   44</span><span class="stringliteral">    sgn : ndarray</span></div>
<div class="line"><span class="lineno">   45</span><span class="stringliteral">        If return_sign is True, this will be an array of floating-point</span></div>
<div class="line"><span class="lineno">   46</span><span class="stringliteral">        numbers matching res and +1, 0, or -1 depending on the sign</span></div>
<div class="line"><span class="lineno">   47</span><span class="stringliteral">        of the result. If False, only one result is returned.</span></div>
<div class="line"><span class="lineno">   48</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   49</span><span class="stringliteral">    See Also</span></div>
<div class="line"><span class="lineno">   50</span><span class="stringliteral">    --------</span></div>
<div class="line"><span class="lineno">   51</span><span class="stringliteral">    numpy.logaddexp, numpy.logaddexp2</span></div>
<div class="line"><span class="lineno">   52</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   53</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">   54</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">   55</span><span class="stringliteral">    NumPy has a logaddexp function which is very similar to `logsumexp`, but</span></div>
<div class="line"><span class="lineno">   56</span><span class="stringliteral">    only handles two arguments. `logaddexp.reduce` is similar to this</span></div>
<div class="line"><span class="lineno">   57</span><span class="stringliteral">    function, but may be less stable.</span></div>
<div class="line"><span class="lineno">   58</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   59</span><span class="stringliteral">    Examples</span></div>
<div class="line"><span class="lineno">   60</span><span class="stringliteral">    --------</span></div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral">    &gt;&gt;&gt; from scipy.special import logsumexp</span></div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">    &gt;&gt;&gt; a = np.arange(10)</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">    &gt;&gt;&gt; logsumexp(a)</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral">    9.4586297444267107</span></div>
<div class="line"><span class="lineno">   65</span><span class="stringliteral">    &gt;&gt;&gt; np.log(np.sum(np.exp(a)))</span></div>
<div class="line"><span class="lineno">   66</span><span class="stringliteral">    9.4586297444267107</span></div>
<div class="line"><span class="lineno">   67</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   68</span><span class="stringliteral">    With weights</span></div>
<div class="line"><span class="lineno">   69</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   70</span><span class="stringliteral">    &gt;&gt;&gt; a = np.arange(10)</span></div>
<div class="line"><span class="lineno">   71</span><span class="stringliteral">    &gt;&gt;&gt; b = np.arange(10, 0, -1)</span></div>
<div class="line"><span class="lineno">   72</span><span class="stringliteral">    &gt;&gt;&gt; logsumexp(a, b=b)</span></div>
<div class="line"><span class="lineno">   73</span><span class="stringliteral">    9.9170178533034665</span></div>
<div class="line"><span class="lineno">   74</span><span class="stringliteral">    &gt;&gt;&gt; np.log(np.sum(b*np.exp(a)))</span></div>
<div class="line"><span class="lineno">   75</span><span class="stringliteral">    9.9170178533034647</span></div>
<div class="line"><span class="lineno">   76</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   77</span><span class="stringliteral">    Returning a sign flag</span></div>
<div class="line"><span class="lineno">   78</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   79</span><span class="stringliteral">    &gt;&gt;&gt; logsumexp([1,2],b=[1,-1],return_sign=True)</span></div>
<div class="line"><span class="lineno">   80</span><span class="stringliteral">    (1.5413248546129181, -1.0)</span></div>
<div class="line"><span class="lineno">   81</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   82</span><span class="stringliteral">    Notice that `logsumexp` does not directly support masked arrays. To use it</span></div>
<div class="line"><span class="lineno">   83</span><span class="stringliteral">    on a masked array, convert the mask into zero weights:</span></div>
<div class="line"><span class="lineno">   84</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   85</span><span class="stringliteral">    &gt;&gt;&gt; a = np.ma.array([np.log(2), 2, np.log(3)],</span></div>
<div class="line"><span class="lineno">   86</span><span class="stringliteral">    ...                  mask=[False, True, False])</span></div>
<div class="line"><span class="lineno">   87</span><span class="stringliteral">    &gt;&gt;&gt; b = (~a.mask).astype(int)</span></div>
<div class="line"><span class="lineno">   88</span><span class="stringliteral">    &gt;&gt;&gt; logsumexp(a.data, b=b), np.log(5)</span></div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral">    1.6094379124341005, 1.6094379124341005</span></div>
<div class="line"><span class="lineno">   90</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   91</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   92</span>    a = _asarray_validated(a, check_finite=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">   93</span>    <span class="keywordflow">if</span> b <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   94</span>        a, b = np.broadcast_arrays(a, b)</div>
<div class="line"><span class="lineno">   95</span>        <span class="keywordflow">if</span> np.any(b == 0):</div>
<div class="line"><span class="lineno">   96</span>            a = a + 0.  <span class="comment"># promote to at least float</span></div>
<div class="line"><span class="lineno">   97</span>            a[b == 0] = -np.inf</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>    a_max = np.amax(a, axis=axis, keepdims=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>    <span class="keywordflow">if</span> a_max.ndim &gt; 0:</div>
<div class="line"><span class="lineno">  102</span>        a_max[~np.isfinite(a_max)] = 0</div>
<div class="line"><span class="lineno">  103</span>    <span class="keywordflow">elif</span> <span class="keywordflow">not</span> np.isfinite(a_max):</div>
<div class="line"><span class="lineno">  104</span>        a_max = 0</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span>    <span class="keywordflow">if</span> b <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  107</span>        b = np.asarray(b)</div>
<div class="line"><span class="lineno">  108</span>        tmp = b * np.exp(a - a_max)</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  110</span>        tmp = np.exp(a - a_max)</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>    <span class="comment"># suppress warnings about log of zero</span></div>
<div class="line"><span class="lineno">  113</span>    <span class="keyword">with</span> np.errstate(divide=<span class="stringliteral">&#39;ignore&#39;</span>):</div>
<div class="line"><span class="lineno">  114</span>        s = np.sum(tmp, axis=axis, keepdims=keepdims)</div>
<div class="line"><span class="lineno">  115</span>        <span class="keywordflow">if</span> return_sign:</div>
<div class="line"><span class="lineno">  116</span>            sgn = np.sign(s)</div>
<div class="line"><span class="lineno">  117</span>            s *= sgn  <span class="comment"># /= makes more sense but we need zero -&gt; zero</span></div>
<div class="line"><span class="lineno">  118</span>        out = np.log(s)</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> keepdims:</div>
<div class="line"><span class="lineno">  121</span>        a_max = np.squeeze(a_max, axis=axis)</div>
<div class="line"><span class="lineno">  122</span>    out += a_max</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">if</span> return_sign:</div>
<div class="line"><span class="lineno">  125</span>        <span class="keywordflow">return</span> out, sgn</div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  127</span>        <span class="keywordflow">return</span> out</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0f89d51f7a881ec9ecb760b7133a1e3b" name="a0f89d51f7a881ec9ecb760b7133a1e3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f89d51f7a881ec9ecb760b7133a1e3b">&#9670;&#160;</a></span>softmax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.special._logsumexp.softmax </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>axis</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute the softmax function.

The softmax function transforms each element of a collection by
computing the exponential of each element divided by the sum of the
exponentials of all the elements. That is, if `x` is a one-dimensional
numpy array::

    softmax(x) = np.exp(x)/sum(np.exp(x))

Parameters
----------
x : array_like
    Input array.
axis : int or tuple of ints, optional
    Axis to compute values along. Default is None and softmax will be
    computed over the entire array `x`.

Returns
-------
s : ndarray
    An array the same shape as `x`. The result will sum to 1 along the
    specified axis.

Notes
-----
The formula for the softmax function :math:`\sigma(x)` for a vector
:math:`x = \{x_0, x_1, ..., x_{n-1}\}` is

.. math:: \sigma(x)_j = \frac{e^{x_j}}{\sum_k e^{x_k}}

The `softmax` function is the gradient of `logsumexp`.

The implementation uses shifting to avoid overflow. See [1]_ for more
details.

.. versionadded:: 1.2.0

References
----------
.. [1] P. Blanchard, D.J. Higham, N.J. Higham, "Accurately computing the
   log-sum-exp and softmax functions", IMA Journal of Numerical Analysis,
   Vol.41(4), :doi:`10.1093/imanum/draa038`.

Examples
--------
&gt;&gt;&gt; from scipy.special import softmax
&gt;&gt;&gt; np.set_printoptions(precision=5)

&gt;&gt;&gt; x = np.array([[1, 0.5, 0.2, 3],
...               [1,  -1,   7, 3],
...               [2,  12,  13, 3]])
...

Compute the softmax transformation over the entire array.

&gt;&gt;&gt; m = softmax(x)
&gt;&gt;&gt; m
array([[  4.48309e-06,   2.71913e-06,   2.01438e-06,   3.31258e-05],
       [  4.48309e-06,   6.06720e-07,   1.80861e-03,   3.31258e-05],
       [  1.21863e-05,   2.68421e-01,   7.29644e-01,   3.31258e-05]])

&gt;&gt;&gt; m.sum()
1.0

Compute the softmax transformation along the first axis (i.e., the
columns).

&gt;&gt;&gt; m = softmax(x, axis=0)

&gt;&gt;&gt; m
array([[  2.11942e-01,   1.01300e-05,   2.75394e-06,   3.33333e-01],
       [  2.11942e-01,   2.26030e-06,   2.47262e-03,   3.33333e-01],
       [  5.76117e-01,   9.99988e-01,   9.97525e-01,   3.33333e-01]])

&gt;&gt;&gt; m.sum(axis=0)
array([ 1.,  1.,  1.,  1.])

Compute the softmax transformation along the second axis (i.e., the rows).

&gt;&gt;&gt; m = softmax(x, axis=1)
&gt;&gt;&gt; m
array([[  1.05877e-01,   6.42177e-02,   4.75736e-02,   7.82332e-01],
       [  2.42746e-03,   3.28521e-04,   9.79307e-01,   1.79366e-02],
       [  1.22094e-05,   2.68929e-01,   7.31025e-01,   3.31885e-05]])

&gt;&gt;&gt; m.sum(axis=1)
array([ 1.,  1.,  1.])</pre> <div class="fragment"><div class="line"><span class="lineno">  130</span><span class="keyword">def </span>softmax(x, axis=None):</div>
<div class="line"><span class="lineno">  131</span>    <span class="stringliteral">r&quot;&quot;&quot;Compute the softmax function.</span></div>
<div class="line"><span class="lineno">  132</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  133</span><span class="stringliteral">    The softmax function transforms each element of a collection by</span></div>
<div class="line"><span class="lineno">  134</span><span class="stringliteral">    computing the exponential of each element divided by the sum of the</span></div>
<div class="line"><span class="lineno">  135</span><span class="stringliteral">    exponentials of all the elements. That is, if `x` is a one-dimensional</span></div>
<div class="line"><span class="lineno">  136</span><span class="stringliteral">    numpy array::</span></div>
<div class="line"><span class="lineno">  137</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  138</span><span class="stringliteral">        softmax(x) = np.exp(x)/sum(np.exp(x))</span></div>
<div class="line"><span class="lineno">  139</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  140</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  141</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  142</span><span class="stringliteral">    x : array_like</span></div>
<div class="line"><span class="lineno">  143</span><span class="stringliteral">        Input array.</span></div>
<div class="line"><span class="lineno">  144</span><span class="stringliteral">    axis : int or tuple of ints, optional</span></div>
<div class="line"><span class="lineno">  145</span><span class="stringliteral">        Axis to compute values along. Default is None and softmax will be</span></div>
<div class="line"><span class="lineno">  146</span><span class="stringliteral">        computed over the entire array `x`.</span></div>
<div class="line"><span class="lineno">  147</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  148</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  149</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  150</span><span class="stringliteral">    s : ndarray</span></div>
<div class="line"><span class="lineno">  151</span><span class="stringliteral">        An array the same shape as `x`. The result will sum to 1 along the</span></div>
<div class="line"><span class="lineno">  152</span><span class="stringliteral">        specified axis.</span></div>
<div class="line"><span class="lineno">  153</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  154</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">  155</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">  156</span><span class="stringliteral">    The formula for the softmax function :math:`\sigma(x)` for a vector</span></div>
<div class="line"><span class="lineno">  157</span><span class="stringliteral">    :math:`x = \{x_0, x_1, ..., x_{n-1}\}` is</span></div>
<div class="line"><span class="lineno">  158</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  159</span><span class="stringliteral">    .. math:: \sigma(x)_j = \frac{e^{x_j}}{\sum_k e^{x_k}}</span></div>
<div class="line"><span class="lineno">  160</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  161</span><span class="stringliteral">    The `softmax` function is the gradient of `logsumexp`.</span></div>
<div class="line"><span class="lineno">  162</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  163</span><span class="stringliteral">    The implementation uses shifting to avoid overflow. See [1]_ for more</span></div>
<div class="line"><span class="lineno">  164</span><span class="stringliteral">    details.</span></div>
<div class="line"><span class="lineno">  165</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  166</span><span class="stringliteral">    .. versionadded:: 1.2.0</span></div>
<div class="line"><span class="lineno">  167</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  168</span><span class="stringliteral">    References</span></div>
<div class="line"><span class="lineno">  169</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  170</span><span class="stringliteral">    .. [1] P. Blanchard, D.J. Higham, N.J. Higham, &quot;Accurately computing the</span></div>
<div class="line"><span class="lineno">  171</span><span class="stringliteral">       log-sum-exp and softmax functions&quot;, IMA Journal of Numerical Analysis,</span></div>
<div class="line"><span class="lineno">  172</span><span class="stringliteral">       Vol.41(4), :doi:`10.1093/imanum/draa038`.</span></div>
<div class="line"><span class="lineno">  173</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  174</span><span class="stringliteral">    Examples</span></div>
<div class="line"><span class="lineno">  175</span><span class="stringliteral">    --------</span></div>
<div class="line"><span class="lineno">  176</span><span class="stringliteral">    &gt;&gt;&gt; from scipy.special import softmax</span></div>
<div class="line"><span class="lineno">  177</span><span class="stringliteral">    &gt;&gt;&gt; np.set_printoptions(precision=5)</span></div>
<div class="line"><span class="lineno">  178</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  179</span><span class="stringliteral">    &gt;&gt;&gt; x = np.array([[1, 0.5, 0.2, 3],</span></div>
<div class="line"><span class="lineno">  180</span><span class="stringliteral">    ...               [1,  -1,   7, 3],</span></div>
<div class="line"><span class="lineno">  181</span><span class="stringliteral">    ...               [2,  12,  13, 3]])</span></div>
<div class="line"><span class="lineno">  182</span><span class="stringliteral">    ...</span></div>
<div class="line"><span class="lineno">  183</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  184</span><span class="stringliteral">    Compute the softmax transformation over the entire array.</span></div>
<div class="line"><span class="lineno">  185</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  186</span><span class="stringliteral">    &gt;&gt;&gt; m = softmax(x)</span></div>
<div class="line"><span class="lineno">  187</span><span class="stringliteral">    &gt;&gt;&gt; m</span></div>
<div class="line"><span class="lineno">  188</span><span class="stringliteral">    array([[  4.48309e-06,   2.71913e-06,   2.01438e-06,   3.31258e-05],</span></div>
<div class="line"><span class="lineno">  189</span><span class="stringliteral">           [  4.48309e-06,   6.06720e-07,   1.80861e-03,   3.31258e-05],</span></div>
<div class="line"><span class="lineno">  190</span><span class="stringliteral">           [  1.21863e-05,   2.68421e-01,   7.29644e-01,   3.31258e-05]])</span></div>
<div class="line"><span class="lineno">  191</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  192</span><span class="stringliteral">    &gt;&gt;&gt; m.sum()</span></div>
<div class="line"><span class="lineno">  193</span><span class="stringliteral">    1.0</span></div>
<div class="line"><span class="lineno">  194</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  195</span><span class="stringliteral">    Compute the softmax transformation along the first axis (i.e., the</span></div>
<div class="line"><span class="lineno">  196</span><span class="stringliteral">    columns).</span></div>
<div class="line"><span class="lineno">  197</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  198</span><span class="stringliteral">    &gt;&gt;&gt; m = softmax(x, axis=0)</span></div>
<div class="line"><span class="lineno">  199</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  200</span><span class="stringliteral">    &gt;&gt;&gt; m</span></div>
<div class="line"><span class="lineno">  201</span><span class="stringliteral">    array([[  2.11942e-01,   1.01300e-05,   2.75394e-06,   3.33333e-01],</span></div>
<div class="line"><span class="lineno">  202</span><span class="stringliteral">           [  2.11942e-01,   2.26030e-06,   2.47262e-03,   3.33333e-01],</span></div>
<div class="line"><span class="lineno">  203</span><span class="stringliteral">           [  5.76117e-01,   9.99988e-01,   9.97525e-01,   3.33333e-01]])</span></div>
<div class="line"><span class="lineno">  204</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  205</span><span class="stringliteral">    &gt;&gt;&gt; m.sum(axis=0)</span></div>
<div class="line"><span class="lineno">  206</span><span class="stringliteral">    array([ 1.,  1.,  1.,  1.])</span></div>
<div class="line"><span class="lineno">  207</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  208</span><span class="stringliteral">    Compute the softmax transformation along the second axis (i.e., the rows).</span></div>
<div class="line"><span class="lineno">  209</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  210</span><span class="stringliteral">    &gt;&gt;&gt; m = softmax(x, axis=1)</span></div>
<div class="line"><span class="lineno">  211</span><span class="stringliteral">    &gt;&gt;&gt; m</span></div>
<div class="line"><span class="lineno">  212</span><span class="stringliteral">    array([[  1.05877e-01,   6.42177e-02,   4.75736e-02,   7.82332e-01],</span></div>
<div class="line"><span class="lineno">  213</span><span class="stringliteral">           [  2.42746e-03,   3.28521e-04,   9.79307e-01,   1.79366e-02],</span></div>
<div class="line"><span class="lineno">  214</span><span class="stringliteral">           [  1.22094e-05,   2.68929e-01,   7.31025e-01,   3.31885e-05]])</span></div>
<div class="line"><span class="lineno">  215</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  216</span><span class="stringliteral">    &gt;&gt;&gt; m.sum(axis=1)</span></div>
<div class="line"><span class="lineno">  217</span><span class="stringliteral">    array([ 1.,  1.,  1.])</span></div>
<div class="line"><span class="lineno">  218</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  219</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  220</span>    x = _asarray_validated(x, check_finite=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">  221</span>    x_max = np.amax(x, axis=axis, keepdims=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  222</span>    exp_x_shifted = np.exp(x - x_max)</div>
<div class="line"><span class="lineno">  223</span>    <span class="keywordflow">return</span> exp_x_shifted / np.sum(exp_x_shifted, axis=axis, keepdims=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span> </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
