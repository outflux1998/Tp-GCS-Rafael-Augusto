<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: scipy.sparse.linalg._isolve.lsqr Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacescipy.html">scipy</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse.html">sparse</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg.html">linalg</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__isolve.html">_isolve</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__isolve_1_1lsqr.html">lsqr</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">scipy.sparse.linalg._isolve.lsqr Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a038735e1e37d80eb81a9dcaeae522cab" id="r_a038735e1e37d80eb81a9dcaeae522cab"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__isolve_1_1lsqr.html#a038735e1e37d80eb81a9dcaeae522cab">_sym_ortho</a> (<a class="el" href="__blas__subroutines_8h.html#a4da0a64c77789ca4c8115aef76120fd2">a</a>, b)</td></tr>
<tr class="separator:a038735e1e37d80eb81a9dcaeae522cab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fb27e8fdde4c4a9ede5ad3375080cb0" id="r_a9fb27e8fdde4c4a9ede5ad3375080cb0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__isolve_1_1lsqr.html#a9fb27e8fdde4c4a9ede5ad3375080cb0">lsqr</a> (A, b, damp=0.0, atol=1e-6, btol=1e-6, conlim=1e8, iter_lim=None, show=False, calc_var=False, x0=None)</td></tr>
<tr class="separator:a9fb27e8fdde4c4a9ede5ad3375080cb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a68eed99b5fda58e0adb1c32745ad2382" id="r_a68eed99b5fda58e0adb1c32745ad2382"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__isolve_1_1lsqr.html#a68eed99b5fda58e0adb1c32745ad2382">eps</a> = np.finfo(np.float64).eps</td></tr>
<tr class="separator:a68eed99b5fda58e0adb1c32745ad2382"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Sparse Equations and Least Squares.

The original Fortran code was written by C. C. Paige and M. A. Saunders as
described in

C. C. Paige and M. A. Saunders, LSQR: An algorithm for sparse linear
equations and sparse least squares, TOMS 8(1), 43--71 (1982).

C. C. Paige and M. A. Saunders, Algorithm 583; LSQR: Sparse linear
equations and least-squares problems, TOMS 8(2), 195--209 (1982).

It is licensed under the following BSD license:

Copyright (c) 2006, Systems Optimization Laboratory
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.

    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials provided
      with the distribution.

    * Neither the name of Stanford University nor the names of its
      contributors may be used to endorse or promote products derived
      from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

The Fortran code was translated to Python for use in CVXOPT by Jeffery
Kline with contributions by Mridul Aanjaneya and Bob Myhill.

Adapted for SciPy by Stefan van der Walt.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a038735e1e37d80eb81a9dcaeae522cab" name="a038735e1e37d80eb81a9dcaeae522cab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a038735e1e37d80eb81a9dcaeae522cab">&#9670;&#160;</a></span>_sym_ortho()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._isolve.lsqr._sym_ortho </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Stable implementation of Givens rotation.

Notes
-----
The routine 'SymOrtho' was added for numerical stability. This is
recommended by S.-C. Choi in [1]_.  It removes the unpleasant potential of
``1/eps`` in some important places (see, for example text following
"Compute the next plane rotation Qk" in minres.py).

References
----------
.. [1] S.-C. Choi, "Iterative Methods for Singular Linear Equations
       and Least-Squares Problems", Dissertation,
       http://www.stanford.edu/group/SOL/dissertations/sou-cheng-choi-thesis.pdf</pre> <div class="fragment"><div class="line"><span class="lineno">   61</span><span class="keyword">def </span>_sym_ortho(a, b):</div>
<div class="line"><span class="lineno">   62</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">    Stable implementation of Givens rotation.</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   65</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">   66</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">   67</span><span class="stringliteral">    The routine &#39;SymOrtho&#39; was added for numerical stability. This is</span></div>
<div class="line"><span class="lineno">   68</span><span class="stringliteral">    recommended by S.-C. Choi in [1]_.  It removes the unpleasant potential of</span></div>
<div class="line"><span class="lineno">   69</span><span class="stringliteral">    ``1/eps`` in some important places (see, for example text following</span></div>
<div class="line"><span class="lineno">   70</span><span class="stringliteral">    &quot;Compute the next plane rotation Qk&quot; in minres.py).</span></div>
<div class="line"><span class="lineno">   71</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   72</span><span class="stringliteral">    References</span></div>
<div class="line"><span class="lineno">   73</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">   74</span><span class="stringliteral">    .. [1] S.-C. Choi, &quot;Iterative Methods for Singular Linear Equations</span></div>
<div class="line"><span class="lineno">   75</span><span class="stringliteral">           and Least-Squares Problems&quot;, Dissertation,</span></div>
<div class="line"><span class="lineno">   76</span><span class="stringliteral">           http://www.stanford.edu/group/SOL/dissertations/sou-cheng-choi-thesis.pdf</span></div>
<div class="line"><span class="lineno">   77</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   78</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   79</span>    <span class="keywordflow">if</span> b == 0:</div>
<div class="line"><span class="lineno">   80</span>        <span class="keywordflow">return</span> np.sign(a), 0, abs(a)</div>
<div class="line"><span class="lineno">   81</span>    <span class="keywordflow">elif</span> a == 0:</div>
<div class="line"><span class="lineno">   82</span>        <span class="keywordflow">return</span> 0, np.sign(b), abs(b)</div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">elif</span> abs(b) &gt; abs(a):</div>
<div class="line"><span class="lineno">   84</span>        tau = a / b</div>
<div class="line"><span class="lineno">   85</span>        s = np.sign(b) / sqrt(1 + tau * tau)</div>
<div class="line"><span class="lineno">   86</span>        c = s * tau</div>
<div class="line"><span class="lineno">   87</span>        r = b / s</div>
<div class="line"><span class="lineno">   88</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   89</span>        tau = b / a</div>
<div class="line"><span class="lineno">   90</span>        c = np.sign(a) / sqrt(1+tau*tau)</div>
<div class="line"><span class="lineno">   91</span>        s = c * tau</div>
<div class="line"><span class="lineno">   92</span>        r = a / c</div>
<div class="line"><span class="lineno">   93</span>    <span class="keywordflow">return</span> c, s, r</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a9fb27e8fdde4c4a9ede5ad3375080cb0" name="a9fb27e8fdde4c4a9ede5ad3375080cb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fb27e8fdde4c4a9ede5ad3375080cb0">&#9670;&#160;</a></span>lsqr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._isolve.lsqr.lsqr </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>damp</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>atol</em> = <code>1e-6</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>btol</em> = <code>1e-6</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>conlim</em> = <code>1e8</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iter_lim</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>show</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>calc_var</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x0</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Find the least-squares solution to a large, sparse, linear system
of equations.

The function solves ``Ax = b``  or  ``min ||Ax - b||^2`` or
``min ||Ax - b||^2 + d^2 ||x - x0||^2``.

The matrix A may be square or rectangular (over-determined or
under-determined), and may have any rank.

::

  1. Unsymmetric equations --    solve  Ax = b

  2. Linear least squares  --    solve  Ax = b
                                 in the least-squares sense

  3. Damped least squares  --    solve  (   A    )*x = (    b    )
                                        ( damp*I )     ( damp*x0 )
                                 in the least-squares sense

Parameters
----------
A : {sparse matrix, ndarray, LinearOperator}
    Representation of an m-by-n matrix.
    Alternatively, ``A`` can be a linear operator which can
    produce ``Ax`` and ``A^T x`` using, e.g.,
    ``scipy.sparse.linalg.LinearOperator``.
b : array_like, shape (m,)
    Right-hand side vector ``b``.
damp : float
    Damping coefficient. Default is 0.
atol, btol : float, optional
    Stopping tolerances. `lsqr` continues iterations until a
    certain backward error estimate is smaller than some quantity
    depending on atol and btol.  Let ``r = b - Ax`` be the
    residual vector for the current approximate solution ``x``.
    If ``Ax = b`` seems to be consistent, `lsqr` terminates
    when ``norm(r) &lt;= atol * norm(A) * norm(x) + btol * norm(b)``.
    Otherwise, `lsqr` terminates when ``norm(A^H r) &lt;=
    atol * norm(A) * norm(r)``.  If both tolerances are 1.0e-6 (default),
    the final ``norm(r)`` should be accurate to about 6
    digits. (The final ``x`` will usually have fewer correct digits,
    depending on ``cond(A)`` and the size of LAMBDA.)  If `atol`
    or `btol` is None, a default value of 1.0e-6 will be used.
    Ideally, they should be estimates of the relative error in the
    entries of ``A`` and ``b`` respectively.  For example, if the entries
    of ``A`` have 7 correct digits, set ``atol = 1e-7``. This prevents
    the algorithm from doing unnecessary work beyond the
    uncertainty of the input data.
conlim : float, optional
    Another stopping tolerance.  lsqr terminates if an estimate of
    ``cond(A)`` exceeds `conlim`.  For compatible systems ``Ax =
    b``, `conlim` could be as large as 1.0e+12 (say).  For
    least-squares problems, conlim should be less than 1.0e+8.
    Maximum precision can be obtained by setting ``atol = btol =
    conlim = zero``, but the number of iterations may then be
    excessive. Default is 1e8.
iter_lim : int, optional
    Explicit limitation on number of iterations (for safety).
show : bool, optional
    Display an iteration log. Default is False.
calc_var : bool, optional
    Whether to estimate diagonals of ``(A'A + damp^2*I)^{-1}``.
x0 : array_like, shape (n,), optional
    Initial guess of x, if None zeros are used. Default is None.

    .. versionadded:: 1.0.0

Returns
-------
x : ndarray of float
    The final solution.
istop : int
    Gives the reason for termination.
    1 means x is an approximate solution to Ax = b.
    2 means x approximately solves the least-squares problem.
itn : int
    Iteration number upon termination.
r1norm : float
    ``norm(r)``, where ``r = b - Ax``.
r2norm : float
    ``sqrt( norm(r)^2  +  damp^2 * norm(x - x0)^2 )``.  Equal to `r1norm`
    if ``damp == 0``.
anorm : float
    Estimate of Frobenius norm of ``Abar = [[A]; [damp*I]]``.
acond : float
    Estimate of ``cond(Abar)``.
arnorm : float
    Estimate of ``norm(A'@r - damp^2*(x - x0))``.
xnorm : float
    ``norm(x)``
var : ndarray of float
    If ``calc_var`` is True, estimates all diagonals of
    ``(A'A)^{-1}`` (if ``damp == 0``) or more generally ``(A'A +
    damp^2*I)^{-1}``.  This is well defined if A has full column
    rank or ``damp &gt; 0``.  (Not sure what var means if ``rank(A)
    &lt; n`` and ``damp = 0.``)

Notes
-----
LSQR uses an iterative method to approximate the solution.  The
number of iterations required to reach a certain accuracy depends
strongly on the scaling of the problem.  Poor scaling of the rows
or columns of A should therefore be avoided where possible.

For example, in problem 1 the solution is unaltered by
row-scaling.  If a row of A is very small or large compared to
the other rows of A, the corresponding row of ( A  b ) should be
scaled up or down.

In problems 1 and 2, the solution x is easily recovered
following column-scaling.  Unless better information is known,
the nonzero columns of A should be scaled so that they all have
the same Euclidean norm (e.g., 1.0).

In problem 3, there is no freedom to re-scale if damp is
nonzero.  However, the value of damp should be assigned only
after attention has been paid to the scaling of A.

The parameter damp is intended to help regularize
ill-conditioned systems, by preventing the true solution from
being very large.  Another aid to regularization is provided by
the parameter acond, which may be used to terminate iterations
before the computed solution becomes very large.

If some initial estimate ``x0`` is known and if ``damp == 0``,
one could proceed as follows:

  1. Compute a residual vector ``r0 = b - A@x0``.
  2. Use LSQR to solve the system  ``A@dx = r0``.
  3. Add the correction dx to obtain a final solution ``x = x0 + dx``.

This requires that ``x0`` be available before and after the call
to LSQR.  To judge the benefits, suppose LSQR takes k1 iterations
to solve A@x = b and k2 iterations to solve A@dx = r0.
If x0 is "good", norm(r0) will be smaller than norm(b).
If the same stopping tolerances atol and btol are used for each
system, k1 and k2 will be similar, but the final solution x0 + dx
should be more accurate.  The only way to reduce the total work
is to use a larger stopping tolerance for the second system.
If some value btol is suitable for A@x = b, the larger value
btol*norm(b)/norm(r0)  should be suitable for A@dx = r0.

Preconditioning is another way to reduce the number of iterations.
If it is possible to solve a related system ``M@x = b``
efficiently, where M approximates A in some helpful way (e.g. M -
A has low rank or its elements are small relative to those of A),
LSQR may converge more rapidly on the system ``A@M(inverse)@z =
b``, after which x can be recovered by solving M@x = z.

If A is symmetric, LSQR should not be used!

Alternatives are the symmetric conjugate-gradient method (cg)
and/or SYMMLQ.  SYMMLQ is an implementation of symmetric cg that
applies to any symmetric A and will converge more rapidly than
LSQR.  If A is positive definite, there are other implementations
of symmetric cg that require slightly less work per iteration than
SYMMLQ (but will take the same number of iterations).

References
----------
.. [1] C. C. Paige and M. A. Saunders (1982a).
       "LSQR: An algorithm for sparse linear equations and
       sparse least squares", ACM TOMS 8(1), 43-71.
.. [2] C. C. Paige and M. A. Saunders (1982b).
       "Algorithm 583.  LSQR: Sparse linear equations and least
       squares problems", ACM TOMS 8(2), 195-209.
.. [3] M. A. Saunders (1995).  "Solution of sparse rectangular
       systems using LSQR and CRAIG", BIT 35, 588-604.

Examples
--------
&gt;&gt;&gt; from scipy.sparse import csc_matrix
&gt;&gt;&gt; from scipy.sparse.linalg import lsqr
&gt;&gt;&gt; A = csc_matrix([[1., 0.], [1., 1.], [0., 1.]], dtype=float)

The first example has the trivial solution ``[0, 0]``

&gt;&gt;&gt; b = np.array([0., 0., 0.], dtype=float)
&gt;&gt;&gt; x, istop, itn, normr = lsqr(A, b)[:4]
&gt;&gt;&gt; istop
0
&gt;&gt;&gt; x
array([ 0.,  0.])

The stopping code `istop=0` returned indicates that a vector of zeros was
found as a solution. The returned solution `x` indeed contains
``[0., 0.]``. The next example has a non-trivial solution:

&gt;&gt;&gt; b = np.array([1., 0., -1.], dtype=float)
&gt;&gt;&gt; x, istop, itn, r1norm = lsqr(A, b)[:4]
&gt;&gt;&gt; istop
1
&gt;&gt;&gt; x
array([ 1., -1.])
&gt;&gt;&gt; itn
1
&gt;&gt;&gt; r1norm
4.440892098500627e-16

As indicated by `istop=1`, `lsqr` found a solution obeying the tolerance
limits. The given solution ``[1., -1.]`` obviously solves the equation. The
remaining return values include information about the number of iterations
(`itn=1`) and the remaining difference of left and right side of the solved
equation.
The final example demonstrates the behavior in the case where there is no
solution for the equation:

&gt;&gt;&gt; b = np.array([1., 0.01, -1.], dtype=float)
&gt;&gt;&gt; x, istop, itn, r1norm = lsqr(A, b)[:4]
&gt;&gt;&gt; istop
2
&gt;&gt;&gt; x
array([ 1.00333333, -0.99666667])
&gt;&gt;&gt; A.dot(x)-b
array([ 0.00333333, -0.00333333,  0.00333333])
&gt;&gt;&gt; r1norm
0.005773502691896255

`istop` indicates that the system is inconsistent and thus `x` is rather an
approximate solution to the corresponding least-squares problem. `r1norm`
contains the norm of the minimal residual that was found.
</pre> <div class="fragment"><div class="line"><span class="lineno">   97</span>         iter_lim=<span class="keywordtype">None</span>, show=<span class="keyword">False</span>, calc_var=<span class="keyword">False</span>, x0=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">   98</span>    <span class="stringliteral">&quot;&quot;&quot;Find the least-squares solution to a large, sparse, linear system</span></div>
<div class="line"><span class="lineno">   99</span><span class="stringliteral">    of equations.</span></div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral">    The function solves ``Ax = b``  or  ``min ||Ax - b||^2`` or</span></div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">    ``min ||Ax - b||^2 + d^2 ||x - x0||^2``.</span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">    The matrix A may be square or rectangular (over-determined or</span></div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">    under-determined), and may have any rank.</span></div>
<div class="line"><span class="lineno">  106</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  107</span><span class="stringliteral">    ::</span></div>
<div class="line"><span class="lineno">  108</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  109</span><span class="stringliteral">      1. Unsymmetric equations --    solve  Ax = b</span></div>
<div class="line"><span class="lineno">  110</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  111</span><span class="stringliteral">      2. Linear least squares  --    solve  Ax = b</span></div>
<div class="line"><span class="lineno">  112</span><span class="stringliteral">                                     in the least-squares sense</span></div>
<div class="line"><span class="lineno">  113</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  114</span><span class="stringliteral">      3. Damped least squares  --    solve  (   A    )*x = (    b    )</span></div>
<div class="line"><span class="lineno">  115</span><span class="stringliteral">                                            ( damp*I )     ( damp*x0 )</span></div>
<div class="line"><span class="lineno">  116</span><span class="stringliteral">                                     in the least-squares sense</span></div>
<div class="line"><span class="lineno">  117</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  118</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  119</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  120</span><span class="stringliteral">    A : {sparse matrix, ndarray, LinearOperator}</span></div>
<div class="line"><span class="lineno">  121</span><span class="stringliteral">        Representation of an m-by-n matrix.</span></div>
<div class="line"><span class="lineno">  122</span><span class="stringliteral">        Alternatively, ``A`` can be a linear operator which can</span></div>
<div class="line"><span class="lineno">  123</span><span class="stringliteral">        produce ``Ax`` and ``A^T x`` using, e.g.,</span></div>
<div class="line"><span class="lineno">  124</span><span class="stringliteral">        ``scipy.sparse.linalg.LinearOperator``.</span></div>
<div class="line"><span class="lineno">  125</span><span class="stringliteral">    b : array_like, shape (m,)</span></div>
<div class="line"><span class="lineno">  126</span><span class="stringliteral">        Right-hand side vector ``b``.</span></div>
<div class="line"><span class="lineno">  127</span><span class="stringliteral">    damp : float</span></div>
<div class="line"><span class="lineno">  128</span><span class="stringliteral">        Damping coefficient. Default is 0.</span></div>
<div class="line"><span class="lineno">  129</span><span class="stringliteral">    atol, btol : float, optional</span></div>
<div class="line"><span class="lineno">  130</span><span class="stringliteral">        Stopping tolerances. `lsqr` continues iterations until a</span></div>
<div class="line"><span class="lineno">  131</span><span class="stringliteral">        certain backward error estimate is smaller than some quantity</span></div>
<div class="line"><span class="lineno">  132</span><span class="stringliteral">        depending on atol and btol.  Let ``r = b - Ax`` be the</span></div>
<div class="line"><span class="lineno">  133</span><span class="stringliteral">        residual vector for the current approximate solution ``x``.</span></div>
<div class="line"><span class="lineno">  134</span><span class="stringliteral">        If ``Ax = b`` seems to be consistent, `lsqr` terminates</span></div>
<div class="line"><span class="lineno">  135</span><span class="stringliteral">        when ``norm(r) &lt;= atol * norm(A) * norm(x) + btol * norm(b)``.</span></div>
<div class="line"><span class="lineno">  136</span><span class="stringliteral">        Otherwise, `lsqr` terminates when ``norm(A^H r) &lt;=</span></div>
<div class="line"><span class="lineno">  137</span><span class="stringliteral">        atol * norm(A) * norm(r)``.  If both tolerances are 1.0e-6 (default),</span></div>
<div class="line"><span class="lineno">  138</span><span class="stringliteral">        the final ``norm(r)`` should be accurate to about 6</span></div>
<div class="line"><span class="lineno">  139</span><span class="stringliteral">        digits. (The final ``x`` will usually have fewer correct digits,</span></div>
<div class="line"><span class="lineno">  140</span><span class="stringliteral">        depending on ``cond(A)`` and the size of LAMBDA.)  If `atol`</span></div>
<div class="line"><span class="lineno">  141</span><span class="stringliteral">        or `btol` is None, a default value of 1.0e-6 will be used.</span></div>
<div class="line"><span class="lineno">  142</span><span class="stringliteral">        Ideally, they should be estimates of the relative error in the</span></div>
<div class="line"><span class="lineno">  143</span><span class="stringliteral">        entries of ``A`` and ``b`` respectively.  For example, if the entries</span></div>
<div class="line"><span class="lineno">  144</span><span class="stringliteral">        of ``A`` have 7 correct digits, set ``atol = 1e-7``. This prevents</span></div>
<div class="line"><span class="lineno">  145</span><span class="stringliteral">        the algorithm from doing unnecessary work beyond the</span></div>
<div class="line"><span class="lineno">  146</span><span class="stringliteral">        uncertainty of the input data.</span></div>
<div class="line"><span class="lineno">  147</span><span class="stringliteral">    conlim : float, optional</span></div>
<div class="line"><span class="lineno">  148</span><span class="stringliteral">        Another stopping tolerance.  lsqr terminates if an estimate of</span></div>
<div class="line"><span class="lineno">  149</span><span class="stringliteral">        ``cond(A)`` exceeds `conlim`.  For compatible systems ``Ax =</span></div>
<div class="line"><span class="lineno">  150</span><span class="stringliteral">        b``, `conlim` could be as large as 1.0e+12 (say).  For</span></div>
<div class="line"><span class="lineno">  151</span><span class="stringliteral">        least-squares problems, conlim should be less than 1.0e+8.</span></div>
<div class="line"><span class="lineno">  152</span><span class="stringliteral">        Maximum precision can be obtained by setting ``atol = btol =</span></div>
<div class="line"><span class="lineno">  153</span><span class="stringliteral">        conlim = zero``, but the number of iterations may then be</span></div>
<div class="line"><span class="lineno">  154</span><span class="stringliteral">        excessive. Default is 1e8.</span></div>
<div class="line"><span class="lineno">  155</span><span class="stringliteral">    iter_lim : int, optional</span></div>
<div class="line"><span class="lineno">  156</span><span class="stringliteral">        Explicit limitation on number of iterations (for safety).</span></div>
<div class="line"><span class="lineno">  157</span><span class="stringliteral">    show : bool, optional</span></div>
<div class="line"><span class="lineno">  158</span><span class="stringliteral">        Display an iteration log. Default is False.</span></div>
<div class="line"><span class="lineno">  159</span><span class="stringliteral">    calc_var : bool, optional</span></div>
<div class="line"><span class="lineno">  160</span><span class="stringliteral">        Whether to estimate diagonals of ``(A&#39;A + damp^2*I)^{-1}``.</span></div>
<div class="line"><span class="lineno">  161</span><span class="stringliteral">    x0 : array_like, shape (n,), optional</span></div>
<div class="line"><span class="lineno">  162</span><span class="stringliteral">        Initial guess of x, if None zeros are used. Default is None.</span></div>
<div class="line"><span class="lineno">  163</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  164</span><span class="stringliteral">        .. versionadded:: 1.0.0</span></div>
<div class="line"><span class="lineno">  165</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  166</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  167</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  168</span><span class="stringliteral">    x : ndarray of float</span></div>
<div class="line"><span class="lineno">  169</span><span class="stringliteral">        The final solution.</span></div>
<div class="line"><span class="lineno">  170</span><span class="stringliteral">    istop : int</span></div>
<div class="line"><span class="lineno">  171</span><span class="stringliteral">        Gives the reason for termination.</span></div>
<div class="line"><span class="lineno">  172</span><span class="stringliteral">        1 means x is an approximate solution to Ax = b.</span></div>
<div class="line"><span class="lineno">  173</span><span class="stringliteral">        2 means x approximately solves the least-squares problem.</span></div>
<div class="line"><span class="lineno">  174</span><span class="stringliteral">    itn : int</span></div>
<div class="line"><span class="lineno">  175</span><span class="stringliteral">        Iteration number upon termination.</span></div>
<div class="line"><span class="lineno">  176</span><span class="stringliteral">    r1norm : float</span></div>
<div class="line"><span class="lineno">  177</span><span class="stringliteral">        ``norm(r)``, where ``r = b - Ax``.</span></div>
<div class="line"><span class="lineno">  178</span><span class="stringliteral">    r2norm : float</span></div>
<div class="line"><span class="lineno">  179</span><span class="stringliteral">        ``sqrt( norm(r)^2  +  damp^2 * norm(x - x0)^2 )``.  Equal to `r1norm`</span></div>
<div class="line"><span class="lineno">  180</span><span class="stringliteral">        if ``damp == 0``.</span></div>
<div class="line"><span class="lineno">  181</span><span class="stringliteral">    anorm : float</span></div>
<div class="line"><span class="lineno">  182</span><span class="stringliteral">        Estimate of Frobenius norm of ``Abar = [[A]; [damp*I]]``.</span></div>
<div class="line"><span class="lineno">  183</span><span class="stringliteral">    acond : float</span></div>
<div class="line"><span class="lineno">  184</span><span class="stringliteral">        Estimate of ``cond(Abar)``.</span></div>
<div class="line"><span class="lineno">  185</span><span class="stringliteral">    arnorm : float</span></div>
<div class="line"><span class="lineno">  186</span><span class="stringliteral">        Estimate of ``norm(A&#39;@r - damp^2*(x - x0))``.</span></div>
<div class="line"><span class="lineno">  187</span><span class="stringliteral">    xnorm : float</span></div>
<div class="line"><span class="lineno">  188</span><span class="stringliteral">        ``norm(x)``</span></div>
<div class="line"><span class="lineno">  189</span><span class="stringliteral">    var : ndarray of float</span></div>
<div class="line"><span class="lineno">  190</span><span class="stringliteral">        If ``calc_var`` is True, estimates all diagonals of</span></div>
<div class="line"><span class="lineno">  191</span><span class="stringliteral">        ``(A&#39;A)^{-1}`` (if ``damp == 0``) or more generally ``(A&#39;A +</span></div>
<div class="line"><span class="lineno">  192</span><span class="stringliteral">        damp^2*I)^{-1}``.  This is well defined if A has full column</span></div>
<div class="line"><span class="lineno">  193</span><span class="stringliteral">        rank or ``damp &gt; 0``.  (Not sure what var means if ``rank(A)</span></div>
<div class="line"><span class="lineno">  194</span><span class="stringliteral">        &lt; n`` and ``damp = 0.``)</span></div>
<div class="line"><span class="lineno">  195</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  196</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">  197</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">  198</span><span class="stringliteral">    LSQR uses an iterative method to approximate the solution.  The</span></div>
<div class="line"><span class="lineno">  199</span><span class="stringliteral">    number of iterations required to reach a certain accuracy depends</span></div>
<div class="line"><span class="lineno">  200</span><span class="stringliteral">    strongly on the scaling of the problem.  Poor scaling of the rows</span></div>
<div class="line"><span class="lineno">  201</span><span class="stringliteral">    or columns of A should therefore be avoided where possible.</span></div>
<div class="line"><span class="lineno">  202</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  203</span><span class="stringliteral">    For example, in problem 1 the solution is unaltered by</span></div>
<div class="line"><span class="lineno">  204</span><span class="stringliteral">    row-scaling.  If a row of A is very small or large compared to</span></div>
<div class="line"><span class="lineno">  205</span><span class="stringliteral">    the other rows of A, the corresponding row of ( A  b ) should be</span></div>
<div class="line"><span class="lineno">  206</span><span class="stringliteral">    scaled up or down.</span></div>
<div class="line"><span class="lineno">  207</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  208</span><span class="stringliteral">    In problems 1 and 2, the solution x is easily recovered</span></div>
<div class="line"><span class="lineno">  209</span><span class="stringliteral">    following column-scaling.  Unless better information is known,</span></div>
<div class="line"><span class="lineno">  210</span><span class="stringliteral">    the nonzero columns of A should be scaled so that they all have</span></div>
<div class="line"><span class="lineno">  211</span><span class="stringliteral">    the same Euclidean norm (e.g., 1.0).</span></div>
<div class="line"><span class="lineno">  212</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  213</span><span class="stringliteral">    In problem 3, there is no freedom to re-scale if damp is</span></div>
<div class="line"><span class="lineno">  214</span><span class="stringliteral">    nonzero.  However, the value of damp should be assigned only</span></div>
<div class="line"><span class="lineno">  215</span><span class="stringliteral">    after attention has been paid to the scaling of A.</span></div>
<div class="line"><span class="lineno">  216</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  217</span><span class="stringliteral">    The parameter damp is intended to help regularize</span></div>
<div class="line"><span class="lineno">  218</span><span class="stringliteral">    ill-conditioned systems, by preventing the true solution from</span></div>
<div class="line"><span class="lineno">  219</span><span class="stringliteral">    being very large.  Another aid to regularization is provided by</span></div>
<div class="line"><span class="lineno">  220</span><span class="stringliteral">    the parameter acond, which may be used to terminate iterations</span></div>
<div class="line"><span class="lineno">  221</span><span class="stringliteral">    before the computed solution becomes very large.</span></div>
<div class="line"><span class="lineno">  222</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  223</span><span class="stringliteral">    If some initial estimate ``x0`` is known and if ``damp == 0``,</span></div>
<div class="line"><span class="lineno">  224</span><span class="stringliteral">    one could proceed as follows:</span></div>
<div class="line"><span class="lineno">  225</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  226</span><span class="stringliteral">      1. Compute a residual vector ``r0 = b - A@x0``.</span></div>
<div class="line"><span class="lineno">  227</span><span class="stringliteral">      2. Use LSQR to solve the system  ``A@dx = r0``.</span></div>
<div class="line"><span class="lineno">  228</span><span class="stringliteral">      3. Add the correction dx to obtain a final solution ``x = x0 + dx``.</span></div>
<div class="line"><span class="lineno">  229</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  230</span><span class="stringliteral">    This requires that ``x0`` be available before and after the call</span></div>
<div class="line"><span class="lineno">  231</span><span class="stringliteral">    to LSQR.  To judge the benefits, suppose LSQR takes k1 iterations</span></div>
<div class="line"><span class="lineno">  232</span><span class="stringliteral">    to solve A@x = b and k2 iterations to solve A@dx = r0.</span></div>
<div class="line"><span class="lineno">  233</span><span class="stringliteral">    If x0 is &quot;good&quot;, norm(r0) will be smaller than norm(b).</span></div>
<div class="line"><span class="lineno">  234</span><span class="stringliteral">    If the same stopping tolerances atol and btol are used for each</span></div>
<div class="line"><span class="lineno">  235</span><span class="stringliteral">    system, k1 and k2 will be similar, but the final solution x0 + dx</span></div>
<div class="line"><span class="lineno">  236</span><span class="stringliteral">    should be more accurate.  The only way to reduce the total work</span></div>
<div class="line"><span class="lineno">  237</span><span class="stringliteral">    is to use a larger stopping tolerance for the second system.</span></div>
<div class="line"><span class="lineno">  238</span><span class="stringliteral">    If some value btol is suitable for A@x = b, the larger value</span></div>
<div class="line"><span class="lineno">  239</span><span class="stringliteral">    btol*norm(b)/norm(r0)  should be suitable for A@dx = r0.</span></div>
<div class="line"><span class="lineno">  240</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  241</span><span class="stringliteral">    Preconditioning is another way to reduce the number of iterations.</span></div>
<div class="line"><span class="lineno">  242</span><span class="stringliteral">    If it is possible to solve a related system ``M@x = b``</span></div>
<div class="line"><span class="lineno">  243</span><span class="stringliteral">    efficiently, where M approximates A in some helpful way (e.g. M -</span></div>
<div class="line"><span class="lineno">  244</span><span class="stringliteral">    A has low rank or its elements are small relative to those of A),</span></div>
<div class="line"><span class="lineno">  245</span><span class="stringliteral">    LSQR may converge more rapidly on the system ``A@M(inverse)@z =</span></div>
<div class="line"><span class="lineno">  246</span><span class="stringliteral">    b``, after which x can be recovered by solving M@x = z.</span></div>
<div class="line"><span class="lineno">  247</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  248</span><span class="stringliteral">    If A is symmetric, LSQR should not be used!</span></div>
<div class="line"><span class="lineno">  249</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  250</span><span class="stringliteral">    Alternatives are the symmetric conjugate-gradient method (cg)</span></div>
<div class="line"><span class="lineno">  251</span><span class="stringliteral">    and/or SYMMLQ.  SYMMLQ is an implementation of symmetric cg that</span></div>
<div class="line"><span class="lineno">  252</span><span class="stringliteral">    applies to any symmetric A and will converge more rapidly than</span></div>
<div class="line"><span class="lineno">  253</span><span class="stringliteral">    LSQR.  If A is positive definite, there are other implementations</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">    of symmetric cg that require slightly less work per iteration than</span></div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral">    SYMMLQ (but will take the same number of iterations).</span></div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  257</span><span class="stringliteral">    References</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral">    .. [1] C. C. Paige and M. A. Saunders (1982a).</span></div>
<div class="line"><span class="lineno">  260</span><span class="stringliteral">           &quot;LSQR: An algorithm for sparse linear equations and</span></div>
<div class="line"><span class="lineno">  261</span><span class="stringliteral">           sparse least squares&quot;, ACM TOMS 8(1), 43-71.</span></div>
<div class="line"><span class="lineno">  262</span><span class="stringliteral">    .. [2] C. C. Paige and M. A. Saunders (1982b).</span></div>
<div class="line"><span class="lineno">  263</span><span class="stringliteral">           &quot;Algorithm 583.  LSQR: Sparse linear equations and least</span></div>
<div class="line"><span class="lineno">  264</span><span class="stringliteral">           squares problems&quot;, ACM TOMS 8(2), 195-209.</span></div>
<div class="line"><span class="lineno">  265</span><span class="stringliteral">    .. [3] M. A. Saunders (1995).  &quot;Solution of sparse rectangular</span></div>
<div class="line"><span class="lineno">  266</span><span class="stringliteral">           systems using LSQR and CRAIG&quot;, BIT 35, 588-604.</span></div>
<div class="line"><span class="lineno">  267</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  268</span><span class="stringliteral">    Examples</span></div>
<div class="line"><span class="lineno">  269</span><span class="stringliteral">    --------</span></div>
<div class="line"><span class="lineno">  270</span><span class="stringliteral">    &gt;&gt;&gt; from scipy.sparse import csc_matrix</span></div>
<div class="line"><span class="lineno">  271</span><span class="stringliteral">    &gt;&gt;&gt; from scipy.sparse.linalg import lsqr</span></div>
<div class="line"><span class="lineno">  272</span><span class="stringliteral">    &gt;&gt;&gt; A = csc_matrix([[1., 0.], [1., 1.], [0., 1.]], dtype=float)</span></div>
<div class="line"><span class="lineno">  273</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  274</span><span class="stringliteral">    The first example has the trivial solution ``[0, 0]``</span></div>
<div class="line"><span class="lineno">  275</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  276</span><span class="stringliteral">    &gt;&gt;&gt; b = np.array([0., 0., 0.], dtype=float)</span></div>
<div class="line"><span class="lineno">  277</span><span class="stringliteral">    &gt;&gt;&gt; x, istop, itn, normr = lsqr(A, b)[:4]</span></div>
<div class="line"><span class="lineno">  278</span><span class="stringliteral">    &gt;&gt;&gt; istop</span></div>
<div class="line"><span class="lineno">  279</span><span class="stringliteral">    0</span></div>
<div class="line"><span class="lineno">  280</span><span class="stringliteral">    &gt;&gt;&gt; x</span></div>
<div class="line"><span class="lineno">  281</span><span class="stringliteral">    array([ 0.,  0.])</span></div>
<div class="line"><span class="lineno">  282</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  283</span><span class="stringliteral">    The stopping code `istop=0` returned indicates that a vector of zeros was</span></div>
<div class="line"><span class="lineno">  284</span><span class="stringliteral">    found as a solution. The returned solution `x` indeed contains</span></div>
<div class="line"><span class="lineno">  285</span><span class="stringliteral">    ``[0., 0.]``. The next example has a non-trivial solution:</span></div>
<div class="line"><span class="lineno">  286</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  287</span><span class="stringliteral">    &gt;&gt;&gt; b = np.array([1., 0., -1.], dtype=float)</span></div>
<div class="line"><span class="lineno">  288</span><span class="stringliteral">    &gt;&gt;&gt; x, istop, itn, r1norm = lsqr(A, b)[:4]</span></div>
<div class="line"><span class="lineno">  289</span><span class="stringliteral">    &gt;&gt;&gt; istop</span></div>
<div class="line"><span class="lineno">  290</span><span class="stringliteral">    1</span></div>
<div class="line"><span class="lineno">  291</span><span class="stringliteral">    &gt;&gt;&gt; x</span></div>
<div class="line"><span class="lineno">  292</span><span class="stringliteral">    array([ 1., -1.])</span></div>
<div class="line"><span class="lineno">  293</span><span class="stringliteral">    &gt;&gt;&gt; itn</span></div>
<div class="line"><span class="lineno">  294</span><span class="stringliteral">    1</span></div>
<div class="line"><span class="lineno">  295</span><span class="stringliteral">    &gt;&gt;&gt; r1norm</span></div>
<div class="line"><span class="lineno">  296</span><span class="stringliteral">    4.440892098500627e-16</span></div>
<div class="line"><span class="lineno">  297</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  298</span><span class="stringliteral">    As indicated by `istop=1`, `lsqr` found a solution obeying the tolerance</span></div>
<div class="line"><span class="lineno">  299</span><span class="stringliteral">    limits. The given solution ``[1., -1.]`` obviously solves the equation. The</span></div>
<div class="line"><span class="lineno">  300</span><span class="stringliteral">    remaining return values include information about the number of iterations</span></div>
<div class="line"><span class="lineno">  301</span><span class="stringliteral">    (`itn=1`) and the remaining difference of left and right side of the solved</span></div>
<div class="line"><span class="lineno">  302</span><span class="stringliteral">    equation.</span></div>
<div class="line"><span class="lineno">  303</span><span class="stringliteral">    The final example demonstrates the behavior in the case where there is no</span></div>
<div class="line"><span class="lineno">  304</span><span class="stringliteral">    solution for the equation:</span></div>
<div class="line"><span class="lineno">  305</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  306</span><span class="stringliteral">    &gt;&gt;&gt; b = np.array([1., 0.01, -1.], dtype=float)</span></div>
<div class="line"><span class="lineno">  307</span><span class="stringliteral">    &gt;&gt;&gt; x, istop, itn, r1norm = lsqr(A, b)[:4]</span></div>
<div class="line"><span class="lineno">  308</span><span class="stringliteral">    &gt;&gt;&gt; istop</span></div>
<div class="line"><span class="lineno">  309</span><span class="stringliteral">    2</span></div>
<div class="line"><span class="lineno">  310</span><span class="stringliteral">    &gt;&gt;&gt; x</span></div>
<div class="line"><span class="lineno">  311</span><span class="stringliteral">    array([ 1.00333333, -0.99666667])</span></div>
<div class="line"><span class="lineno">  312</span><span class="stringliteral">    &gt;&gt;&gt; A.dot(x)-b</span></div>
<div class="line"><span class="lineno">  313</span><span class="stringliteral">    array([ 0.00333333, -0.00333333,  0.00333333])</span></div>
<div class="line"><span class="lineno">  314</span><span class="stringliteral">    &gt;&gt;&gt; r1norm</span></div>
<div class="line"><span class="lineno">  315</span><span class="stringliteral">    0.005773502691896255</span></div>
<div class="line"><span class="lineno">  316</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  317</span><span class="stringliteral">    `istop` indicates that the system is inconsistent and thus `x` is rather an</span></div>
<div class="line"><span class="lineno">  318</span><span class="stringliteral">    approximate solution to the corresponding least-squares problem. `r1norm`</span></div>
<div class="line"><span class="lineno">  319</span><span class="stringliteral">    contains the norm of the minimal residual that was found.</span></div>
<div class="line"><span class="lineno">  320</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  321</span>    A = aslinearoperator(A)</div>
<div class="line"><span class="lineno">  322</span>    b = np.atleast_1d(b)</div>
<div class="line"><span class="lineno">  323</span>    <span class="keywordflow">if</span> b.ndim &gt; 1:</div>
<div class="line"><span class="lineno">  324</span>        b = b.squeeze()</div>
<div class="line"><span class="lineno">  325</span> </div>
<div class="line"><span class="lineno">  326</span>    m, n = A.shape</div>
<div class="line"><span class="lineno">  327</span>    <span class="keywordflow">if</span> iter_lim <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  328</span>        iter_lim = 2 * n</div>
<div class="line"><span class="lineno">  329</span>    var = np.zeros(n)</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>    msg = (<span class="stringliteral">&#39;The exact solution is  x = 0                              &#39;</span>,</div>
<div class="line"><span class="lineno">  332</span>           <span class="stringliteral">&#39;Ax - b is small enough, given atol, btol                  &#39;</span>,</div>
<div class="line"><span class="lineno">  333</span>           <span class="stringliteral">&#39;The least-squares solution is good enough, given atol     &#39;</span>,</div>
<div class="line"><span class="lineno">  334</span>           <span class="stringliteral">&#39;The estimate of cond(Abar) has exceeded conlim            &#39;</span>,</div>
<div class="line"><span class="lineno">  335</span>           <span class="stringliteral">&#39;Ax - b is small enough for this machine                   &#39;</span>,</div>
<div class="line"><span class="lineno">  336</span>           <span class="stringliteral">&#39;The least-squares solution is good enough for this machine&#39;</span>,</div>
<div class="line"><span class="lineno">  337</span>           <span class="stringliteral">&#39;Cond(Abar) seems to be too large for this machine         &#39;</span>,</div>
<div class="line"><span class="lineno">  338</span>           <span class="stringliteral">&#39;The iteration limit has been reached                      &#39;</span>)</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>    <span class="keywordflow">if</span> show:</div>
<div class="line"><span class="lineno">  341</span>        print(<span class="stringliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  342</span>        print(<span class="stringliteral">&#39;LSQR            Least-squares solution of  Ax = b&#39;</span>)</div>
<div class="line"><span class="lineno">  343</span>        str1 = f<span class="stringliteral">&#39;The matrix A has {m} rows and {n} columns&#39;</span></div>
<div class="line"><span class="lineno">  344</span>        str2 = <span class="stringliteral">&#39;damp = %20.14e   calc_var = %8g&#39;</span> % (damp, calc_var)</div>
<div class="line"><span class="lineno">  345</span>        str3 = <span class="stringliteral">&#39;atol = %8.2e                 conlim = %8.2e&#39;</span> % (atol, conlim)</div>
<div class="line"><span class="lineno">  346</span>        str4 = <span class="stringliteral">&#39;btol = %8.2e               iter_lim = %8g&#39;</span> % (btol, iter_lim)</div>
<div class="line"><span class="lineno">  347</span>        print(str1)</div>
<div class="line"><span class="lineno">  348</span>        print(str2)</div>
<div class="line"><span class="lineno">  349</span>        print(str3)</div>
<div class="line"><span class="lineno">  350</span>        print(str4)</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>    itn = 0</div>
<div class="line"><span class="lineno">  353</span>    istop = 0</div>
<div class="line"><span class="lineno">  354</span>    ctol = 0</div>
<div class="line"><span class="lineno">  355</span>    <span class="keywordflow">if</span> conlim &gt; 0:</div>
<div class="line"><span class="lineno">  356</span>        ctol = 1/conlim</div>
<div class="line"><span class="lineno">  357</span>    anorm = 0</div>
<div class="line"><span class="lineno">  358</span>    acond = 0</div>
<div class="line"><span class="lineno">  359</span>    dampsq = damp**2</div>
<div class="line"><span class="lineno">  360</span>    ddnorm = 0</div>
<div class="line"><span class="lineno">  361</span>    res2 = 0</div>
<div class="line"><span class="lineno">  362</span>    xnorm = 0</div>
<div class="line"><span class="lineno">  363</span>    xxnorm = 0</div>
<div class="line"><span class="lineno">  364</span>    z = 0</div>
<div class="line"><span class="lineno">  365</span>    cs2 = -1</div>
<div class="line"><span class="lineno">  366</span>    sn2 = 0</div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>    <span class="comment"># Set up the first vectors u and v for the bidiagonalization.</span></div>
<div class="line"><span class="lineno">  369</span>    <span class="comment"># These satisfy  beta*u = b - A@x,  alfa*v = A&#39;@u.</span></div>
<div class="line"><span class="lineno">  370</span>    u = b</div>
<div class="line"><span class="lineno">  371</span>    bnorm = np.linalg.norm(b)</div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span>    <span class="keywordflow">if</span> x0 <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  374</span>        x = np.zeros(n)</div>
<div class="line"><span class="lineno">  375</span>        beta = bnorm.copy()</div>
<div class="line"><span class="lineno">  376</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  377</span>        x = np.asarray(x0)</div>
<div class="line"><span class="lineno">  378</span>        u = u - A.matvec(x)</div>
<div class="line"><span class="lineno">  379</span>        beta = np.linalg.norm(u)</div>
<div class="line"><span class="lineno">  380</span> </div>
<div class="line"><span class="lineno">  381</span>    <span class="keywordflow">if</span> beta &gt; 0:</div>
<div class="line"><span class="lineno">  382</span>        u = (1/beta) * u</div>
<div class="line"><span class="lineno">  383</span>        v = A.rmatvec(u)</div>
<div class="line"><span class="lineno">  384</span>        alfa = np.linalg.norm(v)</div>
<div class="line"><span class="lineno">  385</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  386</span>        v = x.copy()</div>
<div class="line"><span class="lineno">  387</span>        alfa = 0</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>    <span class="keywordflow">if</span> alfa &gt; 0:</div>
<div class="line"><span class="lineno">  390</span>        v = (1/alfa) * v</div>
<div class="line"><span class="lineno">  391</span>    w = v.copy()</div>
<div class="line"><span class="lineno">  392</span> </div>
<div class="line"><span class="lineno">  393</span>    rhobar = alfa</div>
<div class="line"><span class="lineno">  394</span>    phibar = beta</div>
<div class="line"><span class="lineno">  395</span>    rnorm = beta</div>
<div class="line"><span class="lineno">  396</span>    r1norm = rnorm</div>
<div class="line"><span class="lineno">  397</span>    r2norm = rnorm</div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>    <span class="comment"># Reverse the order here from the original matlab code because</span></div>
<div class="line"><span class="lineno">  400</span>    <span class="comment"># there was an error on return when arnorm==0</span></div>
<div class="line"><span class="lineno">  401</span>    arnorm = alfa * beta</div>
<div class="line"><span class="lineno">  402</span>    <span class="keywordflow">if</span> arnorm == 0:</div>
<div class="line"><span class="lineno">  403</span>        <span class="keywordflow">if</span> show:</div>
<div class="line"><span class="lineno">  404</span>            print(msg[0])</div>
<div class="line"><span class="lineno">  405</span>        <span class="keywordflow">return</span> x, istop, itn, r1norm, r2norm, anorm, acond, arnorm, xnorm, var</div>
<div class="line"><span class="lineno">  406</span> </div>
<div class="line"><span class="lineno">  407</span>    head1 = <span class="stringliteral">&#39;   Itn      x[0]       r1norm     r2norm &#39;</span></div>
<div class="line"><span class="lineno">  408</span>    head2 = <span class="stringliteral">&#39; Compatible    LS      Norm A   Cond A&#39;</span></div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>    <span class="keywordflow">if</span> show:</div>
<div class="line"><span class="lineno">  411</span>        print(<span class="stringliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  412</span>        print(head1, head2)</div>
<div class="line"><span class="lineno">  413</span>        test1 = 1</div>
<div class="line"><span class="lineno">  414</span>        test2 = alfa / beta</div>
<div class="line"><span class="lineno">  415</span>        str1 = <span class="stringliteral">&#39;%6g %12.5e&#39;</span> % (itn, x[0])</div>
<div class="line"><span class="lineno">  416</span>        str2 = <span class="stringliteral">&#39; %10.3e %10.3e&#39;</span> % (r1norm, r2norm)</div>
<div class="line"><span class="lineno">  417</span>        str3 = <span class="stringliteral">&#39;  %8.1e %8.1e&#39;</span> % (test1, test2)</div>
<div class="line"><span class="lineno">  418</span>        print(str1, str2, str3)</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>    <span class="comment"># Main iteration loop.</span></div>
<div class="line"><span class="lineno">  421</span>    <span class="keywordflow">while</span> itn &lt; iter_lim:</div>
<div class="line"><span class="lineno">  422</span>        itn = itn + 1</div>
<div class="line"><span class="lineno">  423</span>        <span class="comment"># Perform the next step of the bidiagonalization to obtain the</span></div>
<div class="line"><span class="lineno">  424</span>        <span class="comment"># next  beta, u, alfa, v. These satisfy the relations</span></div>
<div class="line"><span class="lineno">  425</span>        <span class="comment">#     beta*u  =  a@v   -  alfa*u,</span></div>
<div class="line"><span class="lineno">  426</span>        <span class="comment">#     alfa*v  =  A&#39;@u  -  beta*v.</span></div>
<div class="line"><span class="lineno">  427</span>        u = A.matvec(v) - alfa * u</div>
<div class="line"><span class="lineno">  428</span>        beta = np.linalg.norm(u)</div>
<div class="line"><span class="lineno">  429</span> </div>
<div class="line"><span class="lineno">  430</span>        <span class="keywordflow">if</span> beta &gt; 0:</div>
<div class="line"><span class="lineno">  431</span>            u = (1/beta) * u</div>
<div class="line"><span class="lineno">  432</span>            anorm = sqrt(anorm**2 + alfa**2 + beta**2 + dampsq)</div>
<div class="line"><span class="lineno">  433</span>            v = A.rmatvec(u) - beta * v</div>
<div class="line"><span class="lineno">  434</span>            alfa = np.linalg.norm(v)</div>
<div class="line"><span class="lineno">  435</span>            <span class="keywordflow">if</span> alfa &gt; 0:</div>
<div class="line"><span class="lineno">  436</span>                v = (1 / alfa) * v</div>
<div class="line"><span class="lineno">  437</span> </div>
<div class="line"><span class="lineno">  438</span>        <span class="comment"># Use a plane rotation to eliminate the damping parameter.</span></div>
<div class="line"><span class="lineno">  439</span>        <span class="comment"># This alters the diagonal (rhobar) of the lower-bidiagonal matrix.</span></div>
<div class="line"><span class="lineno">  440</span>        <span class="keywordflow">if</span> damp &gt; 0:</div>
<div class="line"><span class="lineno">  441</span>            rhobar1 = sqrt(rhobar**2 + dampsq)</div>
<div class="line"><span class="lineno">  442</span>            cs1 = rhobar / rhobar1</div>
<div class="line"><span class="lineno">  443</span>            sn1 = damp / rhobar1</div>
<div class="line"><span class="lineno">  444</span>            psi = sn1 * phibar</div>
<div class="line"><span class="lineno">  445</span>            phibar = cs1 * phibar</div>
<div class="line"><span class="lineno">  446</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  447</span>            <span class="comment"># cs1 = 1 and sn1 = 0</span></div>
<div class="line"><span class="lineno">  448</span>            rhobar1 = rhobar</div>
<div class="line"><span class="lineno">  449</span>            psi = 0.</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>        <span class="comment"># Use a plane rotation to eliminate the subdiagonal element (beta)</span></div>
<div class="line"><span class="lineno">  452</span>        <span class="comment"># of the lower-bidiagonal matrix, giving an upper-bidiagonal matrix.</span></div>
<div class="line"><span class="lineno">  453</span>        cs, sn, rho = _sym_ortho(rhobar1, beta)</div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>        theta = sn * alfa</div>
<div class="line"><span class="lineno">  456</span>        rhobar = -cs * alfa</div>
<div class="line"><span class="lineno">  457</span>        phi = cs * phibar</div>
<div class="line"><span class="lineno">  458</span>        phibar = sn * phibar</div>
<div class="line"><span class="lineno">  459</span>        tau = sn * phi</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>        <span class="comment"># Update x and w.</span></div>
<div class="line"><span class="lineno">  462</span>        t1 = phi / rho</div>
<div class="line"><span class="lineno">  463</span>        t2 = -theta / rho</div>
<div class="line"><span class="lineno">  464</span>        dk = (1 / rho) * w</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>        x = x + t1 * w</div>
<div class="line"><span class="lineno">  467</span>        w = v + t2 * w</div>
<div class="line"><span class="lineno">  468</span>        ddnorm = ddnorm + np.linalg.norm(dk)**2</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>        <span class="keywordflow">if</span> calc_var:</div>
<div class="line"><span class="lineno">  471</span>            var = var + dk**2</div>
<div class="line"><span class="lineno">  472</span> </div>
<div class="line"><span class="lineno">  473</span>        <span class="comment"># Use a plane rotation on the right to eliminate the</span></div>
<div class="line"><span class="lineno">  474</span>        <span class="comment"># super-diagonal element (theta) of the upper-bidiagonal matrix.</span></div>
<div class="line"><span class="lineno">  475</span>        <span class="comment"># Then use the result to estimate norm(x).</span></div>
<div class="line"><span class="lineno">  476</span>        delta = sn2 * rho</div>
<div class="line"><span class="lineno">  477</span>        gambar = -cs2 * rho</div>
<div class="line"><span class="lineno">  478</span>        rhs = phi - delta * z</div>
<div class="line"><span class="lineno">  479</span>        zbar = rhs / gambar</div>
<div class="line"><span class="lineno">  480</span>        xnorm = sqrt(xxnorm + zbar**2)</div>
<div class="line"><span class="lineno">  481</span>        gamma = sqrt(gambar**2 + theta**2)</div>
<div class="line"><span class="lineno">  482</span>        cs2 = gambar / gamma</div>
<div class="line"><span class="lineno">  483</span>        sn2 = theta / gamma</div>
<div class="line"><span class="lineno">  484</span>        z = rhs / gamma</div>
<div class="line"><span class="lineno">  485</span>        xxnorm = xxnorm + z**2</div>
<div class="line"><span class="lineno">  486</span> </div>
<div class="line"><span class="lineno">  487</span>        <span class="comment"># Test for convergence.</span></div>
<div class="line"><span class="lineno">  488</span>        <span class="comment"># First, estimate the condition of the matrix  Abar,</span></div>
<div class="line"><span class="lineno">  489</span>        <span class="comment"># and the norms of  rbar  and  Abar&#39;rbar.</span></div>
<div class="line"><span class="lineno">  490</span>        acond = anorm * sqrt(ddnorm)</div>
<div class="line"><span class="lineno">  491</span>        res1 = phibar**2</div>
<div class="line"><span class="lineno">  492</span>        res2 = res2 + psi**2</div>
<div class="line"><span class="lineno">  493</span>        rnorm = sqrt(res1 + res2)</div>
<div class="line"><span class="lineno">  494</span>        arnorm = alfa * abs(tau)</div>
<div class="line"><span class="lineno">  495</span> </div>
<div class="line"><span class="lineno">  496</span>        <span class="comment"># Distinguish between</span></div>
<div class="line"><span class="lineno">  497</span>        <span class="comment">#    r1norm = ||b - Ax|| and</span></div>
<div class="line"><span class="lineno">  498</span>        <span class="comment">#    r2norm = rnorm in current code</span></div>
<div class="line"><span class="lineno">  499</span>        <span class="comment">#           = sqrt(r1norm^2 + damp^2*||x - x0||^2).</span></div>
<div class="line"><span class="lineno">  500</span>        <span class="comment">#    Estimate r1norm from</span></div>
<div class="line"><span class="lineno">  501</span>        <span class="comment">#    r1norm = sqrt(r2norm^2 - damp^2*||x - x0||^2).</span></div>
<div class="line"><span class="lineno">  502</span>        <span class="comment"># Although there is cancellation, it might be accurate enough.</span></div>
<div class="line"><span class="lineno">  503</span>        <span class="keywordflow">if</span> damp &gt; 0:</div>
<div class="line"><span class="lineno">  504</span>            r1sq = rnorm**2 - dampsq * xxnorm</div>
<div class="line"><span class="lineno">  505</span>            r1norm = sqrt(abs(r1sq))</div>
<div class="line"><span class="lineno">  506</span>            <span class="keywordflow">if</span> r1sq &lt; 0:</div>
<div class="line"><span class="lineno">  507</span>                r1norm = -r1norm</div>
<div class="line"><span class="lineno">  508</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  509</span>            r1norm = rnorm</div>
<div class="line"><span class="lineno">  510</span>        r2norm = rnorm</div>
<div class="line"><span class="lineno">  511</span> </div>
<div class="line"><span class="lineno">  512</span>        <span class="comment"># Now use these norms to estimate certain other quantities,</span></div>
<div class="line"><span class="lineno">  513</span>        <span class="comment"># some of which will be small near a solution.</span></div>
<div class="line"><span class="lineno">  514</span>        test1 = rnorm / bnorm</div>
<div class="line"><span class="lineno">  515</span>        test2 = arnorm / (anorm * rnorm + eps)</div>
<div class="line"><span class="lineno">  516</span>        test3 = 1 / (acond + eps)</div>
<div class="line"><span class="lineno">  517</span>        t1 = test1 / (1 + anorm * xnorm / bnorm)</div>
<div class="line"><span class="lineno">  518</span>        rtol = btol + atol * anorm * xnorm / bnorm</div>
<div class="line"><span class="lineno">  519</span> </div>
<div class="line"><span class="lineno">  520</span>        <span class="comment"># The following tests guard against extremely small values of</span></div>
<div class="line"><span class="lineno">  521</span>        <span class="comment"># atol, btol  or  ctol.  (The user may have set any or all of</span></div>
<div class="line"><span class="lineno">  522</span>        <span class="comment"># the parameters  atol, btol, conlim  to 0.)</span></div>
<div class="line"><span class="lineno">  523</span>        <span class="comment"># The effect is equivalent to the normal tests using</span></div>
<div class="line"><span class="lineno">  524</span>        <span class="comment"># atol = eps,  btol = eps,  conlim = 1/eps.</span></div>
<div class="line"><span class="lineno">  525</span>        <span class="keywordflow">if</span> itn &gt;= iter_lim:</div>
<div class="line"><span class="lineno">  526</span>            istop = 7</div>
<div class="line"><span class="lineno">  527</span>        <span class="keywordflow">if</span> 1 + test3 &lt;= 1:</div>
<div class="line"><span class="lineno">  528</span>            istop = 6</div>
<div class="line"><span class="lineno">  529</span>        <span class="keywordflow">if</span> 1 + test2 &lt;= 1:</div>
<div class="line"><span class="lineno">  530</span>            istop = 5</div>
<div class="line"><span class="lineno">  531</span>        <span class="keywordflow">if</span> 1 + t1 &lt;= 1:</div>
<div class="line"><span class="lineno">  532</span>            istop = 4</div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span>        <span class="comment"># Allow for tolerances set by the user.</span></div>
<div class="line"><span class="lineno">  535</span>        <span class="keywordflow">if</span> test3 &lt;= ctol:</div>
<div class="line"><span class="lineno">  536</span>            istop = 3</div>
<div class="line"><span class="lineno">  537</span>        <span class="keywordflow">if</span> test2 &lt;= atol:</div>
<div class="line"><span class="lineno">  538</span>            istop = 2</div>
<div class="line"><span class="lineno">  539</span>        <span class="keywordflow">if</span> test1 &lt;= rtol:</div>
<div class="line"><span class="lineno">  540</span>            istop = 1</div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span>        <span class="keywordflow">if</span> show:</div>
<div class="line"><span class="lineno">  543</span>            <span class="comment"># See if it is time to print something.</span></div>
<div class="line"><span class="lineno">  544</span>            prnt = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  545</span>            <span class="keywordflow">if</span> n &lt;= 40:</div>
<div class="line"><span class="lineno">  546</span>                prnt = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  547</span>            <span class="keywordflow">if</span> itn &lt;= 10:</div>
<div class="line"><span class="lineno">  548</span>                prnt = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  549</span>            <span class="keywordflow">if</span> itn &gt;= iter_lim-10:</div>
<div class="line"><span class="lineno">  550</span>                prnt = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  551</span>            <span class="comment"># if itn%10 == 0: prnt = True</span></div>
<div class="line"><span class="lineno">  552</span>            <span class="keywordflow">if</span> test3 &lt;= 2*ctol:</div>
<div class="line"><span class="lineno">  553</span>                prnt = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  554</span>            <span class="keywordflow">if</span> test2 &lt;= 10*atol:</div>
<div class="line"><span class="lineno">  555</span>                prnt = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  556</span>            <span class="keywordflow">if</span> test1 &lt;= 10*rtol:</div>
<div class="line"><span class="lineno">  557</span>                prnt = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  558</span>            <span class="keywordflow">if</span> istop != 0:</div>
<div class="line"><span class="lineno">  559</span>                prnt = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>            <span class="keywordflow">if</span> prnt:</div>
<div class="line"><span class="lineno">  562</span>                str1 = <span class="stringliteral">&#39;%6g %12.5e&#39;</span> % (itn, x[0])</div>
<div class="line"><span class="lineno">  563</span>                str2 = <span class="stringliteral">&#39; %10.3e %10.3e&#39;</span> % (r1norm, r2norm)</div>
<div class="line"><span class="lineno">  564</span>                str3 = <span class="stringliteral">&#39;  %8.1e %8.1e&#39;</span> % (test1, test2)</div>
<div class="line"><span class="lineno">  565</span>                str4 = <span class="stringliteral">&#39; %8.1e %8.1e&#39;</span> % (anorm, acond)</div>
<div class="line"><span class="lineno">  566</span>                print(str1, str2, str3, str4)</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>        <span class="keywordflow">if</span> istop != 0:</div>
<div class="line"><span class="lineno">  569</span>            <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  570</span> </div>
<div class="line"><span class="lineno">  571</span>    <span class="comment"># End of iteration loop.</span></div>
<div class="line"><span class="lineno">  572</span>    <span class="comment"># Print the stopping condition.</span></div>
<div class="line"><span class="lineno">  573</span>    <span class="keywordflow">if</span> show:</div>
<div class="line"><span class="lineno">  574</span>        print(<span class="stringliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  575</span>        print(<span class="stringliteral">&#39;LSQR finished&#39;</span>)</div>
<div class="line"><span class="lineno">  576</span>        print(msg[istop])</div>
<div class="line"><span class="lineno">  577</span>        print(<span class="stringliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  578</span>        str1 = <span class="stringliteral">&#39;istop =%8g   r1norm =%8.1e&#39;</span> % (istop, r1norm)</div>
<div class="line"><span class="lineno">  579</span>        str2 = <span class="stringliteral">&#39;anorm =%8.1e   arnorm =%8.1e&#39;</span> % (anorm, arnorm)</div>
<div class="line"><span class="lineno">  580</span>        str3 = <span class="stringliteral">&#39;itn   =%8g   r2norm =%8.1e&#39;</span> % (itn, r2norm)</div>
<div class="line"><span class="lineno">  581</span>        str4 = <span class="stringliteral">&#39;acond =%8.1e   xnorm  =%8.1e&#39;</span> % (acond, xnorm)</div>
<div class="line"><span class="lineno">  582</span>        print(str1 + <span class="stringliteral">&#39;   &#39;</span> + str2)</div>
<div class="line"><span class="lineno">  583</span>        print(str3 + <span class="stringliteral">&#39;   &#39;</span> + str4)</div>
<div class="line"><span class="lineno">  584</span>        print(<span class="stringliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>    <span class="keywordflow">return</span> x, istop, itn, r1norm, r2norm, anorm, acond, arnorm, xnorm, var</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a68eed99b5fda58e0adb1c32745ad2382" name="a68eed99b5fda58e0adb1c32745ad2382"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68eed99b5fda58e0adb1c32745ad2382">&#9670;&#160;</a></span>eps</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._isolve.lsqr.eps = np.finfo(np.float64).eps</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
