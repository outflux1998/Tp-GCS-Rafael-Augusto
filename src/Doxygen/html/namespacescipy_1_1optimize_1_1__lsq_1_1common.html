<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: scipy.optimize._lsq.common Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacescipy.html">scipy</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1optimize.html">optimize</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq.html">_lsq</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html">common</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">scipy.optimize._lsq.common Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a82270e61d80be1e51f122287fd16ec0d" id="r_a82270e61d80be1e51f122287fd16ec0d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a82270e61d80be1e51f122287fd16ec0d">intersect_trust_region</a> (<a class="el" href="namespacescipy_1_1optimize_1_1__nonlin.html#a9f63beec99dbf869db2b02f71b2dd31e">x</a>, s, Delta)</td></tr>
<tr class="separator:a82270e61d80be1e51f122287fd16ec0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1f199fb0893704ab9f2765fe907aa1f" id="r_af1f199fb0893704ab9f2765fe907aa1f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#af1f199fb0893704ab9f2765fe907aa1f">solve_lsq_trust_region</a> (<a class="el" href="__blas__subroutines_8h.html#a25eafceb38c8e75bc60701fea6623f71">n</a>, m, uf, s, V, Delta, initial_alpha=None, <a class="el" href="__lapack__subroutines_8h.html#aa4a017e91ee751f9803a1bdb6caf1c06">rtol</a>=0.01, max_iter=10)</td></tr>
<tr class="separator:af1f199fb0893704ab9f2765fe907aa1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1630ded126d0e065000df48fd8831add" id="r_a1630ded126d0e065000df48fd8831add"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a1630ded126d0e065000df48fd8831add">solve_trust_region_2d</a> (B, <a class="el" href="__lapack__subroutines_8h.html#aeb0d2dd2a2609d5775607acf542b2161">g</a>, Delta)</td></tr>
<tr class="separator:a1630ded126d0e065000df48fd8831add"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bd41d6c2d8809fabf99d993c74665f7" id="r_a5bd41d6c2d8809fabf99d993c74665f7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a5bd41d6c2d8809fabf99d993c74665f7">update_tr_radius</a> (Delta, actual_reduction, predicted_reduction, step_norm, bound_hit)</td></tr>
<tr class="separator:a5bd41d6c2d8809fabf99d993c74665f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a085f04996ed8d4c6bf93ffb11fd62e37" id="r_a085f04996ed8d4c6bf93ffb11fd62e37"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a085f04996ed8d4c6bf93ffb11fd62e37">build_quadratic_1d</a> (J, <a class="el" href="__lapack__subroutines_8h.html#aeb0d2dd2a2609d5775607acf542b2161">g</a>, s, diag=None, <a class="el" href="return__character_2foo77_8f.html#a9b7d82ad2204eafeec9b6f8e2a0b827d">s0</a>=None)</td></tr>
<tr class="separator:a085f04996ed8d4c6bf93ffb11fd62e37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98b03fc784f5913b43a4b74f8ba83d3f" id="r_a98b03fc784f5913b43a4b74f8ba83d3f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a98b03fc784f5913b43a4b74f8ba83d3f">minimize_quadratic_1d</a> (<a class="el" href="__blas__subroutines_8h.html#a4da0a64c77789ca4c8115aef76120fd2">a</a>, b, lb, ub, c=0)</td></tr>
<tr class="separator:a98b03fc784f5913b43a4b74f8ba83d3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad49ae7fcf1eb0a5b247fcb269df8df5e" id="r_ad49ae7fcf1eb0a5b247fcb269df8df5e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#ad49ae7fcf1eb0a5b247fcb269df8df5e">evaluate_quadratic</a> (J, <a class="el" href="__lapack__subroutines_8h.html#aeb0d2dd2a2609d5775607acf542b2161">g</a>, s, diag=None)</td></tr>
<tr class="separator:ad49ae7fcf1eb0a5b247fcb269df8df5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a8165ffe3b3a90aa3f210e8cd24ff14" id="r_a3a8165ffe3b3a90aa3f210e8cd24ff14"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a3a8165ffe3b3a90aa3f210e8cd24ff14">in_bounds</a> (<a class="el" href="namespacescipy_1_1optimize_1_1__nonlin.html#a9f63beec99dbf869db2b02f71b2dd31e">x</a>, lb, ub)</td></tr>
<tr class="separator:a3a8165ffe3b3a90aa3f210e8cd24ff14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ccc66b1c6c6b834b6dfcaa5d5b851a" id="r_a38ccc66b1c6c6b834b6dfcaa5d5b851a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a38ccc66b1c6c6b834b6dfcaa5d5b851a">step_size_to_bound</a> (<a class="el" href="namespacescipy_1_1optimize_1_1__nonlin.html#a9f63beec99dbf869db2b02f71b2dd31e">x</a>, s, lb, ub)</td></tr>
<tr class="separator:a38ccc66b1c6c6b834b6dfcaa5d5b851a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ae73ad503a1bc35498b7b13a8b5a66b" id="r_a2ae73ad503a1bc35498b7b13a8b5a66b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a2ae73ad503a1bc35498b7b13a8b5a66b">find_active_constraints</a> (<a class="el" href="namespacescipy_1_1optimize_1_1__nonlin.html#a9f63beec99dbf869db2b02f71b2dd31e">x</a>, lb, ub, <a class="el" href="__lapack__subroutines_8h.html#aa4a017e91ee751f9803a1bdb6caf1c06">rtol</a>=1e-10)</td></tr>
<tr class="separator:a2ae73ad503a1bc35498b7b13a8b5a66b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63e2917ff1f202d37ed1eaec00fefa0b" id="r_a63e2917ff1f202d37ed1eaec00fefa0b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a63e2917ff1f202d37ed1eaec00fefa0b">make_strictly_feasible</a> (<a class="el" href="namespacescipy_1_1optimize_1_1__nonlin.html#a9f63beec99dbf869db2b02f71b2dd31e">x</a>, lb, ub, rstep=1e-10)</td></tr>
<tr class="separator:a63e2917ff1f202d37ed1eaec00fefa0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5661576c563adf81737a022496c8abd" id="r_ab5661576c563adf81737a022496c8abd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#ab5661576c563adf81737a022496c8abd">CL_scaling_vector</a> (<a class="el" href="namespacescipy_1_1optimize_1_1__nonlin.html#a9f63beec99dbf869db2b02f71b2dd31e">x</a>, <a class="el" href="__lapack__subroutines_8h.html#aeb0d2dd2a2609d5775607acf542b2161">g</a>, lb, ub)</td></tr>
<tr class="separator:ab5661576c563adf81737a022496c8abd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66175cc218fd4eb09dbc29f72c12921d" id="r_a66175cc218fd4eb09dbc29f72c12921d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a66175cc218fd4eb09dbc29f72c12921d">reflective_transformation</a> (y, lb, ub)</td></tr>
<tr class="separator:a66175cc218fd4eb09dbc29f72c12921d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fd933de7910156e779fe7a25caad342" id="r_a6fd933de7910156e779fe7a25caad342"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a6fd933de7910156e779fe7a25caad342">print_header_nonlinear</a> ()</td></tr>
<tr class="separator:a6fd933de7910156e779fe7a25caad342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7932835922e2c362179c722b9c245dbb" id="r_a7932835922e2c362179c722b9c245dbb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a7932835922e2c362179c722b9c245dbb">print_iteration_nonlinear</a> (iteration, nfev, cost, cost_reduction, step_norm, optimality)</td></tr>
<tr class="separator:a7932835922e2c362179c722b9c245dbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0f37dc2f33295abcf3083b04395170f" id="r_aa0f37dc2f33295abcf3083b04395170f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#aa0f37dc2f33295abcf3083b04395170f">print_header_linear</a> ()</td></tr>
<tr class="separator:aa0f37dc2f33295abcf3083b04395170f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ac066c1df0c353d1915ae5d29bd11c3" id="r_a6ac066c1df0c353d1915ae5d29bd11c3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a6ac066c1df0c353d1915ae5d29bd11c3">print_iteration_linear</a> (iteration, cost, cost_reduction, step_norm, optimality)</td></tr>
<tr class="separator:a6ac066c1df0c353d1915ae5d29bd11c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67c0c6b61737bd5cace803600c7fb0bd" id="r_a67c0c6b61737bd5cace803600c7fb0bd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a67c0c6b61737bd5cace803600c7fb0bd">compute_grad</a> (J, <a class="el" href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a>)</td></tr>
<tr class="separator:a67c0c6b61737bd5cace803600c7fb0bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cb745f7d51d250a3135df888e4e2fd4" id="r_a9cb745f7d51d250a3135df888e4e2fd4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a9cb745f7d51d250a3135df888e4e2fd4">compute_jac_scale</a> (J, scale_inv_old=None)</td></tr>
<tr class="separator:a9cb745f7d51d250a3135df888e4e2fd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af16bfdaa52562e005fa46566647f2583" id="r_af16bfdaa52562e005fa46566647f2583"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#af16bfdaa52562e005fa46566647f2583">left_multiplied_operator</a> (J, <a class="el" href="__lapack__subroutines_8h.html#a4c293bae27b15a76659be28378992185">d</a>)</td></tr>
<tr class="separator:af16bfdaa52562e005fa46566647f2583"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab84f6d934eec0606ad26df906b39b2e8" id="r_ab84f6d934eec0606ad26df906b39b2e8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#ab84f6d934eec0606ad26df906b39b2e8">right_multiplied_operator</a> (J, <a class="el" href="__lapack__subroutines_8h.html#a4c293bae27b15a76659be28378992185">d</a>)</td></tr>
<tr class="separator:ab84f6d934eec0606ad26df906b39b2e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b9c2a6e779332a723c0eba402973036" id="r_a1b9c2a6e779332a723c0eba402973036"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a1b9c2a6e779332a723c0eba402973036">regularized_lsq_operator</a> (J, diag)</td></tr>
<tr class="separator:a1b9c2a6e779332a723c0eba402973036"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca475b6fcc243b1f6e73fb91cde9977e" id="r_aca475b6fcc243b1f6e73fb91cde9977e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#aca475b6fcc243b1f6e73fb91cde9977e">right_multiply</a> (J, <a class="el" href="__lapack__subroutines_8h.html#a4c293bae27b15a76659be28378992185">d</a>, copy=True)</td></tr>
<tr class="separator:aca475b6fcc243b1f6e73fb91cde9977e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e95b38a3bb6b04d7e4b819ef0a645ee" id="r_a1e95b38a3bb6b04d7e4b819ef0a645ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a1e95b38a3bb6b04d7e4b819ef0a645ee">left_multiply</a> (J, <a class="el" href="__lapack__subroutines_8h.html#a4c293bae27b15a76659be28378992185">d</a>, copy=True)</td></tr>
<tr class="separator:a1e95b38a3bb6b04d7e4b819ef0a645ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4332a297dd771632dd52100532360df7" id="r_a4332a297dd771632dd52100532360df7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#a4332a297dd771632dd52100532360df7">check_termination</a> (dF, F, dx_norm, x_norm, ratio, ftol, xtol)</td></tr>
<tr class="separator:a4332a297dd771632dd52100532360df7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0dd4efec417f670a4461129ca7a4673" id="r_ae0dd4efec417f670a4461129ca7a4673"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#ae0dd4efec417f670a4461129ca7a4673">scale_for_robust_loss_function</a> (J, <a class="el" href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a>, <a class="el" href="__lapack__subroutines_8h.html#a9bb256f5d273cef048eb659e4ee52fe2">rho</a>)</td></tr>
<tr class="separator:ae0dd4efec417f670a4461129ca7a4673"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:afb51cc46129a4c6d7cf813ed10281333" id="r_afb51cc46129a4c6d7cf813ed10281333"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1optimize_1_1__lsq_1_1common.html#afb51cc46129a4c6d7cf813ed10281333">EPS</a> = np.finfo(float).<a class="el" href="__lapack__subroutines_8h.html#a57833d05f43fd1408080af6eec88fc43">eps</a></td></tr>
<tr class="separator:afb51cc46129a4c6d7cf813ed10281333"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Functions used by least-squares algorithms.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a085f04996ed8d4c6bf93ffb11fd62e37" name="a085f04996ed8d4c6bf93ffb11fd62e37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a085f04996ed8d4c6bf93ffb11fd62e37">&#9670;&#160;</a></span>build_quadratic_1d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.build_quadratic_1d </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>diag</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>s0</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Parameterize a multivariate quadratic function along a line.

The resulting univariate quadratic function is given as follows:
::
    f(t) = 0.5 * (s0 + s*t).T * (J.T*J + diag) * (s0 + s*t) +
           g.T * (s0 + s*t)

Parameters
----------
J : ndarray, sparse matrix or LinearOperator shape (m, n)
    Jacobian matrix, affects the quadratic term.
g : ndarray, shape (n,)
    Gradient, defines the linear term.
s : ndarray, shape (n,)
    Direction vector of a line.
diag : None or ndarray with shape (n,), optional
    Addition diagonal part, affects the quadratic term.
    If None, assumed to be 0.
s0 : None or ndarray with shape (n,), optional
    Initial point. If None, assumed to be 0.

Returns
-------
a : float
    Coefficient for t**2.
b : float
    Coefficient for t.
c : float
    Free term. Returned only if `s0` is provided.
</pre> <div class="fragment"><div class="line"><span class="lineno">  251</span><span class="keyword">def </span>build_quadratic_1d(J, g, s, diag=None, s0=None):</div>
<div class="line"><span class="lineno">  252</span>    <span class="stringliteral">&quot;&quot;&quot;Parameterize a multivariate quadratic function along a line.</span></div>
<div class="line"><span class="lineno">  253</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">    The resulting univariate quadratic function is given as follows:</span></div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral">    ::</span></div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral">        f(t) = 0.5 * (s0 + s*t).T * (J.T*J + diag) * (s0 + s*t) +</span></div>
<div class="line"><span class="lineno">  257</span><span class="stringliteral">               g.T * (s0 + s*t)</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  260</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  261</span><span class="stringliteral">    J : ndarray, sparse matrix or LinearOperator shape (m, n)</span></div>
<div class="line"><span class="lineno">  262</span><span class="stringliteral">        Jacobian matrix, affects the quadratic term.</span></div>
<div class="line"><span class="lineno">  263</span><span class="stringliteral">    g : ndarray, shape (n,)</span></div>
<div class="line"><span class="lineno">  264</span><span class="stringliteral">        Gradient, defines the linear term.</span></div>
<div class="line"><span class="lineno">  265</span><span class="stringliteral">    s : ndarray, shape (n,)</span></div>
<div class="line"><span class="lineno">  266</span><span class="stringliteral">        Direction vector of a line.</span></div>
<div class="line"><span class="lineno">  267</span><span class="stringliteral">    diag : None or ndarray with shape (n,), optional</span></div>
<div class="line"><span class="lineno">  268</span><span class="stringliteral">        Addition diagonal part, affects the quadratic term.</span></div>
<div class="line"><span class="lineno">  269</span><span class="stringliteral">        If None, assumed to be 0.</span></div>
<div class="line"><span class="lineno">  270</span><span class="stringliteral">    s0 : None or ndarray with shape (n,), optional</span></div>
<div class="line"><span class="lineno">  271</span><span class="stringliteral">        Initial point. If None, assumed to be 0.</span></div>
<div class="line"><span class="lineno">  272</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  273</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  274</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  275</span><span class="stringliteral">    a : float</span></div>
<div class="line"><span class="lineno">  276</span><span class="stringliteral">        Coefficient for t**2.</span></div>
<div class="line"><span class="lineno">  277</span><span class="stringliteral">    b : float</span></div>
<div class="line"><span class="lineno">  278</span><span class="stringliteral">        Coefficient for t.</span></div>
<div class="line"><span class="lineno">  279</span><span class="stringliteral">    c : float</span></div>
<div class="line"><span class="lineno">  280</span><span class="stringliteral">        Free term. Returned only if `s0` is provided.</span></div>
<div class="line"><span class="lineno">  281</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  282</span>    v = J.dot(s)</div>
<div class="line"><span class="lineno">  283</span>    a = np.dot(v, v)</div>
<div class="line"><span class="lineno">  284</span>    <span class="keywordflow">if</span> diag <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  285</span>        a += np.dot(s * diag, s)</div>
<div class="line"><span class="lineno">  286</span>    a *= 0.5</div>
<div class="line"><span class="lineno">  287</span> </div>
<div class="line"><span class="lineno">  288</span>    b = np.dot(g, s)</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>    <span class="keywordflow">if</span> s0 <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  291</span>        u = J.dot(s0)</div>
<div class="line"><span class="lineno">  292</span>        b += np.dot(u, v)</div>
<div class="line"><span class="lineno">  293</span>        c = 0.5 * np.dot(u, u) + np.dot(g, s0)</div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">if</span> diag <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  295</span>            b += np.dot(s0 * diag, s)</div>
<div class="line"><span class="lineno">  296</span>            c += 0.5 * np.dot(s0 * diag, s0)</div>
<div class="line"><span class="lineno">  297</span>        <span class="keywordflow">return</span> a, b, c</div>
<div class="line"><span class="lineno">  298</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  299</span>        <span class="keywordflow">return</span> a, b</div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a4332a297dd771632dd52100532360df7" name="a4332a297dd771632dd52100532360df7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4332a297dd771632dd52100532360df7">&#9670;&#160;</a></span>check_termination()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.check_termination </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dx_norm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x_norm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ftol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>xtol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check termination condition for nonlinear least squares.</pre> <div class="fragment"><div class="line"><span class="lineno">  708</span><span class="keyword">def </span>check_termination(dF, F, dx_norm, x_norm, ratio, ftol, xtol):</div>
<div class="line"><span class="lineno">  709</span>    <span class="stringliteral">&quot;&quot;&quot;Check termination condition for nonlinear least squares.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  710</span>    ftol_satisfied = dF &lt; ftol * F <span class="keywordflow">and</span> ratio &gt; 0.25</div>
<div class="line"><span class="lineno">  711</span>    xtol_satisfied = dx_norm &lt; xtol * (xtol + x_norm)</div>
<div class="line"><span class="lineno">  712</span> </div>
<div class="line"><span class="lineno">  713</span>    <span class="keywordflow">if</span> ftol_satisfied <span class="keywordflow">and</span> xtol_satisfied:</div>
<div class="line"><span class="lineno">  714</span>        <span class="keywordflow">return</span> 4</div>
<div class="line"><span class="lineno">  715</span>    <span class="keywordflow">elif</span> ftol_satisfied:</div>
<div class="line"><span class="lineno">  716</span>        <span class="keywordflow">return</span> 2</div>
<div class="line"><span class="lineno">  717</span>    <span class="keywordflow">elif</span> xtol_satisfied:</div>
<div class="line"><span class="lineno">  718</span>        <span class="keywordflow">return</span> 3</div>
<div class="line"><span class="lineno">  719</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  720</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  721</span> </div>
<div class="line"><span class="lineno">  722</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ab5661576c563adf81737a022496c8abd" name="ab5661576c563adf81737a022496c8abd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5661576c563adf81737a022496c8abd">&#9670;&#160;</a></span>CL_scaling_vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.CL_scaling_vector </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ub</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute Coleman-Li scaling vector and its derivatives.

Components of a vector v are defined as follows:
::
           | ub[i] - x[i], if g[i] &lt; 0 and ub[i] &lt; np.inf
    v[i] = | x[i] - lb[i], if g[i] &gt; 0 and lb[i] &gt; -np.inf
           | 1,           otherwise

According to this definition v[i] &gt;= 0 for all i. It differs from the
definition in paper [1]_ (eq. (2.2)), where the absolute value of v is
used. Both definitions are equivalent down the line.
Derivatives of v with respect to x take value 1, -1 or 0 depending on a
case.

Returns
-------
v : ndarray with shape of x
    Scaling vector.
dv : ndarray with shape of x
    Derivatives of v[i] with respect to x[i], diagonal elements of v's
    Jacobian.

References
----------
.. [1] M.A. Branch, T.F. Coleman, and Y. Li, "A Subspace, Interior,
       and Conjugate Gradient Method for Large-Scale Bound-Constrained
       Minimization Problems," SIAM Journal on Scientific Computing,
       Vol. 21, Number 1, pp 1-23, 1999.
</pre> <div class="fragment"><div class="line"><span class="lineno">  467</span><span class="keyword">def </span>CL_scaling_vector(x, g, lb, ub):</div>
<div class="line"><span class="lineno">  468</span>    <span class="stringliteral">&quot;&quot;&quot;Compute Coleman-Li scaling vector and its derivatives.</span></div>
<div class="line"><span class="lineno">  469</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  470</span><span class="stringliteral">    Components of a vector v are defined as follows:</span></div>
<div class="line"><span class="lineno">  471</span><span class="stringliteral">    ::</span></div>
<div class="line"><span class="lineno">  472</span><span class="stringliteral">               | ub[i] - x[i], if g[i] &lt; 0 and ub[i] &lt; np.inf</span></div>
<div class="line"><span class="lineno">  473</span><span class="stringliteral">        v[i] = | x[i] - lb[i], if g[i] &gt; 0 and lb[i] &gt; -np.inf</span></div>
<div class="line"><span class="lineno">  474</span><span class="stringliteral">               | 1,           otherwise</span></div>
<div class="line"><span class="lineno">  475</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  476</span><span class="stringliteral">    According to this definition v[i] &gt;= 0 for all i. It differs from the</span></div>
<div class="line"><span class="lineno">  477</span><span class="stringliteral">    definition in paper [1]_ (eq. (2.2)), where the absolute value of v is</span></div>
<div class="line"><span class="lineno">  478</span><span class="stringliteral">    used. Both definitions are equivalent down the line.</span></div>
<div class="line"><span class="lineno">  479</span><span class="stringliteral">    Derivatives of v with respect to x take value 1, -1 or 0 depending on a</span></div>
<div class="line"><span class="lineno">  480</span><span class="stringliteral">    case.</span></div>
<div class="line"><span class="lineno">  481</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  482</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  483</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  484</span><span class="stringliteral">    v : ndarray with shape of x</span></div>
<div class="line"><span class="lineno">  485</span><span class="stringliteral">        Scaling vector.</span></div>
<div class="line"><span class="lineno">  486</span><span class="stringliteral">    dv : ndarray with shape of x</span></div>
<div class="line"><span class="lineno">  487</span><span class="stringliteral">        Derivatives of v[i] with respect to x[i], diagonal elements of v&#39;s</span></div>
<div class="line"><span class="lineno">  488</span><span class="stringliteral">        Jacobian.</span></div>
<div class="line"><span class="lineno">  489</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  490</span><span class="stringliteral">    References</span></div>
<div class="line"><span class="lineno">  491</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  492</span><span class="stringliteral">    .. [1] M.A. Branch, T.F. Coleman, and Y. Li, &quot;A Subspace, Interior,</span></div>
<div class="line"><span class="lineno">  493</span><span class="stringliteral">           and Conjugate Gradient Method for Large-Scale Bound-Constrained</span></div>
<div class="line"><span class="lineno">  494</span><span class="stringliteral">           Minimization Problems,&quot; SIAM Journal on Scientific Computing,</span></div>
<div class="line"><span class="lineno">  495</span><span class="stringliteral">           Vol. 21, Number 1, pp 1-23, 1999.</span></div>
<div class="line"><span class="lineno">  496</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  497</span>    v = np.ones_like(x)</div>
<div class="line"><span class="lineno">  498</span>    dv = np.zeros_like(x)</div>
<div class="line"><span class="lineno">  499</span> </div>
<div class="line"><span class="lineno">  500</span>    mask = (g &lt; 0) &amp; np.isfinite(ub)</div>
<div class="line"><span class="lineno">  501</span>    v[mask] = ub[mask] - x[mask]</div>
<div class="line"><span class="lineno">  502</span>    dv[mask] = -1</div>
<div class="line"><span class="lineno">  503</span> </div>
<div class="line"><span class="lineno">  504</span>    mask = (g &gt; 0) &amp; np.isfinite(lb)</div>
<div class="line"><span class="lineno">  505</span>    v[mask] = x[mask] - lb[mask]</div>
<div class="line"><span class="lineno">  506</span>    dv[mask] = 1</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>    <span class="keywordflow">return</span> v, dv</div>
<div class="line"><span class="lineno">  509</span> </div>
<div class="line"><span class="lineno">  510</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a67c0c6b61737bd5cace803600c7fb0bd" name="a67c0c6b61737bd5cace803600c7fb0bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67c0c6b61737bd5cace803600c7fb0bd">&#9670;&#160;</a></span>compute_grad()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.compute_grad </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute gradient of the least-squares cost function.</pre> <div class="fragment"><div class="line"><span class="lineno">  593</span><span class="keyword">def </span>compute_grad(J, f):</div>
<div class="line"><span class="lineno">  594</span>    <span class="stringliteral">&quot;&quot;&quot;Compute gradient of the least-squares cost function.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  595</span>    <span class="keywordflow">if</span> isinstance(J, LinearOperator):</div>
<div class="line"><span class="lineno">  596</span>        <span class="keywordflow">return</span> J.rmatvec(f)</div>
<div class="line"><span class="lineno">  597</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  598</span>        <span class="keywordflow">return</span> J.T.dot(f)</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a9cb745f7d51d250a3135df888e4e2fd4" name="a9cb745f7d51d250a3135df888e4e2fd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cb745f7d51d250a3135df888e4e2fd4">&#9670;&#160;</a></span>compute_jac_scale()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.compute_jac_scale </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scale_inv_old</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute variables scale based on the Jacobian matrix.</pre> <div class="fragment"><div class="line"><span class="lineno">  601</span><span class="keyword">def </span>compute_jac_scale(J, scale_inv_old=None):</div>
<div class="line"><span class="lineno">  602</span>    <span class="stringliteral">&quot;&quot;&quot;Compute variables scale based on the Jacobian matrix.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  603</span>    <span class="keywordflow">if</span> issparse(J):</div>
<div class="line"><span class="lineno">  604</span>        scale_inv = np.asarray(J.power(2).sum(axis=0)).ravel()**0.5</div>
<div class="line"><span class="lineno">  605</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  606</span>        scale_inv = np.sum(J**2, axis=0)**0.5</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    <span class="keywordflow">if</span> scale_inv_old <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  609</span>        scale_inv[scale_inv == 0] = 1</div>
<div class="line"><span class="lineno">  610</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  611</span>        scale_inv = np.maximum(scale_inv, scale_inv_old)</div>
<div class="line"><span class="lineno">  612</span> </div>
<div class="line"><span class="lineno">  613</span>    <span class="keywordflow">return</span> 1 / scale_inv, scale_inv</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad49ae7fcf1eb0a5b247fcb269df8df5e" name="ad49ae7fcf1eb0a5b247fcb269df8df5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad49ae7fcf1eb0a5b247fcb269df8df5e">&#9670;&#160;</a></span>evaluate_quadratic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.evaluate_quadratic </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>diag</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute values of a quadratic function arising in least squares.

The function is 0.5 * s.T * (J.T * J + diag) * s + g.T * s.

Parameters
----------
J : ndarray, sparse matrix or LinearOperator, shape (m, n)
    Jacobian matrix, affects the quadratic term.
g : ndarray, shape (n,)
    Gradient, defines the linear term.
s : ndarray, shape (k, n) or (n,)
    Array containing steps as rows.
diag : ndarray, shape (n,), optional
    Addition diagonal part, affects the quadratic term.
    If None, assumed to be 0.

Returns
-------
values : ndarray with shape (k,) or float
    Values of the function. If `s` was 2-D, then ndarray is
    returned, otherwise, float is returned.
</pre> <div class="fragment"><div class="line"><span class="lineno">  325</span><span class="keyword">def </span>evaluate_quadratic(J, g, s, diag=None):</div>
<div class="line"><span class="lineno">  326</span>    <span class="stringliteral">&quot;&quot;&quot;Compute values of a quadratic function arising in least squares.</span></div>
<div class="line"><span class="lineno">  327</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  328</span><span class="stringliteral">    The function is 0.5 * s.T * (J.T * J + diag) * s + g.T * s.</span></div>
<div class="line"><span class="lineno">  329</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  330</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  331</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  332</span><span class="stringliteral">    J : ndarray, sparse matrix or LinearOperator, shape (m, n)</span></div>
<div class="line"><span class="lineno">  333</span><span class="stringliteral">        Jacobian matrix, affects the quadratic term.</span></div>
<div class="line"><span class="lineno">  334</span><span class="stringliteral">    g : ndarray, shape (n,)</span></div>
<div class="line"><span class="lineno">  335</span><span class="stringliteral">        Gradient, defines the linear term.</span></div>
<div class="line"><span class="lineno">  336</span><span class="stringliteral">    s : ndarray, shape (k, n) or (n,)</span></div>
<div class="line"><span class="lineno">  337</span><span class="stringliteral">        Array containing steps as rows.</span></div>
<div class="line"><span class="lineno">  338</span><span class="stringliteral">    diag : ndarray, shape (n,), optional</span></div>
<div class="line"><span class="lineno">  339</span><span class="stringliteral">        Addition diagonal part, affects the quadratic term.</span></div>
<div class="line"><span class="lineno">  340</span><span class="stringliteral">        If None, assumed to be 0.</span></div>
<div class="line"><span class="lineno">  341</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  342</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  343</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  344</span><span class="stringliteral">    values : ndarray with shape (k,) or float</span></div>
<div class="line"><span class="lineno">  345</span><span class="stringliteral">        Values of the function. If `s` was 2-D, then ndarray is</span></div>
<div class="line"><span class="lineno">  346</span><span class="stringliteral">        returned, otherwise, float is returned.</span></div>
<div class="line"><span class="lineno">  347</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  348</span>    <span class="keywordflow">if</span> s.ndim == 1:</div>
<div class="line"><span class="lineno">  349</span>        Js = J.dot(s)</div>
<div class="line"><span class="lineno">  350</span>        q = np.dot(Js, Js)</div>
<div class="line"><span class="lineno">  351</span>        <span class="keywordflow">if</span> diag <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  352</span>            q += np.dot(s * diag, s)</div>
<div class="line"><span class="lineno">  353</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  354</span>        Js = J.dot(s.T)</div>
<div class="line"><span class="lineno">  355</span>        q = np.sum(Js**2, axis=0)</div>
<div class="line"><span class="lineno">  356</span>        <span class="keywordflow">if</span> diag <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  357</span>            q += np.sum(diag * s**2, axis=1)</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>    l = np.dot(s, g)</div>
<div class="line"><span class="lineno">  360</span> </div>
<div class="line"><span class="lineno">  361</span>    <span class="keywordflow">return</span> 0.5 * q + l</div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span><span class="comment"># Utility functions to work with bound constraints.</span></div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ae73ad503a1bc35498b7b13a8b5a66b" name="a2ae73ad503a1bc35498b7b13a8b5a66b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ae73ad503a1bc35498b7b13a8b5a66b">&#9670;&#160;</a></span>find_active_constraints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.find_active_constraints </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>rtol</em> = <code>1e-10</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Determine which constraints are active in a given point.

The threshold is computed using `rtol` and the absolute value of the
closest bound.

Returns
-------
active : ndarray of int with shape of x
    Each component shows whether the corresponding constraint is active:

         *  0 - a constraint is not active.
         * -1 - a lower bound is active.
         *  1 - a upper bound is active.
</pre> <div class="fragment"><div class="line"><span class="lineno">  401</span><span class="keyword">def </span>find_active_constraints(x, lb, ub, rtol=1e-10):</div>
<div class="line"><span class="lineno">  402</span>    <span class="stringliteral">&quot;&quot;&quot;Determine which constraints are active in a given point.</span></div>
<div class="line"><span class="lineno">  403</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  404</span><span class="stringliteral">    The threshold is computed using `rtol` and the absolute value of the</span></div>
<div class="line"><span class="lineno">  405</span><span class="stringliteral">    closest bound.</span></div>
<div class="line"><span class="lineno">  406</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  407</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  408</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  409</span><span class="stringliteral">    active : ndarray of int with shape of x</span></div>
<div class="line"><span class="lineno">  410</span><span class="stringliteral">        Each component shows whether the corresponding constraint is active:</span></div>
<div class="line"><span class="lineno">  411</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  412</span><span class="stringliteral">             *  0 - a constraint is not active.</span></div>
<div class="line"><span class="lineno">  413</span><span class="stringliteral">             * -1 - a lower bound is active.</span></div>
<div class="line"><span class="lineno">  414</span><span class="stringliteral">             *  1 - a upper bound is active.</span></div>
<div class="line"><span class="lineno">  415</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  416</span>    active = np.zeros_like(x, dtype=int)</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>    <span class="keywordflow">if</span> rtol == 0:</div>
<div class="line"><span class="lineno">  419</span>        active[x &lt;= lb] = -1</div>
<div class="line"><span class="lineno">  420</span>        active[x &gt;= ub] = 1</div>
<div class="line"><span class="lineno">  421</span>        <span class="keywordflow">return</span> active</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>    lower_dist = x - lb</div>
<div class="line"><span class="lineno">  424</span>    upper_dist = ub - x</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    lower_threshold = rtol * np.maximum(1, np.abs(lb))</div>
<div class="line"><span class="lineno">  427</span>    upper_threshold = rtol * np.maximum(1, np.abs(ub))</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>    lower_active = (np.isfinite(lb) &amp;</div>
<div class="line"><span class="lineno">  430</span>                    (lower_dist &lt;= np.minimum(upper_dist, lower_threshold)))</div>
<div class="line"><span class="lineno">  431</span>    active[lower_active] = -1</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>    upper_active = (np.isfinite(ub) &amp;</div>
<div class="line"><span class="lineno">  434</span>                    (upper_dist &lt;= np.minimum(lower_dist, upper_threshold)))</div>
<div class="line"><span class="lineno">  435</span>    active[upper_active] = 1</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>    <span class="keywordflow">return</span> active</div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a8165ffe3b3a90aa3f210e8cd24ff14" name="a3a8165ffe3b3a90aa3f210e8cd24ff14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a8165ffe3b3a90aa3f210e8cd24ff14">&#9670;&#160;</a></span>in_bounds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.in_bounds </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ub</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check if a point lies within bounds.</pre> <div class="fragment"><div class="line"><span class="lineno">  367</span><span class="keyword">def </span>in_bounds(x, lb, ub):</div>
<div class="line"><span class="lineno">  368</span>    <span class="stringliteral">&quot;&quot;&quot;Check if a point lies within bounds.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  369</span>    <span class="keywordflow">return</span> np.all((x &gt;= lb) &amp; (x &lt;= ub))</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a82270e61d80be1e51f122287fd16ec0d" name="a82270e61d80be1e51f122287fd16ec0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82270e61d80be1e51f122287fd16ec0d">&#9670;&#160;</a></span>intersect_trust_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.intersect_trust_region </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Find the intersection of a line with the boundary of a trust region.

This function solves the quadratic equation with respect to t
||(x + s*t)||**2 = Delta**2.

Returns
-------
t_neg, t_pos : tuple of float
    Negative and positive roots.

Raises
------
ValueError
    If `s` is zero or `x` is not within the trust region.
</pre> <div class="fragment"><div class="line"><span class="lineno">   18</span><span class="keyword">def </span>intersect_trust_region(x, s, Delta):</div>
<div class="line"><span class="lineno">   19</span>    <span class="stringliteral">&quot;&quot;&quot;Find the intersection of a line with the boundary of a trust region.</span></div>
<div class="line"><span class="lineno">   20</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   21</span><span class="stringliteral">    This function solves the quadratic equation with respect to t</span></div>
<div class="line"><span class="lineno">   22</span><span class="stringliteral">    ||(x + s*t)||**2 = Delta**2.</span></div>
<div class="line"><span class="lineno">   23</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   24</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">   25</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">   26</span><span class="stringliteral">    t_neg, t_pos : tuple of float</span></div>
<div class="line"><span class="lineno">   27</span><span class="stringliteral">        Negative and positive roots.</span></div>
<div class="line"><span class="lineno">   28</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   29</span><span class="stringliteral">    Raises</span></div>
<div class="line"><span class="lineno">   30</span><span class="stringliteral">    ------</span></div>
<div class="line"><span class="lineno">   31</span><span class="stringliteral">    ValueError</span></div>
<div class="line"><span class="lineno">   32</span><span class="stringliteral">        If `s` is zero or `x` is not within the trust region.</span></div>
<div class="line"><span class="lineno">   33</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   34</span>    a = np.dot(s, s)</div>
<div class="line"><span class="lineno">   35</span>    <span class="keywordflow">if</span> a == 0:</div>
<div class="line"><span class="lineno">   36</span>        <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;`s` is zero.&quot;</span>)</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>    b = np.dot(x, s)</div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>    c = np.dot(x, x) - Delta**2</div>
<div class="line"><span class="lineno">   41</span>    <span class="keywordflow">if</span> c &gt; 0:</div>
<div class="line"><span class="lineno">   42</span>        <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;`x` is not within the trust region.&quot;</span>)</div>
<div class="line"><span class="lineno">   43</span> </div>
<div class="line"><span class="lineno">   44</span>    d = np.sqrt(b*b - a*c)  <span class="comment"># Root from one fourth of the discriminant.</span></div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>    <span class="comment"># Computations below avoid loss of significance, see &quot;Numerical Recipes&quot;.</span></div>
<div class="line"><span class="lineno">   47</span>    q = -(b + copysign(d, b))</div>
<div class="line"><span class="lineno">   48</span>    t1 = q / a</div>
<div class="line"><span class="lineno">   49</span>    t2 = c / q</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">if</span> t1 &lt; t2:</div>
<div class="line"><span class="lineno">   52</span>        <span class="keywordflow">return</span> t1, t2</div>
<div class="line"><span class="lineno">   53</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   54</span>        <span class="keywordflow">return</span> t2, t1</div>
<div class="line"><span class="lineno">   55</span> </div>
<div class="line"><span class="lineno">   56</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="af16bfdaa52562e005fa46566647f2583" name="af16bfdaa52562e005fa46566647f2583"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af16bfdaa52562e005fa46566647f2583">&#9670;&#160;</a></span>left_multiplied_operator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.left_multiplied_operator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>d</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return diag(d) J as LinearOperator.</pre> <div class="fragment"><div class="line"><span class="lineno">  616</span><span class="keyword">def </span>left_multiplied_operator(J, d):</div>
<div class="line"><span class="lineno">  617</span>    <span class="stringliteral">&quot;&quot;&quot;Return diag(d) J as LinearOperator.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  618</span>    J = aslinearoperator(J)</div>
<div class="line"><span class="lineno">  619</span> </div>
<div class="line"><span class="lineno">  620</span>    <span class="keyword">def </span>matvec(x):</div>
<div class="line"><span class="lineno">  621</span>        <span class="keywordflow">return</span> d * J.matvec(x)</div>
<div class="line"><span class="lineno">  622</span> </div>
<div class="line"><span class="lineno">  623</span>    <span class="keyword">def </span>matmat(X):</div>
<div class="line"><span class="lineno">  624</span>        <span class="keywordflow">return</span> d[:, np.newaxis] * J.matmat(X)</div>
<div class="line"><span class="lineno">  625</span> </div>
<div class="line"><span class="lineno">  626</span>    <span class="keyword">def </span>rmatvec(x):</div>
<div class="line"><span class="lineno">  627</span>        <span class="keywordflow">return</span> J.rmatvec(x.ravel() * d)</div>
<div class="line"><span class="lineno">  628</span> </div>
<div class="line"><span class="lineno">  629</span>    <span class="keywordflow">return</span> LinearOperator(J.shape, matvec=matvec, matmat=matmat,</div>
<div class="line"><span class="lineno">  630</span>                          rmatvec=rmatvec)</div>
<div class="line"><span class="lineno">  631</span> </div>
<div class="line"><span class="lineno">  632</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e95b38a3bb6b04d7e4b819ef0a645ee" name="a1e95b38a3bb6b04d7e4b819ef0a645ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e95b38a3bb6b04d7e4b819ef0a645ee">&#9670;&#160;</a></span>left_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.left_multiply </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>copy</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute diag(d) J.

If `copy` is False, `J` is modified in place (unless being LinearOperator).
</pre> <div class="fragment"><div class="line"><span class="lineno">  690</span><span class="keyword">def </span>left_multiply(J, d, copy=True):</div>
<div class="line"><span class="lineno">  691</span>    <span class="stringliteral">&quot;&quot;&quot;Compute diag(d) J.</span></div>
<div class="line"><span class="lineno">  692</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  693</span><span class="stringliteral">    If `copy` is False, `J` is modified in place (unless being LinearOperator).</span></div>
<div class="line"><span class="lineno">  694</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  695</span>    <span class="keywordflow">if</span> copy <span class="keywordflow">and</span> <span class="keywordflow">not</span> isinstance(J, LinearOperator):</div>
<div class="line"><span class="lineno">  696</span>        J = J.copy()</div>
<div class="line"><span class="lineno">  697</span> </div>
<div class="line"><span class="lineno">  698</span>    <span class="keywordflow">if</span> issparse(J):</div>
<div class="line"><span class="lineno">  699</span>        J.data *= np.repeat(d, np.diff(J.indptr))  <span class="comment"># scikit-learn recipe.</span></div>
<div class="line"><span class="lineno">  700</span>    <span class="keywordflow">elif</span> isinstance(J, LinearOperator):</div>
<div class="line"><span class="lineno">  701</span>        J = left_multiplied_operator(J, d)</div>
<div class="line"><span class="lineno">  702</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  703</span>        J *= d[:, np.newaxis]</div>
<div class="line"><span class="lineno">  704</span> </div>
<div class="line"><span class="lineno">  705</span>    <span class="keywordflow">return</span> J</div>
<div class="line"><span class="lineno">  706</span> </div>
<div class="line"><span class="lineno">  707</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a63e2917ff1f202d37ed1eaec00fefa0b" name="a63e2917ff1f202d37ed1eaec00fefa0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63e2917ff1f202d37ed1eaec00fefa0b">&#9670;&#160;</a></span>make_strictly_feasible()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.make_strictly_feasible </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>rstep</em> = <code>1e-10</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Shift a point to the interior of a feasible region.

Each element of the returned vector is at least at a relative distance
`rstep` from the closest bound. If ``rstep=0`` then `np.nextafter` is used.
</pre> <div class="fragment"><div class="line"><span class="lineno">  440</span><span class="keyword">def </span>make_strictly_feasible(x, lb, ub, rstep=1e-10):</div>
<div class="line"><span class="lineno">  441</span>    <span class="stringliteral">&quot;&quot;&quot;Shift a point to the interior of a feasible region.</span></div>
<div class="line"><span class="lineno">  442</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  443</span><span class="stringliteral">    Each element of the returned vector is at least at a relative distance</span></div>
<div class="line"><span class="lineno">  444</span><span class="stringliteral">    `rstep` from the closest bound. If ``rstep=0`` then `np.nextafter` is used.</span></div>
<div class="line"><span class="lineno">  445</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  446</span>    x_new = x.copy()</div>
<div class="line"><span class="lineno">  447</span> </div>
<div class="line"><span class="lineno">  448</span>    active = find_active_constraints(x, lb, ub, rstep)</div>
<div class="line"><span class="lineno">  449</span>    lower_mask = np.equal(active, -1)</div>
<div class="line"><span class="lineno">  450</span>    upper_mask = np.equal(active, 1)</div>
<div class="line"><span class="lineno">  451</span> </div>
<div class="line"><span class="lineno">  452</span>    <span class="keywordflow">if</span> rstep == 0:</div>
<div class="line"><span class="lineno">  453</span>        x_new[lower_mask] = np.nextafter(lb[lower_mask], ub[lower_mask])</div>
<div class="line"><span class="lineno">  454</span>        x_new[upper_mask] = np.nextafter(ub[upper_mask], lb[upper_mask])</div>
<div class="line"><span class="lineno">  455</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  456</span>        x_new[lower_mask] = (lb[lower_mask] +</div>
<div class="line"><span class="lineno">  457</span>                             rstep * np.maximum(1, np.abs(lb[lower_mask])))</div>
<div class="line"><span class="lineno">  458</span>        x_new[upper_mask] = (ub[upper_mask] -</div>
<div class="line"><span class="lineno">  459</span>                             rstep * np.maximum(1, np.abs(ub[upper_mask])))</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    tight_bounds = (x_new &lt; lb) | (x_new &gt; ub)</div>
<div class="line"><span class="lineno">  462</span>    x_new[tight_bounds] = 0.5 * (lb[tight_bounds] + ub[tight_bounds])</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>    <span class="keywordflow">return</span> x_new</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a98b03fc784f5913b43a4b74f8ba83d3f" name="a98b03fc784f5913b43a4b74f8ba83d3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98b03fc784f5913b43a4b74f8ba83d3f">&#9670;&#160;</a></span>minimize_quadratic_1d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.minimize_quadratic_1d </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>c</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Minimize a 1-D quadratic function subject to bounds.

The free term `c` is 0 by default. Bounds must be finite.

Returns
-------
t : float
    Minimum point.
y : float
    Minimum value.
</pre> <div class="fragment"><div class="line"><span class="lineno">  302</span><span class="keyword">def </span>minimize_quadratic_1d(a, b, lb, ub, c=0):</div>
<div class="line"><span class="lineno">  303</span>    <span class="stringliteral">&quot;&quot;&quot;Minimize a 1-D quadratic function subject to bounds.</span></div>
<div class="line"><span class="lineno">  304</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  305</span><span class="stringliteral">    The free term `c` is 0 by default. Bounds must be finite.</span></div>
<div class="line"><span class="lineno">  306</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  307</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  308</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  309</span><span class="stringliteral">    t : float</span></div>
<div class="line"><span class="lineno">  310</span><span class="stringliteral">        Minimum point.</span></div>
<div class="line"><span class="lineno">  311</span><span class="stringliteral">    y : float</span></div>
<div class="line"><span class="lineno">  312</span><span class="stringliteral">        Minimum value.</span></div>
<div class="line"><span class="lineno">  313</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  314</span>    t = [lb, ub]</div>
<div class="line"><span class="lineno">  315</span>    <span class="keywordflow">if</span> a != 0:</div>
<div class="line"><span class="lineno">  316</span>        extremum = -0.5 * b / a</div>
<div class="line"><span class="lineno">  317</span>        <span class="keywordflow">if</span> lb &lt; extremum &lt; ub:</div>
<div class="line"><span class="lineno">  318</span>            t.append(extremum)</div>
<div class="line"><span class="lineno">  319</span>    t = np.asarray(t)</div>
<div class="line"><span class="lineno">  320</span>    y = t * (a * t + b) + c</div>
<div class="line"><span class="lineno">  321</span>    min_index = np.argmin(y)</div>
<div class="line"><span class="lineno">  322</span>    <span class="keywordflow">return</span> t[min_index], y[min_index]</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aa0f37dc2f33295abcf3083b04395170f" name="aa0f37dc2f33295abcf3083b04395170f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0f37dc2f33295abcf3083b04395170f">&#9670;&#160;</a></span>print_header_linear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.print_header_linear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  568</span><span class="keyword">def </span>print_header_linear():</div>
<div class="line"><span class="lineno">  569</span>    print(<span class="stringliteral">&quot;{0:^15}{1:^15}{2:^15}{3:^15}{4:^15}&quot;</span></div>
<div class="line"><span class="lineno">  570</span>          .format(<span class="stringliteral">&quot;Iteration&quot;</span>, <span class="stringliteral">&quot;Cost&quot;</span>, <span class="stringliteral">&quot;Cost reduction&quot;</span>, <span class="stringliteral">&quot;Step norm&quot;</span>,</div>
<div class="line"><span class="lineno">  571</span>                  <span class="stringliteral">&quot;Optimality&quot;</span>))</div>
<div class="line"><span class="lineno">  572</span> </div>
<div class="line"><span class="lineno">  573</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a6fd933de7910156e779fe7a25caad342" name="a6fd933de7910156e779fe7a25caad342"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fd933de7910156e779fe7a25caad342">&#9670;&#160;</a></span>print_header_nonlinear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.print_header_nonlinear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  545</span><span class="keyword">def </span>print_header_nonlinear():</div>
<div class="line"><span class="lineno">  546</span>    print(<span class="stringliteral">&quot;{0:^15}{1:^15}{2:^15}{3:^15}{4:^15}{5:^15}&quot;</span></div>
<div class="line"><span class="lineno">  547</span>          .format(<span class="stringliteral">&quot;Iteration&quot;</span>, <span class="stringliteral">&quot;Total nfev&quot;</span>, <span class="stringliteral">&quot;Cost&quot;</span>, <span class="stringliteral">&quot;Cost reduction&quot;</span>,</div>
<div class="line"><span class="lineno">  548</span>                  <span class="stringliteral">&quot;Step norm&quot;</span>, <span class="stringliteral">&quot;Optimality&quot;</span>))</div>
<div class="line"><span class="lineno">  549</span> </div>
<div class="line"><span class="lineno">  550</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ac066c1df0c353d1915ae5d29bd11c3" name="a6ac066c1df0c353d1915ae5d29bd11c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ac066c1df0c353d1915ae5d29bd11c3">&#9670;&#160;</a></span>print_iteration_linear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.print_iteration_linear </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cost_reduction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>step_norm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>optimality</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  575</span>                           optimality):</div>
<div class="line"><span class="lineno">  576</span>    <span class="keywordflow">if</span> cost_reduction <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  577</span>        cost_reduction = <span class="stringliteral">&quot; &quot;</span> * 15</div>
<div class="line"><span class="lineno">  578</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  579</span>        cost_reduction = <span class="stringliteral">&quot;{0:^15.2e}&quot;</span>.format(cost_reduction)</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>    <span class="keywordflow">if</span> step_norm <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  582</span>        step_norm = <span class="stringliteral">&quot; &quot;</span> * 15</div>
<div class="line"><span class="lineno">  583</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  584</span>        step_norm = <span class="stringliteral">&quot;{0:^15.2e}&quot;</span>.format(step_norm)</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>    print(<span class="stringliteral">&quot;{0:^15}{1:^15.4e}{2}{3}{4:^15.2e}&quot;</span>.format(</div>
<div class="line"><span class="lineno">  587</span>        iteration, cost, cost_reduction, step_norm, optimality))</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span><span class="comment"># Simple helper functions.</span></div>
<div class="line"><span class="lineno">  591</span> </div>
<div class="line"><span class="lineno">  592</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a7932835922e2c362179c722b9c245dbb" name="a7932835922e2c362179c722b9c245dbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7932835922e2c362179c722b9c245dbb">&#9670;&#160;</a></span>print_iteration_nonlinear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.print_iteration_nonlinear </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nfev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cost_reduction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>step_norm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>optimality</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  552</span>                              step_norm, optimality):</div>
<div class="line"><span class="lineno">  553</span>    <span class="keywordflow">if</span> cost_reduction <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  554</span>        cost_reduction = <span class="stringliteral">&quot; &quot;</span> * 15</div>
<div class="line"><span class="lineno">  555</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  556</span>        cost_reduction = <span class="stringliteral">&quot;{0:^15.2e}&quot;</span>.format(cost_reduction)</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>    <span class="keywordflow">if</span> step_norm <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  559</span>        step_norm = <span class="stringliteral">&quot; &quot;</span> * 15</div>
<div class="line"><span class="lineno">  560</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  561</span>        step_norm = <span class="stringliteral">&quot;{0:^15.2e}&quot;</span>.format(step_norm)</div>
<div class="line"><span class="lineno">  562</span> </div>
<div class="line"><span class="lineno">  563</span>    print(<span class="stringliteral">&quot;{0:^15}{1:^15}{2:^15.4e}{3}{4}{5:^15.2e}&quot;</span></div>
<div class="line"><span class="lineno">  564</span>          .format(iteration, nfev, cost, cost_reduction,</div>
<div class="line"><span class="lineno">  565</span>                  step_norm, optimality))</div>
<div class="line"><span class="lineno">  566</span> </div>
<div class="line"><span class="lineno">  567</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a66175cc218fd4eb09dbc29f72c12921d" name="a66175cc218fd4eb09dbc29f72c12921d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66175cc218fd4eb09dbc29f72c12921d">&#9670;&#160;</a></span>reflective_transformation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.reflective_transformation </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ub</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute reflective transformation and its gradient.</pre> <div class="fragment"><div class="line"><span class="lineno">  511</span><span class="keyword">def </span>reflective_transformation(y, lb, ub):</div>
<div class="line"><span class="lineno">  512</span>    <span class="stringliteral">&quot;&quot;&quot;Compute reflective transformation and its gradient.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  513</span>    <span class="keywordflow">if</span> in_bounds(y, lb, ub):</div>
<div class="line"><span class="lineno">  514</span>        <span class="keywordflow">return</span> y, np.ones_like(y)</div>
<div class="line"><span class="lineno">  515</span> </div>
<div class="line"><span class="lineno">  516</span>    lb_finite = np.isfinite(lb)</div>
<div class="line"><span class="lineno">  517</span>    ub_finite = np.isfinite(ub)</div>
<div class="line"><span class="lineno">  518</span> </div>
<div class="line"><span class="lineno">  519</span>    x = y.copy()</div>
<div class="line"><span class="lineno">  520</span>    g_negative = np.zeros_like(y, dtype=bool)</div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span>    mask = lb_finite &amp; ~ub_finite</div>
<div class="line"><span class="lineno">  523</span>    x[mask] = np.maximum(y[mask], 2 * lb[mask] - y[mask])</div>
<div class="line"><span class="lineno">  524</span>    g_negative[mask] = y[mask] &lt; lb[mask]</div>
<div class="line"><span class="lineno">  525</span> </div>
<div class="line"><span class="lineno">  526</span>    mask = ~lb_finite &amp; ub_finite</div>
<div class="line"><span class="lineno">  527</span>    x[mask] = np.minimum(y[mask], 2 * ub[mask] - y[mask])</div>
<div class="line"><span class="lineno">  528</span>    g_negative[mask] = y[mask] &gt; ub[mask]</div>
<div class="line"><span class="lineno">  529</span> </div>
<div class="line"><span class="lineno">  530</span>    mask = lb_finite &amp; ub_finite</div>
<div class="line"><span class="lineno">  531</span>    d = ub - lb</div>
<div class="line"><span class="lineno">  532</span>    t = np.remainder(y[mask] - lb[mask], 2 * d[mask])</div>
<div class="line"><span class="lineno">  533</span>    x[mask] = lb[mask] + np.minimum(t, 2 * d[mask] - t)</div>
<div class="line"><span class="lineno">  534</span>    g_negative[mask] = t &gt; d[mask]</div>
<div class="line"><span class="lineno">  535</span> </div>
<div class="line"><span class="lineno">  536</span>    g = np.ones_like(y)</div>
<div class="line"><span class="lineno">  537</span>    g[g_negative] = -1</div>
<div class="line"><span class="lineno">  538</span> </div>
<div class="line"><span class="lineno">  539</span>    <span class="keywordflow">return</span> x, g</div>
<div class="line"><span class="lineno">  540</span> </div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span><span class="comment"># Functions to display algorithm&#39;s progress.</span></div>
<div class="line"><span class="lineno">  543</span> </div>
<div class="line"><span class="lineno">  544</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1b9c2a6e779332a723c0eba402973036" name="a1b9c2a6e779332a723c0eba402973036"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b9c2a6e779332a723c0eba402973036">&#9670;&#160;</a></span>regularized_lsq_operator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.regularized_lsq_operator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>diag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return a matrix arising in regularized least squares as LinearOperator.

The matrix is
    [ J ]
    [ D ]
where D is diagonal matrix with elements from `diag`.
</pre> <div class="fragment"><div class="line"><span class="lineno">  650</span><span class="keyword">def </span>regularized_lsq_operator(J, diag):</div>
<div class="line"><span class="lineno">  651</span>    <span class="stringliteral">&quot;&quot;&quot;Return a matrix arising in regularized least squares as LinearOperator.</span></div>
<div class="line"><span class="lineno">  652</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  653</span><span class="stringliteral">    The matrix is</span></div>
<div class="line"><span class="lineno">  654</span><span class="stringliteral">        [ J ]</span></div>
<div class="line"><span class="lineno">  655</span><span class="stringliteral">        [ D ]</span></div>
<div class="line"><span class="lineno">  656</span><span class="stringliteral">    where D is diagonal matrix with elements from `diag`.</span></div>
<div class="line"><span class="lineno">  657</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  658</span>    J = aslinearoperator(J)</div>
<div class="line"><span class="lineno">  659</span>    m, n = J.shape</div>
<div class="line"><span class="lineno">  660</span> </div>
<div class="line"><span class="lineno">  661</span>    <span class="keyword">def </span>matvec(x):</div>
<div class="line"><span class="lineno">  662</span>        <span class="keywordflow">return</span> np.hstack((J.matvec(x), diag * x))</div>
<div class="line"><span class="lineno">  663</span> </div>
<div class="line"><span class="lineno">  664</span>    <span class="keyword">def </span>rmatvec(x):</div>
<div class="line"><span class="lineno">  665</span>        x1 = x[:m]</div>
<div class="line"><span class="lineno">  666</span>        x2 = x[m:]</div>
<div class="line"><span class="lineno">  667</span>        <span class="keywordflow">return</span> J.rmatvec(x1) + diag * x2</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>    <span class="keywordflow">return</span> LinearOperator((m + n, n), matvec=matvec, rmatvec=rmatvec)</div>
<div class="line"><span class="lineno">  670</span> </div>
<div class="line"><span class="lineno">  671</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ab84f6d934eec0606ad26df906b39b2e8" name="ab84f6d934eec0606ad26df906b39b2e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab84f6d934eec0606ad26df906b39b2e8">&#9670;&#160;</a></span>right_multiplied_operator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.right_multiplied_operator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>d</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return J diag(d) as LinearOperator.</pre> <div class="fragment"><div class="line"><span class="lineno">  633</span><span class="keyword">def </span>right_multiplied_operator(J, d):</div>
<div class="line"><span class="lineno">  634</span>    <span class="stringliteral">&quot;&quot;&quot;Return J diag(d) as LinearOperator.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  635</span>    J = aslinearoperator(J)</div>
<div class="line"><span class="lineno">  636</span> </div>
<div class="line"><span class="lineno">  637</span>    <span class="keyword">def </span>matvec(x):</div>
<div class="line"><span class="lineno">  638</span>        <span class="keywordflow">return</span> J.matvec(np.ravel(x) * d)</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span>    <span class="keyword">def </span>matmat(X):</div>
<div class="line"><span class="lineno">  641</span>        <span class="keywordflow">return</span> J.matmat(X * d[:, np.newaxis])</div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span>    <span class="keyword">def </span>rmatvec(x):</div>
<div class="line"><span class="lineno">  644</span>        <span class="keywordflow">return</span> d * J.rmatvec(x)</div>
<div class="line"><span class="lineno">  645</span> </div>
<div class="line"><span class="lineno">  646</span>    <span class="keywordflow">return</span> LinearOperator(J.shape, matvec=matvec, matmat=matmat,</div>
<div class="line"><span class="lineno">  647</span>                          rmatvec=rmatvec)</div>
<div class="line"><span class="lineno">  648</span> </div>
<div class="line"><span class="lineno">  649</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aca475b6fcc243b1f6e73fb91cde9977e" name="aca475b6fcc243b1f6e73fb91cde9977e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca475b6fcc243b1f6e73fb91cde9977e">&#9670;&#160;</a></span>right_multiply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.right_multiply </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>copy</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute J diag(d).

If `copy` is False, `J` is modified in place (unless being LinearOperator).
</pre> <div class="fragment"><div class="line"><span class="lineno">  672</span><span class="keyword">def </span>right_multiply(J, d, copy=True):</div>
<div class="line"><span class="lineno">  673</span>    <span class="stringliteral">&quot;&quot;&quot;Compute J diag(d).</span></div>
<div class="line"><span class="lineno">  674</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  675</span><span class="stringliteral">    If `copy` is False, `J` is modified in place (unless being LinearOperator).</span></div>
<div class="line"><span class="lineno">  676</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  677</span>    <span class="keywordflow">if</span> copy <span class="keywordflow">and</span> <span class="keywordflow">not</span> isinstance(J, LinearOperator):</div>
<div class="line"><span class="lineno">  678</span>        J = J.copy()</div>
<div class="line"><span class="lineno">  679</span> </div>
<div class="line"><span class="lineno">  680</span>    <span class="keywordflow">if</span> issparse(J):</div>
<div class="line"><span class="lineno">  681</span>        J.data *= d.take(J.indices, mode=<span class="stringliteral">&#39;clip&#39;</span>)  <span class="comment"># scikit-learn recipe.</span></div>
<div class="line"><span class="lineno">  682</span>    <span class="keywordflow">elif</span> isinstance(J, LinearOperator):</div>
<div class="line"><span class="lineno">  683</span>        J = right_multiplied_operator(J, d)</div>
<div class="line"><span class="lineno">  684</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  685</span>        J *= d</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>    <span class="keywordflow">return</span> J</div>
<div class="line"><span class="lineno">  688</span> </div>
<div class="line"><span class="lineno">  689</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ae0dd4efec417f670a4461129ca7a4673" name="ae0dd4efec417f670a4461129ca7a4673"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0dd4efec417f670a4461129ca7a4673">&#9670;&#160;</a></span>scale_for_robust_loss_function()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.scale_for_robust_loss_function </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>rho</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Scale Jacobian and residuals for a robust loss function.

Arrays are modified in place.
</pre> <div class="fragment"><div class="line"><span class="lineno">  723</span><span class="keyword">def </span>scale_for_robust_loss_function(J, f, rho):</div>
<div class="line"><span class="lineno">  724</span>    <span class="stringliteral">&quot;&quot;&quot;Scale Jacobian and residuals for a robust loss function.</span></div>
<div class="line"><span class="lineno">  725</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  726</span><span class="stringliteral">    Arrays are modified in place.</span></div>
<div class="line"><span class="lineno">  727</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  728</span>    J_scale = rho[1] + 2 * rho[2] * f**2</div>
<div class="line"><span class="lineno">  729</span>    J_scale[J_scale &lt; EPS] = EPS</div>
<div class="line"><span class="lineno">  730</span>    J_scale **= 0.5</div>
<div class="line"><span class="lineno">  731</span> </div>
<div class="line"><span class="lineno">  732</span>    f *= rho[1] / J_scale</div>
<div class="line"><span class="lineno">  733</span> </div>
<div class="line"><span class="lineno">  734</span>    <span class="keywordflow">return</span> left_multiply(J, J_scale, copy=<span class="keyword">False</span>), f</div>
</div><!-- fragment -->
</div>
</div>
<a id="af1f199fb0893704ab9f2765fe907aa1f" name="af1f199fb0893704ab9f2765fe907aa1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1f199fb0893704ab9f2765fe907aa1f">&#9670;&#160;</a></span>solve_lsq_trust_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.solve_lsq_trust_region </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>uf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>V</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>initial_alpha</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>rtol</em> = <code>0.01</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_iter</em> = <code>10</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Solve a trust-region problem arising in least-squares minimization.

This function implements a method described by J. J. More [1]_ and used
in MINPACK, but it relies on a single SVD of Jacobian instead of series
of Cholesky decompositions. Before running this function, compute:
``U, s, VT = svd(J, full_matrices=False)``.

Parameters
----------
n : int
    Number of variables.
m : int
    Number of residuals.
uf : ndarray
    Computed as U.T.dot(f).
s : ndarray
    Singular values of J.
V : ndarray
    Transpose of VT.
Delta : float
    Radius of a trust region.
initial_alpha : float, optional
    Initial guess for alpha, which might be available from a previous
    iteration. If None, determined automatically.
rtol : float, optional
    Stopping tolerance for the root-finding procedure. Namely, the
    solution ``p`` will satisfy ``abs(norm(p) - Delta) &lt; rtol * Delta``.
max_iter : int, optional
    Maximum allowed number of iterations for the root-finding procedure.

Returns
-------
p : ndarray, shape (n,)
    Found solution of a trust-region problem.
alpha : float
    Positive value such that (J.T*J + alpha*I)*p = -J.T*f.
    Sometimes called Levenberg-Marquardt parameter.
n_iter : int
    Number of iterations made by root-finding procedure. Zero means
    that Gauss-Newton step was selected as the solution.

References
----------
.. [1] More, J. J., "The Levenberg-Marquardt Algorithm: Implementation
       and Theory," Numerical Analysis, ed. G. A. Watson, Lecture Notes
       in Mathematics 630, Springer Verlag, pp. 105-116, 1977.
</pre> <div class="fragment"><div class="line"><span class="lineno">   58</span>                           rtol=0.01, max_iter=10):</div>
<div class="line"><span class="lineno">   59</span>    <span class="stringliteral">&quot;&quot;&quot;Solve a trust-region problem arising in least-squares minimization.</span></div>
<div class="line"><span class="lineno">   60</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral">    This function implements a method described by J. J. More [1]_ and used</span></div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">    in MINPACK, but it relies on a single SVD of Jacobian instead of series</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">    of Cholesky decompositions. Before running this function, compute:</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral">    ``U, s, VT = svd(J, full_matrices=False)``.</span></div>
<div class="line"><span class="lineno">   65</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   66</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">   67</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">   68</span><span class="stringliteral">    n : int</span></div>
<div class="line"><span class="lineno">   69</span><span class="stringliteral">        Number of variables.</span></div>
<div class="line"><span class="lineno">   70</span><span class="stringliteral">    m : int</span></div>
<div class="line"><span class="lineno">   71</span><span class="stringliteral">        Number of residuals.</span></div>
<div class="line"><span class="lineno">   72</span><span class="stringliteral">    uf : ndarray</span></div>
<div class="line"><span class="lineno">   73</span><span class="stringliteral">        Computed as U.T.dot(f).</span></div>
<div class="line"><span class="lineno">   74</span><span class="stringliteral">    s : ndarray</span></div>
<div class="line"><span class="lineno">   75</span><span class="stringliteral">        Singular values of J.</span></div>
<div class="line"><span class="lineno">   76</span><span class="stringliteral">    V : ndarray</span></div>
<div class="line"><span class="lineno">   77</span><span class="stringliteral">        Transpose of VT.</span></div>
<div class="line"><span class="lineno">   78</span><span class="stringliteral">    Delta : float</span></div>
<div class="line"><span class="lineno">   79</span><span class="stringliteral">        Radius of a trust region.</span></div>
<div class="line"><span class="lineno">   80</span><span class="stringliteral">    initial_alpha : float, optional</span></div>
<div class="line"><span class="lineno">   81</span><span class="stringliteral">        Initial guess for alpha, which might be available from a previous</span></div>
<div class="line"><span class="lineno">   82</span><span class="stringliteral">        iteration. If None, determined automatically.</span></div>
<div class="line"><span class="lineno">   83</span><span class="stringliteral">    rtol : float, optional</span></div>
<div class="line"><span class="lineno">   84</span><span class="stringliteral">        Stopping tolerance for the root-finding procedure. Namely, the</span></div>
<div class="line"><span class="lineno">   85</span><span class="stringliteral">        solution ``p`` will satisfy ``abs(norm(p) - Delta) &lt; rtol * Delta``.</span></div>
<div class="line"><span class="lineno">   86</span><span class="stringliteral">    max_iter : int, optional</span></div>
<div class="line"><span class="lineno">   87</span><span class="stringliteral">        Maximum allowed number of iterations for the root-finding procedure.</span></div>
<div class="line"><span class="lineno">   88</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">   90</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">   91</span><span class="stringliteral">    p : ndarray, shape (n,)</span></div>
<div class="line"><span class="lineno">   92</span><span class="stringliteral">        Found solution of a trust-region problem.</span></div>
<div class="line"><span class="lineno">   93</span><span class="stringliteral">    alpha : float</span></div>
<div class="line"><span class="lineno">   94</span><span class="stringliteral">        Positive value such that (J.T*J + alpha*I)*p = -J.T*f.</span></div>
<div class="line"><span class="lineno">   95</span><span class="stringliteral">        Sometimes called Levenberg-Marquardt parameter.</span></div>
<div class="line"><span class="lineno">   96</span><span class="stringliteral">    n_iter : int</span></div>
<div class="line"><span class="lineno">   97</span><span class="stringliteral">        Number of iterations made by root-finding procedure. Zero means</span></div>
<div class="line"><span class="lineno">   98</span><span class="stringliteral">        that Gauss-Newton step was selected as the solution.</span></div>
<div class="line"><span class="lineno">   99</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral">    References</span></div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">    .. [1] More, J. J., &quot;The Levenberg-Marquardt Algorithm: Implementation</span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral">           and Theory,&quot; Numerical Analysis, ed. G. A. Watson, Lecture Notes</span></div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">           in Mathematics 630, Springer Verlag, pp. 105-116, 1977.</span></div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  106</span>    <span class="keyword">def </span>phi_and_derivative(alpha, suf, s, Delta):</div>
<div class="line"><span class="lineno">  107</span>        <span class="stringliteral">&quot;&quot;&quot;Function of which to find zero.</span></div>
<div class="line"><span class="lineno">  108</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  109</span><span class="stringliteral">        It is defined as &quot;norm of regularized (by alpha) least-squares</span></div>
<div class="line"><span class="lineno">  110</span><span class="stringliteral">        solution minus `Delta`&quot;. Refer to [1]_.</span></div>
<div class="line"><span class="lineno">  111</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  112</span>        denom = s**2 + alpha</div>
<div class="line"><span class="lineno">  113</span>        p_norm = norm(suf / denom)</div>
<div class="line"><span class="lineno">  114</span>        phi = p_norm - Delta</div>
<div class="line"><span class="lineno">  115</span>        phi_prime = -np.sum(suf ** 2 / denom**3) / p_norm</div>
<div class="line"><span class="lineno">  116</span>        <span class="keywordflow">return</span> phi, phi_prime</div>
<div class="line"><span class="lineno">  117</span> </div>
<div class="line"><span class="lineno">  118</span>    suf = s * uf</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>    <span class="comment"># Check if J has full rank and try Gauss-Newton step.</span></div>
<div class="line"><span class="lineno">  121</span>    <span class="keywordflow">if</span> m &gt;= n:</div>
<div class="line"><span class="lineno">  122</span>        threshold = EPS * m * s[0]</div>
<div class="line"><span class="lineno">  123</span>        full_rank = s[-1] &gt; threshold</div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  125</span>        full_rank = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordflow">if</span> full_rank:</div>
<div class="line"><span class="lineno">  128</span>        p = -V.dot(uf / s)</div>
<div class="line"><span class="lineno">  129</span>        <span class="keywordflow">if</span> norm(p) &lt;= Delta:</div>
<div class="line"><span class="lineno">  130</span>            <span class="keywordflow">return</span> p, 0.0, 0</div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span>    alpha_upper = norm(suf) / Delta</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>    <span class="keywordflow">if</span> full_rank:</div>
<div class="line"><span class="lineno">  135</span>        phi, phi_prime = phi_and_derivative(0.0, suf, s, Delta)</div>
<div class="line"><span class="lineno">  136</span>        alpha_lower = -phi / phi_prime</div>
<div class="line"><span class="lineno">  137</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  138</span>        alpha_lower = 0.0</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>    <span class="keywordflow">if</span> initial_alpha <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> <span class="keywordflow">not</span> full_rank <span class="keywordflow">and</span> initial_alpha == 0:</div>
<div class="line"><span class="lineno">  141</span>        alpha = max(0.001 * alpha_upper, (alpha_lower * alpha_upper)**0.5)</div>
<div class="line"><span class="lineno">  142</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  143</span>        alpha = initial_alpha</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>    <span class="keywordflow">for</span> it <span class="keywordflow">in</span> range(max_iter):</div>
<div class="line"><span class="lineno">  146</span>        <span class="keywordflow">if</span> alpha &lt; alpha_lower <span class="keywordflow">or</span> alpha &gt; alpha_upper:</div>
<div class="line"><span class="lineno">  147</span>            alpha = max(0.001 * alpha_upper, (alpha_lower * alpha_upper)**0.5)</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>        phi, phi_prime = phi_and_derivative(alpha, suf, s, Delta)</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>        <span class="keywordflow">if</span> phi &lt; 0:</div>
<div class="line"><span class="lineno">  152</span>            alpha_upper = alpha</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>        ratio = phi / phi_prime</div>
<div class="line"><span class="lineno">  155</span>        alpha_lower = max(alpha_lower, alpha - ratio)</div>
<div class="line"><span class="lineno">  156</span>        alpha -= (phi + Delta) * ratio / Delta</div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>        <span class="keywordflow">if</span> np.abs(phi) &lt; rtol * Delta:</div>
<div class="line"><span class="lineno">  159</span>            <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span>    p = -V.dot(suf / (s**2 + alpha))</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>    <span class="comment"># Make the norm of p equal to Delta, p is changed only slightly during</span></div>
<div class="line"><span class="lineno">  164</span>    <span class="comment"># this. It is done to prevent p lie outside the trust region (which can</span></div>
<div class="line"><span class="lineno">  165</span>    <span class="comment"># cause problems later).</span></div>
<div class="line"><span class="lineno">  166</span>    p *= Delta / norm(p)</div>
<div class="line"><span class="lineno">  167</span> </div>
<div class="line"><span class="lineno">  168</span>    <span class="keywordflow">return</span> p, alpha, it + 1</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1630ded126d0e065000df48fd8831add" name="a1630ded126d0e065000df48fd8831add"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1630ded126d0e065000df48fd8831add">&#9670;&#160;</a></span>solve_trust_region_2d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.solve_trust_region_2d </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Solve a general trust-region problem in 2 dimensions.

The problem is reformulated as a 4th order algebraic equation,
the solution of which is found by numpy.roots.

Parameters
----------
B : ndarray, shape (2, 2)
    Symmetric matrix, defines a quadratic term of the function.
g : ndarray, shape (2,)
    Defines a linear term of the function.
Delta : float
    Radius of a trust region.

Returns
-------
p : ndarray, shape (2,)
    Found solution.
newton_step : bool
    Whether the returned solution is the Newton step which lies within
    the trust region.
</pre> <div class="fragment"><div class="line"><span class="lineno">  171</span><span class="keyword">def </span>solve_trust_region_2d(B, g, Delta):</div>
<div class="line"><span class="lineno">  172</span>    <span class="stringliteral">&quot;&quot;&quot;Solve a general trust-region problem in 2 dimensions.</span></div>
<div class="line"><span class="lineno">  173</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  174</span><span class="stringliteral">    The problem is reformulated as a 4th order algebraic equation,</span></div>
<div class="line"><span class="lineno">  175</span><span class="stringliteral">    the solution of which is found by numpy.roots.</span></div>
<div class="line"><span class="lineno">  176</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  177</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  178</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  179</span><span class="stringliteral">    B : ndarray, shape (2, 2)</span></div>
<div class="line"><span class="lineno">  180</span><span class="stringliteral">        Symmetric matrix, defines a quadratic term of the function.</span></div>
<div class="line"><span class="lineno">  181</span><span class="stringliteral">    g : ndarray, shape (2,)</span></div>
<div class="line"><span class="lineno">  182</span><span class="stringliteral">        Defines a linear term of the function.</span></div>
<div class="line"><span class="lineno">  183</span><span class="stringliteral">    Delta : float</span></div>
<div class="line"><span class="lineno">  184</span><span class="stringliteral">        Radius of a trust region.</span></div>
<div class="line"><span class="lineno">  185</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  186</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  187</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  188</span><span class="stringliteral">    p : ndarray, shape (2,)</span></div>
<div class="line"><span class="lineno">  189</span><span class="stringliteral">        Found solution.</span></div>
<div class="line"><span class="lineno">  190</span><span class="stringliteral">    newton_step : bool</span></div>
<div class="line"><span class="lineno">  191</span><span class="stringliteral">        Whether the returned solution is the Newton step which lies within</span></div>
<div class="line"><span class="lineno">  192</span><span class="stringliteral">        the trust region.</span></div>
<div class="line"><span class="lineno">  193</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  194</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  195</span>        R, lower = cho_factor(B)</div>
<div class="line"><span class="lineno">  196</span>        p = -cho_solve((R, lower), g)</div>
<div class="line"><span class="lineno">  197</span>        <span class="keywordflow">if</span> np.dot(p, p) &lt;= Delta**2:</div>
<div class="line"><span class="lineno">  198</span>            <span class="keywordflow">return</span> p, <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  199</span>    <span class="keywordflow">except</span> LinAlgError:</div>
<div class="line"><span class="lineno">  200</span>        <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>    a = B[0, 0] * Delta**2</div>
<div class="line"><span class="lineno">  203</span>    b = B[0, 1] * Delta**2</div>
<div class="line"><span class="lineno">  204</span>    c = B[1, 1] * Delta**2</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>    d = g[0] * Delta</div>
<div class="line"><span class="lineno">  207</span>    f = g[1] * Delta</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>    coeffs = np.array(</div>
<div class="line"><span class="lineno">  210</span>        [-b + d, 2 * (a - c + f), 6 * b, 2 * (-a + c + f), -b - d])</div>
<div class="line"><span class="lineno">  211</span>    t = np.roots(coeffs)  <span class="comment"># Can handle leading zeros.</span></div>
<div class="line"><span class="lineno">  212</span>    t = np.real(t[np.isreal(t)])</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>    p = Delta * np.vstack((2 * t / (1 + t**2), (1 - t**2) / (1 + t**2)))</div>
<div class="line"><span class="lineno">  215</span>    value = 0.5 * np.sum(p * B.dot(p), axis=0) + np.dot(g, p)</div>
<div class="line"><span class="lineno">  216</span>    i = np.argmin(value)</div>
<div class="line"><span class="lineno">  217</span>    p = p[:, i]</div>
<div class="line"><span class="lineno">  218</span> </div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">return</span> p, <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a38ccc66b1c6c6b834b6dfcaa5d5b851a" name="a38ccc66b1c6c6b834b6dfcaa5d5b851a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38ccc66b1c6c6b834b6dfcaa5d5b851a">&#9670;&#160;</a></span>step_size_to_bound()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.step_size_to_bound </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ub</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute a min_step size required to reach a bound.

The function computes a positive scalar t, such that x + s * t is on
the bound.

Returns
-------
step : float
    Computed step. Non-negative value.
hits : ndarray of int with shape of x
    Each element indicates whether a corresponding variable reaches the
    bound:

         *  0 - the bound was not hit.
         * -1 - the lower bound was hit.
         *  1 - the upper bound was hit.
</pre> <div class="fragment"><div class="line"><span class="lineno">  372</span><span class="keyword">def </span>step_size_to_bound(x, s, lb, ub):</div>
<div class="line"><span class="lineno">  373</span>    <span class="stringliteral">&quot;&quot;&quot;Compute a min_step size required to reach a bound.</span></div>
<div class="line"><span class="lineno">  374</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  375</span><span class="stringliteral">    The function computes a positive scalar t, such that x + s * t is on</span></div>
<div class="line"><span class="lineno">  376</span><span class="stringliteral">    the bound.</span></div>
<div class="line"><span class="lineno">  377</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  378</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  379</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  380</span><span class="stringliteral">    step : float</span></div>
<div class="line"><span class="lineno">  381</span><span class="stringliteral">        Computed step. Non-negative value.</span></div>
<div class="line"><span class="lineno">  382</span><span class="stringliteral">    hits : ndarray of int with shape of x</span></div>
<div class="line"><span class="lineno">  383</span><span class="stringliteral">        Each element indicates whether a corresponding variable reaches the</span></div>
<div class="line"><span class="lineno">  384</span><span class="stringliteral">        bound:</span></div>
<div class="line"><span class="lineno">  385</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  386</span><span class="stringliteral">             *  0 - the bound was not hit.</span></div>
<div class="line"><span class="lineno">  387</span><span class="stringliteral">             * -1 - the lower bound was hit.</span></div>
<div class="line"><span class="lineno">  388</span><span class="stringliteral">             *  1 - the upper bound was hit.</span></div>
<div class="line"><span class="lineno">  389</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  390</span>    non_zero = np.nonzero(s)</div>
<div class="line"><span class="lineno">  391</span>    s_non_zero = s[non_zero]</div>
<div class="line"><span class="lineno">  392</span>    steps = np.empty_like(x)</div>
<div class="line"><span class="lineno">  393</span>    steps.fill(np.inf)</div>
<div class="line"><span class="lineno">  394</span>    <span class="keyword">with</span> np.errstate(over=<span class="stringliteral">&#39;ignore&#39;</span>):</div>
<div class="line"><span class="lineno">  395</span>        steps[non_zero] = np.maximum((lb - x)[non_zero] / s_non_zero,</div>
<div class="line"><span class="lineno">  396</span>                                     (ub - x)[non_zero] / s_non_zero)</div>
<div class="line"><span class="lineno">  397</span>    min_step = np.min(steps)</div>
<div class="line"><span class="lineno">  398</span>    <span class="keywordflow">return</span> min_step, np.equal(steps, min_step) * np.sign(s).astype(int)</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a5bd41d6c2d8809fabf99d993c74665f7" name="a5bd41d6c2d8809fabf99d993c74665f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bd41d6c2d8809fabf99d993c74665f7">&#9670;&#160;</a></span>update_tr_radius()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.update_tr_radius </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>actual_reduction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>predicted_reduction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>step_norm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>bound_hit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Update the radius of a trust region based on the cost reduction.

Returns
-------
Delta : float
    New radius.
ratio : float
    Ratio between actual and predicted reductions.
</pre> <div class="fragment"><div class="line"><span class="lineno">  223</span>                     step_norm, bound_hit):</div>
<div class="line"><span class="lineno">  224</span>    <span class="stringliteral">&quot;&quot;&quot;Update the radius of a trust region based on the cost reduction.</span></div>
<div class="line"><span class="lineno">  225</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  226</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  227</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  228</span><span class="stringliteral">    Delta : float</span></div>
<div class="line"><span class="lineno">  229</span><span class="stringliteral">        New radius.</span></div>
<div class="line"><span class="lineno">  230</span><span class="stringliteral">    ratio : float</span></div>
<div class="line"><span class="lineno">  231</span><span class="stringliteral">        Ratio between actual and predicted reductions.</span></div>
<div class="line"><span class="lineno">  232</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  233</span>    <span class="keywordflow">if</span> predicted_reduction &gt; 0:</div>
<div class="line"><span class="lineno">  234</span>        ratio = actual_reduction / predicted_reduction</div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">elif</span> predicted_reduction == actual_reduction == 0:</div>
<div class="line"><span class="lineno">  236</span>        ratio = 1</div>
<div class="line"><span class="lineno">  237</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  238</span>        ratio = 0</div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>    <span class="keywordflow">if</span> ratio &lt; 0.25:</div>
<div class="line"><span class="lineno">  241</span>        Delta = 0.25 * step_norm</div>
<div class="line"><span class="lineno">  242</span>    <span class="keywordflow">elif</span> ratio &gt; 0.75 <span class="keywordflow">and</span> bound_hit:</div>
<div class="line"><span class="lineno">  243</span>        Delta *= 2.0</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>    <span class="keywordflow">return</span> Delta, ratio</div>
<div class="line"><span class="lineno">  246</span> </div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span><span class="comment"># Construction and minimization of quadratic functions.</span></div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="afb51cc46129a4c6d7cf813ed10281333" name="afb51cc46129a4c6d7cf813ed10281333"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb51cc46129a4c6d7cf813ed10281333">&#9670;&#160;</a></span>EPS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.optimize._lsq.common.EPS = np.finfo(float).<a class="el" href="__lapack__subroutines_8h.html#a57833d05f43fd1408080af6eec88fc43">eps</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
