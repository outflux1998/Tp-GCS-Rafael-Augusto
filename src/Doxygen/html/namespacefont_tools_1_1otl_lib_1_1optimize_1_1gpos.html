<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: fontTools.otlLib.optimize.gpos Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacefont_tools.html">fontTools</a></li><li class="navelem"><a class="el" href="namespacefont_tools_1_1otl_lib.html">otlLib</a></li><li class="navelem"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize.html">optimize</a></li><li class="navelem"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html">gpos</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">fontTools.otlLib.optimize.gpos Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfont_tools_1_1otl_lib_1_1optimize_1_1gpos_1_1_cluster.html">Cluster</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4e5d58a273cfbc9d7e9022bcfbb1b763" id="r_a4e5d58a273cfbc9d7e9022bcfbb1b763"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a4e5d58a273cfbc9d7e9022bcfbb1b763">_compression_level_from_env</a> ()</td></tr>
<tr class="separator:a4e5d58a273cfbc9d7e9022bcfbb1b763"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac52bcc109e7ba52ebd37109ae5349342" id="r_ac52bcc109e7ba52ebd37109ae5349342"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#ac52bcc109e7ba52ebd37109ae5349342">compact</a> (<a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a> font, int level)</td></tr>
<tr class="separator:ac52bcc109e7ba52ebd37109ae5349342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44a364733d6a7532f361c827d619aba5" id="r_a44a364733d6a7532f361c827d619aba5"><td class="memItemLeft" align="right" valign="top">None&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a44a364733d6a7532f361c827d619aba5">compact_lookup</a> (<a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a> font, int level, otTables.Lookup lookup)</td></tr>
<tr class="separator:a44a364733d6a7532f361c827d619aba5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80a9324facd1e5fa20fc6d9d00c1c0a3" id="r_a80a9324facd1e5fa20fc6d9d00c1c0a3"><td class="memItemLeft" align="right" valign="top">None&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a80a9324facd1e5fa20fc6d9d00c1c0a3">compact_ext_lookup</a> (<a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a> font, int level, otTables.Lookup lookup)</td></tr>
<tr class="separator:a80a9324facd1e5fa20fc6d9d00c1c0a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e171b282350b197de017250ca9aa369" id="r_a1e171b282350b197de017250ca9aa369"><td class="memItemLeft" align="right" valign="top">Sequence[otTables.PairPos]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a1e171b282350b197de017250ca9aa369">compact_pair_pos</a> (<a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a> font, int level, Sequence[otTables.PairPos] subtables)</td></tr>
<tr class="separator:a1e171b282350b197de017250ca9aa369"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad263192c94e1134e1d289e11a14c58e0" id="r_ad263192c94e1134e1d289e11a14c58e0"><td class="memItemLeft" align="right" valign="top">List[otTables.PairPos]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#ad263192c94e1134e1d289e11a14c58e0">compact_class_pairs</a> (<a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a> font, int level, otTables.PairPos subtable)</td></tr>
<tr class="separator:ad263192c94e1134e1d289e11a14c58e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93ced93f285fd1beccfaff576d35453e" id="r_a93ced93f285fd1beccfaff576d35453e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a93ced93f285fd1beccfaff576d35453e">is_really_zero</a> (otTables.Class2Record class2)</td></tr>
<tr class="separator:a93ced93f285fd1beccfaff576d35453e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24ff19714da88cb7154160a86e2b3ada" id="r_a24ff19714da88cb7154160a86e2b3ada"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a24ff19714da88cb7154160a86e2b3ada">_getClassRanges</a> (Iterable[int] glyphIDs)</td></tr>
<tr class="separator:a24ff19714da88cb7154160a86e2b3ada"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17d3633316eb052eea4c5d39b77ee9e3" id="r_a17d3633316eb052eea4c5d39b77ee9e3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a17d3633316eb052eea4c5d39b77ee9e3">_classDef_bytes</a> (List[Tuple[List[Tuple[int, int]], int, int]] class_data, List[int] class_ids, coverage=False)</td></tr>
<tr class="separator:a17d3633316eb052eea4c5d39b77ee9e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53ad9625c7680e1a4e764169bd75f3ba" id="r_a53ad9625c7680e1a4e764169bd75f3ba"><td class="memItemLeft" align="right" valign="top">List[<a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a994a94d5a819abf0423dc2d5dde73eb4">Pairs</a>]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a53ad9625c7680e1a4e764169bd75f3ba">cluster_pairs_by_class2_coverage_custom_cost</a> (<a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a> font, <a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a994a94d5a819abf0423dc2d5dde73eb4">Pairs</a> pairs, int compression=5)</td></tr>
<tr class="separator:a53ad9625c7680e1a4e764169bd75f3ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5184e9b72ca37ff5ba4b0594a478f192" id="r_a5184e9b72ca37ff5ba4b0594a478f192"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a5184e9b72ca37ff5ba4b0594a478f192">log</a> = logging.getLogger(__name__)</td></tr>
<tr class="separator:a5184e9b72ca37ff5ba4b0594a478f192"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39f22f0d8c58b752377f5797756d6719" id="r_a39f22f0d8c58b752377f5797756d6719"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a39f22f0d8c58b752377f5797756d6719">COMPRESSION_LEVEL</a> = OPTIONS[f&quot;{__name__}:COMPRESSION_LEVEL&quot;]</td></tr>
<tr class="separator:a39f22f0d8c58b752377f5797756d6719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18708b8513fa29df93ae23e583b2352b" id="r_a18708b8513fa29df93ae23e583b2352b"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a18708b8513fa29df93ae23e583b2352b">GPOS_COMPACT_MODE_ENV_KEY</a> = &quot;FONTTOOLS_GPOS_COMPACT_MODE&quot;</td></tr>
<tr class="separator:a18708b8513fa29df93ae23e583b2352b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a195c7de4650f3dbafdbf6ea5cde46c97" id="r_a195c7de4650f3dbafdbf6ea5cde46c97"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a195c7de4650f3dbafdbf6ea5cde46c97">GPOS_COMPACT_MODE_DEFAULT</a> = str(COMPRESSION_LEVEL.default)</td></tr>
<tr class="separator:a195c7de4650f3dbafdbf6ea5cde46c97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a994a94d5a819abf0423dc2d5dde73eb4" id="r_a994a94d5a819abf0423dc2d5dde73eb4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a994a94d5a819abf0423dc2d5dde73eb4">Pairs</a></td></tr>
<tr class="separator:a994a94d5a819abf0423dc2d5dde73eb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2321856b60bd145cd606db20133d1c06" id="r_a2321856b60bd145cd606db20133d1c06"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a2321856b60bd145cd606db20133d1c06">ClusteringContext</a></td></tr>
<tr class="separator:a2321856b60bd145cd606db20133d1c06"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a17d3633316eb052eea4c5d39b77ee9e3" name="a17d3633316eb052eea4c5d39b77ee9e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17d3633316eb052eea4c5d39b77ee9e3">&#9670;&#160;</a></span>_classDef_bytes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.otlLib.optimize.gpos._classDef_bytes </td>
          <td>(</td>
          <td class="paramtype">List[Tuple[List[Tuple[int, int]], int, int]]&#160;</td>
          <td class="paramname"><em>class_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">List[int]&#160;</td>
          <td class="paramname"><em>class_ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>coverage</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  157</span>):</div>
<div class="line"><span class="lineno">  158</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> class_ids:</div>
<div class="line"><span class="lineno">  159</span>        <span class="keywordflow">return</span> 0</div>
<div class="line"><span class="lineno">  160</span>    first_ranges, min_glyph_id, max_glyph_id = class_data[class_ids[0]]</div>
<div class="line"><span class="lineno">  161</span>    range_count = len(first_ranges)</div>
<div class="line"><span class="lineno">  162</span>    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> class_ids[1:]:</div>
<div class="line"><span class="lineno">  163</span>        data = class_data[i]</div>
<div class="line"><span class="lineno">  164</span>        range_count += len(data[0])</div>
<div class="line"><span class="lineno">  165</span>        min_glyph_id = min(min_glyph_id, data[1])</div>
<div class="line"><span class="lineno">  166</span>        max_glyph_id = max(max_glyph_id, data[2])</div>
<div class="line"><span class="lineno">  167</span>    glyphCount = max_glyph_id - min_glyph_id + 1</div>
<div class="line"><span class="lineno">  168</span>    <span class="comment"># https://docs.microsoft.com/en-us/typography/opentype/spec/chapter2#class-definition-table-format-1</span></div>
<div class="line"><span class="lineno">  169</span>    format1_bytes = 6 + glyphCount * 2</div>
<div class="line"><span class="lineno">  170</span>    <span class="comment"># https://docs.microsoft.com/en-us/typography/opentype/spec/chapter2#class-definition-table-format-2</span></div>
<div class="line"><span class="lineno">  171</span>    format2_bytes = 4 + range_count * 6</div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordflow">return</span> min(format1_bytes, format2_bytes)</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a4e5d58a273cfbc9d7e9022bcfbb1b763" name="a4e5d58a273cfbc9d7e9022bcfbb1b763"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e5d58a273cfbc9d7e9022bcfbb1b763">&#9670;&#160;</a></span>_compression_level_from_env()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"> int fontTools.otlLib.optimize.gpos._compression_level_from_env </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   24</span><span class="keyword">def </span>_compression_level_from_env() -&gt; int:</div>
<div class="line"><span class="lineno">   25</span>    env_level = GPOS_COMPACT_MODE_DEFAULT</div>
<div class="line"><span class="lineno">   26</span>    <span class="keywordflow">if</span> GPOS_COMPACT_MODE_ENV_KEY <span class="keywordflow">in</span> os.environ:</div>
<div class="line"><span class="lineno">   27</span>        <span class="keyword">import</span> warnings</div>
<div class="line"><span class="lineno">   28</span> </div>
<div class="line"><span class="lineno">   29</span>        warnings.warn(</div>
<div class="line"><span class="lineno">   30</span>            f<span class="stringliteral">&quot;&#39;{GPOS_COMPACT_MODE_ENV_KEY}&#39; environment variable is deprecated. &quot;</span></div>
<div class="line"><span class="lineno">   31</span>            <span class="stringliteral">&quot;Please set the &#39;fontTools.otlLib.optimize.gpos:COMPRESSION_LEVEL&#39; option &quot;</span></div>
<div class="line"><span class="lineno">   32</span>            <span class="stringliteral">&quot;in TTFont.cfg.&quot;</span>,</div>
<div class="line"><span class="lineno">   33</span>            DeprecationWarning,</div>
<div class="line"><span class="lineno">   34</span>        )</div>
<div class="line"><span class="lineno">   35</span> </div>
<div class="line"><span class="lineno">   36</span>        env_level = os.environ[GPOS_COMPACT_MODE_ENV_KEY]</div>
<div class="line"><span class="lineno">   37</span>    <span class="keywordflow">if</span> len(env_level) == 1 <span class="keywordflow">and</span> env_level <span class="keywordflow">in</span> <span class="stringliteral">&quot;0123456789&quot;</span>:</div>
<div class="line"><span class="lineno">   38</span>        <span class="keywordflow">return</span> int(env_level)</div>
<div class="line"><span class="lineno">   39</span>    <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&quot;Bad {GPOS_COMPACT_MODE_ENV_KEY}={env_level}&quot;</span>)</div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a24ff19714da88cb7154160a86e2b3ada" name="a24ff19714da88cb7154160a86e2b3ada"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24ff19714da88cb7154160a86e2b3ada">&#9670;&#160;</a></span>_getClassRanges()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.otlLib.optimize.gpos._getClassRanges </td>
          <td>(</td>
          <td class="paramtype">Iterable[int]&#160;</td>
          <td class="paramname"><em>glyphIDs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  139</span><span class="keyword">def </span>_getClassRanges(glyphIDs: Iterable[int]):</div>
<div class="line"><span class="lineno">  140</span>    glyphIDs = sorted(glyphIDs)</div>
<div class="line"><span class="lineno">  141</span>    last = glyphIDs[0]</div>
<div class="line"><span class="lineno">  142</span>    ranges = [[last]]</div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">for</span> glyphID <span class="keywordflow">in</span> glyphIDs[1:]:</div>
<div class="line"><span class="lineno">  144</span>        <span class="keywordflow">if</span> glyphID != last + 1:</div>
<div class="line"><span class="lineno">  145</span>            ranges[-1].append(last)</div>
<div class="line"><span class="lineno">  146</span>            ranges.append([glyphID])</div>
<div class="line"><span class="lineno">  147</span>        last = glyphID</div>
<div class="line"><span class="lineno">  148</span>    ranges[-1].append(last)</div>
<div class="line"><span class="lineno">  149</span>    <span class="keywordflow">return</span> ranges, glyphIDs[0], glyphIDs[-1]</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span><span class="comment"># Adapted from https://github.com/fonttools/fonttools/blob/f64f0b42f2d1163b2d85194e0979def539f5dca3/Lib/fontTools/ttLib/tables/otTables.py#L960-L989</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a53ad9625c7680e1a4e764169bd75f3ba" name="a53ad9625c7680e1a4e764169bd75f3ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53ad9625c7680e1a4e764169bd75f3ba">&#9670;&#160;</a></span>cluster_pairs_by_class2_coverage_custom_cost()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> List[<a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a994a94d5a819abf0423dc2d5dde73eb4">Pairs</a>] fontTools.otlLib.optimize.gpos.cluster_pairs_by_class2_coverage_custom_cost </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a>&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefont_tools_1_1otl_lib_1_1optimize_1_1gpos.html#a994a94d5a819abf0423dc2d5dde73eb4">Pairs</a>&#160;</td>
          <td class="paramname"><em>pairs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>compression</em> = <code>5</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  316</span>) -&gt; List[Pairs]:</div>
<div class="line"><span class="lineno">  317</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> pairs:</div>
<div class="line"><span class="lineno">  318</span>        <span class="comment"># The subtable was actually empty?</span></div>
<div class="line"><span class="lineno">  319</span>        <span class="keywordflow">return</span> [pairs]</div>
<div class="line"><span class="lineno">  320</span> </div>
<div class="line"><span class="lineno">  321</span>    <span class="comment"># Sorted for reproducibility/determinism</span></div>
<div class="line"><span class="lineno">  322</span>    all_class1 = sorted(set(pair[0] <span class="keywordflow">for</span> pair <span class="keywordflow">in</span> pairs))</div>
<div class="line"><span class="lineno">  323</span>    all_class2 = sorted(set(pair[1] <span class="keywordflow">for</span> pair <span class="keywordflow">in</span> pairs))</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>    <span class="comment"># Use Python&#39;s big ints for binary vectors representing each line</span></div>
<div class="line"><span class="lineno">  326</span>    lines = [</div>
<div class="line"><span class="lineno">  327</span>        sum(</div>
<div class="line"><span class="lineno">  328</span>            1 &lt;&lt; i <span class="keywordflow">if</span> (class1, class2) <span class="keywordflow">in</span> pairs <span class="keywordflow">else</span> 0</div>
<div class="line"><span class="lineno">  329</span>            <span class="keywordflow">for</span> i, class2 <span class="keywordflow">in</span> enumerate(all_class2)</div>
<div class="line"><span class="lineno">  330</span>        )</div>
<div class="line"><span class="lineno">  331</span>        <span class="keywordflow">for</span> class1 <span class="keywordflow">in</span> all_class1</div>
<div class="line"><span class="lineno">  332</span>    ]</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>    <span class="comment"># Map glyph names to ids and work with ints throughout for ClassDef formats</span></div>
<div class="line"><span class="lineno">  335</span>    name_to_id = font.getReverseGlyphMap()</div>
<div class="line"><span class="lineno">  336</span>    <span class="comment"># Each entry in the arrays below is (range_count, min_glyph_id, max_glyph_id)</span></div>
<div class="line"><span class="lineno">  337</span>    all_class1_data = [</div>
<div class="line"><span class="lineno">  338</span>        _getClassRanges(name_to_id[name] <span class="keywordflow">for</span> name <span class="keywordflow">in</span> cls) <span class="keywordflow">for</span> cls <span class="keywordflow">in</span> all_class1</div>
<div class="line"><span class="lineno">  339</span>    ]</div>
<div class="line"><span class="lineno">  340</span>    all_class2_data = [</div>
<div class="line"><span class="lineno">  341</span>        _getClassRanges(name_to_id[name] <span class="keywordflow">for</span> name <span class="keywordflow">in</span> cls) <span class="keywordflow">for</span> cls <span class="keywordflow">in</span> all_class2</div>
<div class="line"><span class="lineno">  342</span>    ]</div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>    format1 = 0</div>
<div class="line"><span class="lineno">  345</span>    format2 = 0</div>
<div class="line"><span class="lineno">  346</span>    <span class="keywordflow">for</span> pair, value <span class="keywordflow">in</span> pairs.items():</div>
<div class="line"><span class="lineno">  347</span>        format1 |= value[0].getEffectiveFormat() <span class="keywordflow">if</span> value[0] <span class="keywordflow">else</span> 0</div>
<div class="line"><span class="lineno">  348</span>        format2 |= value[1].getEffectiveFormat() <span class="keywordflow">if</span> value[1] <span class="keywordflow">else</span> 0</div>
<div class="line"><span class="lineno">  349</span>    valueFormat1_bytes = bit_count(format1) * 2</div>
<div class="line"><span class="lineno">  350</span>    valueFormat2_bytes = bit_count(format2) * 2</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>    ctx = ClusteringContext(</div>
<div class="line"><span class="lineno">  353</span>        lines,</div>
<div class="line"><span class="lineno">  354</span>        all_class1,</div>
<div class="line"><span class="lineno">  355</span>        all_class1_data,</div>
<div class="line"><span class="lineno">  356</span>        all_class2_data,</div>
<div class="line"><span class="lineno">  357</span>        valueFormat1_bytes,</div>
<div class="line"><span class="lineno">  358</span>        valueFormat2_bytes,</div>
<div class="line"><span class="lineno">  359</span>    )</div>
<div class="line"><span class="lineno">  360</span> </div>
<div class="line"><span class="lineno">  361</span>    cluster_cache: Dict[int, Cluster] = {}</div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span>    <span class="keyword">def </span>make_cluster(indices: int) -&gt; Cluster:</div>
<div class="line"><span class="lineno">  364</span>        cluster = cluster_cache.get(indices, <span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">  365</span>        <span class="keywordflow">if</span> cluster <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  366</span>            <span class="keywordflow">return</span> cluster</div>
<div class="line"><span class="lineno">  367</span>        cluster = Cluster(ctx, indices)</div>
<div class="line"><span class="lineno">  368</span>        cluster_cache[indices] = cluster</div>
<div class="line"><span class="lineno">  369</span>        <span class="keywordflow">return</span> cluster</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>    <span class="keyword">def </span>merge(cluster: Cluster, other: Cluster) -&gt; Cluster:</div>
<div class="line"><span class="lineno">  372</span>        <span class="keywordflow">return</span> make_cluster(cluster.indices_bitmask | other.indices_bitmask)</div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>    <span class="comment"># Agglomerative clustering by hand, checking the cost gain of the new</span></div>
<div class="line"><span class="lineno">  375</span>    <span class="comment"># cluster against the previously separate clusters</span></div>
<div class="line"><span class="lineno">  376</span>    <span class="comment"># Start with 1 cluster per line</span></div>
<div class="line"><span class="lineno">  377</span>    <span class="comment"># cluster = set of lines = new subtable</span></div>
<div class="line"><span class="lineno">  378</span>    clusters = [make_cluster(1 &lt;&lt; i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(lines))]</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>    <span class="comment"># Cost of 1 cluster with everything</span></div>
<div class="line"><span class="lineno">  381</span>    <span class="comment"># `(1 &lt;&lt; len) - 1` gives a bitmask full of 1&#39;s of length `len`</span></div>
<div class="line"><span class="lineno">  382</span>    cost_before_splitting = make_cluster((1 &lt;&lt; len(lines)) - 1).cost</div>
<div class="line"><span class="lineno">  383</span>    log.debug(f<span class="stringliteral">&quot;        len(clusters) = {len(clusters)}&quot;</span>)</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>    <span class="keywordflow">while</span> len(clusters) &gt; 1:</div>
<div class="line"><span class="lineno">  386</span>        lowest_cost_change = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  387</span>        best_cluster_index = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  388</span>        best_other_index = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  389</span>        best_merged = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  390</span>        <span class="keywordflow">for</span> i, cluster <span class="keywordflow">in</span> enumerate(clusters):</div>
<div class="line"><span class="lineno">  391</span>            <span class="keywordflow">for</span> j, other <span class="keywordflow">in</span> enumerate(clusters[i + 1 :]):</div>
<div class="line"><span class="lineno">  392</span>                merged = merge(cluster, other)</div>
<div class="line"><span class="lineno">  393</span>                cost_change = merged.cost - cluster.cost - other.cost</div>
<div class="line"><span class="lineno">  394</span>                <span class="keywordflow">if</span> lowest_cost_change <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> cost_change &lt; lowest_cost_change:</div>
<div class="line"><span class="lineno">  395</span>                    lowest_cost_change = cost_change</div>
<div class="line"><span class="lineno">  396</span>                    best_cluster_index = i</div>
<div class="line"><span class="lineno">  397</span>                    best_other_index = i + 1 + j</div>
<div class="line"><span class="lineno">  398</span>                    best_merged = merged</div>
<div class="line"><span class="lineno">  399</span>        <span class="keyword">assert</span> lowest_cost_change <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  400</span>        <span class="keyword">assert</span> best_cluster_index <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  401</span>        <span class="keyword">assert</span> best_other_index <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  402</span>        <span class="keyword">assert</span> best_merged <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span>        <span class="comment"># If the best merge we found is still taking down the file size, then</span></div>
<div class="line"><span class="lineno">  405</span>        <span class="comment"># there&#39;s no question: we must do it, because it&#39;s beneficial in both</span></div>
<div class="line"><span class="lineno">  406</span>        <span class="comment"># ways (lower file size and lower number of subtables).  However, if the</span></div>
<div class="line"><span class="lineno">  407</span>        <span class="comment"># best merge we found is not reducing file size anymore, then we need to</span></div>
<div class="line"><span class="lineno">  408</span>        <span class="comment"># look at the other stop criteria = the compression factor.</span></div>
<div class="line"><span class="lineno">  409</span>        <span class="keywordflow">if</span> lowest_cost_change &gt; 0:</div>
<div class="line"><span class="lineno">  410</span>            <span class="comment"># Stop critera: check whether we should keep merging.</span></div>
<div class="line"><span class="lineno">  411</span>            <span class="comment"># Compute size reduction brought by splitting</span></div>
<div class="line"><span class="lineno">  412</span>            cost_after_splitting = sum(c.cost <span class="keywordflow">for</span> c <span class="keywordflow">in</span> clusters)</div>
<div class="line"><span class="lineno">  413</span>            <span class="comment"># size_reduction so that after = before * (1 - size_reduction)</span></div>
<div class="line"><span class="lineno">  414</span>            <span class="comment"># E.g. before = 1000, after = 800, 1 - 800/1000 = 0.2</span></div>
<div class="line"><span class="lineno">  415</span>            size_reduction = 1 - cost_after_splitting / cost_before_splitting</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>            <span class="comment"># Force more merging by taking into account the compression number.</span></div>
<div class="line"><span class="lineno">  418</span>            <span class="comment"># Target behaviour: compression number = 1 to 9, default 5 like gzip</span></div>
<div class="line"><span class="lineno">  419</span>            <span class="comment">#   - 1 = accept to add 1 subtable to reduce size by 50%</span></div>
<div class="line"><span class="lineno">  420</span>            <span class="comment">#   - 5 = accept to add 5 subtables to reduce size by 50%</span></div>
<div class="line"><span class="lineno">  421</span>            <span class="comment"># See https://github.com/harfbuzz/packtab/blob/master/Lib/packTab/__init__.py#L690-L691</span></div>
<div class="line"><span class="lineno">  422</span>            <span class="comment"># Given the size reduction we have achieved so far, compute how many</span></div>
<div class="line"><span class="lineno">  423</span>            <span class="comment"># new subtables are acceptable.</span></div>
<div class="line"><span class="lineno">  424</span>            max_new_subtables = -log2(1 - size_reduction) * compression</div>
<div class="line"><span class="lineno">  425</span>            log.debug(</div>
<div class="line"><span class="lineno">  426</span>                f<span class="stringliteral">&quot;            len(clusters) = {len(clusters):3d}    size_reduction={size_reduction:5.2f}    max_new_subtables={max_new_subtables}&quot;</span>,</div>
<div class="line"><span class="lineno">  427</span>            )</div>
<div class="line"><span class="lineno">  428</span>            <span class="keywordflow">if</span> compression == 9:</div>
<div class="line"><span class="lineno">  429</span>                <span class="comment"># Override level 9 to mean: create any number of subtables</span></div>
<div class="line"><span class="lineno">  430</span>                max_new_subtables = len(clusters)</div>
<div class="line"><span class="lineno">  431</span> </div>
<div class="line"><span class="lineno">  432</span>            <span class="comment"># If we have managed to take the number of new subtables below the</span></div>
<div class="line"><span class="lineno">  433</span>            <span class="comment"># threshold, then we can stop.</span></div>
<div class="line"><span class="lineno">  434</span>            <span class="keywordflow">if</span> len(clusters) &lt;= max_new_subtables + 1:</div>
<div class="line"><span class="lineno">  435</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>        <span class="comment"># No reason to stop yet, do the merge and move on to the next.</span></div>
<div class="line"><span class="lineno">  438</span>        del clusters[best_other_index]</div>
<div class="line"><span class="lineno">  439</span>        clusters[best_cluster_index] = best_merged</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>    <span class="comment"># All clusters are final; turn bitmasks back into the &quot;Pairs&quot; format</span></div>
<div class="line"><span class="lineno">  442</span>    pairs_by_class1: Dict[Tuple[str, ...], Pairs] = defaultdict(dict)</div>
<div class="line"><span class="lineno">  443</span>    <span class="keywordflow">for</span> pair, values <span class="keywordflow">in</span> pairs.items():</div>
<div class="line"><span class="lineno">  444</span>        pairs_by_class1[pair[0]][pair] = values</div>
<div class="line"><span class="lineno">  445</span>    pairs_groups: List[Pairs] = []</div>
<div class="line"><span class="lineno">  446</span>    <span class="keywordflow">for</span> cluster <span class="keywordflow">in</span> clusters:</div>
<div class="line"><span class="lineno">  447</span>        pairs_group: Pairs = dict()</div>
<div class="line"><span class="lineno">  448</span>        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> cluster.indices:</div>
<div class="line"><span class="lineno">  449</span>            class1 = all_class1[i]</div>
<div class="line"><span class="lineno">  450</span>            pairs_group.update(pairs_by_class1[class1])</div>
<div class="line"><span class="lineno">  451</span>        pairs_groups.append(pairs_group)</div>
<div class="line"><span class="lineno">  452</span>    <span class="keywordflow">return</span> pairs_groups</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac52bcc109e7ba52ebd37109ae5349342" name="ac52bcc109e7ba52ebd37109ae5349342"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac52bcc109e7ba52ebd37109ae5349342">&#9670;&#160;</a></span>compact()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> <a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a> fontTools.otlLib.optimize.gpos.compact </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a>&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   42</span><span class="keyword">def </span>compact(font: TTFont, level: int) -&gt; TTFont:</div>
<div class="line"><span class="lineno">   43</span>    <span class="comment"># Ideal plan:</span></div>
<div class="line"><span class="lineno">   44</span>    <span class="comment">#  1. Find lookups of Lookup Type 2: Pair Adjustment Positioning Subtable</span></div>
<div class="line"><span class="lineno">   45</span>    <span class="comment">#     https://docs.microsoft.com/en-us/typography/opentype/spec/gpos#lookup-type-2-pair-adjustment-positioning-subtable</span></div>
<div class="line"><span class="lineno">   46</span>    <span class="comment">#  2. Extract glyph-glyph kerning and class-kerning from all present subtables</span></div>
<div class="line"><span class="lineno">   47</span>    <span class="comment">#  3. Regroup into different subtable arrangements</span></div>
<div class="line"><span class="lineno">   48</span>    <span class="comment">#  4. Put back into the lookup</span></div>
<div class="line"><span class="lineno">   49</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">   50</span>    <span class="comment"># Actual implementation:</span></div>
<div class="line"><span class="lineno">   51</span>    <span class="comment">#  2. Only class kerning is optimized currently</span></div>
<div class="line"><span class="lineno">   52</span>    <span class="comment">#  3. If the input kerning is already in several subtables, the subtables</span></div>
<div class="line"><span class="lineno">   53</span>    <span class="comment">#     are not grouped together first; instead each subtable is treated</span></div>
<div class="line"><span class="lineno">   54</span>    <span class="comment">#     independently, so currently this step is:</span></div>
<div class="line"><span class="lineno">   55</span>    <span class="comment">#     Split existing subtables into more smaller subtables</span></div>
<div class="line"><span class="lineno">   56</span>    gpos = font[<span class="stringliteral">&quot;GPOS&quot;</span>]</div>
<div class="line"><span class="lineno">   57</span>    <span class="keywordflow">for</span> lookup <span class="keywordflow">in</span> gpos.table.LookupList.Lookup:</div>
<div class="line"><span class="lineno">   58</span>        <span class="keywordflow">if</span> lookup.LookupType == 2:</div>
<div class="line"><span class="lineno">   59</span>            compact_lookup(font, level, lookup)</div>
<div class="line"><span class="lineno">   60</span>        <span class="keywordflow">elif</span> lookup.LookupType == 9 <span class="keywordflow">and</span> lookup.SubTable[0].ExtensionLookupType == 2:</div>
<div class="line"><span class="lineno">   61</span>            compact_ext_lookup(font, level, lookup)</div>
<div class="line"><span class="lineno">   62</span>    <span class="keywordflow">return</span> font</div>
<div class="line"><span class="lineno">   63</span> </div>
<div class="line"><span class="lineno">   64</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad263192c94e1134e1d289e11a14c58e0" name="ad263192c94e1134e1d289e11a14c58e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad263192c94e1134e1d289e11a14c58e0">&#9670;&#160;</a></span>compact_class_pairs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> List[otTables.PairPos] fontTools.otlLib.optimize.gpos.compact_class_pairs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a>&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">otTables.PairPos
&#160;</td>
          <td class="paramname"><em>subtable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  100</span>) -&gt; List[otTables.PairPos]:</div>
<div class="line"><span class="lineno">  101</span>    <span class="keyword">from</span> <a class="code hl_namespace" href="namespacefont_tools_1_1otl_lib_1_1builder.html">fontTools.otlLib.builder</a> <span class="keyword">import</span> buildPairPosClassesSubtable</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>    subtables = []</div>
<div class="line"><span class="lineno">  104</span>    classes1: DefaultDict[int, List[str]] = defaultdict(list)</div>
<div class="line"><span class="lineno">  105</span>    <span class="keywordflow">for</span> g <span class="keywordflow">in</span> subtable.Coverage.glyphs:</div>
<div class="line"><span class="lineno">  106</span>        classes1[subtable.ClassDef1.classDefs.get(g, 0)].append(g)</div>
<div class="line"><span class="lineno">  107</span>    classes2: DefaultDict[int, List[str]] = defaultdict(list)</div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">for</span> g, i <span class="keywordflow">in</span> subtable.ClassDef2.classDefs.items():</div>
<div class="line"><span class="lineno">  109</span>        classes2[i].append(g)</div>
<div class="line"><span class="lineno">  110</span>    all_pairs = {}</div>
<div class="line"><span class="lineno">  111</span>    <span class="keywordflow">for</span> i, class1 <span class="keywordflow">in</span> enumerate(subtable.Class1Record):</div>
<div class="line"><span class="lineno">  112</span>        <span class="keywordflow">for</span> j, class2 <span class="keywordflow">in</span> enumerate(class1.Class2Record):</div>
<div class="line"><span class="lineno">  113</span>            <span class="keywordflow">if</span> is_really_zero(class2):</div>
<div class="line"><span class="lineno">  114</span>                <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  115</span>            all_pairs[(tuple(sorted(classes1[i])), tuple(sorted(classes2[j])))] = (</div>
<div class="line"><span class="lineno">  116</span>                getattr(class2, <span class="stringliteral">&quot;Value1&quot;</span>, <span class="keywordtype">None</span>),</div>
<div class="line"><span class="lineno">  117</span>                getattr(class2, <span class="stringliteral">&quot;Value2&quot;</span>, <span class="keywordtype">None</span>),</div>
<div class="line"><span class="lineno">  118</span>            )</div>
<div class="line"><span class="lineno">  119</span>    grouped_pairs = cluster_pairs_by_class2_coverage_custom_cost(font, all_pairs, level)</div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordflow">for</span> pairs <span class="keywordflow">in</span> grouped_pairs:</div>
<div class="line"><span class="lineno">  121</span>        subtables.append(buildPairPosClassesSubtable(pairs, font.getReverseGlyphMap()))</div>
<div class="line"><span class="lineno">  122</span>    <span class="keywordflow">return</span> subtables</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="ttc" id="anamespacefont_tools_1_1otl_lib_1_1builder_html"><div class="ttname"><a href="namespacefont_tools_1_1otl_lib_1_1builder.html">fontTools.otlLib.builder</a></div><div class="ttdef"><b>Definition</b> builder.py:1</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a80a9324facd1e5fa20fc6d9d00c1c0a3" name="a80a9324facd1e5fa20fc6d9d00c1c0a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80a9324facd1e5fa20fc6d9d00c1c0a3">&#9670;&#160;</a></span>compact_ext_lookup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> None fontTools.otlLib.optimize.gpos.compact_ext_lookup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a>&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">otTables.Lookup&#160;</td>
          <td class="paramname"><em>lookup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   71</span><span class="keyword">def </span>compact_ext_lookup(font: TTFont, level: int, lookup: otTables.Lookup) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   72</span>    new_subtables = compact_pair_pos(</div>
<div class="line"><span class="lineno">   73</span>        font, level, [ext_subtable.ExtSubTable <span class="keywordflow">for</span> ext_subtable <span class="keywordflow">in</span> lookup.SubTable]</div>
<div class="line"><span class="lineno">   74</span>    )</div>
<div class="line"><span class="lineno">   75</span>    new_ext_subtables = []</div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">for</span> subtable <span class="keywordflow">in</span> new_subtables:</div>
<div class="line"><span class="lineno">   77</span>        ext_subtable = otTables.ExtensionPos()</div>
<div class="line"><span class="lineno">   78</span>        ext_subtable.Format = 1</div>
<div class="line"><span class="lineno">   79</span>        ext_subtable.ExtSubTable = subtable</div>
<div class="line"><span class="lineno">   80</span>        new_ext_subtables.append(ext_subtable)</div>
<div class="line"><span class="lineno">   81</span>    lookup.SubTable = new_ext_subtables</div>
<div class="line"><span class="lineno">   82</span>    lookup.SubTableCount = len(new_ext_subtables)</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a44a364733d6a7532f361c827d619aba5" name="a44a364733d6a7532f361c827d619aba5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44a364733d6a7532f361c827d619aba5">&#9670;&#160;</a></span>compact_lookup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> None fontTools.otlLib.optimize.gpos.compact_lookup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a>&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">otTables.Lookup&#160;</td>
          <td class="paramname"><em>lookup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   65</span><span class="keyword">def </span>compact_lookup(font: TTFont, level: int, lookup: otTables.Lookup) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   66</span>    new_subtables = compact_pair_pos(font, level, lookup.SubTable)</div>
<div class="line"><span class="lineno">   67</span>    lookup.SubTable = new_subtables</div>
<div class="line"><span class="lineno">   68</span>    lookup.SubTableCount = len(new_subtables)</div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e171b282350b197de017250ca9aa369" name="a1e171b282350b197de017250ca9aa369"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e171b282350b197de017250ca9aa369">&#9670;&#160;</a></span>compact_pair_pos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> Sequence[otTables.PairPos] fontTools.otlLib.optimize.gpos.compact_pair_pos </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfont_tools_1_1tt_lib_1_1tt_font_1_1_t_t_font.html">TTFont</a>&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Sequence[otTables.PairPos]
&#160;</td>
          <td class="paramname"><em>subtables</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   87</span>) -&gt; Sequence[otTables.PairPos]:</div>
<div class="line"><span class="lineno">   88</span>    new_subtables = []</div>
<div class="line"><span class="lineno">   89</span>    <span class="keywordflow">for</span> subtable <span class="keywordflow">in</span> subtables:</div>
<div class="line"><span class="lineno">   90</span>        <span class="keywordflow">if</span> subtable.Format == 1:</div>
<div class="line"><span class="lineno">   91</span>            <span class="comment"># Not doing anything to Format 1 (yet?)</span></div>
<div class="line"><span class="lineno">   92</span>            new_subtables.append(subtable)</div>
<div class="line"><span class="lineno">   93</span>        <span class="keywordflow">elif</span> subtable.Format == 2:</div>
<div class="line"><span class="lineno">   94</span>            new_subtables.extend(compact_class_pairs(font, level, subtable))</div>
<div class="line"><span class="lineno">   95</span>    <span class="keywordflow">return</span> new_subtables</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a93ced93f285fd1beccfaff576d35453e" name="a93ced93f285fd1beccfaff576d35453e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93ced93f285fd1beccfaff576d35453e">&#9670;&#160;</a></span>is_really_zero()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> bool fontTools.otlLib.optimize.gpos.is_really_zero </td>
          <td>(</td>
          <td class="paramtype">otTables.Class2Record&#160;</td>
          <td class="paramname"><em>class2</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  125</span><span class="keyword">def </span>is_really_zero(class2: otTables.Class2Record) -&gt; bool:</div>
<div class="line"><span class="lineno">  126</span>    v1 = getattr(class2, <span class="stringliteral">&quot;Value1&quot;</span>, <span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">  127</span>    v2 = getattr(class2, <span class="stringliteral">&quot;Value2&quot;</span>, <span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">  128</span>    <span class="keywordflow">return</span> (v1 <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> v1.getEffectiveFormat() == 0) <span class="keywordflow">and</span> (</div>
<div class="line"><span class="lineno">  129</span>        v2 <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> v2.getEffectiveFormat() == 0</div>
<div class="line"><span class="lineno">  130</span>    )</div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a2321856b60bd145cd606db20133d1c06" name="a2321856b60bd145cd606db20133d1c06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2321856b60bd145cd606db20133d1c06">&#9670;&#160;</a></span>ClusteringContext</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.otlLib.optimize.gpos.ClusteringContext</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  namedtuple(</div>
<div class="line"><span class="lineno">    2</span>    <span class="stringliteral">&quot;ClusteringContext&quot;</span>,</div>
<div class="line"><span class="lineno">    3</span>    [</div>
<div class="line"><span class="lineno">    4</span>        <span class="stringliteral">&quot;lines&quot;</span>,</div>
<div class="line"><span class="lineno">    5</span>        <span class="stringliteral">&quot;all_class1&quot;</span>,</div>
<div class="line"><span class="lineno">    6</span>        <span class="stringliteral">&quot;all_class1_data&quot;</span>,</div>
<div class="line"><span class="lineno">    7</span>        <span class="stringliteral">&quot;all_class2_data&quot;</span>,</div>
<div class="line"><span class="lineno">    8</span>        <span class="stringliteral">&quot;valueFormat1_bytes&quot;</span>,</div>
<div class="line"><span class="lineno">    9</span>        <span class="stringliteral">&quot;valueFormat2_bytes&quot;</span>,</div>
<div class="line"><span class="lineno">   10</span>    ],</div>
<div class="line"><span class="lineno">   11</span>)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a39f22f0d8c58b752377f5797756d6719" name="a39f22f0d8c58b752377f5797756d6719"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39f22f0d8c58b752377f5797756d6719">&#9670;&#160;</a></span>COMPRESSION_LEVEL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.otlLib.optimize.gpos.COMPRESSION_LEVEL = OPTIONS[f&quot;{__name__}:COMPRESSION_LEVEL&quot;]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a195c7de4650f3dbafdbf6ea5cde46c97" name="a195c7de4650f3dbafdbf6ea5cde46c97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a195c7de4650f3dbafdbf6ea5cde46c97">&#9670;&#160;</a></span>GPOS_COMPACT_MODE_DEFAULT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.otlLib.optimize.gpos.GPOS_COMPACT_MODE_DEFAULT = str(COMPRESSION_LEVEL.default)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a18708b8513fa29df93ae23e583b2352b" name="a18708b8513fa29df93ae23e583b2352b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18708b8513fa29df93ae23e583b2352b">&#9670;&#160;</a></span>GPOS_COMPACT_MODE_ENV_KEY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">str fontTools.otlLib.optimize.gpos.GPOS_COMPACT_MODE_ENV_KEY = &quot;FONTTOOLS_GPOS_COMPACT_MODE&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5184e9b72ca37ff5ba4b0594a478f192" name="a5184e9b72ca37ff5ba4b0594a478f192"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5184e9b72ca37ff5ba4b0594a478f192">&#9670;&#160;</a></span>log</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.otlLib.optimize.gpos.log = logging.getLogger(__name__)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a994a94d5a819abf0423dc2d5dde73eb4" name="a994a94d5a819abf0423dc2d5dde73eb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a994a94d5a819abf0423dc2d5dde73eb4">&#9670;&#160;</a></span>Pairs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.otlLib.optimize.gpos.Pairs</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  Dict[</div>
<div class="line"><span class="lineno">    2</span>    Tuple[Tuple[str, ...], Tuple[str, ...]],</div>
<div class="line"><span class="lineno">    3</span>    Tuple[otBase.ValueRecord, otBase.ValueRecord],</div>
<div class="line"><span class="lineno">    4</span>]</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
