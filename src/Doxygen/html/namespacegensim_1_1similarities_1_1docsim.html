<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: gensim.similarities.docsim Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacegensim.html">gensim</a></li><li class="navelem"><a class="el" href="namespacegensim_1_1similarities.html">similarities</a></li><li class="navelem"><a class="el" href="namespacegensim_1_1similarities_1_1docsim.html">docsim</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">gensim.similarities.docsim Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgensim_1_1similarities_1_1docsim_1_1_matrix_similarity.html">MatrixSimilarity</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgensim_1_1similarities_1_1docsim_1_1_shard.html">Shard</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgensim_1_1similarities_1_1docsim_1_1_similarity.html">Similarity</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgensim_1_1similarities_1_1docsim_1_1_soft_cosine_similarity.html">SoftCosineSimilarity</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgensim_1_1similarities_1_1docsim_1_1_sparse_matrix_similarity.html">SparseMatrixSimilarity</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgensim_1_1similarities_1_1docsim_1_1_wmd_similarity.html">WmdSimilarity</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1f04a70bd131e3c9f195da8b4eac45e8" id="r_a1f04a70bd131e3c9f195da8b4eac45e8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegensim_1_1similarities_1_1docsim.html#a1f04a70bd131e3c9f195da8b4eac45e8">query_shard</a> (args)</td></tr>
<tr class="separator:a1f04a70bd131e3c9f195da8b4eac45e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af965c4b9fffce9796f14ddc019766c5e" id="r_af965c4b9fffce9796f14ddc019766c5e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegensim_1_1similarities_1_1docsim.html#af965c4b9fffce9796f14ddc019766c5e">_nlargest</a> (<a class="el" href="__blas__subroutines_8h.html#a25eafceb38c8e75bc60701fea6623f71">n</a>, iterable)</td></tr>
<tr class="separator:af965c4b9fffce9796f14ddc019766c5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a10b6d1ead01112bb09514db567e21c60" id="r_a10b6d1ead01112bb09514db567e21c60"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegensim_1_1similarities_1_1docsim.html#a10b6d1ead01112bb09514db567e21c60">logger</a> = logging.getLogger(__name__)</td></tr>
<tr class="separator:a10b6d1ead01112bb09514db567e21c60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ea88dba811014d2ae2a0887d0622ac2" id="r_a6ea88dba811014d2ae2a0887d0622ac2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegensim_1_1similarities_1_1docsim.html#a6ea88dba811014d2ae2a0887d0622ac2">PARALLEL_SHARDS</a> = False</td></tr>
<tr class="separator:a6ea88dba811014d2ae2a0887d0622ac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Compute similarities across a collection of documents in the Vector Space Model.

The main class is :class:`~gensim.similarities.docsim.Similarity`, which builds an index for a given set of documents.

Once the index is built, you can perform efficient queries like "Tell me how similar is this query document to each
document in the index?". The result is a vector of numbers as large as the size of the initial set of documents,
that is, one float for each index document. Alternatively, you can also request only the top-N most
similar index documents to the query.


How It Works
------------
The :class:`~gensim.similarities.docsim.Similarity` class splits the index into several smaller sub-indexes ("shards"),
which are disk-based. If your entire index fits in memory (~one million documents per 1GB of RAM),
you can also use the :class:`~gensim.similarities.docsim.MatrixSimilarity`
or :class:`~gensim.similarities.docsim.SparseMatrixSimilarity` classes directly.
These are more simple but do not scale as well: they keep the entire index in RAM, no sharding. They also do not
support adding new document to the index dynamically.

Once the index has been initialized, you can query for document similarity simply by

.. sourcecode:: pycon

    &gt;&gt;&gt; from gensim.test.utils import common_corpus, common_dictionary, get_tmpfile
    &gt;&gt;&gt;
    &gt;&gt;&gt; index_tmpfile = get_tmpfile("index")
    &gt;&gt;&gt; query = [(1, 2), (6, 1), (7, 2)]
    &gt;&gt;&gt;
    &gt;&gt;&gt; index = Similarity(index_tmpfile, common_corpus, num_features=len(common_dictionary))  # build the index
    &gt;&gt;&gt; similarities = index[query]  # get similarities between the query and all index documents

If you have more query documents, you can submit them all at once, in a batch

.. sourcecode:: pycon

    &gt;&gt;&gt; from gensim.test.utils import common_corpus, common_dictionary, get_tmpfile
    &gt;&gt;&gt;
    &gt;&gt;&gt; index_tmpfile = get_tmpfile("index")
    &gt;&gt;&gt; batch_of_documents = common_corpus[:]  # only as example
    &gt;&gt;&gt; index = Similarity(index_tmpfile, common_corpus, num_features=len(common_dictionary))  # build the index
    &gt;&gt;&gt;
    &gt;&gt;&gt; # the batch is simply an iterable of documents, aka gensim corpus:
    &gt;&gt;&gt; for similarities in index[batch_of_documents]:
    ...     pass

The benefit of this batch (aka "chunked") querying is a much better performance.
To see the speed-up on your machine, run ``python -m gensim.test.simspeed``
(compare to my results `here &lt;http://groups.google.com/group/gensim/msg/4f6f171a869e4fca?&gt;`_).

There is also a special syntax for when you need similarity of documents in the index
to the index itself (i.e. queries = the indexed documents themselves). This special syntax
uses the faster, batch queries internally and **is ideal for all-vs-all pairwise similarities**:

.. sourcecode:: pycon

    &gt;&gt;&gt; from gensim.test.utils import common_corpus, common_dictionary, get_tmpfile
    &gt;&gt;&gt;
    &gt;&gt;&gt; index_tmpfile = get_tmpfile("index")
    &gt;&gt;&gt; index = Similarity(index_tmpfile, common_corpus, num_features=len(common_dictionary))  # build the index
    &gt;&gt;&gt;
    &gt;&gt;&gt; for similarities in index:  # yield similarities of the 1st indexed document, then 2nd...
    ...     pass</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="af965c4b9fffce9796f14ddc019766c5e" name="af965c4b9fffce9796f14ddc019766c5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af965c4b9fffce9796f14ddc019766c5e">&#9670;&#160;</a></span>_nlargest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">gensim.similarities.docsim._nlargest </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iterable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Helper for extracting n documents with maximum similarity.

Parameters
----------
n : int
    Number of elements to be extracted
iterable : iterable of list of (int, float)
    Iterable containing documents with computed similarities

Returns
-------
:class:`list`
    List with the n largest elements from the dataset defined by iterable.

Notes
-----
Elements are compared by the absolute value of similarity, because negative value of similarity
does not mean some form of dissimilarity.</pre> <div class="fragment"><div class="line"><span class="lineno">  236</span><span class="keyword">def </span>_nlargest(n, iterable):</div>
<div class="line"><span class="lineno">  237</span>    <span class="stringliteral">&quot;&quot;&quot;Helper for extracting n documents with maximum similarity.</span></div>
<div class="line"><span class="lineno">  238</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  239</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  240</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  241</span><span class="stringliteral">    n : int</span></div>
<div class="line"><span class="lineno">  242</span><span class="stringliteral">        Number of elements to be extracted</span></div>
<div class="line"><span class="lineno">  243</span><span class="stringliteral">    iterable : iterable of list of (int, float)</span></div>
<div class="line"><span class="lineno">  244</span><span class="stringliteral">        Iterable containing documents with computed similarities</span></div>
<div class="line"><span class="lineno">  245</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  246</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  247</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  248</span><span class="stringliteral">    :class:`list`</span></div>
<div class="line"><span class="lineno">  249</span><span class="stringliteral">        List with the n largest elements from the dataset defined by iterable.</span></div>
<div class="line"><span class="lineno">  250</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  251</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">  252</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">  253</span><span class="stringliteral">    Elements are compared by the absolute value of similarity, because negative value of similarity</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">    does not mean some form of dissimilarity.</span></div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  257</span>    <span class="keywordflow">return</span> heapq.nlargest(n, itertools.chain(*iterable), key=<span class="keyword">lambda</span> item: abs(item[1]))</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f04a70bd131e3c9f195da8b4eac45e8" name="a1f04a70bd131e3c9f195da8b4eac45e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f04a70bd131e3c9f195da8b4eac45e8">&#9670;&#160;</a></span>query_shard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gensim.similarities.docsim.query_shard </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Helper for request query from shard, same as shard[query].

Parameters
---------
args : (list of (int, number), :class:`~gensim.interfaces.SimilarityABC`)
    Query and Shard instances

Returns
-------
:class:`numpy.ndarray` or :class:`scipy.sparse.csr_matrix`
    Similarities of the query against documents indexed in this shard.</pre> <div class="fragment"><div class="line"><span class="lineno">  215</span><span class="keyword">def </span>query_shard(args):</div>
<div class="line"><span class="lineno">  216</span>    <span class="stringliteral">&quot;&quot;&quot;Helper for request query from shard, same as shard[query].</span></div>
<div class="line"><span class="lineno">  217</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  218</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  219</span><span class="stringliteral">    ---------</span></div>
<div class="line"><span class="lineno">  220</span><span class="stringliteral">    args : (list of (int, number), :class:`~gensim.interfaces.SimilarityABC`)</span></div>
<div class="line"><span class="lineno">  221</span><span class="stringliteral">        Query and Shard instances</span></div>
<div class="line"><span class="lineno">  222</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  223</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  224</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  225</span><span class="stringliteral">    :class:`numpy.ndarray` or :class:`scipy.sparse.csr_matrix`</span></div>
<div class="line"><span class="lineno">  226</span><span class="stringliteral">        Similarities of the query against documents indexed in this shard.</span></div>
<div class="line"><span class="lineno">  227</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  228</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  229</span>    query, shard = args  <span class="comment"># simulate starmap (not part of multiprocessing in older Pythons)</span></div>
<div class="line"><span class="lineno">  230</span>    logger.debug(<span class="stringliteral">&quot;querying shard %s num_best=%s in process %s&quot;</span>, shard, shard.num_best, os.getpid())</div>
<div class="line"><span class="lineno">  231</span>    result = shard[query]</div>
<div class="line"><span class="lineno">  232</span>    logger.debug(<span class="stringliteral">&quot;finished querying shard %s in process %s&quot;</span>, shard, os.getpid())</div>
<div class="line"><span class="lineno">  233</span>    <span class="keywordflow">return</span> result</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a10b6d1ead01112bb09514db567e21c60" name="a10b6d1ead01112bb09514db567e21c60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10b6d1ead01112bb09514db567e21c60">&#9670;&#160;</a></span>logger</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gensim.similarities.docsim.logger = logging.getLogger(__name__)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6ea88dba811014d2ae2a0887d0622ac2" name="a6ea88dba811014d2ae2a0887d0622ac2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ea88dba811014d2ae2a0887d0622ac2">&#9670;&#160;</a></span>PARALLEL_SHARDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool gensim.similarities.docsim.PARALLEL_SHARDS = False</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
