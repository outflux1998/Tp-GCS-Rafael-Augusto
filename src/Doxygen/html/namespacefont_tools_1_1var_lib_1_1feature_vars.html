<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: fontTools.varLib.featureVars Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacefont_tools.html">fontTools</a></li><li class="navelem"><a class="el" href="namespacefont_tools_1_1var_lib.html">varLib</a></li><li class="navelem"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html">featureVars</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">fontTools.varLib.featureVars Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7786f95e2107a599dd4b94db66ed8080" id="r_a7786f95e2107a599dd4b94db66ed8080"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a7786f95e2107a599dd4b94db66ed8080">addFeatureVariations</a> (font, conditionalSubstitutions, featureTag='rvrn')</td></tr>
<tr class="separator:a7786f95e2107a599dd4b94db66ed8080"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fd05d756d391ca0a77856b79b3d450d" id="r_a7fd05d756d391ca0a77856b79b3d450d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a7fd05d756d391ca0a77856b79b3d450d">_checkSubstitutionGlyphsExist</a> (glyphNames, substitutions)</td></tr>
<tr class="separator:a7fd05d756d391ca0a77856b79b3d450d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98455ef199d9013baf64572e88095604" id="r_a98455ef199d9013baf64572e88095604"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a98455ef199d9013baf64572e88095604">overlayFeatureVariations</a> (conditionalSubstitutions)</td></tr>
<tr class="separator:a98455ef199d9013baf64572e88095604"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4bd21f345e0baaaf925d482efa4d004" id="r_ad4bd21f345e0baaaf925d482efa4d004"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#ad4bd21f345e0baaaf925d482efa4d004">overlayBox</a> (top, bot)</td></tr>
<tr class="separator:ad4bd21f345e0baaaf925d482efa4d004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0f4124cf2154bc8fcc734f94b1999d8" id="r_ab0f4124cf2154bc8fcc734f94b1999d8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#ab0f4124cf2154bc8fcc734f94b1999d8">cleanupBox</a> (box)</td></tr>
<tr class="separator:ab0f4124cf2154bc8fcc734f94b1999d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a310010fd95eec7e5c7a52e6f738c0d" id="r_a1a310010fd95eec7e5c7a52e6f738c0d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a1a310010fd95eec7e5c7a52e6f738c0d">addFeatureVariationsRaw</a> (font, table, conditionalSubstitutions, featureTag='rvrn')</td></tr>
<tr class="separator:a1a310010fd95eec7e5c7a52e6f738c0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3abda32a4614269287cb36afcbeb11e" id="r_aa3abda32a4614269287cb36afcbeb11e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#aa3abda32a4614269287cb36afcbeb11e">buildGSUB</a> ()</td></tr>
<tr class="separator:aa3abda32a4614269287cb36afcbeb11e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd511c6d4af6324ff25fa997792aab0b" id="r_acd511c6d4af6324ff25fa997792aab0b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#acd511c6d4af6324ff25fa997792aab0b">makeSubstitutionsHashable</a> (conditionalSubstitutions)</td></tr>
<tr class="separator:acd511c6d4af6324ff25fa997792aab0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b36371d608180e8c6ccf56234458f7c" id="r_a6b36371d608180e8c6ccf56234458f7c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a6b36371d608180e8c6ccf56234458f7c">buildSubstitutionLookups</a> (gsub, allSubstitutions)</td></tr>
<tr class="separator:a6b36371d608180e8c6ccf56234458f7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abeeec6b6cec97d63c63e8fc438c0457c" id="r_abeeec6b6cec97d63c63e8fc438c0457c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#abeeec6b6cec97d63c63e8fc438c0457c">buildFeatureVariations</a> (featureVariationRecords)</td></tr>
<tr class="separator:abeeec6b6cec97d63c63e8fc438c0457c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a812b8ccc3d259dce927a918c62ecb05c" id="r_a812b8ccc3d259dce927a918c62ecb05c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a812b8ccc3d259dce927a918c62ecb05c">buildFeatureRecord</a> (featureTag, lookupListIndices)</td></tr>
<tr class="separator:a812b8ccc3d259dce927a918c62ecb05c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f152e80d7e173306b7743e0c808b7aa" id="r_a7f152e80d7e173306b7743e0c808b7aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a7f152e80d7e173306b7743e0c808b7aa">buildFeatureVariationRecord</a> (conditionTable, substitutionRecords)</td></tr>
<tr class="separator:a7f152e80d7e173306b7743e0c808b7aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affa50ed71fc354a331f772d998b11bad" id="r_affa50ed71fc354a331f772d998b11bad"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#affa50ed71fc354a331f772d998b11bad">buildFeatureTableSubstitutionRecord</a> (featureIndex, lookupListIndices)</td></tr>
<tr class="separator:affa50ed71fc354a331f772d998b11bad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfb52f6a7fb266da42b04dfd886d0b89" id="r_acfb52f6a7fb266da42b04dfd886d0b89"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#acfb52f6a7fb266da42b04dfd886d0b89">buildConditionTable</a> (axisIndex, filterRangeMinValue, filterRangeMaxValue)</td></tr>
<tr class="separator:acfb52f6a7fb266da42b04dfd886d0b89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71bbc76b3ecb3a9ce0dd4de99e99e156" id="r_a71bbc76b3ecb3a9ce0dd4de99e99e156"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a71bbc76b3ecb3a9ce0dd4de99e99e156">sortFeatureList</a> (table)</td></tr>
<tr class="separator:a71bbc76b3ecb3a9ce0dd4de99e99e156"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dca2df9f8535a3e301d2520a9af8561" id="r_a0dca2df9f8535a3e301d2520a9af8561"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#a0dca2df9f8535a3e301d2520a9af8561">remapFeatures</a> (table, featureRemap)</td></tr>
<tr class="separator:a0dca2df9f8535a3e301d2520a9af8561"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeffe07cebc1e166a12f872c422d83a0d" id="r_aeffe07cebc1e166a12f872c422d83a0d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefont_tools_1_1var_lib_1_1feature_vars.html#aeffe07cebc1e166a12f872c422d83a0d">_remapLangSys</a> (langSys, featureRemap)</td></tr>
<tr class="separator:aeffe07cebc1e166a12f872c422d83a0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Module to build FeatureVariation tables:
https://docs.microsoft.com/en-us/typography/opentype/spec/chapter2#featurevariations-table

NOTE: The API is experimental and subject to change.
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a7fd05d756d391ca0a77856b79b3d450d" name="a7fd05d756d391ca0a77856b79b3d450d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fd05d756d391ca0a77856b79b3d450d">&#9670;&#160;</a></span>_checkSubstitutionGlyphsExist()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars._checkSubstitutionGlyphsExist </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>glyphNames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>substitutions</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   73</span><span class="keyword">def </span>_checkSubstitutionGlyphsExist(glyphNames, substitutions):</div>
<div class="line"><span class="lineno">   74</span>    referencedGlyphNames = set()</div>
<div class="line"><span class="lineno">   75</span>    <span class="keywordflow">for</span> _, substitution <span class="keywordflow">in</span> substitutions:</div>
<div class="line"><span class="lineno">   76</span>        referencedGlyphNames |=  substitution.keys()</div>
<div class="line"><span class="lineno">   77</span>        referencedGlyphNames |=  set(substitution.values())</div>
<div class="line"><span class="lineno">   78</span>    missing = referencedGlyphNames - glyphNames</div>
<div class="line"><span class="lineno">   79</span>    <span class="keywordflow">if</span> missing:</div>
<div class="line"><span class="lineno">   80</span>       <span class="keywordflow">raise</span> VarLibValidationError(</div>
<div class="line"><span class="lineno">   81</span>            <span class="stringliteral">&quot;Missing glyphs are referenced in conditional substitution rules:&quot;</span></div>
<div class="line"><span class="lineno">   82</span>            f<span class="stringliteral">&quot; {&#39;, &#39;.join(missing)}&quot;</span></div>
<div class="line"><span class="lineno">   83</span>        )</div>
<div class="line"><span class="lineno">   84</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aeffe07cebc1e166a12f872c422d83a0d" name="aeffe07cebc1e166a12f872c422d83a0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeffe07cebc1e166a12f872c422d83a0d">&#9670;&#160;</a></span>_remapLangSys()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars._remapLangSys </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>langSys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>featureRemap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  517</span><span class="keyword">def </span>_remapLangSys(langSys, featureRemap):</div>
<div class="line"><span class="lineno">  518</span>    <span class="keywordflow">if</span> langSys.ReqFeatureIndex != 0xffff:</div>
<div class="line"><span class="lineno">  519</span>        langSys.ReqFeatureIndex = featureRemap[langSys.ReqFeatureIndex]</div>
<div class="line"><span class="lineno">  520</span>    langSys.FeatureIndex = [featureRemap[index] <span class="keywordflow">for</span> index <span class="keywordflow">in</span> langSys.FeatureIndex]</div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a7786f95e2107a599dd4b94db66ed8080" name="a7786f95e2107a599dd4b94db66ed8080"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7786f95e2107a599dd4b94db66ed8080">&#9670;&#160;</a></span>addFeatureVariations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.addFeatureVariations </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>conditionalSubstitutions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>featureTag</em> = <code>'rvrn'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Add conditional substitutions to a Variable Font.

The `conditionalSubstitutions` argument is a list of (Region, Substitutions)
tuples.

A Region is a list of Boxes. A Box is a dict mapping axisTags to
(minValue, maxValue) tuples. Irrelevant axes may be omitted and they are
interpretted as extending to end of axis in each direction.  A Box represents
an orthogonal 'rectangular' subset of an N-dimensional design space.
A Region represents a more complex subset of an N-dimensional design space,
ie. the union of all the Boxes in the Region.
For efficiency, Boxes within a Region should ideally not overlap, but
functionality is not compromised if they do.

The minimum and maximum values are expressed in normalized coordinates.

A Substitution is a dict mapping source glyph names to substitute glyph names.

Example:

# &gt;&gt;&gt; f = TTFont(srcPath)
# &gt;&gt;&gt; condSubst = [
# ...     # A list of (Region, Substitution) tuples.
# ...     ([{"wdth": (0.5, 1.0)}], {"cent": "cent.rvrn"}),
# ...     ([{"wght": (0.5, 1.0)}], {"dollar": "dollar.rvrn"}),
# ... ]
# &gt;&gt;&gt; addFeatureVariations(f, condSubst)
# &gt;&gt;&gt; f.save(dstPath)
</pre> <div class="fragment"><div class="line"><span class="lineno">   16</span><span class="keyword">def </span>addFeatureVariations(font, conditionalSubstitutions, featureTag=&#39;rvrn&#39;):</div>
<div class="line"><span class="lineno">   17</span>    <span class="stringliteral">&quot;&quot;&quot;Add conditional substitutions to a Variable Font.</span></div>
<div class="line"><span class="lineno">   18</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   19</span><span class="stringliteral">    The `conditionalSubstitutions` argument is a list of (Region, Substitutions)</span></div>
<div class="line"><span class="lineno">   20</span><span class="stringliteral">    tuples.</span></div>
<div class="line"><span class="lineno">   21</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   22</span><span class="stringliteral">    A Region is a list of Boxes. A Box is a dict mapping axisTags to</span></div>
<div class="line"><span class="lineno">   23</span><span class="stringliteral">    (minValue, maxValue) tuples. Irrelevant axes may be omitted and they are</span></div>
<div class="line"><span class="lineno">   24</span><span class="stringliteral">    interpretted as extending to end of axis in each direction.  A Box represents</span></div>
<div class="line"><span class="lineno">   25</span><span class="stringliteral">    an orthogonal &#39;rectangular&#39; subset of an N-dimensional design space.</span></div>
<div class="line"><span class="lineno">   26</span><span class="stringliteral">    A Region represents a more complex subset of an N-dimensional design space,</span></div>
<div class="line"><span class="lineno">   27</span><span class="stringliteral">    ie. the union of all the Boxes in the Region.</span></div>
<div class="line"><span class="lineno">   28</span><span class="stringliteral">    For efficiency, Boxes within a Region should ideally not overlap, but</span></div>
<div class="line"><span class="lineno">   29</span><span class="stringliteral">    functionality is not compromised if they do.</span></div>
<div class="line"><span class="lineno">   30</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   31</span><span class="stringliteral">    The minimum and maximum values are expressed in normalized coordinates.</span></div>
<div class="line"><span class="lineno">   32</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   33</span><span class="stringliteral">    A Substitution is a dict mapping source glyph names to substitute glyph names.</span></div>
<div class="line"><span class="lineno">   34</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   35</span><span class="stringliteral">    Example:</span></div>
<div class="line"><span class="lineno">   36</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   37</span><span class="stringliteral">    # &gt;&gt;&gt; f = TTFont(srcPath)</span></div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral">    # &gt;&gt;&gt; condSubst = [</span></div>
<div class="line"><span class="lineno">   39</span><span class="stringliteral">    # ...     # A list of (Region, Substitution) tuples.</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">    # ...     ([{&quot;wdth&quot;: (0.5, 1.0)}], {&quot;cent&quot;: &quot;cent.rvrn&quot;}),</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral">    # ...     ([{&quot;wght&quot;: (0.5, 1.0)}], {&quot;dollar&quot;: &quot;dollar.rvrn&quot;}),</span></div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral">    # ... ]</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">    # &gt;&gt;&gt; addFeatureVariations(f, condSubst)</span></div>
<div class="line"><span class="lineno">   44</span><span class="stringliteral">    # &gt;&gt;&gt; f.save(dstPath)</span></div>
<div class="line"><span class="lineno">   45</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    _checkSubstitutionGlyphsExist(</div>
<div class="line"><span class="lineno">   48</span>        glyphNames=set(font.getGlyphOrder()),</div>
<div class="line"><span class="lineno">   49</span>        substitutions=conditionalSubstitutions,</div>
<div class="line"><span class="lineno">   50</span>    )</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>    substitutions = overlayFeatureVariations(conditionalSubstitutions)</div>
<div class="line"><span class="lineno">   53</span> </div>
<div class="line"><span class="lineno">   54</span>    <span class="comment"># turn substitution dicts into tuples of tuples, so they are hashable</span></div>
<div class="line"><span class="lineno">   55</span>    conditionalSubstitutions, allSubstitutions = makeSubstitutionsHashable(substitutions)</div>
<div class="line"><span class="lineno">   56</span>    <span class="keywordflow">if</span> <span class="stringliteral">&quot;GSUB&quot;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> font:</div>
<div class="line"><span class="lineno">   57</span>        font[<span class="stringliteral">&quot;GSUB&quot;</span>] = buildGSUB()</div>
<div class="line"><span class="lineno">   58</span> </div>
<div class="line"><span class="lineno">   59</span>    <span class="comment"># setup lookups</span></div>
<div class="line"><span class="lineno">   60</span>    lookupMap = buildSubstitutionLookups(font[<span class="stringliteral">&quot;GSUB&quot;</span>].table, allSubstitutions)</div>
<div class="line"><span class="lineno">   61</span> </div>
<div class="line"><span class="lineno">   62</span>    <span class="comment"># addFeatureVariationsRaw takes a list of</span></div>
<div class="line"><span class="lineno">   63</span>    <span class="comment">#  ( {condition}, [ lookup indices ] )</span></div>
<div class="line"><span class="lineno">   64</span>    <span class="comment"># so rearrange our lookups to match</span></div>
<div class="line"><span class="lineno">   65</span>    conditionsAndLookups = []</div>
<div class="line"><span class="lineno">   66</span>    <span class="keywordflow">for</span> conditionSet, substitutions <span class="keywordflow">in</span> conditionalSubstitutions:</div>
<div class="line"><span class="lineno">   67</span>        conditionsAndLookups.append((conditionSet, [lookupMap[s] <span class="keywordflow">for</span> s <span class="keywordflow">in</span> substitutions]))</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>    addFeatureVariationsRaw(font, font[<span class="stringliteral">&quot;GSUB&quot;</span>].table,</div>
<div class="line"><span class="lineno">   70</span>                            conditionsAndLookups,</div>
<div class="line"><span class="lineno">   71</span>                            featureTag)</div>
<div class="line"><span class="lineno">   72</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1a310010fd95eec7e5c7a52e6f738c0d" name="a1a310010fd95eec7e5c7a52e6f738c0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a310010fd95eec7e5c7a52e6f738c0d">&#9670;&#160;</a></span>addFeatureVariationsRaw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.addFeatureVariationsRaw </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>conditionalSubstitutions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>featureTag</em> = <code>'rvrn'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Low level implementation of addFeatureVariations that directly
models the possibilities of the FeatureVariations table.</pre> <div class="fragment"><div class="line"><span class="lineno">  301</span><span class="keyword">def </span>addFeatureVariationsRaw(font, table, conditionalSubstitutions, featureTag=&#39;rvrn&#39;):</div>
<div class="line"><span class="lineno">  302</span>    <span class="stringliteral">&quot;&quot;&quot;Low level implementation of addFeatureVariations that directly</span></div>
<div class="line"><span class="lineno">  303</span><span class="stringliteral">    models the possibilities of the FeatureVariations table.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  306</span>    <span class="comment"># if there is no &lt;featureTag&gt; feature:</span></div>
<div class="line"><span class="lineno">  307</span>    <span class="comment">#     make empty &lt;featureTag&gt; feature</span></div>
<div class="line"><span class="lineno">  308</span>    <span class="comment">#     sort features, get &lt;featureTag&gt; feature index</span></div>
<div class="line"><span class="lineno">  309</span>    <span class="comment">#     add &lt;featureTag&gt; feature to all scripts</span></div>
<div class="line"><span class="lineno">  310</span>    <span class="comment"># make lookups</span></div>
<div class="line"><span class="lineno">  311</span>    <span class="comment"># add feature variations</span></div>
<div class="line"><span class="lineno">  312</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  313</span>    <span class="keywordflow">if</span> table.Version &lt; 0x00010001:</div>
<div class="line"><span class="lineno">  314</span>        table.Version = 0x00010001  <span class="comment"># allow table.FeatureVariations</span></div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>    table.FeatureVariations = <span class="keywordtype">None</span>  <span class="comment"># delete any existing FeatureVariations</span></div>
<div class="line"><span class="lineno">  317</span> </div>
<div class="line"><span class="lineno">  318</span>    varFeatureIndices = []</div>
<div class="line"><span class="lineno">  319</span>    <span class="keywordflow">for</span> index, feature <span class="keywordflow">in</span> enumerate(table.FeatureList.FeatureRecord):</div>
<div class="line"><span class="lineno">  320</span>        <span class="keywordflow">if</span> feature.FeatureTag == featureTag:</div>
<div class="line"><span class="lineno">  321</span>            varFeatureIndices.append(index)</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> varFeatureIndices:</div>
<div class="line"><span class="lineno">  324</span>        varFeature = buildFeatureRecord(featureTag, [])</div>
<div class="line"><span class="lineno">  325</span>        table.FeatureList.FeatureRecord.append(varFeature)</div>
<div class="line"><span class="lineno">  326</span>        table.FeatureList.FeatureCount = len(table.FeatureList.FeatureRecord)</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>        sortFeatureList(table)</div>
<div class="line"><span class="lineno">  329</span>        varFeatureIndex = table.FeatureList.FeatureRecord.index(varFeature)</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>        <span class="keywordflow">for</span> scriptRecord <span class="keywordflow">in</span> table.ScriptList.ScriptRecord:</div>
<div class="line"><span class="lineno">  332</span>            <span class="keywordflow">if</span> scriptRecord.Script.DefaultLangSys <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  333</span>                <span class="keywordflow">raise</span> VarLibError(</div>
<div class="line"><span class="lineno">  334</span>                    <span class="stringliteral">&quot;Feature variations require that the script &quot;</span></div>
<div class="line"><span class="lineno">  335</span>                    f<span class="stringliteral">&quot;&#39;{scriptRecord.ScriptTag}&#39; defines a default language system.&quot;</span></div>
<div class="line"><span class="lineno">  336</span>                )</div>
<div class="line"><span class="lineno">  337</span>            langSystems = [lsr.LangSys <span class="keywordflow">for</span> lsr <span class="keywordflow">in</span> scriptRecord.Script.LangSysRecord]</div>
<div class="line"><span class="lineno">  338</span>            <span class="keywordflow">for</span> langSys <span class="keywordflow">in</span> [scriptRecord.Script.DefaultLangSys] + langSystems:</div>
<div class="line"><span class="lineno">  339</span>                langSys.FeatureIndex.append(varFeatureIndex)</div>
<div class="line"><span class="lineno">  340</span>                langSys.FeatureCount = len(langSys.FeatureIndex)</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>        varFeatureIndices = [varFeatureIndex]</div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>    axisIndices = {axis.axisTag: axisIndex <span class="keywordflow">for</span> axisIndex, axis <span class="keywordflow">in</span> enumerate(font[<span class="stringliteral">&quot;fvar&quot;</span>].axes)}</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>    featureVariationRecords = []</div>
<div class="line"><span class="lineno">  347</span>    <span class="keywordflow">for</span> conditionSet, lookupIndices <span class="keywordflow">in</span> conditionalSubstitutions:</div>
<div class="line"><span class="lineno">  348</span>        conditionTable = []</div>
<div class="line"><span class="lineno">  349</span>        <span class="keywordflow">for</span> axisTag, (minValue, maxValue) <span class="keywordflow">in</span> sorted(conditionSet.items()):</div>
<div class="line"><span class="lineno">  350</span>            <span class="keywordflow">if</span> minValue &gt; maxValue:</div>
<div class="line"><span class="lineno">  351</span>                <span class="keywordflow">raise</span> VarLibValidationError(</div>
<div class="line"><span class="lineno">  352</span>                    <span class="stringliteral">&quot;A condition set has a minimum value above the maximum value.&quot;</span></div>
<div class="line"><span class="lineno">  353</span>                )</div>
<div class="line"><span class="lineno">  354</span>            ct = buildConditionTable(axisIndices[axisTag], minValue, maxValue)</div>
<div class="line"><span class="lineno">  355</span>            conditionTable.append(ct)</div>
<div class="line"><span class="lineno">  356</span>        records = []</div>
<div class="line"><span class="lineno">  357</span>        <span class="keywordflow">for</span> varFeatureIndex <span class="keywordflow">in</span> varFeatureIndices:</div>
<div class="line"><span class="lineno">  358</span>            existingLookupIndices = table.FeatureList.FeatureRecord[varFeatureIndex].Feature.LookupListIndex</div>
<div class="line"><span class="lineno">  359</span>            records.append(buildFeatureTableSubstitutionRecord(varFeatureIndex, existingLookupIndices + lookupIndices))</div>
<div class="line"><span class="lineno">  360</span>        featureVariationRecords.append(buildFeatureVariationRecord(conditionTable, records))</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>    table.FeatureVariations = buildFeatureVariations(featureVariationRecords)</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span> </div>
<div class="line"><span class="lineno">  365</span><span class="comment">#</span></div>
<div class="line"><span class="lineno">  366</span><span class="comment"># Building GSUB/FeatureVariations internals</span></div>
<div class="line"><span class="lineno">  367</span><span class="comment">#</span></div>
<div class="line"><span class="lineno">  368</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="acfb52f6a7fb266da42b04dfd886d0b89" name="acfb52f6a7fb266da42b04dfd886d0b89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfb52f6a7fb266da42b04dfd886d0b89">&#9670;&#160;</a></span>buildConditionTable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.buildConditionTable </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>axisIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>filterRangeMinValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>filterRangeMaxValue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build a ConditionTable.</pre> <div class="fragment"><div class="line"><span class="lineno">  477</span><span class="keyword">def </span>buildConditionTable(axisIndex, filterRangeMinValue, filterRangeMaxValue):</div>
<div class="line"><span class="lineno">  478</span>    <span class="stringliteral">&quot;&quot;&quot;Build a ConditionTable.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  479</span>    ct = ot.ConditionTable()</div>
<div class="line"><span class="lineno">  480</span>    ct.Format = 1</div>
<div class="line"><span class="lineno">  481</span>    ct.AxisIndex = axisIndex</div>
<div class="line"><span class="lineno">  482</span>    ct.FilterRangeMinValue = filterRangeMinValue</div>
<div class="line"><span class="lineno">  483</span>    ct.FilterRangeMaxValue = filterRangeMaxValue</div>
<div class="line"><span class="lineno">  484</span>    <span class="keywordflow">return</span> ct</div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a812b8ccc3d259dce927a918c62ecb05c" name="a812b8ccc3d259dce927a918c62ecb05c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a812b8ccc3d259dce927a918c62ecb05c">&#9670;&#160;</a></span>buildFeatureRecord()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.buildFeatureRecord </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>featureTag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lookupListIndices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build a FeatureRecord.</pre> <div class="fragment"><div class="line"><span class="lineno">  444</span><span class="keyword">def </span>buildFeatureRecord(featureTag, lookupListIndices):</div>
<div class="line"><span class="lineno">  445</span>    <span class="stringliteral">&quot;&quot;&quot;Build a FeatureRecord.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  446</span>    fr = ot.FeatureRecord()</div>
<div class="line"><span class="lineno">  447</span>    fr.FeatureTag = featureTag</div>
<div class="line"><span class="lineno">  448</span>    fr.Feature = ot.Feature()</div>
<div class="line"><span class="lineno">  449</span>    fr.Feature.LookupListIndex = lookupListIndices</div>
<div class="line"><span class="lineno">  450</span>    fr.Feature.populateDefaults()</div>
<div class="line"><span class="lineno">  451</span>    <span class="keywordflow">return</span> fr</div>
<div class="line"><span class="lineno">  452</span> </div>
<div class="line"><span class="lineno">  453</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="affa50ed71fc354a331f772d998b11bad" name="affa50ed71fc354a331f772d998b11bad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affa50ed71fc354a331f772d998b11bad">&#9670;&#160;</a></span>buildFeatureTableSubstitutionRecord()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.buildFeatureTableSubstitutionRecord </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>featureIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>lookupListIndices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build a FeatureTableSubstitutionRecord.</pre> <div class="fragment"><div class="line"><span class="lineno">  467</span><span class="keyword">def </span>buildFeatureTableSubstitutionRecord(featureIndex, lookupListIndices):</div>
<div class="line"><span class="lineno">  468</span>    <span class="stringliteral">&quot;&quot;&quot;Build a FeatureTableSubstitutionRecord.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  469</span>    ftsr = ot.FeatureTableSubstitutionRecord()</div>
<div class="line"><span class="lineno">  470</span>    ftsr.FeatureIndex = featureIndex</div>
<div class="line"><span class="lineno">  471</span>    ftsr.Feature = ot.Feature()</div>
<div class="line"><span class="lineno">  472</span>    ftsr.Feature.LookupListIndex = lookupListIndices</div>
<div class="line"><span class="lineno">  473</span>    ftsr.Feature.LookupCount = len(lookupListIndices)</div>
<div class="line"><span class="lineno">  474</span>    <span class="keywordflow">return</span> ftsr</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f152e80d7e173306b7743e0c808b7aa" name="a7f152e80d7e173306b7743e0c808b7aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f152e80d7e173306b7743e0c808b7aa">&#9670;&#160;</a></span>buildFeatureVariationRecord()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.buildFeatureVariationRecord </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>conditionTable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>substitutionRecords</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build a FeatureVariationRecord.</pre> <div class="fragment"><div class="line"><span class="lineno">  454</span><span class="keyword">def </span>buildFeatureVariationRecord(conditionTable, substitutionRecords):</div>
<div class="line"><span class="lineno">  455</span>    <span class="stringliteral">&quot;&quot;&quot;Build a FeatureVariationRecord.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  456</span>    fvr = ot.FeatureVariationRecord()</div>
<div class="line"><span class="lineno">  457</span>    fvr.ConditionSet = ot.ConditionSet()</div>
<div class="line"><span class="lineno">  458</span>    fvr.ConditionSet.ConditionTable = conditionTable</div>
<div class="line"><span class="lineno">  459</span>    fvr.ConditionSet.ConditionCount = len(conditionTable)</div>
<div class="line"><span class="lineno">  460</span>    fvr.FeatureTableSubstitution = ot.FeatureTableSubstitution()</div>
<div class="line"><span class="lineno">  461</span>    fvr.FeatureTableSubstitution.Version = 0x00010000</div>
<div class="line"><span class="lineno">  462</span>    fvr.FeatureTableSubstitution.SubstitutionRecord = substitutionRecords</div>
<div class="line"><span class="lineno">  463</span>    fvr.FeatureTableSubstitution.SubstitutionCount = len(substitutionRecords)</div>
<div class="line"><span class="lineno">  464</span>    <span class="keywordflow">return</span> fvr</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="abeeec6b6cec97d63c63e8fc438c0457c" name="abeeec6b6cec97d63c63e8fc438c0457c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abeeec6b6cec97d63c63e8fc438c0457c">&#9670;&#160;</a></span>buildFeatureVariations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.buildFeatureVariations </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>featureVariationRecords</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build the FeatureVariations subtable.</pre> <div class="fragment"><div class="line"><span class="lineno">  435</span><span class="keyword">def </span>buildFeatureVariations(featureVariationRecords):</div>
<div class="line"><span class="lineno">  436</span>    <span class="stringliteral">&quot;&quot;&quot;Build the FeatureVariations subtable.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  437</span>    fv = ot.FeatureVariations()</div>
<div class="line"><span class="lineno">  438</span>    fv.Version = 0x00010000</div>
<div class="line"><span class="lineno">  439</span>    fv.FeatureVariationRecord = featureVariationRecords</div>
<div class="line"><span class="lineno">  440</span>    fv.FeatureVariationCount = len(featureVariationRecords)</div>
<div class="line"><span class="lineno">  441</span>    <span class="keywordflow">return</span> fv</div>
<div class="line"><span class="lineno">  442</span> </div>
<div class="line"><span class="lineno">  443</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3abda32a4614269287cb36afcbeb11e" name="aa3abda32a4614269287cb36afcbeb11e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3abda32a4614269287cb36afcbeb11e">&#9670;&#160;</a></span>buildGSUB()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.buildGSUB </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build a GSUB table from scratch.</pre> <div class="fragment"><div class="line"><span class="lineno">  369</span><span class="keyword">def </span>buildGSUB():</div>
<div class="line"><span class="lineno">  370</span>    <span class="stringliteral">&quot;&quot;&quot;Build a GSUB table from scratch.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  371</span>    fontTable = newTable(<span class="stringliteral">&quot;GSUB&quot;</span>)</div>
<div class="line"><span class="lineno">  372</span>    gsub = fontTable.table = ot.GSUB()</div>
<div class="line"><span class="lineno">  373</span>    gsub.Version = 0x00010001  <span class="comment"># allow gsub.FeatureVariations</span></div>
<div class="line"><span class="lineno">  374</span> </div>
<div class="line"><span class="lineno">  375</span>    gsub.ScriptList = ot.ScriptList()</div>
<div class="line"><span class="lineno">  376</span>    gsub.ScriptList.ScriptRecord = []</div>
<div class="line"><span class="lineno">  377</span>    gsub.FeatureList = ot.FeatureList()</div>
<div class="line"><span class="lineno">  378</span>    gsub.FeatureList.FeatureRecord = []</div>
<div class="line"><span class="lineno">  379</span>    gsub.LookupList = ot.LookupList()</div>
<div class="line"><span class="lineno">  380</span>    gsub.LookupList.Lookup = []</div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span>    srec = ot.ScriptRecord()</div>
<div class="line"><span class="lineno">  383</span>    srec.ScriptTag = <span class="stringliteral">&#39;DFLT&#39;</span></div>
<div class="line"><span class="lineno">  384</span>    srec.Script = ot.Script()</div>
<div class="line"><span class="lineno">  385</span>    srec.Script.DefaultLangSys = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  386</span>    srec.Script.LangSysRecord = []</div>
<div class="line"><span class="lineno">  387</span>    srec.Script.LangSysCount = 0</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>    langrec = ot.LangSysRecord()</div>
<div class="line"><span class="lineno">  390</span>    langrec.LangSys = ot.LangSys()</div>
<div class="line"><span class="lineno">  391</span>    langrec.LangSys.ReqFeatureIndex = 0xFFFF</div>
<div class="line"><span class="lineno">  392</span>    langrec.LangSys.FeatureIndex = []</div>
<div class="line"><span class="lineno">  393</span>    srec.Script.DefaultLangSys = langrec.LangSys</div>
<div class="line"><span class="lineno">  394</span> </div>
<div class="line"><span class="lineno">  395</span>    gsub.ScriptList.ScriptRecord.append(srec)</div>
<div class="line"><span class="lineno">  396</span>    gsub.ScriptList.ScriptCount = 1</div>
<div class="line"><span class="lineno">  397</span>    gsub.FeatureVariations = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>    <span class="keywordflow">return</span> fontTable</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a6b36371d608180e8c6ccf56234458f7c" name="a6b36371d608180e8c6ccf56234458f7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b36371d608180e8c6ccf56234458f7c">&#9670;&#160;</a></span>buildSubstitutionLookups()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.buildSubstitutionLookups </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gsub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>allSubstitutions</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build the lookups for the glyph substitutions, return a dict mapping
the substitution to lookup indices.</pre> <div class="fragment"><div class="line"><span class="lineno">  418</span><span class="keyword">def </span>buildSubstitutionLookups(gsub, allSubstitutions):</div>
<div class="line"><span class="lineno">  419</span>    <span class="stringliteral">&quot;&quot;&quot;Build the lookups for the glyph substitutions, return a dict mapping</span></div>
<div class="line"><span class="lineno">  420</span><span class="stringliteral">    the substitution to lookup indices.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  421</span>    firstIndex = len(gsub.LookupList.Lookup)</div>
<div class="line"><span class="lineno">  422</span>    lookupMap = {}</div>
<div class="line"><span class="lineno">  423</span>    <span class="keywordflow">for</span> i, substitutionMap <span class="keywordflow">in</span> enumerate(allSubstitutions):</div>
<div class="line"><span class="lineno">  424</span>        lookupMap[substitutionMap] = i + firstIndex</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    <span class="keywordflow">for</span> subst <span class="keywordflow">in</span> allSubstitutions:</div>
<div class="line"><span class="lineno">  427</span>        substMap = dict(subst)</div>
<div class="line"><span class="lineno">  428</span>        lookup = buildLookup([buildSingleSubstSubtable(substMap)])</div>
<div class="line"><span class="lineno">  429</span>        gsub.LookupList.Lookup.append(lookup)</div>
<div class="line"><span class="lineno">  430</span>        <span class="keyword">assert</span> gsub.LookupList.Lookup[lookupMap[subst]] <span class="keywordflow">is</span> lookup</div>
<div class="line"><span class="lineno">  431</span>    gsub.LookupList.LookupCount = len(gsub.LookupList.Lookup)</div>
<div class="line"><span class="lineno">  432</span>    <span class="keywordflow">return</span> lookupMap</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ab0f4124cf2154bc8fcc734f94b1999d8" name="ab0f4124cf2154bc8fcc734f94b1999d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0f4124cf2154bc8fcc734f94b1999d8">&#9670;&#160;</a></span>cleanupBox()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.cleanupBox </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>box</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return a sparse copy of `box`, without redundant (default) values.

    &gt;&gt;&gt; cleanupBox({})
    {}
    &gt;&gt;&gt; cleanupBox({'wdth': (0.0, 1.0)})
    {'wdth': (0.0, 1.0)}
    &gt;&gt;&gt; cleanupBox({'wdth': (-1.0, 1.0)})
    {}</pre> <div class="fragment"><div class="line"><span class="lineno">  283</span><span class="keyword">def </span>cleanupBox(box):</div>
<div class="line"><span class="lineno">  284</span>    <span class="stringliteral">&quot;&quot;&quot;Return a sparse copy of `box`, without redundant (default) values.</span></div>
<div class="line"><span class="lineno">  285</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  286</span><span class="stringliteral">        &gt;&gt;&gt; cleanupBox({})</span></div>
<div class="line"><span class="lineno">  287</span><span class="stringliteral">        {}</span></div>
<div class="line"><span class="lineno">  288</span><span class="stringliteral">        &gt;&gt;&gt; cleanupBox({&#39;wdth&#39;: (0.0, 1.0)})</span></div>
<div class="line"><span class="lineno">  289</span><span class="stringliteral">        {&#39;wdth&#39;: (0.0, 1.0)}</span></div>
<div class="line"><span class="lineno">  290</span><span class="stringliteral">        &gt;&gt;&gt; cleanupBox({&#39;wdth&#39;: (-1.0, 1.0)})</span></div>
<div class="line"><span class="lineno">  291</span><span class="stringliteral">        {}</span></div>
<div class="line"><span class="lineno">  292</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  293</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  294</span>    <span class="keywordflow">return</span> {tag: limit <span class="keywordflow">for</span> tag, limit <span class="keywordflow">in</span> box.items() <span class="keywordflow">if</span> limit != (-1.0, 1.0)}</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span> </div>
<div class="line"><span class="lineno">  297</span><span class="comment">#</span></div>
<div class="line"><span class="lineno">  298</span><span class="comment"># Low level implementation</span></div>
<div class="line"><span class="lineno">  299</span><span class="comment">#</span></div>
<div class="line"><span class="lineno">  300</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="acd511c6d4af6324ff25fa997792aab0b" name="acd511c6d4af6324ff25fa997792aab0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd511c6d4af6324ff25fa997792aab0b">&#9670;&#160;</a></span>makeSubstitutionsHashable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.makeSubstitutionsHashable </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>conditionalSubstitutions</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Turn all the substitution dictionaries in sorted tuples of tuples so
they are hashable, to detect duplicates so we don't write out redundant
data.</pre> <div class="fragment"><div class="line"><span class="lineno">  402</span><span class="keyword">def </span>makeSubstitutionsHashable(conditionalSubstitutions):</div>
<div class="line"><span class="lineno">  403</span>    <span class="stringliteral">&quot;&quot;&quot;Turn all the substitution dictionaries in sorted tuples of tuples so</span></div>
<div class="line"><span class="lineno">  404</span><span class="stringliteral">    they are hashable, to detect duplicates so we don&#39;t write out redundant</span></div>
<div class="line"><span class="lineno">  405</span><span class="stringliteral">    data.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  406</span>    allSubstitutions = set()</div>
<div class="line"><span class="lineno">  407</span>    condSubst = []</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">for</span> conditionSet, substitutionMaps <span class="keywordflow">in</span> conditionalSubstitutions:</div>
<div class="line"><span class="lineno">  409</span>        substitutions = []</div>
<div class="line"><span class="lineno">  410</span>        <span class="keywordflow">for</span> substitutionMap <span class="keywordflow">in</span> substitutionMaps:</div>
<div class="line"><span class="lineno">  411</span>            subst = tuple(sorted(substitutionMap.items()))</div>
<div class="line"><span class="lineno">  412</span>            substitutions.append(subst)</div>
<div class="line"><span class="lineno">  413</span>            allSubstitutions.add(subst)</div>
<div class="line"><span class="lineno">  414</span>        condSubst.append((conditionSet, substitutions))</div>
<div class="line"><span class="lineno">  415</span>    <span class="keywordflow">return</span> condSubst, sorted(allSubstitutions)</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4bd21f345e0baaaf925d482efa4d004" name="ad4bd21f345e0baaaf925d482efa4d004"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4bd21f345e0baaaf925d482efa4d004">&#9670;&#160;</a></span>overlayBox()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.overlayBox </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>bot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Overlays ``top`` box on top of ``bot`` box.

Returns two items:

* Box for intersection of ``top`` and ``bot``, or None if they don't intersect.
* Box for remainder of ``bot``.  Remainder box might not be exact (since the
  remainder might not be a simple box), but is inclusive of the exact
  remainder.
</pre> <div class="fragment"><div class="line"><span class="lineno">  204</span><span class="keyword">def </span>overlayBox(top, bot):</div>
<div class="line"><span class="lineno">  205</span>    <span class="stringliteral">&quot;&quot;&quot;Overlays ``top`` box on top of ``bot`` box.</span></div>
<div class="line"><span class="lineno">  206</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  207</span><span class="stringliteral">    Returns two items:</span></div>
<div class="line"><span class="lineno">  208</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  209</span><span class="stringliteral">    * Box for intersection of ``top`` and ``bot``, or None if they don&#39;t intersect.</span></div>
<div class="line"><span class="lineno">  210</span><span class="stringliteral">    * Box for remainder of ``bot``.  Remainder box might not be exact (since the</span></div>
<div class="line"><span class="lineno">  211</span><span class="stringliteral">      remainder might not be a simple box), but is inclusive of the exact</span></div>
<div class="line"><span class="lineno">  212</span><span class="stringliteral">      remainder.</span></div>
<div class="line"><span class="lineno">  213</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>    <span class="comment"># Intersection</span></div>
<div class="line"><span class="lineno">  216</span>    intersection = {}</div>
<div class="line"><span class="lineno">  217</span>    intersection.update(top)</div>
<div class="line"><span class="lineno">  218</span>    intersection.update(bot)</div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">for</span> axisTag <span class="keywordflow">in</span> set(top) &amp; set(bot):</div>
<div class="line"><span class="lineno">  220</span>        min1, max1 = top[axisTag]</div>
<div class="line"><span class="lineno">  221</span>        min2, max2 = bot[axisTag]</div>
<div class="line"><span class="lineno">  222</span>        minimum = max(min1, min2)</div>
<div class="line"><span class="lineno">  223</span>        maximum = min(max1, max2)</div>
<div class="line"><span class="lineno">  224</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> minimum &lt; maximum:</div>
<div class="line"><span class="lineno">  225</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span>, bot <span class="comment"># Do not intersect</span></div>
<div class="line"><span class="lineno">  226</span>        intersection[axisTag] = minimum,maximum</div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>    <span class="comment"># Remainder</span></div>
<div class="line"><span class="lineno">  229</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  230</span>    <span class="comment"># Remainder is empty if bot&#39;s each axis range lies within that of intersection.</span></div>
<div class="line"><span class="lineno">  231</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  232</span>    <span class="comment"># Remainder is shrank if bot&#39;s each, except for exactly one, axis range lies</span></div>
<div class="line"><span class="lineno">  233</span>    <span class="comment"># within that of intersection, and that one axis, it spills out of the</span></div>
<div class="line"><span class="lineno">  234</span>    <span class="comment"># intersection only on one side.</span></div>
<div class="line"><span class="lineno">  235</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  236</span>    <span class="comment"># Bot is returned in full as remainder otherwise, as true remainder is not</span></div>
<div class="line"><span class="lineno">  237</span>    <span class="comment"># representable as a single box.</span></div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>    remainder = dict(bot)</div>
<div class="line"><span class="lineno">  240</span>    exactlyOne = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  241</span>    fullyInside = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  242</span>    <span class="keywordflow">for</span> axisTag <span class="keywordflow">in</span> bot:</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">if</span> axisTag <span class="keywordflow">not</span> <span class="keywordflow">in</span> intersection:</div>
<div class="line"><span class="lineno">  244</span>            fullyInside = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  245</span>            <span class="keywordflow">continue</span> <span class="comment"># Axis range lies fully within</span></div>
<div class="line"><span class="lineno">  246</span>        min1, max1 = intersection[axisTag]</div>
<div class="line"><span class="lineno">  247</span>        min2, max2 = bot[axisTag]</div>
<div class="line"><span class="lineno">  248</span>        <span class="keywordflow">if</span> min1 &lt;= min2 <span class="keywordflow">and</span> max2 &lt;= max1:</div>
<div class="line"><span class="lineno">  249</span>            <span class="keywordflow">continue</span> <span class="comment"># Axis range lies fully within</span></div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span>        <span class="comment"># Bot&#39;s range doesn&#39;t fully lie within that of top&#39;s for this axis.</span></div>
<div class="line"><span class="lineno">  252</span>        <span class="comment"># We know they intersect, so it cannot lie fully without either; so they</span></div>
<div class="line"><span class="lineno">  253</span>        <span class="comment"># overlap.</span></div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>        <span class="comment"># If we have had an overlapping axis before, remainder is not</span></div>
<div class="line"><span class="lineno">  256</span>        <span class="comment"># representable as a box, so return full bottom and go home.</span></div>
<div class="line"><span class="lineno">  257</span>        <span class="keywordflow">if</span> exactlyOne:</div>
<div class="line"><span class="lineno">  258</span>            <span class="keywordflow">return</span> intersection, bot</div>
<div class="line"><span class="lineno">  259</span>        exactlyOne = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  260</span>        fullyInside = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>        <span class="comment"># Otherwise, cut remainder on this axis and continue.</span></div>
<div class="line"><span class="lineno">  263</span>        <span class="keywordflow">if</span> min1 &lt;= min2:</div>
<div class="line"><span class="lineno">  264</span>            <span class="comment"># Right side survives.</span></div>
<div class="line"><span class="lineno">  265</span>            minimum = max(max1, min2)</div>
<div class="line"><span class="lineno">  266</span>            maximum = max2</div>
<div class="line"><span class="lineno">  267</span>        <span class="keywordflow">elif</span> max2 &lt;= max1:</div>
<div class="line"><span class="lineno">  268</span>            <span class="comment"># Left side survives.</span></div>
<div class="line"><span class="lineno">  269</span>            minimum = min2</div>
<div class="line"><span class="lineno">  270</span>            maximum = min(min1, max2)</div>
<div class="line"><span class="lineno">  271</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  272</span>            <span class="comment"># Remainder leaks out from both sides.  Can&#39;t cut either.</span></div>
<div class="line"><span class="lineno">  273</span>            <span class="keywordflow">return</span> intersection, bot</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>        remainder[axisTag] = minimum,maximum</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>    <span class="keywordflow">if</span> fullyInside:</div>
<div class="line"><span class="lineno">  278</span>        <span class="comment"># bot is fully within intersection.  Remainder is empty.</span></div>
<div class="line"><span class="lineno">  279</span>        <span class="keywordflow">return</span> intersection, <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">return</span> intersection, remainder</div>
<div class="line"><span class="lineno">  282</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a98455ef199d9013baf64572e88095604" name="a98455ef199d9013baf64572e88095604"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98455ef199d9013baf64572e88095604">&#9670;&#160;</a></span>overlayFeatureVariations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.overlayFeatureVariations </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>conditionalSubstitutions</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Compute overlaps between all conditional substitutions.

The `conditionalSubstitutions` argument is a list of (Region, Substitutions)
tuples.

A Region is a list of Boxes. A Box is a dict mapping axisTags to
(minValue, maxValue) tuples. Irrelevant axes may be omitted and they are
interpretted as extending to end of axis in each direction.  A Box represents
an orthogonal 'rectangular' subset of an N-dimensional design space.
A Region represents a more complex subset of an N-dimensional design space,
ie. the union of all the Boxes in the Region.
For efficiency, Boxes within a Region should ideally not overlap, but
functionality is not compromised if they do.

The minimum and maximum values are expressed in normalized coordinates.

A Substitution is a dict mapping source glyph names to substitute glyph names.

Returns data is in similar but different format.  Overlaps of distinct
substitution Boxes (*not* Regions) are explicitly listed as distinct rules,
and rules with the same Box merged.  The more specific rules appear earlier
in the resulting list.  Moreover, instead of just a dictionary of substitutions,
a list of dictionaries is returned for substitutions corresponding to each
unique space, with each dictionary being identical to one of the input
substitution dictionaries.  These dictionaries are not merged to allow data
sharing when they are converted into font tables.

Example::

    &gt;&gt;&gt; condSubst = [
    ...     # A list of (Region, Substitution) tuples.
    ...     ([{"wght": (0.5, 1.0)}], {"dollar": "dollar.rvrn"}),
    ...     ([{"wght": (0.5, 1.0)}], {"dollar": "dollar.rvrn"}),
    ...     ([{"wdth": (0.5, 1.0)}], {"cent": "cent.rvrn"}),
    ...     ([{"wght": (0.5, 1.0), "wdth": (-1, 1.0)}], {"dollar": "dollar.rvrn"}),
    ... ]
    &gt;&gt;&gt; from pprint import pprint
    &gt;&gt;&gt; pprint(overlayFeatureVariations(condSubst))
    [({'wdth': (0.5, 1.0), 'wght': (0.5, 1.0)},
      [{'dollar': 'dollar.rvrn'}, {'cent': 'cent.rvrn'}]),
     ({'wdth': (0.5, 1.0)}, [{'cent': 'cent.rvrn'}]),
     ({'wght': (0.5, 1.0)}, [{'dollar': 'dollar.rvrn'}])]</pre> <div class="fragment"><div class="line"><span class="lineno">   85</span><span class="keyword">def </span>overlayFeatureVariations(conditionalSubstitutions):</div>
<div class="line"><span class="lineno">   86</span>    <span class="stringliteral">&quot;&quot;&quot;Compute overlaps between all conditional substitutions.</span></div>
<div class="line"><span class="lineno">   87</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   88</span><span class="stringliteral">    The `conditionalSubstitutions` argument is a list of (Region, Substitutions)</span></div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral">    tuples.</span></div>
<div class="line"><span class="lineno">   90</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   91</span><span class="stringliteral">    A Region is a list of Boxes. A Box is a dict mapping axisTags to</span></div>
<div class="line"><span class="lineno">   92</span><span class="stringliteral">    (minValue, maxValue) tuples. Irrelevant axes may be omitted and they are</span></div>
<div class="line"><span class="lineno">   93</span><span class="stringliteral">    interpretted as extending to end of axis in each direction.  A Box represents</span></div>
<div class="line"><span class="lineno">   94</span><span class="stringliteral">    an orthogonal &#39;rectangular&#39; subset of an N-dimensional design space.</span></div>
<div class="line"><span class="lineno">   95</span><span class="stringliteral">    A Region represents a more complex subset of an N-dimensional design space,</span></div>
<div class="line"><span class="lineno">   96</span><span class="stringliteral">    ie. the union of all the Boxes in the Region.</span></div>
<div class="line"><span class="lineno">   97</span><span class="stringliteral">    For efficiency, Boxes within a Region should ideally not overlap, but</span></div>
<div class="line"><span class="lineno">   98</span><span class="stringliteral">    functionality is not compromised if they do.</span></div>
<div class="line"><span class="lineno">   99</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral">    The minimum and maximum values are expressed in normalized coordinates.</span></div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">    A Substitution is a dict mapping source glyph names to substitute glyph names.</span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">    Returns data is in similar but different format.  Overlaps of distinct</span></div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">    substitution Boxes (*not* Regions) are explicitly listed as distinct rules,</span></div>
<div class="line"><span class="lineno">  106</span><span class="stringliteral">    and rules with the same Box merged.  The more specific rules appear earlier</span></div>
<div class="line"><span class="lineno">  107</span><span class="stringliteral">    in the resulting list.  Moreover, instead of just a dictionary of substitutions,</span></div>
<div class="line"><span class="lineno">  108</span><span class="stringliteral">    a list of dictionaries is returned for substitutions corresponding to each</span></div>
<div class="line"><span class="lineno">  109</span><span class="stringliteral">    unique space, with each dictionary being identical to one of the input</span></div>
<div class="line"><span class="lineno">  110</span><span class="stringliteral">    substitution dictionaries.  These dictionaries are not merged to allow data</span></div>
<div class="line"><span class="lineno">  111</span><span class="stringliteral">    sharing when they are converted into font tables.</span></div>
<div class="line"><span class="lineno">  112</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  113</span><span class="stringliteral">    Example::</span></div>
<div class="line"><span class="lineno">  114</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  115</span><span class="stringliteral">        &gt;&gt;&gt; condSubst = [</span></div>
<div class="line"><span class="lineno">  116</span><span class="stringliteral">        ...     # A list of (Region, Substitution) tuples.</span></div>
<div class="line"><span class="lineno">  117</span><span class="stringliteral">        ...     ([{&quot;wght&quot;: (0.5, 1.0)}], {&quot;dollar&quot;: &quot;dollar.rvrn&quot;}),</span></div>
<div class="line"><span class="lineno">  118</span><span class="stringliteral">        ...     ([{&quot;wght&quot;: (0.5, 1.0)}], {&quot;dollar&quot;: &quot;dollar.rvrn&quot;}),</span></div>
<div class="line"><span class="lineno">  119</span><span class="stringliteral">        ...     ([{&quot;wdth&quot;: (0.5, 1.0)}], {&quot;cent&quot;: &quot;cent.rvrn&quot;}),</span></div>
<div class="line"><span class="lineno">  120</span><span class="stringliteral">        ...     ([{&quot;wght&quot;: (0.5, 1.0), &quot;wdth&quot;: (-1, 1.0)}], {&quot;dollar&quot;: &quot;dollar.rvrn&quot;}),</span></div>
<div class="line"><span class="lineno">  121</span><span class="stringliteral">        ... ]</span></div>
<div class="line"><span class="lineno">  122</span><span class="stringliteral">        &gt;&gt;&gt; from pprint import pprint</span></div>
<div class="line"><span class="lineno">  123</span><span class="stringliteral">        &gt;&gt;&gt; pprint(overlayFeatureVariations(condSubst))</span></div>
<div class="line"><span class="lineno">  124</span><span class="stringliteral">        [({&#39;wdth&#39;: (0.5, 1.0), &#39;wght&#39;: (0.5, 1.0)},</span></div>
<div class="line"><span class="lineno">  125</span><span class="stringliteral">          [{&#39;dollar&#39;: &#39;dollar.rvrn&#39;}, {&#39;cent&#39;: &#39;cent.rvrn&#39;}]),</span></div>
<div class="line"><span class="lineno">  126</span><span class="stringliteral">         ({&#39;wdth&#39;: (0.5, 1.0)}, [{&#39;cent&#39;: &#39;cent.rvrn&#39;}]),</span></div>
<div class="line"><span class="lineno">  127</span><span class="stringliteral">         ({&#39;wght&#39;: (0.5, 1.0)}, [{&#39;dollar&#39;: &#39;dollar.rvrn&#39;}])]</span></div>
<div class="line"><span class="lineno">  128</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  129</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="comment"># Merge same-substitutions rules, as this creates fewer number oflookups.</span></div>
<div class="line"><span class="lineno">  132</span>    merged = OrderedDict()</div>
<div class="line"><span class="lineno">  133</span>    <span class="keywordflow">for</span> value,key <span class="keywordflow">in</span> conditionalSubstitutions:</div>
<div class="line"><span class="lineno">  134</span>        key = hashdict(key)</div>
<div class="line"><span class="lineno">  135</span>        <span class="keywordflow">if</span> key <span class="keywordflow">in</span> merged:</div>
<div class="line"><span class="lineno">  136</span>            merged[key].extend(value)</div>
<div class="line"><span class="lineno">  137</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  138</span>            merged[key] = value</div>
<div class="line"><span class="lineno">  139</span>    conditionalSubstitutions = [(v,dict(k)) <span class="keywordflow">for</span> k,v <span class="keywordflow">in</span> merged.items()]</div>
<div class="line"><span class="lineno">  140</span>    del merged</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    <span class="comment"># Merge same-region rules, as this is cheaper.</span></div>
<div class="line"><span class="lineno">  143</span>    <span class="comment"># Also convert boxes to hashdict()</span></div>
<div class="line"><span class="lineno">  144</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  145</span>    <span class="comment"># Reversing is such that earlier entries win in case of conflicting substitution</span></div>
<div class="line"><span class="lineno">  146</span>    <span class="comment"># rules for the same region.</span></div>
<div class="line"><span class="lineno">  147</span>    merged = OrderedDict()</div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordflow">for</span> key,value <span class="keywordflow">in</span> reversed(conditionalSubstitutions):</div>
<div class="line"><span class="lineno">  149</span>        key = tuple(sorted((hashdict(cleanupBox(k)) <span class="keywordflow">for</span> k <span class="keywordflow">in</span> key),</div>
<div class="line"><span class="lineno">  150</span>                           key=<span class="keyword">lambda</span> d: tuple(sorted(d.items()))))</div>
<div class="line"><span class="lineno">  151</span>        <span class="keywordflow">if</span> key <span class="keywordflow">in</span> merged:</div>
<div class="line"><span class="lineno">  152</span>            merged[key].update(value)</div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  154</span>            merged[key] = dict(value)</div>
<div class="line"><span class="lineno">  155</span>    conditionalSubstitutions = list(reversed(merged.items()))</div>
<div class="line"><span class="lineno">  156</span>    del merged</div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>    <span class="comment"># Overlay</span></div>
<div class="line"><span class="lineno">  159</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  160</span>    <span class="comment"># Rank is the bit-set of the index of all contributing layers.</span></div>
<div class="line"><span class="lineno">  161</span>    initMapInit = ((hashdict(),0),) <span class="comment"># Initializer representing the entire space</span></div>
<div class="line"><span class="lineno">  162</span>    boxMap = OrderedDict(initMapInit) <span class="comment"># Map from Box to Rank</span></div>
<div class="line"><span class="lineno">  163</span>    <span class="keywordflow">for</span> i,(currRegion,_) <span class="keywordflow">in</span> enumerate(conditionalSubstitutions):</div>
<div class="line"><span class="lineno">  164</span>        newMap = OrderedDict(initMapInit)</div>
<div class="line"><span class="lineno">  165</span>        currRank = 1&lt;&lt;i</div>
<div class="line"><span class="lineno">  166</span>        <span class="keywordflow">for</span> box,rank <span class="keywordflow">in</span> boxMap.items():</div>
<div class="line"><span class="lineno">  167</span>            <span class="keywordflow">for</span> currBox <span class="keywordflow">in</span> currRegion:</div>
<div class="line"><span class="lineno">  168</span>                intersection, remainder = overlayBox(currBox, box)</div>
<div class="line"><span class="lineno">  169</span>                <span class="keywordflow">if</span> intersection <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  170</span>                    intersection = hashdict(intersection)</div>
<div class="line"><span class="lineno">  171</span>                    newMap[intersection] = newMap.get(intersection, 0) | rank|currRank</div>
<div class="line"><span class="lineno">  172</span>                <span class="keywordflow">if</span> remainder <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  173</span>                    remainder = hashdict(remainder)</div>
<div class="line"><span class="lineno">  174</span>                    newMap[remainder] = newMap.get(remainder, 0) | rank</div>
<div class="line"><span class="lineno">  175</span>        boxMap = newMap</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    <span class="comment"># Generate output</span></div>
<div class="line"><span class="lineno">  178</span>    items = []</div>
<div class="line"><span class="lineno">  179</span>    <span class="keywordflow">for</span> box,rank <span class="keywordflow">in</span> sorted(boxMap.items(),</div>
<div class="line"><span class="lineno">  180</span>                           key=(<span class="keyword">lambda</span> BoxAndRank: -popCount(BoxAndRank[1]))):</div>
<div class="line"><span class="lineno">  181</span>        <span class="comment"># Skip any box that doesn&#39;t have any substitution.</span></div>
<div class="line"><span class="lineno">  182</span>        <span class="keywordflow">if</span> rank == 0:</div>
<div class="line"><span class="lineno">  183</span>            <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  184</span>        substsList = []</div>
<div class="line"><span class="lineno">  185</span>        i = 0</div>
<div class="line"><span class="lineno">  186</span>        <span class="keywordflow">while</span> rank:</div>
<div class="line"><span class="lineno">  187</span>          <span class="keywordflow">if</span> rank &amp; 1:</div>
<div class="line"><span class="lineno">  188</span>              substsList.append(conditionalSubstitutions[i][1])</div>
<div class="line"><span class="lineno">  189</span>          rank &gt;&gt;= 1</div>
<div class="line"><span class="lineno">  190</span>          i += 1</div>
<div class="line"><span class="lineno">  191</span>        items.append((dict(box),substsList))</div>
<div class="line"><span class="lineno">  192</span>    <span class="keywordflow">return</span> items</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span> </div>
<div class="line"><span class="lineno">  195</span><span class="comment">#</span></div>
<div class="line"><span class="lineno">  196</span><span class="comment"># Terminology:</span></div>
<div class="line"><span class="lineno">  197</span><span class="comment">#</span></div>
<div class="line"><span class="lineno">  198</span><span class="comment"># A &#39;Box&#39; is a dict representing an orthogonal &quot;rectangular&quot; bit of N-dimensional space.</span></div>
<div class="line"><span class="lineno">  199</span><span class="comment"># The keys in the dict are axis tags, the values are (minValue, maxValue) tuples.</span></div>
<div class="line"><span class="lineno">  200</span><span class="comment"># Missing dimensions (keys) are substituted by the default min and max values</span></div>
<div class="line"><span class="lineno">  201</span><span class="comment"># from the corresponding axes.</span></div>
<div class="line"><span class="lineno">  202</span><span class="comment">#</span></div>
<div class="line"><span class="lineno">  203</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0dca2df9f8535a3e301d2520a9af8561" name="a0dca2df9f8535a3e301d2520a9af8561"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dca2df9f8535a3e301d2520a9af8561">&#9670;&#160;</a></span>remapFeatures()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.remapFeatures </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>featureRemap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Go through the scripts list, and remap feature indices.</pre> <div class="fragment"><div class="line"><span class="lineno">  501</span><span class="keyword">def </span>remapFeatures(table, featureRemap):</div>
<div class="line"><span class="lineno">  502</span>    <span class="stringliteral">&quot;&quot;&quot;Go through the scripts list, and remap feature indices.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  503</span>    <span class="keywordflow">for</span> scriptIndex, script <span class="keywordflow">in</span> enumerate(table.ScriptList.ScriptRecord):</div>
<div class="line"><span class="lineno">  504</span>        defaultLangSys = script.Script.DefaultLangSys</div>
<div class="line"><span class="lineno">  505</span>        <span class="keywordflow">if</span> defaultLangSys <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  506</span>            _remapLangSys(defaultLangSys, featureRemap)</div>
<div class="line"><span class="lineno">  507</span>        <span class="keywordflow">for</span> langSysRecordIndex, langSysRec <span class="keywordflow">in</span> enumerate(script.Script.LangSysRecord):</div>
<div class="line"><span class="lineno">  508</span>            langSys = langSysRec.LangSys</div>
<div class="line"><span class="lineno">  509</span>            _remapLangSys(langSys, featureRemap)</div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>    <span class="keywordflow">if</span> hasattr(table, <span class="stringliteral">&quot;FeatureVariations&quot;</span>) <span class="keywordflow">and</span> table.FeatureVariations <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  512</span>        <span class="keywordflow">for</span> fvr <span class="keywordflow">in</span> table.FeatureVariations.FeatureVariationRecord:</div>
<div class="line"><span class="lineno">  513</span>            <span class="keywordflow">for</span> ftsr <span class="keywordflow">in</span> fvr.FeatureTableSubstitution.SubstitutionRecord:</div>
<div class="line"><span class="lineno">  514</span>                ftsr.FeatureIndex = featureRemap[ftsr.FeatureIndex]</div>
<div class="line"><span class="lineno">  515</span> </div>
<div class="line"><span class="lineno">  516</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a71bbc76b3ecb3a9ce0dd4de99e99e156" name="a71bbc76b3ecb3a9ce0dd4de99e99e156"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71bbc76b3ecb3a9ce0dd4de99e99e156">&#9670;&#160;</a></span>sortFeatureList()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fontTools.varLib.featureVars.sortFeatureList </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>table</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Sort the feature list by feature tag, and remap the feature indices
elsewhere. This is needed after the feature list has been modified.
</pre> <div class="fragment"><div class="line"><span class="lineno">  487</span><span class="keyword">def </span>sortFeatureList(table):</div>
<div class="line"><span class="lineno">  488</span>    <span class="stringliteral">&quot;&quot;&quot;Sort the feature list by feature tag, and remap the feature indices</span></div>
<div class="line"><span class="lineno">  489</span><span class="stringliteral">    elsewhere. This is needed after the feature list has been modified.</span></div>
<div class="line"><span class="lineno">  490</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  491</span>    <span class="comment"># decorate, sort, undecorate, because we need to make an index remapping table</span></div>
<div class="line"><span class="lineno">  492</span>    tagIndexFea = [(fea.FeatureTag, index, fea) <span class="keywordflow">for</span> index, fea <span class="keywordflow">in</span> enumerate(table.FeatureList.FeatureRecord)]</div>
<div class="line"><span class="lineno">  493</span>    tagIndexFea.sort()</div>
<div class="line"><span class="lineno">  494</span>    table.FeatureList.FeatureRecord = [fea <span class="keywordflow">for</span> tag, index, fea <span class="keywordflow">in</span> tagIndexFea]</div>
<div class="line"><span class="lineno">  495</span>    featureRemap = dict(zip([index <span class="keywordflow">for</span> tag, index, fea <span class="keywordflow">in</span> tagIndexFea], range(len(tagIndexFea))))</div>
<div class="line"><span class="lineno">  496</span> </div>
<div class="line"><span class="lineno">  497</span>    <span class="comment"># Remap the feature indices</span></div>
<div class="line"><span class="lineno">  498</span>    remapFeatures(table, featureRemap)</div>
<div class="line"><span class="lineno">  499</span> </div>
<div class="line"><span class="lineno">  500</span> </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
