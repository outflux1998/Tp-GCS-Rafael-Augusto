<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: sklearn.covariance._shrunk_covariance Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacesklearn.html">sklearn</a></li><li class="navelem"><a class="el" href="namespacesklearn_1_1covariance.html">covariance</a></li><li class="navelem"><a class="el" href="namespacesklearn_1_1covariance_1_1__shrunk__covariance.html">_shrunk_covariance</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">sklearn.covariance._shrunk_covariance Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsklearn_1_1covariance_1_1__shrunk__covariance_1_1_ledoit_wolf.html">LedoitWolf</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsklearn_1_1covariance_1_1__shrunk__covariance_1_1_o_a_s.html">OAS</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsklearn_1_1covariance_1_1__shrunk__covariance_1_1_shrunk_covariance.html">ShrunkCovariance</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a209d3d41c1355ac7f739fcddace238d8" id="r_a209d3d41c1355ac7f739fcddace238d8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesklearn_1_1covariance_1_1__shrunk__covariance.html#a209d3d41c1355ac7f739fcddace238d8">shrunk_covariance</a> (emp_cov, shrinkage=0.1)</td></tr>
<tr class="separator:a209d3d41c1355ac7f739fcddace238d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add11f8d21f68ce1d1a9bbe59a09d4248" id="r_add11f8d21f68ce1d1a9bbe59a09d4248"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesklearn_1_1covariance_1_1__shrunk__covariance.html#add11f8d21f68ce1d1a9bbe59a09d4248">ledoit_wolf_shrinkage</a> (X, assume_centered=False, block_size=1000)</td></tr>
<tr class="separator:add11f8d21f68ce1d1a9bbe59a09d4248"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87898f17a74c2f54551cac936c0a703c" id="r_a87898f17a74c2f54551cac936c0a703c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesklearn_1_1covariance_1_1__shrunk__covariance.html#a87898f17a74c2f54551cac936c0a703c">ledoit_wolf</a> (X, *assume_centered=False, block_size=1000)</td></tr>
<tr class="separator:a87898f17a74c2f54551cac936c0a703c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa39a74ae7a17ee757622f77359366fe7" id="r_aa39a74ae7a17ee757622f77359366fe7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesklearn_1_1covariance_1_1__shrunk__covariance.html#aa39a74ae7a17ee757622f77359366fe7">oas</a> (X, *assume_centered=False)</td></tr>
<tr class="separator:aa39a74ae7a17ee757622f77359366fe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Covariance estimators using shrinkage.

Shrinkage corresponds to regularising `cov` using a convex combination:
shrunk_cov = (1-shrinkage)*cov + shrinkage*structured_estimate.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a87898f17a74c2f54551cac936c0a703c" name="a87898f17a74c2f54551cac936c0a703c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87898f17a74c2f54551cac936c0a703c">&#9670;&#160;</a></span>ledoit_wolf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sklearn.covariance._shrunk_covariance.ledoit_wolf </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">*&#160;</td>
          <td class="paramname"><em>assume_centered</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>block_size</em> = <code>1000</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Estimate the shrunk Ledoit-Wolf covariance matrix.

Read more in the :ref:`User Guide &lt;shrunk_covariance&gt;`.

Parameters
----------
X : array-like of shape (n_samples, n_features)
    Data from which to compute the covariance estimate.

assume_centered : bool, default=False
    If True, data will not be centered before computation.
    Useful to work with data whose mean is significantly equal to
    zero but is not exactly zero.
    If False, data will be centered before computation.

block_size : int, default=1000
    Size of blocks into which the covariance matrix will be split.
    This is purely a memory optimization and does not affect results.

Returns
-------
shrunk_cov : ndarray of shape (n_features, n_features)
    Shrunk covariance.

shrinkage : float
    Coefficient in the convex combination used for the computation
    of the shrunk estimate.

Notes
-----
The regularized (shrunk) covariance is:

(1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)

where mu = trace(cov) / n_features
</pre> <div class="fragment"><div class="line"><span class="lineno">  291</span><span class="keyword">def </span>ledoit_wolf(X, *, assume_centered=False, block_size=1000):</div>
<div class="line"><span class="lineno">  292</span>    <span class="stringliteral">&quot;&quot;&quot;Estimate the shrunk Ledoit-Wolf covariance matrix.</span></div>
<div class="line"><span class="lineno">  293</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  294</span><span class="stringliteral">    Read more in the :ref:`User Guide &lt;shrunk_covariance&gt;`.</span></div>
<div class="line"><span class="lineno">  295</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  296</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  297</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  298</span><span class="stringliteral">    X : array-like of shape (n_samples, n_features)</span></div>
<div class="line"><span class="lineno">  299</span><span class="stringliteral">        Data from which to compute the covariance estimate.</span></div>
<div class="line"><span class="lineno">  300</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  301</span><span class="stringliteral">    assume_centered : bool, default=False</span></div>
<div class="line"><span class="lineno">  302</span><span class="stringliteral">        If True, data will not be centered before computation.</span></div>
<div class="line"><span class="lineno">  303</span><span class="stringliteral">        Useful to work with data whose mean is significantly equal to</span></div>
<div class="line"><span class="lineno">  304</span><span class="stringliteral">        zero but is not exactly zero.</span></div>
<div class="line"><span class="lineno">  305</span><span class="stringliteral">        If False, data will be centered before computation.</span></div>
<div class="line"><span class="lineno">  306</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  307</span><span class="stringliteral">    block_size : int, default=1000</span></div>
<div class="line"><span class="lineno">  308</span><span class="stringliteral">        Size of blocks into which the covariance matrix will be split.</span></div>
<div class="line"><span class="lineno">  309</span><span class="stringliteral">        This is purely a memory optimization and does not affect results.</span></div>
<div class="line"><span class="lineno">  310</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  311</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  312</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  313</span><span class="stringliteral">    shrunk_cov : ndarray of shape (n_features, n_features)</span></div>
<div class="line"><span class="lineno">  314</span><span class="stringliteral">        Shrunk covariance.</span></div>
<div class="line"><span class="lineno">  315</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  316</span><span class="stringliteral">    shrinkage : float</span></div>
<div class="line"><span class="lineno">  317</span><span class="stringliteral">        Coefficient in the convex combination used for the computation</span></div>
<div class="line"><span class="lineno">  318</span><span class="stringliteral">        of the shrunk estimate.</span></div>
<div class="line"><span class="lineno">  319</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  320</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">  321</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">  322</span><span class="stringliteral">    The regularized (shrunk) covariance is:</span></div>
<div class="line"><span class="lineno">  323</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  324</span><span class="stringliteral">    (1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)</span></div>
<div class="line"><span class="lineno">  325</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  326</span><span class="stringliteral">    where mu = trace(cov) / n_features</span></div>
<div class="line"><span class="lineno">  327</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  328</span>    X = check_array(X)</div>
<div class="line"><span class="lineno">  329</span>    <span class="comment"># for only one feature, the result is the same whatever the shrinkage</span></div>
<div class="line"><span class="lineno">  330</span>    <span class="keywordflow">if</span> len(X.shape) == 2 <span class="keywordflow">and</span> X.shape[1] == 1:</div>
<div class="line"><span class="lineno">  331</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> assume_centered:</div>
<div class="line"><span class="lineno">  332</span>            X = X - X.mean()</div>
<div class="line"><span class="lineno">  333</span>        <span class="keywordflow">return</span> np.atleast_2d((X**2).mean()), 0.0</div>
<div class="line"><span class="lineno">  334</span>    <span class="keywordflow">if</span> X.ndim == 1:</div>
<div class="line"><span class="lineno">  335</span>        X = np.reshape(X, (1, -1))</div>
<div class="line"><span class="lineno">  336</span>        warnings.warn(</div>
<div class="line"><span class="lineno">  337</span>            <span class="stringliteral">&quot;Only one sample available. You may want to reshape your data array&quot;</span></div>
<div class="line"><span class="lineno">  338</span>        )</div>
<div class="line"><span class="lineno">  339</span>        n_features = X.size</div>
<div class="line"><span class="lineno">  340</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  341</span>        _, n_features = X.shape</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>    <span class="comment"># get Ledoit-Wolf shrinkage</span></div>
<div class="line"><span class="lineno">  344</span>    shrinkage = ledoit_wolf_shrinkage(</div>
<div class="line"><span class="lineno">  345</span>        X, assume_centered=assume_centered, block_size=block_size</div>
<div class="line"><span class="lineno">  346</span>    )</div>
<div class="line"><span class="lineno">  347</span>    emp_cov = empirical_covariance(X, assume_centered=assume_centered)</div>
<div class="line"><span class="lineno">  348</span>    mu = np.sum(np.trace(emp_cov)) / n_features</div>
<div class="line"><span class="lineno">  349</span>    shrunk_cov = (1.0 - shrinkage) * emp_cov</div>
<div class="line"><span class="lineno">  350</span>    shrunk_cov.flat[:: n_features + 1] += shrinkage * mu</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>    <span class="keywordflow">return</span> shrunk_cov, shrinkage</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="add11f8d21f68ce1d1a9bbe59a09d4248" name="add11f8d21f68ce1d1a9bbe59a09d4248"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add11f8d21f68ce1d1a9bbe59a09d4248">&#9670;&#160;</a></span>ledoit_wolf_shrinkage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sklearn.covariance._shrunk_covariance.ledoit_wolf_shrinkage </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>assume_centered</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>block_size</em> = <code>1000</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Estimate the shrunk Ledoit-Wolf covariance matrix.

Read more in the :ref:`User Guide &lt;shrunk_covariance&gt;`.

Parameters
----------
X : array-like of shape (n_samples, n_features)
    Data from which to compute the Ledoit-Wolf shrunk covariance shrinkage.

assume_centered : bool, default=False
    If True, data will not be centered before computation.
    Useful to work with data whose mean is significantly equal to
    zero but is not exactly zero.
    If False, data will be centered before computation.

block_size : int, default=1000
    Size of blocks into which the covariance matrix will be split.

Returns
-------
shrinkage : float
    Coefficient in the convex combination used for the computation
    of the shrunk estimate.

Notes
-----
The regularized (shrunk) covariance is:

(1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)

where mu = trace(cov) / n_features
</pre> <div class="fragment"><div class="line"><span class="lineno">  196</span><span class="keyword">def </span>ledoit_wolf_shrinkage(X, assume_centered=False, block_size=1000):</div>
<div class="line"><span class="lineno">  197</span>    <span class="stringliteral">&quot;&quot;&quot;Estimate the shrunk Ledoit-Wolf covariance matrix.</span></div>
<div class="line"><span class="lineno">  198</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  199</span><span class="stringliteral">    Read more in the :ref:`User Guide &lt;shrunk_covariance&gt;`.</span></div>
<div class="line"><span class="lineno">  200</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  201</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  202</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  203</span><span class="stringliteral">    X : array-like of shape (n_samples, n_features)</span></div>
<div class="line"><span class="lineno">  204</span><span class="stringliteral">        Data from which to compute the Ledoit-Wolf shrunk covariance shrinkage.</span></div>
<div class="line"><span class="lineno">  205</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  206</span><span class="stringliteral">    assume_centered : bool, default=False</span></div>
<div class="line"><span class="lineno">  207</span><span class="stringliteral">        If True, data will not be centered before computation.</span></div>
<div class="line"><span class="lineno">  208</span><span class="stringliteral">        Useful to work with data whose mean is significantly equal to</span></div>
<div class="line"><span class="lineno">  209</span><span class="stringliteral">        zero but is not exactly zero.</span></div>
<div class="line"><span class="lineno">  210</span><span class="stringliteral">        If False, data will be centered before computation.</span></div>
<div class="line"><span class="lineno">  211</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  212</span><span class="stringliteral">    block_size : int, default=1000</span></div>
<div class="line"><span class="lineno">  213</span><span class="stringliteral">        Size of blocks into which the covariance matrix will be split.</span></div>
<div class="line"><span class="lineno">  214</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  215</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  216</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  217</span><span class="stringliteral">    shrinkage : float</span></div>
<div class="line"><span class="lineno">  218</span><span class="stringliteral">        Coefficient in the convex combination used for the computation</span></div>
<div class="line"><span class="lineno">  219</span><span class="stringliteral">        of the shrunk estimate.</span></div>
<div class="line"><span class="lineno">  220</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  221</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">  222</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">  223</span><span class="stringliteral">    The regularized (shrunk) covariance is:</span></div>
<div class="line"><span class="lineno">  224</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  225</span><span class="stringliteral">    (1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)</span></div>
<div class="line"><span class="lineno">  226</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  227</span><span class="stringliteral">    where mu = trace(cov) / n_features</span></div>
<div class="line"><span class="lineno">  228</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  229</span>    X = check_array(X)</div>
<div class="line"><span class="lineno">  230</span>    <span class="comment"># for only one feature, the result is the same whatever the shrinkage</span></div>
<div class="line"><span class="lineno">  231</span>    <span class="keywordflow">if</span> len(X.shape) == 2 <span class="keywordflow">and</span> X.shape[1] == 1:</div>
<div class="line"><span class="lineno">  232</span>        <span class="keywordflow">return</span> 0.0</div>
<div class="line"><span class="lineno">  233</span>    <span class="keywordflow">if</span> X.ndim == 1:</div>
<div class="line"><span class="lineno">  234</span>        X = np.reshape(X, (1, -1))</div>
<div class="line"><span class="lineno">  235</span> </div>
<div class="line"><span class="lineno">  236</span>    <span class="keywordflow">if</span> X.shape[0] == 1:</div>
<div class="line"><span class="lineno">  237</span>        warnings.warn(</div>
<div class="line"><span class="lineno">  238</span>            <span class="stringliteral">&quot;Only one sample available. You may want to reshape your data array&quot;</span></div>
<div class="line"><span class="lineno">  239</span>        )</div>
<div class="line"><span class="lineno">  240</span>    n_samples, n_features = X.shape</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>    <span class="comment"># optionally center data</span></div>
<div class="line"><span class="lineno">  243</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> assume_centered:</div>
<div class="line"><span class="lineno">  244</span>        X = X - X.mean(0)</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>    <span class="comment"># A non-blocked version of the computation is present in the tests</span></div>
<div class="line"><span class="lineno">  247</span>    <span class="comment"># in tests/test_covariance.py</span></div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>    <span class="comment"># number of blocks to split the covariance matrix into</span></div>
<div class="line"><span class="lineno">  250</span>    n_splits = int(n_features / block_size)</div>
<div class="line"><span class="lineno">  251</span>    X2 = X**2</div>
<div class="line"><span class="lineno">  252</span>    emp_cov_trace = np.sum(X2, axis=0) / n_samples</div>
<div class="line"><span class="lineno">  253</span>    mu = np.sum(emp_cov_trace) / n_features</div>
<div class="line"><span class="lineno">  254</span>    beta_ = 0.0  <span class="comment"># sum of the coefficients of &lt;X2.T, X2&gt;</span></div>
<div class="line"><span class="lineno">  255</span>    delta_ = 0.0  <span class="comment"># sum of the *squared* coefficients of &lt;X.T, X&gt;</span></div>
<div class="line"><span class="lineno">  256</span>    <span class="comment"># starting block computation</span></div>
<div class="line"><span class="lineno">  257</span>    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n_splits):</div>
<div class="line"><span class="lineno">  258</span>        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(n_splits):</div>
<div class="line"><span class="lineno">  259</span>            rows = slice(block_size * i, block_size * (i + 1))</div>
<div class="line"><span class="lineno">  260</span>            cols = slice(block_size * j, block_size * (j + 1))</div>
<div class="line"><span class="lineno">  261</span>            beta_ += np.sum(np.dot(X2.T[rows], X2[:, cols]))</div>
<div class="line"><span class="lineno">  262</span>            delta_ += np.sum(np.dot(X.T[rows], X[:, cols]) ** 2)</div>
<div class="line"><span class="lineno">  263</span>        rows = slice(block_size * i, block_size * (i + 1))</div>
<div class="line"><span class="lineno">  264</span>        beta_ += np.sum(np.dot(X2.T[rows], X2[:, block_size * n_splits :]))</div>
<div class="line"><span class="lineno">  265</span>        delta_ += np.sum(np.dot(X.T[rows], X[:, block_size * n_splits :]) ** 2)</div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(n_splits):</div>
<div class="line"><span class="lineno">  267</span>        cols = slice(block_size * j, block_size * (j + 1))</div>
<div class="line"><span class="lineno">  268</span>        beta_ += np.sum(np.dot(X2.T[block_size * n_splits :], X2[:, cols]))</div>
<div class="line"><span class="lineno">  269</span>        delta_ += np.sum(np.dot(X.T[block_size * n_splits :], X[:, cols]) ** 2)</div>
<div class="line"><span class="lineno">  270</span>    delta_ += np.sum(</div>
<div class="line"><span class="lineno">  271</span>        np.dot(X.T[block_size * n_splits :], X[:, block_size * n_splits :]) ** 2</div>
<div class="line"><span class="lineno">  272</span>    )</div>
<div class="line"><span class="lineno">  273</span>    delta_ /= n_samples**2</div>
<div class="line"><span class="lineno">  274</span>    beta_ += np.sum(</div>
<div class="line"><span class="lineno">  275</span>        np.dot(X2.T[block_size * n_splits :], X2[:, block_size * n_splits :])</div>
<div class="line"><span class="lineno">  276</span>    )</div>
<div class="line"><span class="lineno">  277</span>    <span class="comment"># use delta_ to compute beta</span></div>
<div class="line"><span class="lineno">  278</span>    beta = 1.0 / (n_features * n_samples) * (beta_ / n_samples - delta_)</div>
<div class="line"><span class="lineno">  279</span>    <span class="comment"># delta is the sum of the squared coefficients of (&lt;X.T,X&gt; - mu*Id) / p</span></div>
<div class="line"><span class="lineno">  280</span>    delta = delta_ - 2.0 * mu * emp_cov_trace.sum() + n_features * mu**2</div>
<div class="line"><span class="lineno">  281</span>    delta /= n_features</div>
<div class="line"><span class="lineno">  282</span>    <span class="comment"># get final beta as the min between beta and delta</span></div>
<div class="line"><span class="lineno">  283</span>    <span class="comment"># We do this to prevent shrinking more than &quot;1&quot;, which would invert</span></div>
<div class="line"><span class="lineno">  284</span>    <span class="comment"># the value of covariances</span></div>
<div class="line"><span class="lineno">  285</span>    beta = min(beta, delta)</div>
<div class="line"><span class="lineno">  286</span>    <span class="comment"># finally get shrinkage</span></div>
<div class="line"><span class="lineno">  287</span>    shrinkage = 0 <span class="keywordflow">if</span> beta == 0 <span class="keywordflow">else</span> beta / delta</div>
<div class="line"><span class="lineno">  288</span>    <span class="keywordflow">return</span> shrinkage</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aa39a74ae7a17ee757622f77359366fe7" name="aa39a74ae7a17ee757622f77359366fe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa39a74ae7a17ee757622f77359366fe7">&#9670;&#160;</a></span>oas()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sklearn.covariance._shrunk_covariance.oas </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">*&#160;</td>
          <td class="paramname"><em>assume_centered</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Estimate covariance with the Oracle Approximating Shrinkage algorithm.

Parameters
----------
X : array-like of shape (n_samples, n_features)
    Data from which to compute the covariance estimate.

assume_centered : bool, default=False
  If True, data will not be centered before computation.
  Useful to work with data whose mean is significantly equal to
  zero but is not exactly zero.
  If False, data will be centered before computation.

Returns
-------
shrunk_cov : array-like of shape (n_features, n_features)
    Shrunk covariance.

shrinkage : float
    Coefficient in the convex combination used for the computation
    of the shrunk estimate.

Notes
-----
The regularised (shrunk) covariance is:

(1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)

where mu = trace(cov) / n_features

The formula we used to implement the OAS is slightly modified compared
to the one given in the article. See :class:`OAS` for more details.
</pre> <div class="fragment"><div class="line"><span class="lineno">  502</span><span class="keyword">def </span>oas(X, *, assume_centered=False):</div>
<div class="line"><span class="lineno">  503</span>    <span class="stringliteral">&quot;&quot;&quot;Estimate covariance with the Oracle Approximating Shrinkage algorithm.</span></div>
<div class="line"><span class="lineno">  504</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  505</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">  506</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">  507</span><span class="stringliteral">    X : array-like of shape (n_samples, n_features)</span></div>
<div class="line"><span class="lineno">  508</span><span class="stringliteral">        Data from which to compute the covariance estimate.</span></div>
<div class="line"><span class="lineno">  509</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  510</span><span class="stringliteral">    assume_centered : bool, default=False</span></div>
<div class="line"><span class="lineno">  511</span><span class="stringliteral">      If True, data will not be centered before computation.</span></div>
<div class="line"><span class="lineno">  512</span><span class="stringliteral">      Useful to work with data whose mean is significantly equal to</span></div>
<div class="line"><span class="lineno">  513</span><span class="stringliteral">      zero but is not exactly zero.</span></div>
<div class="line"><span class="lineno">  514</span><span class="stringliteral">      If False, data will be centered before computation.</span></div>
<div class="line"><span class="lineno">  515</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  516</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">  517</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">  518</span><span class="stringliteral">    shrunk_cov : array-like of shape (n_features, n_features)</span></div>
<div class="line"><span class="lineno">  519</span><span class="stringliteral">        Shrunk covariance.</span></div>
<div class="line"><span class="lineno">  520</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  521</span><span class="stringliteral">    shrinkage : float</span></div>
<div class="line"><span class="lineno">  522</span><span class="stringliteral">        Coefficient in the convex combination used for the computation</span></div>
<div class="line"><span class="lineno">  523</span><span class="stringliteral">        of the shrunk estimate.</span></div>
<div class="line"><span class="lineno">  524</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  525</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">  526</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">  527</span><span class="stringliteral">    The regularised (shrunk) covariance is:</span></div>
<div class="line"><span class="lineno">  528</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  529</span><span class="stringliteral">    (1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)</span></div>
<div class="line"><span class="lineno">  530</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  531</span><span class="stringliteral">    where mu = trace(cov) / n_features</span></div>
<div class="line"><span class="lineno">  532</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  533</span><span class="stringliteral">    The formula we used to implement the OAS is slightly modified compared</span></div>
<div class="line"><span class="lineno">  534</span><span class="stringliteral">    to the one given in the article. See :class:`OAS` for more details.</span></div>
<div class="line"><span class="lineno">  535</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  536</span>    X = np.asarray(X)</div>
<div class="line"><span class="lineno">  537</span>    <span class="comment"># for only one feature, the result is the same whatever the shrinkage</span></div>
<div class="line"><span class="lineno">  538</span>    <span class="keywordflow">if</span> len(X.shape) == 2 <span class="keywordflow">and</span> X.shape[1] == 1:</div>
<div class="line"><span class="lineno">  539</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> assume_centered:</div>
<div class="line"><span class="lineno">  540</span>            X = X - X.mean()</div>
<div class="line"><span class="lineno">  541</span>        <span class="keywordflow">return</span> np.atleast_2d((X**2).mean()), 0.0</div>
<div class="line"><span class="lineno">  542</span>    <span class="keywordflow">if</span> X.ndim == 1:</div>
<div class="line"><span class="lineno">  543</span>        X = np.reshape(X, (1, -1))</div>
<div class="line"><span class="lineno">  544</span>        warnings.warn(</div>
<div class="line"><span class="lineno">  545</span>            <span class="stringliteral">&quot;Only one sample available. You may want to reshape your data array&quot;</span></div>
<div class="line"><span class="lineno">  546</span>        )</div>
<div class="line"><span class="lineno">  547</span>        n_samples = 1</div>
<div class="line"><span class="lineno">  548</span>        n_features = X.size</div>
<div class="line"><span class="lineno">  549</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  550</span>        n_samples, n_features = X.shape</div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span>    emp_cov = empirical_covariance(X, assume_centered=assume_centered)</div>
<div class="line"><span class="lineno">  553</span>    mu = np.trace(emp_cov) / n_features</div>
<div class="line"><span class="lineno">  554</span> </div>
<div class="line"><span class="lineno">  555</span>    <span class="comment"># formula from Chen et al.&#39;s **implementation**</span></div>
<div class="line"><span class="lineno">  556</span>    alpha = np.mean(emp_cov**2)</div>
<div class="line"><span class="lineno">  557</span>    num = alpha + mu**2</div>
<div class="line"><span class="lineno">  558</span>    den = (n_samples + 1.0) * (alpha - (mu**2) / n_features)</div>
<div class="line"><span class="lineno">  559</span> </div>
<div class="line"><span class="lineno">  560</span>    shrinkage = 1.0 <span class="keywordflow">if</span> den == 0 <span class="keywordflow">else</span> min(num / den, 1.0)</div>
<div class="line"><span class="lineno">  561</span>    shrunk_cov = (1.0 - shrinkage) * emp_cov</div>
<div class="line"><span class="lineno">  562</span>    shrunk_cov.flat[:: n_features + 1] += shrinkage * mu</div>
<div class="line"><span class="lineno">  563</span> </div>
<div class="line"><span class="lineno">  564</span>    <span class="keywordflow">return</span> shrunk_cov, shrinkage</div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a209d3d41c1355ac7f739fcddace238d8" name="a209d3d41c1355ac7f739fcddace238d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a209d3d41c1355ac7f739fcddace238d8">&#9670;&#160;</a></span>shrunk_covariance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sklearn.covariance._shrunk_covariance.shrunk_covariance </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>emp_cov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shrinkage</em> = <code>0.1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Calculate a covariance matrix shrunk on the diagonal.

Read more in the :ref:`User Guide &lt;shrunk_covariance&gt;`.

Parameters
----------
emp_cov : array-like of shape (n_features, n_features)
    Covariance matrix to be shrunk.

shrinkage : float, default=0.1
    Coefficient in the convex combination used for the computation
    of the shrunk estimate. Range is [0, 1].

Returns
-------
shrunk_cov : ndarray of shape (n_features, n_features)
    Shrunk covariance.

Notes
-----
The regularized (shrunk) covariance is given by::

    (1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)

where `mu = trace(cov) / n_features`.
</pre> <div class="fragment"><div class="line"><span class="lineno">   29</span><span class="keyword">def </span>shrunk_covariance(emp_cov, shrinkage=0.1):</div>
<div class="line"><span class="lineno">   30</span>    <span class="stringliteral">&quot;&quot;&quot;Calculate a covariance matrix shrunk on the diagonal.</span></div>
<div class="line"><span class="lineno">   31</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   32</span><span class="stringliteral">    Read more in the :ref:`User Guide &lt;shrunk_covariance&gt;`.</span></div>
<div class="line"><span class="lineno">   33</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   34</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">   35</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">   36</span><span class="stringliteral">    emp_cov : array-like of shape (n_features, n_features)</span></div>
<div class="line"><span class="lineno">   37</span><span class="stringliteral">        Covariance matrix to be shrunk.</span></div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   39</span><span class="stringliteral">    shrinkage : float, default=0.1</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">        Coefficient in the convex combination used for the computation</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral">        of the shrunk estimate. Range is [0, 1].</span></div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">   44</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">   45</span><span class="stringliteral">    shrunk_cov : ndarray of shape (n_features, n_features)</span></div>
<div class="line"><span class="lineno">   46</span><span class="stringliteral">        Shrunk covariance.</span></div>
<div class="line"><span class="lineno">   47</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   48</span><span class="stringliteral">    Notes</span></div>
<div class="line"><span class="lineno">   49</span><span class="stringliteral">    -----</span></div>
<div class="line"><span class="lineno">   50</span><span class="stringliteral">    The regularized (shrunk) covariance is given by::</span></div>
<div class="line"><span class="lineno">   51</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   52</span><span class="stringliteral">        (1 - shrinkage) * cov + shrinkage * mu * np.identity(n_features)</span></div>
<div class="line"><span class="lineno">   53</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   54</span><span class="stringliteral">    where `mu = trace(cov) / n_features`.</span></div>
<div class="line"><span class="lineno">   55</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   56</span>    emp_cov = check_array(emp_cov)</div>
<div class="line"><span class="lineno">   57</span>    n_features = emp_cov.shape[0]</div>
<div class="line"><span class="lineno">   58</span> </div>
<div class="line"><span class="lineno">   59</span>    mu = np.trace(emp_cov) / n_features</div>
<div class="line"><span class="lineno">   60</span>    shrunk_cov = (1.0 - shrinkage) * emp_cov</div>
<div class="line"><span class="lineno">   61</span>    shrunk_cov.flat[:: n_features + 1] += shrinkage * mu</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>    <span class="keywordflow">return</span> shrunk_cov</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span> </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
