<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacescipy.html">scipy</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse.html">sparse</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg.html">linalg</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen.html">_eigen</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg.html">lobpcg</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests.html">tests</a></li><li class="navelem"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html">test_lobpcg</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adf55bcd71fb61253d9ed20fddf312c15" id="r_adf55bcd71fb61253d9ed20fddf312c15"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#adf55bcd71fb61253d9ed20fddf312c15">ElasticRod</a> (<a class="el" href="__blas__subroutines_8h.html#a25eafceb38c8e75bc60701fea6623f71">n</a>)</td></tr>
<tr class="separator:adf55bcd71fb61253d9ed20fddf312c15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adac8c1c3cecbf92750c9754da03d9e48" id="r_adac8c1c3cecbf92750c9754da03d9e48"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#adac8c1c3cecbf92750c9754da03d9e48">MikotaPair</a> (<a class="el" href="__blas__subroutines_8h.html#a25eafceb38c8e75bc60701fea6623f71">n</a>)</td></tr>
<tr class="separator:adac8c1c3cecbf92750c9754da03d9e48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada3b43a9735de07ffdc5ec6412784fb1" id="r_ada3b43a9735de07ffdc5ec6412784fb1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#ada3b43a9735de07ffdc5ec6412784fb1">compare_solutions</a> (A, B, m)</td></tr>
<tr class="separator:ada3b43a9735de07ffdc5ec6412784fb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af63703ac4611e6570275e3d2db63b181" id="r_af63703ac4611e6570275e3d2db63b181"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#af63703ac4611e6570275e3d2db63b181">test_Small</a> ()</td></tr>
<tr class="separator:af63703ac4611e6570275e3d2db63b181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac82bf5193c85bc397910606dadc7affa" id="r_ac82bf5193c85bc397910606dadc7affa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#ac82bf5193c85bc397910606dadc7affa">test_ElasticRod</a> ()</td></tr>
<tr class="separator:ac82bf5193c85bc397910606dadc7affa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a761516490ef9494b5c8b79e1b79c08c7" id="r_a761516490ef9494b5c8b79e1b79c08c7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a761516490ef9494b5c8b79e1b79c08c7">test_MikotaPair</a> ()</td></tr>
<tr class="separator:a761516490ef9494b5c8b79e1b79c08c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a075bc903e4b19cd81757fd56e25a6678" id="r_a075bc903e4b19cd81757fd56e25a6678"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a075bc903e4b19cd81757fd56e25a6678">test_nonhermitian_warning</a> (capsys)</td></tr>
<tr class="separator:a075bc903e4b19cd81757fd56e25a6678"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12313224e7458ea6c988c6994a1b636b" id="r_a12313224e7458ea6c988c6994a1b636b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a12313224e7458ea6c988c6994a1b636b">test_regression</a> ()</td></tr>
<tr class="separator:a12313224e7458ea6c988c6994a1b636b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87170868b5a953632173a9e6b092ff43" id="r_a87170868b5a953632173a9e6b092ff43"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a87170868b5a953632173a9e6b092ff43">test_diagonal</a> (<a class="el" href="__blas__subroutines_8h.html#a25eafceb38c8e75bc60701fea6623f71">n</a>, m, m_excluded)</td></tr>
<tr class="separator:a87170868b5a953632173a9e6b092ff43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a10e5db68ce6c92ca35affd336ecf7b" id="r_a1a10e5db68ce6c92ca35affd336ecf7b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a1a10e5db68ce6c92ca35affd336ecf7b">_check_eigen</a> (M, <a class="el" href="__lapack__subroutines_8h.html#a817b85d82af73ef273fafbec623bb90b">w</a>, V, <a class="el" href="__lapack__subroutines_8h.html#aa4a017e91ee751f9803a1bdb6caf1c06">rtol</a>=1e-8, atol=1e-14)</td></tr>
<tr class="separator:a1a10e5db68ce6c92ca35affd336ecf7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bcaf71a86726eef44f690e78828924b" id="r_a8bcaf71a86726eef44f690e78828924b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a8bcaf71a86726eef44f690e78828924b">_check_fiedler</a> (<a class="el" href="__blas__subroutines_8h.html#a25eafceb38c8e75bc60701fea6623f71">n</a>, p)</td></tr>
<tr class="separator:a8bcaf71a86726eef44f690e78828924b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09d0d1be360ceca30da942276dd6417" id="r_ad09d0d1be360ceca30da942276dd6417"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#ad09d0d1be360ceca30da942276dd6417">test_fiedler_small_8</a> ()</td></tr>
<tr class="separator:ad09d0d1be360ceca30da942276dd6417"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b717b405da8fe5b847a66a345b571a0" id="r_a4b717b405da8fe5b847a66a345b571a0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a4b717b405da8fe5b847a66a345b571a0">test_fiedler_large_12</a> ()</td></tr>
<tr class="separator:a4b717b405da8fe5b847a66a345b571a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29dd804ca1bfa4c44acb34f64b5c0365" id="r_a29dd804ca1bfa4c44acb34f64b5c0365"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a29dd804ca1bfa4c44acb34f64b5c0365">test_failure_to_run_iterations</a> ()</td></tr>
<tr class="separator:a29dd804ca1bfa4c44acb34f64b5c0365"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a948d141721dcb142fec9d58286f709f1" id="r_a948d141721dcb142fec9d58286f709f1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a948d141721dcb142fec9d58286f709f1">test_hermitian</a> ()</td></tr>
<tr class="separator:a948d141721dcb142fec9d58286f709f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24fa0f757848ae0be274efe4b7ec07c4" id="r_a24fa0f757848ae0be274efe4b7ec07c4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a24fa0f757848ae0be274efe4b7ec07c4">test_eigs_consistency</a> (<a class="el" href="__blas__subroutines_8h.html#a25eafceb38c8e75bc60701fea6623f71">n</a>, atol)</td></tr>
<tr class="separator:a24fa0f757848ae0be274efe4b7ec07c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabeedb143541c289c269adcb58421bcd" id="r_aabeedb143541c289c269adcb58421bcd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#aabeedb143541c289c269adcb58421bcd">test_verbosity</a> (tmpdir)</td></tr>
<tr class="separator:aabeedb143541c289c269adcb58421bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcf7608992e588339fe9354ed5e1b110" id="r_afcf7608992e588339fe9354ed5e1b110"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#afcf7608992e588339fe9354ed5e1b110">test_tolerance_float32</a> ()</td></tr>
<tr class="separator:afcf7608992e588339fe9354ed5e1b110"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab72d6331110a56d761ae4a646d6659e3" id="r_ab72d6331110a56d761ae4a646d6659e3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#ab72d6331110a56d761ae4a646d6659e3">test_random_initial_float32</a> ()</td></tr>
<tr class="separator:ab72d6331110a56d761ae4a646d6659e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c029634474d1aeedd142565a7024010" id="r_a4c029634474d1aeedd142565a7024010"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a4c029634474d1aeedd142565a7024010">test_maxit</a> ()</td></tr>
<tr class="separator:a4c029634474d1aeedd142565a7024010"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a33c62d0925b91e2769a9087bbe8928" id="r_a0a33c62d0925b91e2769a9087bbe8928"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a0a33c62d0925b91e2769a9087bbe8928">test_diagonal_data_types</a> ()</td></tr>
<tr class="separator:a0a33c62d0925b91e2769a9087bbe8928"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a05f0881178cd0575d78ffead57de397d" id="r_a05f0881178cd0575d78ffead57de397d"><td class="memItemLeft" align="right" valign="top">tuple&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacescipy_1_1sparse_1_1linalg_1_1__eigen_1_1lobpcg_1_1tests_1_1test__lobpcg.html#a05f0881178cd0575d78ffead57de397d">_IS_32BIT</a> = (sys.maxsize &lt; 2**32)</td></tr>
<tr class="separator:a05f0881178cd0575d78ffead57de397d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment"> Test functions for the sparse.linalg._eigen.lobpcg module
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a1a10e5db68ce6c92ca35affd336ecf7b" name="a1a10e5db68ce6c92ca35affd336ecf7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a10e5db68ce6c92ca35affd336ecf7b">&#9670;&#160;</a></span>_check_eigen()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg._check_eigen </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>M</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>V</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>rtol</em> = <code>1e-8</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>atol</em> = <code>1e-14</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Check if the eigenvalue residual is small.
</pre> <div class="fragment"><div class="line"><span class="lineno">  187</span><span class="keyword">def </span>_check_eigen(M, w, V, rtol=1e-8, atol=1e-14):</div>
<div class="line"><span class="lineno">  188</span>    <span class="stringliteral">&quot;&quot;&quot;Check if the eigenvalue residual is small.</span></div>
<div class="line"><span class="lineno">  189</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  190</span>    mult_wV = np.multiply(w, V)</div>
<div class="line"><span class="lineno">  191</span>    dot_MV = M.dot(V)</div>
<div class="line"><span class="lineno">  192</span>    assert_allclose(mult_wV, dot_MV, rtol=rtol, atol=atol)</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a8bcaf71a86726eef44f690e78828924b" name="a8bcaf71a86726eef44f690e78828924b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bcaf71a86726eef44f690e78828924b">&#9670;&#160;</a></span>_check_fiedler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg._check_fiedler </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Check the Fiedler vector computation.
</pre> <div class="fragment"><div class="line"><span class="lineno">  195</span><span class="keyword">def </span>_check_fiedler(n, p):</div>
<div class="line"><span class="lineno">  196</span>    <span class="stringliteral">&quot;&quot;&quot;Check the Fiedler vector computation.</span></div>
<div class="line"><span class="lineno">  197</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  198</span>    <span class="comment"># This is not necessarily the recommended way to find the Fiedler vector.</span></div>
<div class="line"><span class="lineno">  199</span>    col = np.zeros(n)</div>
<div class="line"><span class="lineno">  200</span>    col[1] = 1</div>
<div class="line"><span class="lineno">  201</span>    A = toeplitz(col)</div>
<div class="line"><span class="lineno">  202</span>    D = np.diag(A.sum(axis=1))</div>
<div class="line"><span class="lineno">  203</span>    L = D - A</div>
<div class="line"><span class="lineno">  204</span>    <span class="comment"># Compute the full eigendecomposition using tricks, e.g.</span></div>
<div class="line"><span class="lineno">  205</span>    <span class="comment"># http://www.cs.yale.edu/homes/spielman/561/2009/lect02-09.pdf</span></div>
<div class="line"><span class="lineno">  206</span>    tmp = np.pi * np.arange(n) / n</div>
<div class="line"><span class="lineno">  207</span>    analytic_w = 2 * (1 - np.cos(tmp))</div>
<div class="line"><span class="lineno">  208</span>    analytic_V = np.cos(np.outer(np.arange(n) + 1/2, tmp))</div>
<div class="line"><span class="lineno">  209</span>    _check_eigen(L, analytic_w, analytic_V)</div>
<div class="line"><span class="lineno">  210</span>    <span class="comment"># Compute the full eigendecomposition using eigh.</span></div>
<div class="line"><span class="lineno">  211</span>    eigh_w, eigh_V = eigh(L)</div>
<div class="line"><span class="lineno">  212</span>    _check_eigen(L, eigh_w, eigh_V)</div>
<div class="line"><span class="lineno">  213</span>    <span class="comment"># Check that the first eigenvalue is near zero and that the rest agree.</span></div>
<div class="line"><span class="lineno">  214</span>    assert_array_less(np.abs([eigh_w[0], analytic_w[0]]), 1e-14)</div>
<div class="line"><span class="lineno">  215</span>    assert_allclose(eigh_w[1:], analytic_w[1:])</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>    <span class="comment"># Check small lobpcg eigenvalues.</span></div>
<div class="line"><span class="lineno">  218</span>    X = analytic_V[:, :p]</div>
<div class="line"><span class="lineno">  219</span>    lobpcg_w, lobpcg_V = lobpcg(L, X, largest=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">  220</span>    assert_equal(lobpcg_w.shape, (p,))</div>
<div class="line"><span class="lineno">  221</span>    assert_equal(lobpcg_V.shape, (n, p))</div>
<div class="line"><span class="lineno">  222</span>    _check_eigen(L, lobpcg_w, lobpcg_V)</div>
<div class="line"><span class="lineno">  223</span>    assert_array_less(np.abs(np.min(lobpcg_w)), 1e-14)</div>
<div class="line"><span class="lineno">  224</span>    assert_allclose(np.sort(lobpcg_w)[1:], analytic_w[1:p])</div>
<div class="line"><span class="lineno">  225</span> </div>
<div class="line"><span class="lineno">  226</span>    <span class="comment"># Check large lobpcg eigenvalues.</span></div>
<div class="line"><span class="lineno">  227</span>    X = analytic_V[:, -p:]</div>
<div class="line"><span class="lineno">  228</span>    lobpcg_w, lobpcg_V = lobpcg(L, X, largest=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  229</span>    assert_equal(lobpcg_w.shape, (p,))</div>
<div class="line"><span class="lineno">  230</span>    assert_equal(lobpcg_V.shape, (n, p))</div>
<div class="line"><span class="lineno">  231</span>    _check_eigen(L, lobpcg_w, lobpcg_V)</div>
<div class="line"><span class="lineno">  232</span>    assert_allclose(np.sort(lobpcg_w), analytic_w[-p:])</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>    <span class="comment"># Look for the Fiedler vector using good but not exactly correct guesses.</span></div>
<div class="line"><span class="lineno">  235</span>    fiedler_guess = np.concatenate((np.ones(n//2), -np.ones(n-n//2)))</div>
<div class="line"><span class="lineno">  236</span>    X = np.vstack((np.ones(n), fiedler_guess)).T</div>
<div class="line"><span class="lineno">  237</span>    lobpcg_w, _ = lobpcg(L, X, largest=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">  238</span>    <span class="comment"># Mathematically, the smaller eigenvalue should be zero</span></div>
<div class="line"><span class="lineno">  239</span>    <span class="comment"># and the larger should be the algebraic connectivity.</span></div>
<div class="line"><span class="lineno">  240</span>    lobpcg_w = np.sort(lobpcg_w)</div>
<div class="line"><span class="lineno">  241</span>    assert_allclose(lobpcg_w, analytic_w[:2], atol=1e-14)</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ada3b43a9735de07ffdc5ec6412784fb1" name="ada3b43a9735de07ffdc5ec6412784fb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada3b43a9735de07ffdc5ec6412784fb1">&#9670;&#160;</a></span>compare_solutions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.compare_solutions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check eig vs. lobpcg consistency.
</pre> <div class="fragment"><div class="line"><span class="lineno">   52</span><span class="keyword">def </span>compare_solutions(A, B, m):</div>
<div class="line"><span class="lineno">   53</span>    <span class="stringliteral">&quot;&quot;&quot;Check eig vs. lobpcg consistency.</span></div>
<div class="line"><span class="lineno">   54</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   55</span>    n = A.shape[0]</div>
<div class="line"><span class="lineno">   56</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">   57</span>    V = rnd.random((n, m))</div>
<div class="line"><span class="lineno">   58</span>    X = orth(V)</div>
<div class="line"><span class="lineno">   59</span>    eigvals, _ = lobpcg(A, X, B=B, tol=1e-2, maxiter=50, largest=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">   60</span>    eigvals.sort()</div>
<div class="line"><span class="lineno">   61</span>    w, _ = eig(A, b=B)</div>
<div class="line"><span class="lineno">   62</span>    w.sort()</div>
<div class="line"><span class="lineno">   63</span>    assert_almost_equal(w[:int(m/2)], eigvals[:int(m/2)], decimal=2)</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="adf55bcd71fb61253d9ed20fddf312c15" name="adf55bcd71fb61253d9ed20fddf312c15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf55bcd71fb61253d9ed20fddf312c15">&#9670;&#160;</a></span>ElasticRod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.ElasticRod </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build the matrices for the generalized eigenvalue problem of the
fixed-free elastic rod vibration model.
</pre> <div class="fragment"><div class="line"><span class="lineno">   23</span><span class="keyword">def </span>ElasticRod(n):</div>
<div class="line"><span class="lineno">   24</span>    <span class="stringliteral">&quot;&quot;&quot;Build the matrices for the generalized eigenvalue problem of the</span></div>
<div class="line"><span class="lineno">   25</span><span class="stringliteral">    fixed-free elastic rod vibration model.</span></div>
<div class="line"><span class="lineno">   26</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   27</span>    L = 1.0</div>
<div class="line"><span class="lineno">   28</span>    le = L/n</div>
<div class="line"><span class="lineno">   29</span>    rho = 7.85e3</div>
<div class="line"><span class="lineno">   30</span>    S = 1.e-4</div>
<div class="line"><span class="lineno">   31</span>    E = 2.1e11</div>
<div class="line"><span class="lineno">   32</span>    mass = rho*S*le/6.</div>
<div class="line"><span class="lineno">   33</span>    k = E*S/le</div>
<div class="line"><span class="lineno">   34</span>    A = k*(diag(r_[2.*ones(n-1), 1])-diag(ones(n-1), 1)-diag(ones(n-1), -1))</div>
<div class="line"><span class="lineno">   35</span>    B = mass*(diag(r_[4.*ones(n-1), 2])+diag(ones(n-1), 1)+diag(ones(n-1), -1))</div>
<div class="line"><span class="lineno">   36</span>    <span class="keywordflow">return</span> A, B</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="adac8c1c3cecbf92750c9754da03d9e48" name="adac8c1c3cecbf92750c9754da03d9e48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adac8c1c3cecbf92750c9754da03d9e48">&#9670;&#160;</a></span>MikotaPair()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.MikotaPair </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Build a pair of full diagonal matrices for the generalized eigenvalue
problem. The Mikota pair acts as a nice test since the eigenvalues are the
squares of the integers n, n=1,2,...
</pre> <div class="fragment"><div class="line"><span class="lineno">   39</span><span class="keyword">def </span>MikotaPair(n):</div>
<div class="line"><span class="lineno">   40</span>    <span class="stringliteral">&quot;&quot;&quot;Build a pair of full diagonal matrices for the generalized eigenvalue</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral">    problem. The Mikota pair acts as a nice test since the eigenvalues are the</span></div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral">    squares of the integers n, n=1,2,...</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   44</span>    x = np.arange(1, n+1)</div>
<div class="line"><span class="lineno">   45</span>    B = diag(1./x)</div>
<div class="line"><span class="lineno">   46</span>    y = np.arange(n-1, 0, -1)</div>
<div class="line"><span class="lineno">   47</span>    z = np.arange(2*n-1, 0, -2)</div>
<div class="line"><span class="lineno">   48</span>    A = diag(z)-diag(y, -1)-diag(y, 1)</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordflow">return</span> A, B</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a87170868b5a953632173a9e6b092ff43" name="a87170868b5a953632173a9e6b092ff43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87170868b5a953632173a9e6b092ff43">&#9670;&#160;</a></span>test_diagonal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_diagonal </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>m_excluded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Test ``m - m_excluded`` eigenvalues and eigenvectors of
diagonal matrices of the size ``n`` varying matrix formats:
dense array, spare matrix, and ``LinearOperator`` for both
matrixes in the generalized eigenvalue problem ``Av = cBv``
and for the preconditioner.
</pre> <div class="fragment"><div class="line"><span class="lineno">  121</span><span class="keyword">def </span>test_diagonal(n, m, m_excluded):</div>
<div class="line"><span class="lineno">  122</span>    <span class="stringliteral">&quot;&quot;&quot;Test ``m - m_excluded`` eigenvalues and eigenvectors of</span></div>
<div class="line"><span class="lineno">  123</span><span class="stringliteral">    diagonal matrices of the size ``n`` varying matrix formats:</span></div>
<div class="line"><span class="lineno">  124</span><span class="stringliteral">    dense array, spare matrix, and ``LinearOperator`` for both</span></div>
<div class="line"><span class="lineno">  125</span><span class="stringliteral">    matrixes in the generalized eigenvalue problem ``Av = cBv``</span></div>
<div class="line"><span class="lineno">  126</span><span class="stringliteral">    and for the preconditioner.</span></div>
<div class="line"><span class="lineno">  127</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  128</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    <span class="comment"># Define the generalized eigenvalue problem Av = cBv</span></div>
<div class="line"><span class="lineno">  131</span>    <span class="comment"># where (c, v) is a generalized eigenpair,</span></div>
<div class="line"><span class="lineno">  132</span>    <span class="comment"># and where we choose A to be the diagonal matrix whose entries are 1..n</span></div>
<div class="line"><span class="lineno">  133</span>    <span class="comment"># and where B is chosen to be the identity matrix.</span></div>
<div class="line"><span class="lineno">  134</span>    vals = np.arange(1, n+1, dtype=float)</div>
<div class="line"><span class="lineno">  135</span>    A_s = diags([vals], [0], (n, n))</div>
<div class="line"><span class="lineno">  136</span>    A_a = A_s.toarray()</div>
<div class="line"><span class="lineno">  137</span> </div>
<div class="line"><span class="lineno">  138</span>    <span class="keyword">def </span>A_f(x):</div>
<div class="line"><span class="lineno">  139</span>        <span class="keywordflow">return</span> A_s @ x</div>
<div class="line"><span class="lineno">  140</span> </div>
<div class="line"><span class="lineno">  141</span>    A_lo = LinearOperator(matvec=A_f,</div>
<div class="line"><span class="lineno">  142</span>                          matmat=A_f,</div>
<div class="line"><span class="lineno">  143</span>                          shape=(n, n), dtype=float)</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>    B_a = eye(n)</div>
<div class="line"><span class="lineno">  146</span>    B_s = csr_matrix(B_a)</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>    <span class="keyword">def </span>B_f(x):</div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">return</span> B_a @ x</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>    B_lo = LinearOperator(matvec=B_f,</div>
<div class="line"><span class="lineno">  152</span>                          matmat=B_f,</div>
<div class="line"><span class="lineno">  153</span>                          shape=(n, n), dtype=float)</div>
<div class="line"><span class="lineno">  154</span> </div>
<div class="line"><span class="lineno">  155</span>    <span class="comment"># Let the preconditioner M be the inverse of A.</span></div>
<div class="line"><span class="lineno">  156</span>    M_s = diags([1./vals], [0], (n, n))</div>
<div class="line"><span class="lineno">  157</span>    M_a = M_s.toarray()</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>    <span class="keyword">def </span>M_f(x):</div>
<div class="line"><span class="lineno">  160</span>        <span class="keywordflow">return</span> M_s @ x</div>
<div class="line"><span class="lineno">  161</span> </div>
<div class="line"><span class="lineno">  162</span>    M_lo = LinearOperator(matvec=M_f,</div>
<div class="line"><span class="lineno">  163</span>                          matmat=M_f,</div>
<div class="line"><span class="lineno">  164</span>                          shape=(n, n), dtype=float)</div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>    <span class="comment"># Pick random initial vectors.</span></div>
<div class="line"><span class="lineno">  167</span>    X = rnd.normal(size=(n, m))</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>    <span class="comment"># Require that the returned eigenvectors be in the orthogonal complement</span></div>
<div class="line"><span class="lineno">  170</span>    <span class="comment"># of the first few standard basis vectors.</span></div>
<div class="line"><span class="lineno">  171</span>    <span class="keywordflow">if</span> m_excluded &gt; 0:</div>
<div class="line"><span class="lineno">  172</span>        Y = np.eye(n, m_excluded)</div>
<div class="line"><span class="lineno">  173</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  174</span>        Y = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordflow">for</span> A <span class="keywordflow">in</span> [A_a, A_s, A_lo]:</div>
<div class="line"><span class="lineno">  177</span>        <span class="keywordflow">for</span> B <span class="keywordflow">in</span> [B_a, B_s, B_lo]:</div>
<div class="line"><span class="lineno">  178</span>            <span class="keywordflow">for</span> M <span class="keywordflow">in</span> [M_a, M_s, M_lo]:</div>
<div class="line"><span class="lineno">  179</span>                eigvals, vecs = lobpcg(A, X, B, M=M, Y=Y,</div>
<div class="line"><span class="lineno">  180</span>                                       maxiter=40, largest=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>                assert_allclose(eigvals, np.arange(1+m_excluded,</div>
<div class="line"><span class="lineno">  183</span>                                                   1+m_excluded+m))</div>
<div class="line"><span class="lineno">  184</span>                _check_eigen(A, eigvals, vecs, rtol=1e-3, atol=1e-3)</div>
<div class="line"><span class="lineno">  185</span> </div>
<div class="line"><span class="lineno">  186</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0a33c62d0925b91e2769a9087bbe8928" name="a0a33c62d0925b91e2769a9087bbe8928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a33c62d0925b91e2769a9087bbe8928">&#9670;&#160;</a></span>test_diagonal_data_types()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_diagonal_data_types </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check lobpcg for diagonal matrices for all matrix types.
</pre> <div class="fragment"><div class="line"><span class="lineno">  395</span><span class="keyword">def </span>test_diagonal_data_types():</div>
<div class="line"><span class="lineno">  396</span>    <span class="stringliteral">&quot;&quot;&quot;Check lobpcg for diagonal matrices for all matrix types.</span></div>
<div class="line"><span class="lineno">  397</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  398</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  399</span>    n = 40</div>
<div class="line"><span class="lineno">  400</span>    m = 4</div>
<div class="line"><span class="lineno">  401</span>    <span class="comment"># Define the generalized eigenvalue problem Av = cBv</span></div>
<div class="line"><span class="lineno">  402</span>    <span class="comment"># where (c, v) is a generalized eigenpair,</span></div>
<div class="line"><span class="lineno">  403</span>    <span class="comment"># and where we choose A  and B to be diagonal.</span></div>
<div class="line"><span class="lineno">  404</span>    vals = np.arange(1, n + 1)</div>
<div class="line"><span class="lineno">  405</span> </div>
<div class="line"><span class="lineno">  406</span>    list_sparse_format = [<span class="stringliteral">&#39;bsr&#39;</span>, <span class="stringliteral">&#39;coo&#39;</span>, <span class="stringliteral">&#39;csc&#39;</span>, <span class="stringliteral">&#39;csr&#39;</span>, <span class="stringliteral">&#39;dia&#39;</span>, <span class="stringliteral">&#39;dok&#39;</span>, <span class="stringliteral">&#39;lil&#39;</span>]</div>
<div class="line"><span class="lineno">  407</span>    sparse_formats = len(list_sparse_format)</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">for</span> s_f_i, s_f <span class="keywordflow">in</span> enumerate(list_sparse_format):</div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>        As64 = diags([vals * vals], [0], (n, n), format=s_f)</div>
<div class="line"><span class="lineno">  411</span>        As32 = As64.astype(np.float32)</div>
<div class="line"><span class="lineno">  412</span>        Af64 = As64.toarray()</div>
<div class="line"><span class="lineno">  413</span>        Af32 = Af64.astype(np.float32)</div>
<div class="line"><span class="lineno">  414</span>        listA = [Af64, As64, Af32, As32]</div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>        Bs64 = diags([vals], [0], (n, n), format=s_f)</div>
<div class="line"><span class="lineno">  417</span>        Bf64 = Bs64.toarray()</div>
<div class="line"><span class="lineno">  418</span>        listB = [Bf64, Bs64]</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>        <span class="comment"># Define the preconditioner function as LinearOperator.</span></div>
<div class="line"><span class="lineno">  421</span>        Ms64 = diags([1./vals], [0], (n, n), format=s_f)</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>        <span class="keyword">def </span>Ms64precond(x):</div>
<div class="line"><span class="lineno">  424</span>            <span class="keywordflow">return</span> Ms64 @ x</div>
<div class="line"><span class="lineno">  425</span>        Ms64precondLO = LinearOperator(matvec=Ms64precond,</div>
<div class="line"><span class="lineno">  426</span>                                       matmat=Ms64precond,</div>
<div class="line"><span class="lineno">  427</span>                                       shape=(n, n),</div>
<div class="line"><span class="lineno">  428</span>                                       dtype=float)</div>
<div class="line"><span class="lineno">  429</span>        Mf64 = Ms64.toarray()</div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>        <span class="keyword">def </span>Mf64precond(x):</div>
<div class="line"><span class="lineno">  432</span>            <span class="keywordflow">return</span> Mf64 @ x</div>
<div class="line"><span class="lineno">  433</span>        Mf64precondLO = LinearOperator(matvec=Mf64precond,</div>
<div class="line"><span class="lineno">  434</span>                                       matmat=Mf64precond,</div>
<div class="line"><span class="lineno">  435</span>                                       shape=(n, n),</div>
<div class="line"><span class="lineno">  436</span>                                       dtype=float)</div>
<div class="line"><span class="lineno">  437</span>        Ms32 = Ms64.astype(np.float32)</div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span>        <span class="keyword">def </span>Ms32precond(x):</div>
<div class="line"><span class="lineno">  440</span>            <span class="keywordflow">return</span> Ms32 @ x</div>
<div class="line"><span class="lineno">  441</span>        Ms32precondLO = LinearOperator(matvec=Ms32precond,</div>
<div class="line"><span class="lineno">  442</span>                                       matmat=Ms32precond,</div>
<div class="line"><span class="lineno">  443</span>                                       shape=(n, n),</div>
<div class="line"><span class="lineno">  444</span>                                       dtype=np.float32)</div>
<div class="line"><span class="lineno">  445</span>        Mf32 = Ms32.toarray()</div>
<div class="line"><span class="lineno">  446</span> </div>
<div class="line"><span class="lineno">  447</span>        <span class="keyword">def </span>Mf32precond(x):</div>
<div class="line"><span class="lineno">  448</span>            <span class="keywordflow">return</span> Mf32 @ x</div>
<div class="line"><span class="lineno">  449</span>        Mf32precondLO = LinearOperator(matvec=Mf32precond,</div>
<div class="line"><span class="lineno">  450</span>                                       matmat=Mf32precond,</div>
<div class="line"><span class="lineno">  451</span>                                       shape=(n, n),</div>
<div class="line"><span class="lineno">  452</span>                                       dtype=np.float32)</div>
<div class="line"><span class="lineno">  453</span>        listM = [<span class="keywordtype">None</span>, Ms64precondLO, Mf64precondLO,</div>
<div class="line"><span class="lineno">  454</span>                 Ms32precondLO, Mf32precondLO]</div>
<div class="line"><span class="lineno">  455</span> </div>
<div class="line"><span class="lineno">  456</span>        <span class="comment"># Setup matrix of the initial approximation to the eigenvectors</span></div>
<div class="line"><span class="lineno">  457</span>        <span class="comment"># (cannot be sparse array).</span></div>
<div class="line"><span class="lineno">  458</span>        Xf64 = rnd.random((n, m))</div>
<div class="line"><span class="lineno">  459</span>        Xf32 = Xf64.astype(np.float32)</div>
<div class="line"><span class="lineno">  460</span>        listX = [Xf64, Xf32]</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>        <span class="comment"># Require that the returned eigenvectors be in the orthogonal complement</span></div>
<div class="line"><span class="lineno">  463</span>        <span class="comment"># of the first few standard basis vectors (cannot be sparse array).</span></div>
<div class="line"><span class="lineno">  464</span>        m_excluded = 3</div>
<div class="line"><span class="lineno">  465</span>        Yf64 = np.eye(n, m_excluded, dtype=float)</div>
<div class="line"><span class="lineno">  466</span>        Yf32 = np.eye(n, m_excluded, dtype=np.float32)</div>
<div class="line"><span class="lineno">  467</span>        listY = [Yf64, Yf32]</div>
<div class="line"><span class="lineno">  468</span> </div>
<div class="line"><span class="lineno">  469</span>        tests = list(itertools.product(listA, listB, listM, listX, listY))</div>
<div class="line"><span class="lineno">  470</span>        <span class="comment"># This is one of the slower tests because there are &gt;1,000 configs</span></div>
<div class="line"><span class="lineno">  471</span>        <span class="comment"># to test here, instead of checking product of all input, output types</span></div>
<div class="line"><span class="lineno">  472</span>        <span class="comment"># test each configuration for the first sparse format, and then</span></div>
<div class="line"><span class="lineno">  473</span>        <span class="comment"># for one additional sparse format. this takes 2/7=30% as long as</span></div>
<div class="line"><span class="lineno">  474</span>        <span class="comment"># testing all configurations for all sparse formats.</span></div>
<div class="line"><span class="lineno">  475</span>        <span class="keywordflow">if</span> s_f_i &gt; 0:</div>
<div class="line"><span class="lineno">  476</span>            tests = tests[s_f_i - 1::sparse_formats-1]</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>        <span class="keywordflow">for</span> A, B, M, X, Y <span class="keywordflow">in</span> tests:</div>
<div class="line"><span class="lineno">  479</span>            eigvals, _ = lobpcg(A, X, B=B, M=M, Y=Y, tol=1e-4,</div>
<div class="line"><span class="lineno">  480</span>                                maxiter=100, largest=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">  481</span>            assert_allclose(eigvals,</div>
<div class="line"><span class="lineno">  482</span>                            np.arange(1 + m_excluded, 1 + m_excluded + m))</div>
</div><!-- fragment -->
</div>
</div>
<a id="a24fa0f757848ae0be274efe4b7ec07c4" name="a24fa0f757848ae0be274efe4b7ec07c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24fa0f757848ae0be274efe4b7ec07c4">&#9670;&#160;</a></span>test_eigs_consistency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_eigs_consistency </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>atol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check eigs vs. lobpcg consistency.
</pre> <div class="fragment"><div class="line"><span class="lineno">  314</span><span class="keyword">def </span>test_eigs_consistency(n, atol):</div>
<div class="line"><span class="lineno">  315</span>    <span class="stringliteral">&quot;&quot;&quot;Check eigs vs. lobpcg consistency.</span></div>
<div class="line"><span class="lineno">  316</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  317</span>    vals = np.arange(1, n+1, dtype=np.float64)</div>
<div class="line"><span class="lineno">  318</span>    A = spdiags(vals, 0, n, n)</div>
<div class="line"><span class="lineno">  319</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  320</span>    X = rnd.random((n, 2))</div>
<div class="line"><span class="lineno">  321</span>    lvals, lvecs = lobpcg(A, X, largest=<span class="keyword">True</span>, maxiter=100)</div>
<div class="line"><span class="lineno">  322</span>    vals, _ = eigs(A, k=2)</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>    _check_eigen(A, lvals, lvecs, atol=atol, rtol=0)</div>
<div class="line"><span class="lineno">  325</span>    assert_allclose(np.sort(vals), np.sort(lvals), atol=1e-14)</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ac82bf5193c85bc397910606dadc7affa" name="ac82bf5193c85bc397910606dadc7affa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac82bf5193c85bc397910606dadc7affa">&#9670;&#160;</a></span>test_ElasticRod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_ElasticRod </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   75</span><span class="keyword">def </span>test_ElasticRod():</div>
<div class="line"><span class="lineno">   76</span>    A, B = ElasticRod(20)</div>
<div class="line"><span class="lineno">   77</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;Exited at iteration&quot;</span>):</div>
<div class="line"><span class="lineno">   78</span>        compare_solutions(A, B, 2)</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a29dd804ca1bfa4c44acb34f64b5c0365" name="a29dd804ca1bfa4c44acb34f64b5c0365"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29dd804ca1bfa4c44acb34f64b5c0365">&#9670;&#160;</a></span>test_failure_to_run_iterations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_failure_to_run_iterations </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check that the code exists gracefully without breaking. Issue #10974.
</pre> <div class="fragment"><div class="line"><span class="lineno">  259</span><span class="keyword">def </span>test_failure_to_run_iterations():</div>
<div class="line"><span class="lineno">  260</span>    <span class="stringliteral">&quot;&quot;&quot;Check that the code exists gracefully without breaking. Issue #10974.</span></div>
<div class="line"><span class="lineno">  261</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  262</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  263</span>    X = rnd.standard_normal((100, 10))</div>
<div class="line"><span class="lineno">  264</span>    A = X @ X.T</div>
<div class="line"><span class="lineno">  265</span>    Q = rnd.standard_normal((X.shape[0], 4))</div>
<div class="line"><span class="lineno">  266</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;Exited at iteration&quot;</span>):</div>
<div class="line"><span class="lineno">  267</span>        eigenvalues, _ = lobpcg(A, Q, maxiter=20)</div>
<div class="line"><span class="lineno">  268</span>    assert(np.max(eigenvalues) &gt; 0)</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span> </div>
<div class="line"><span class="lineno">  271</span><span class="preprocessor">@pytest.mark.filterwarnings(&quot;ignore:The problem size&quot;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b717b405da8fe5b847a66a345b571a0" name="a4b717b405da8fe5b847a66a345b571a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b717b405da8fe5b847a66a345b571a0">&#9670;&#160;</a></span>test_fiedler_large_12()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_fiedler_large_12 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check the dense workaround path avoided for non-small matrices.
</pre> <div class="fragment"><div class="line"><span class="lineno">  252</span><span class="keyword">def </span>test_fiedler_large_12():</div>
<div class="line"><span class="lineno">  253</span>    <span class="stringliteral">&quot;&quot;&quot;Check the dense workaround path avoided for non-small matrices.</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  255</span>    <span class="comment"># This does not trigger the dense path, because 2*5 &lt;= 12.</span></div>
<div class="line"><span class="lineno">  256</span>    _check_fiedler(12, 2)</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09d0d1be360ceca30da942276dd6417" name="ad09d0d1be360ceca30da942276dd6417"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09d0d1be360ceca30da942276dd6417">&#9670;&#160;</a></span>test_fiedler_small_8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_fiedler_small_8 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check the dense workaround path for small matrices.
</pre> <div class="fragment"><div class="line"><span class="lineno">  244</span><span class="keyword">def </span>test_fiedler_small_8():</div>
<div class="line"><span class="lineno">  245</span>    <span class="stringliteral">&quot;&quot;&quot;Check the dense workaround path for small matrices.</span></div>
<div class="line"><span class="lineno">  246</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  247</span>    <span class="comment"># This triggers the dense path because 8 &lt; 2*5.</span></div>
<div class="line"><span class="lineno">  248</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;The problem size&quot;</span>):</div>
<div class="line"><span class="lineno">  249</span>        _check_fiedler(8, 2)</div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a948d141721dcb142fec9d58286f709f1" name="a948d141721dcb142fec9d58286f709f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a948d141721dcb142fec9d58286f709f1">&#9670;&#160;</a></span>test_hermitian()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_hermitian </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check complex-value Hermitian cases.
</pre> <div class="fragment"><div class="line"><span class="lineno">  272</span><span class="keyword">def </span>test_hermitian():</div>
<div class="line"><span class="lineno">  273</span>    <span class="stringliteral">&quot;&quot;&quot;Check complex-value Hermitian cases.</span></div>
<div class="line"><span class="lineno">  274</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  275</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>    sizes = [3, 10, 50]</div>
<div class="line"><span class="lineno">  278</span>    ks = [1, 3, 10, 50]</div>
<div class="line"><span class="lineno">  279</span>    gens = [<span class="keyword">True</span>, <span class="keyword">False</span>]</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">for</span> s, k, gen <span class="keywordflow">in</span> itertools.product(sizes, ks, gens):</div>
<div class="line"><span class="lineno">  282</span>        <span class="keywordflow">if</span> k &gt; s:</div>
<div class="line"><span class="lineno">  283</span>            <span class="keywordflow">continue</span></div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>        H = rnd.random((s, s)) + 1.j * rnd.random((s, s))</div>
<div class="line"><span class="lineno">  286</span>        H = 10 * np.eye(s) + H + H.T.conj()</div>
<div class="line"><span class="lineno">  287</span> </div>
<div class="line"><span class="lineno">  288</span>        X = rnd.random((s, k))</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> gen:</div>
<div class="line"><span class="lineno">  291</span>            B = np.eye(s)</div>
<div class="line"><span class="lineno">  292</span>            w, v = lobpcg(H, X, maxiter=5000)</div>
<div class="line"><span class="lineno">  293</span>            w0, _ = eigh(H)</div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  295</span>            B = rnd.random((s, s)) + 1.j * rnd.random((s, s))</div>
<div class="line"><span class="lineno">  296</span>            B = 10 * np.eye(s) + B.dot(B.T.conj())</div>
<div class="line"><span class="lineno">  297</span>            w, v = lobpcg(H, X, B, maxiter=5000, largest=<span class="keyword">False</span>)</div>
<div class="line"><span class="lineno">  298</span>            w0, _ = eigh(H, B)</div>
<div class="line"><span class="lineno">  299</span> </div>
<div class="line"><span class="lineno">  300</span>        <span class="keywordflow">for</span> wx, vx <span class="keywordflow">in</span> zip(w, v.T):</div>
<div class="line"><span class="lineno">  301</span>            <span class="comment"># Check eigenvector</span></div>
<div class="line"><span class="lineno">  302</span>            assert_allclose(np.linalg.norm(H.dot(vx) - B.dot(vx) * wx)</div>
<div class="line"><span class="lineno">  303</span>                            / np.linalg.norm(H.dot(vx)),</div>
<div class="line"><span class="lineno">  304</span>                            0, atol=5e-4, rtol=0)</div>
<div class="line"><span class="lineno">  305</span> </div>
<div class="line"><span class="lineno">  306</span>            <span class="comment"># Compare eigenvalues</span></div>
<div class="line"><span class="lineno">  307</span>            j = np.argmin(abs(w0 - wx))</div>
<div class="line"><span class="lineno">  308</span>            assert_allclose(wx, w0[j], rtol=1e-4)</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span><span class="comment"># The n=5 case tests the alternative small matrix code path that uses eigh().</span></div>
<div class="line"><span class="lineno">  312</span><span class="preprocessor">@pytest.mark.filterwarnings(&quot;ignore:The problem size&quot;)</span></div>
<div class="line"><span class="lineno">  313</span><span class="preprocessor">@pytest.mark.parametrize(&#39;n, atol&#39;, [(20, 1e-3)</span>, (5, 1e-8)])</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4c029634474d1aeedd142565a7024010" name="a4c029634474d1aeedd142565a7024010"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c029634474d1aeedd142565a7024010">&#9670;&#160;</a></span>test_maxit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_maxit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check lobpcg if maxit=10 runs 10 iterations
if maxit=None runs 20 iterations (the default)
by checking the size of the iteration history output, which should
be the number of iterations plus 2 (initial and final values).
</pre> <div class="fragment"><div class="line"><span class="lineno">  373</span><span class="keyword">def </span>test_maxit():</div>
<div class="line"><span class="lineno">  374</span>    <span class="stringliteral">&quot;&quot;&quot;Check lobpcg if maxit=10 runs 10 iterations</span></div>
<div class="line"><span class="lineno">  375</span><span class="stringliteral">    if maxit=None runs 20 iterations (the default)</span></div>
<div class="line"><span class="lineno">  376</span><span class="stringliteral">    by checking the size of the iteration history output, which should</span></div>
<div class="line"><span class="lineno">  377</span><span class="stringliteral">    be the number of iterations plus 2 (initial and final values).</span></div>
<div class="line"><span class="lineno">  378</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  379</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  380</span>    n = 50</div>
<div class="line"><span class="lineno">  381</span>    m = 4</div>
<div class="line"><span class="lineno">  382</span>    vals = -np.arange(1, n + 1)</div>
<div class="line"><span class="lineno">  383</span>    A = diags([vals], [0], (n, n))</div>
<div class="line"><span class="lineno">  384</span>    A = A.astype(np.float32)</div>
<div class="line"><span class="lineno">  385</span>    X = rnd.standard_normal((n, m))</div>
<div class="line"><span class="lineno">  386</span>    X = X.astype(np.float32)</div>
<div class="line"><span class="lineno">  387</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;Exited at iteration&quot;</span>):</div>
<div class="line"><span class="lineno">  388</span>        _, _, l_h = lobpcg(A, X, tol=1e-8, maxiter=10, retLambdaHistory=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  389</span>    assert_allclose(np.shape(l_h)[0], 10+2)</div>
<div class="line"><span class="lineno">  390</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;Exited at iteration&quot;</span>):</div>
<div class="line"><span class="lineno">  391</span>        _, _, l_h = lobpcg(A, X, tol=1e-8, retLambdaHistory=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  392</span>    assert_allclose(np.shape(l_h)[0], 20+2)</div>
<div class="line"><span class="lineno">  393</span> </div>
<div class="line"><span class="lineno">  394</span><span class="preprocessor">@pytest.mark.slow</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a761516490ef9494b5c8b79e1b79c08c7" name="a761516490ef9494b5c8b79e1b79c08c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a761516490ef9494b5c8b79e1b79c08c7">&#9670;&#160;</a></span>test_MikotaPair()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_MikotaPair </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   81</span><span class="keyword">def </span>test_MikotaPair():</div>
<div class="line"><span class="lineno">   82</span>    A, B = MikotaPair(20)</div>
<div class="line"><span class="lineno">   83</span>    compare_solutions(A, B, 2)</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span><span class="preprocessor">@pytest.mark.filterwarnings(&quot;ignore:Exited at iteration 0&quot;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a075bc903e4b19cd81757fd56e25a6678" name="a075bc903e4b19cd81757fd56e25a6678"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a075bc903e4b19cd81757fd56e25a6678">&#9670;&#160;</a></span>test_nonhermitian_warning()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_nonhermitian_warning </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>capsys</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check the warning of a Ritz matrix being not Hermitian
by feeding a non-Hermitian input matrix.
Also check stdout since verbosityLevel=1 and lack of stderr.
</pre> <div class="fragment"><div class="line"><span class="lineno">   87</span><span class="keyword">def </span>test_nonhermitian_warning(capsys):</div>
<div class="line"><span class="lineno">   88</span>    <span class="stringliteral">&quot;&quot;&quot;Check the warning of a Ritz matrix being not Hermitian</span></div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral">    by feeding a non-Hermitian input matrix.</span></div>
<div class="line"><span class="lineno">   90</span><span class="stringliteral">    Also check stdout since verbosityLevel=1 and lack of stderr.</span></div>
<div class="line"><span class="lineno">   91</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   92</span>    n = 10</div>
<div class="line"><span class="lineno">   93</span>    X = np.arange(n * 2).reshape(n, 2).astype(np.float32)</div>
<div class="line"><span class="lineno">   94</span>    A = np.arange(n * n).reshape(n, n).astype(np.float32)</div>
<div class="line"><span class="lineno">   95</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;Matrix gramA&quot;</span>):</div>
<div class="line"><span class="lineno">   96</span>        _, _ = lobpcg(A, X, verbosityLevel=1, maxiter=0)</div>
<div class="line"><span class="lineno">   97</span>    out, err = capsys.readouterr()  <span class="comment"># Capture output</span></div>
<div class="line"><span class="lineno">   98</span>    <span class="keyword">assert</span> out.startswith(<span class="stringliteral">&quot;Solving standard eigenvalue&quot;</span>)  <span class="comment"># Test stdout</span></div>
<div class="line"><span class="lineno">   99</span>    <span class="keyword">assert</span> err == <span class="stringliteral">&#39;&#39;</span>  <span class="comment"># Test empty stderr</span></div>
<div class="line"><span class="lineno">  100</span>    <span class="comment"># Make the matrix symmetric and the UserWarning dissappears.</span></div>
<div class="line"><span class="lineno">  101</span>    A += A.T</div>
<div class="line"><span class="lineno">  102</span>    _, _ = lobpcg(A, X, verbosityLevel=1, maxiter=0)</div>
<div class="line"><span class="lineno">  103</span>    out, err = capsys.readouterr()  <span class="comment"># Capture output</span></div>
<div class="line"><span class="lineno">  104</span>    <span class="keyword">assert</span> out.startswith(<span class="stringliteral">&quot;Solving standard eigenvalue&quot;</span>)  <span class="comment"># Test stdout</span></div>
<div class="line"><span class="lineno">  105</span>    <span class="keyword">assert</span> err == <span class="stringliteral">&#39;&#39;</span>  <span class="comment"># Test empty stderr</span></div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ab72d6331110a56d761ae4a646d6659e3" name="ab72d6331110a56d761ae4a646d6659e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab72d6331110a56d761ae4a646d6659e3">&#9670;&#160;</a></span>test_random_initial_float32()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_random_initial_float32 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check lobpcg in float32 for specific initial.
</pre> <div class="fragment"><div class="line"><span class="lineno">  358</span><span class="keyword">def </span>test_random_initial_float32():</div>
<div class="line"><span class="lineno">  359</span>    <span class="stringliteral">&quot;&quot;&quot;Check lobpcg in float32 for specific initial.</span></div>
<div class="line"><span class="lineno">  360</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  361</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  362</span>    n = 50</div>
<div class="line"><span class="lineno">  363</span>    m = 4</div>
<div class="line"><span class="lineno">  364</span>    vals = -np.arange(1, n + 1)</div>
<div class="line"><span class="lineno">  365</span>    A = diags([vals], [0], (n, n))</div>
<div class="line"><span class="lineno">  366</span>    A = A.astype(np.float32)</div>
<div class="line"><span class="lineno">  367</span>    X = rnd.random((n, m))</div>
<div class="line"><span class="lineno">  368</span>    X = X.astype(np.float32)</div>
<div class="line"><span class="lineno">  369</span>    eigvals, _ = lobpcg(A, X, tol=1e-3, maxiter=50, verbosityLevel=1)</div>
<div class="line"><span class="lineno">  370</span>    assert_allclose(eigvals, -np.arange(1, 1 + m), atol=1e-2)</div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a12313224e7458ea6c988c6994a1b636b" name="a12313224e7458ea6c988c6994a1b636b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12313224e7458ea6c988c6994a1b636b">&#9670;&#160;</a></span>test_regression()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_regression </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check the eigenvalue of the identity matrix is one.
</pre> <div class="fragment"><div class="line"><span class="lineno">  108</span><span class="keyword">def </span>test_regression():</div>
<div class="line"><span class="lineno">  109</span>    <span class="stringliteral">&quot;&quot;&quot;Check the eigenvalue of the identity matrix is one.</span></div>
<div class="line"><span class="lineno">  110</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  111</span>    <span class="comment"># https://mail.python.org/pipermail/scipy-user/2010-October/026944.html</span></div>
<div class="line"><span class="lineno">  112</span>    n = 10</div>
<div class="line"><span class="lineno">  113</span>    X = np.ones((n, 1))</div>
<div class="line"><span class="lineno">  114</span>    A = np.identity(n)</div>
<div class="line"><span class="lineno">  115</span>    w, _ = lobpcg(A, X)</div>
<div class="line"><span class="lineno">  116</span>    assert_allclose(w, [1])</div>
<div class="line"><span class="lineno">  117</span> </div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span><span class="preprocessor">@pytest.mark.filterwarnings(&quot;ignore:The problem size&quot;)</span></div>
<div class="line"><span class="lineno">  120</span><span class="preprocessor">@pytest.mark.parametrize(&#39;n, m, m_excluded&#39;, [(100, 4, 3)</span>, (4, 2, 0)])</div>
</div><!-- fragment -->
</div>
</div>
<a id="af63703ac4611e6570275e3d2db63b181" name="af63703ac4611e6570275e3d2db63b181"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af63703ac4611e6570275e3d2db63b181">&#9670;&#160;</a></span>test_Small()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_Small </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   66</span><span class="keyword">def </span>test_Small():</div>
<div class="line"><span class="lineno">   67</span>    A, B = ElasticRod(10)</div>
<div class="line"><span class="lineno">   68</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;The problem size&quot;</span>):</div>
<div class="line"><span class="lineno">   69</span>        compare_solutions(A, B, 10)</div>
<div class="line"><span class="lineno">   70</span>    A, B = MikotaPair(10)</div>
<div class="line"><span class="lineno">   71</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;The problem size&quot;</span>):</div>
<div class="line"><span class="lineno">   72</span>        compare_solutions(A, B, 10)</div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="afcf7608992e588339fe9354ed5e1b110" name="afcf7608992e588339fe9354ed5e1b110"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcf7608992e588339fe9354ed5e1b110">&#9670;&#160;</a></span>test_tolerance_float32()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_tolerance_float32 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check lobpcg for attainable tolerance in float32.
</pre> <div class="fragment"><div class="line"><span class="lineno">  343</span><span class="keyword">def </span>test_tolerance_float32():</div>
<div class="line"><span class="lineno">  344</span>    <span class="stringliteral">&quot;&quot;&quot;Check lobpcg for attainable tolerance in float32.</span></div>
<div class="line"><span class="lineno">  345</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  346</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  347</span>    n = 50</div>
<div class="line"><span class="lineno">  348</span>    m = 3</div>
<div class="line"><span class="lineno">  349</span>    vals = -np.arange(1, n + 1)</div>
<div class="line"><span class="lineno">  350</span>    A = diags([vals], [0], (n, n))</div>
<div class="line"><span class="lineno">  351</span>    A = A.astype(np.float32)</div>
<div class="line"><span class="lineno">  352</span>    X = rnd.standard_normal((n, m))</div>
<div class="line"><span class="lineno">  353</span>    X = X.astype(np.float32)</div>
<div class="line"><span class="lineno">  354</span>    eigvals, _ = lobpcg(A, X, tol=1.25e-5, maxiter=50, verbosityLevel=0)</div>
<div class="line"><span class="lineno">  355</span>    assert_allclose(eigvals, -np.arange(1, 1 + m), atol=2e-5, rtol=1e-5)</div>
<div class="line"><span class="lineno">  356</span> </div>
<div class="line"><span class="lineno">  357</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aabeedb143541c289c269adcb58421bcd" name="aabeedb143541c289c269adcb58421bcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabeedb143541c289c269adcb58421bcd">&#9670;&#160;</a></span>test_verbosity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg.test_verbosity </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>tmpdir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Check that nonzero verbosity level code runs.
</pre> <div class="fragment"><div class="line"><span class="lineno">  328</span><span class="keyword">def </span>test_verbosity(tmpdir):</div>
<div class="line"><span class="lineno">  329</span>    <span class="stringliteral">&quot;&quot;&quot;Check that nonzero verbosity level code runs.</span></div>
<div class="line"><span class="lineno">  330</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  331</span>    rnd = np.random.RandomState(0)</div>
<div class="line"><span class="lineno">  332</span>    X = rnd.standard_normal((10, 10))</div>
<div class="line"><span class="lineno">  333</span>    A = X @ X.T</div>
<div class="line"><span class="lineno">  334</span>    Q = rnd.standard_normal((X.shape[0], 1))</div>
<div class="line"><span class="lineno">  335</span>    <span class="keyword">with</span> pytest.warns(UserWarning, match=<span class="stringliteral">&quot;Exited at iteration&quot;</span>):</div>
<div class="line"><span class="lineno">  336</span>        _, _ = lobpcg(A, Q, maxiter=3, verbosityLevel=9)</div>
<div class="line"><span class="lineno">  337</span> </div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span><span class="preprocessor">@pytest.mark.xfail</span>(_IS_32BIT <span class="keywordflow">and</span> sys.platform == <span class="stringliteral">&#39;win32&#39;</span>,</div>
<div class="line"><span class="lineno">  340</span>                   reason=<span class="stringliteral">&quot;tolerance violation on windows&quot;</span>)</div>
<div class="line"><span class="lineno">  341</span><span class="preprocessor">@pytest.mark.xfail(platform.machine()</span> == <span class="stringliteral">&#39;ppc64le&#39;</span>,</div>
<div class="line"><span class="lineno">  342</span>                   reason=<span class="stringliteral">&quot;fails on ppc64le&quot;</span>)</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a05f0881178cd0575d78ffead57de397d" name="a05f0881178cd0575d78ffead57de397d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05f0881178cd0575d78ffead57de397d">&#9670;&#160;</a></span>_IS_32BIT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">tuple scipy.sparse.linalg._eigen.lobpcg.tests.test_lobpcg._IS_32BIT = (sys.maxsize &lt; 2**32)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
