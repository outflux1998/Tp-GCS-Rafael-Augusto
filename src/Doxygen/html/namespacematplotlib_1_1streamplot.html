<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: matplotlib.streamplot Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacematplotlib.html">matplotlib</a></li><li class="navelem"><a class="el" href="namespacematplotlib_1_1streamplot.html">streamplot</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">matplotlib.streamplot Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmatplotlib_1_1streamplot_1_1_domain_map.html">DomainMap</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmatplotlib_1_1streamplot_1_1_grid.html">Grid</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmatplotlib_1_1streamplot_1_1_invalid_index_error.html">InvalidIndexError</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmatplotlib_1_1streamplot_1_1_out_of_bounds.html">OutOfBounds</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmatplotlib_1_1streamplot_1_1_stream_mask.html">StreamMask</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmatplotlib_1_1streamplot_1_1_streamplot_set.html">StreamplotSet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmatplotlib_1_1streamplot_1_1_terminate_trajectory.html">TerminateTrajectory</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4a10373839bb392112a6376bafce24fb" id="r_a4a10373839bb392112a6376bafce24fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacematplotlib_1_1streamplot.html#a4a10373839bb392112a6376bafce24fb">streamplot</a> (axes, x, y, u, v, density=1, linewidth=None, color=None, cmap=None, norm=None, arrowsize=1, arrowstyle='-|&gt;', minlength=0.1, transform=None, zorder=None, start_points=None, maxlength=4.0, integration_direction='both', broken_streamlines=True)</td></tr>
<tr class="separator:a4a10373839bb392112a6376bafce24fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70f7a568913c86d3644cb72090967e2c" id="r_a70f7a568913c86d3644cb72090967e2c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacematplotlib_1_1streamplot.html#a70f7a568913c86d3644cb72090967e2c">_get_integrator</a> (u, v, dmap, minlength, maxlength, integration_direction)</td></tr>
<tr class="separator:a70f7a568913c86d3644cb72090967e2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a623beac982f9c2b2bd7f1082285b36ae" id="r_a623beac982f9c2b2bd7f1082285b36ae"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacematplotlib_1_1streamplot.html#a623beac982f9c2b2bd7f1082285b36ae">get_integrator</a> (u, v, dmap, minlength, maxlength, integration_direction)</td></tr>
<tr class="separator:a623beac982f9c2b2bd7f1082285b36ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55c9b53d9ba0ecb8d9a222a4a2e9c692" id="r_a55c9b53d9ba0ecb8d9a222a4a2e9c692"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacematplotlib_1_1streamplot.html#a55c9b53d9ba0ecb8d9a222a4a2e9c692">_integrate_rk12</a> (x0, <a class="el" href="__ufuncs__defs_8h.html#a5bbf55bb92a1d8c0de447a483a82f1e2">y0</a>, dmap, <a class="el" href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a>, maxlength, broken_streamlines=True)</td></tr>
<tr class="separator:a55c9b53d9ba0ecb8d9a222a4a2e9c692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb6d79104e5c843315c879f06a887787" id="r_abb6d79104e5c843315c879f06a887787"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacematplotlib_1_1streamplot.html#abb6d79104e5c843315c879f06a887787">_euler_step</a> (xyf_traj, dmap, <a class="el" href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a>)</td></tr>
<tr class="separator:abb6d79104e5c843315c879f06a887787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeac79c9a1697c70b9bcc3cbf2c904ad8" id="r_aeac79c9a1697c70b9bcc3cbf2c904ad8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacematplotlib_1_1streamplot.html#aeac79c9a1697c70b9bcc3cbf2c904ad8">interpgrid</a> (<a class="el" href="__blas__subroutines_8h.html#a4da0a64c77789ca4c8115aef76120fd2">a</a>, xi, yi)</td></tr>
<tr class="separator:aeac79c9a1697c70b9bcc3cbf2c904ad8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0db7ee1e7f67c3b61e8157734559f37b" id="r_a0db7ee1e7f67c3b61e8157734559f37b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacematplotlib_1_1streamplot.html#a0db7ee1e7f67c3b61e8157734559f37b">_gen_starting_points</a> (shape)</td></tr>
<tr class="separator:a0db7ee1e7f67c3b61e8157734559f37b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Streamline plotting for 2D vector fields.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="abb6d79104e5c843315c879f06a887787" name="abb6d79104e5c843315c879f06a887787"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb6d79104e5c843315c879f06a887787">&#9670;&#160;</a></span>_euler_step()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">matplotlib.streamplot._euler_step </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>xyf_traj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Simple Euler integration step that extends streamline to boundary.</pre> <div class="fragment"><div class="line"><span class="lineno">  615</span><span class="keyword">def </span>_euler_step(xyf_traj, dmap, f):</div>
<div class="line"><span class="lineno">  616</span>    <span class="stringliteral">&quot;&quot;&quot;Simple Euler integration step that extends streamline to boundary.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  617</span>    ny, nx = dmap.grid.shape</div>
<div class="line"><span class="lineno">  618</span>    xi, yi = xyf_traj[-1]</div>
<div class="line"><span class="lineno">  619</span>    cx, cy = <a class="code hl_variable" href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a>(xi, yi)</div>
<div class="line"><span class="lineno">  620</span>    <span class="keywordflow">if</span> cx == 0:</div>
<div class="line"><span class="lineno">  621</span>        dsx = np.inf</div>
<div class="line"><span class="lineno">  622</span>    <span class="keywordflow">elif</span> cx &lt; 0:</div>
<div class="line"><span class="lineno">  623</span>        dsx = xi / -cx</div>
<div class="line"><span class="lineno">  624</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  625</span>        dsx = (nx - 1 - xi) / cx</div>
<div class="line"><span class="lineno">  626</span>    <span class="keywordflow">if</span> cy == 0:</div>
<div class="line"><span class="lineno">  627</span>        dsy = np.inf</div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">elif</span> cy &lt; 0:</div>
<div class="line"><span class="lineno">  629</span>        dsy = yi / -cy</div>
<div class="line"><span class="lineno">  630</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  631</span>        dsy = (ny - 1 - yi) / cy</div>
<div class="line"><span class="lineno">  632</span>    ds = min(dsx, dsy)</div>
<div class="line"><span class="lineno">  633</span>    xyf_traj.append((xi + cx * ds, yi + cy * ds))</div>
<div class="line"><span class="lineno">  634</span>    <span class="keywordflow">return</span> ds, xyf_traj</div>
<div class="line"><span class="lineno">  635</span> </div>
<div class="line"><span class="lineno">  636</span> </div>
<div class="line"><span class="lineno">  637</span><span class="comment"># Utility functions</span></div>
<div class="line"><span class="lineno">  638</span><span class="comment"># ========================</span></div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="ttc" id="a__lapack__subroutines_8h_html_af01a903df7bdb7a494f5827e45bf3a2a"><div class="ttname"><a href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a></div><div class="ttdeci">void int int int int npy_complex64 int int npy_complex64 float float npy_complex64 npy_complex64 * f</div><div class="ttdef"><b>Definition</b> _lapack_subroutines.h:262</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0db7ee1e7f67c3b61e8157734559f37b" name="a0db7ee1e7f67c3b61e8157734559f37b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0db7ee1e7f67c3b61e8157734559f37b">&#9670;&#160;</a></span>_gen_starting_points()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">matplotlib.streamplot._gen_starting_points </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shape</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Yield starting points for streamlines.

Trying points on the boundary first gives higher quality streamlines.
This algorithm starts with a point on the mask corner and spirals inward.
This algorithm is inefficient, but fast compared to rest of streamplot.
</pre> <div class="fragment"><div class="line"><span class="lineno">  680</span><span class="keyword">def </span>_gen_starting_points(shape):</div>
<div class="line"><span class="lineno">  681</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  682</span><span class="stringliteral">    Yield starting points for streamlines.</span></div>
<div class="line"><span class="lineno">  683</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  684</span><span class="stringliteral">    Trying points on the boundary first gives higher quality streamlines.</span></div>
<div class="line"><span class="lineno">  685</span><span class="stringliteral">    This algorithm starts with a point on the mask corner and spirals inward.</span></div>
<div class="line"><span class="lineno">  686</span><span class="stringliteral">    This algorithm is inefficient, but fast compared to rest of streamplot.</span></div>
<div class="line"><span class="lineno">  687</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  688</span>    ny, nx = shape</div>
<div class="line"><span class="lineno">  689</span>    xfirst = 0</div>
<div class="line"><span class="lineno">  690</span>    yfirst = 1</div>
<div class="line"><span class="lineno">  691</span>    xlast = nx - 1</div>
<div class="line"><span class="lineno">  692</span>    ylast = ny - 1</div>
<div class="line"><span class="lineno">  693</span>    x, y = 0, 0</div>
<div class="line"><span class="lineno">  694</span>    direction = <span class="stringliteral">&#39;right&#39;</span></div>
<div class="line"><span class="lineno">  695</span>    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(nx * ny):</div>
<div class="line"><span class="lineno">  696</span>        <span class="keywordflow">yield</span> x, y</div>
<div class="line"><span class="lineno">  697</span> </div>
<div class="line"><span class="lineno">  698</span>        <span class="keywordflow">if</span> direction == <span class="stringliteral">&#39;right&#39;</span>:</div>
<div class="line"><span class="lineno">  699</span>            x += 1</div>
<div class="line"><span class="lineno">  700</span>            <span class="keywordflow">if</span> x &gt;= xlast:</div>
<div class="line"><span class="lineno">  701</span>                xlast -= 1</div>
<div class="line"><span class="lineno">  702</span>                direction = <span class="stringliteral">&#39;up&#39;</span></div>
<div class="line"><span class="lineno">  703</span>        <span class="keywordflow">elif</span> direction == <span class="stringliteral">&#39;up&#39;</span>:</div>
<div class="line"><span class="lineno">  704</span>            y += 1</div>
<div class="line"><span class="lineno">  705</span>            <span class="keywordflow">if</span> y &gt;= ylast:</div>
<div class="line"><span class="lineno">  706</span>                ylast -= 1</div>
<div class="line"><span class="lineno">  707</span>                direction = <span class="stringliteral">&#39;left&#39;</span></div>
<div class="line"><span class="lineno">  708</span>        <span class="keywordflow">elif</span> direction == <span class="stringliteral">&#39;left&#39;</span>:</div>
<div class="line"><span class="lineno">  709</span>            x -= 1</div>
<div class="line"><span class="lineno">  710</span>            <span class="keywordflow">if</span> x &lt;= xfirst:</div>
<div class="line"><span class="lineno">  711</span>                xfirst += 1</div>
<div class="line"><span class="lineno">  712</span>                direction = <span class="stringliteral">&#39;down&#39;</span></div>
<div class="line"><span class="lineno">  713</span>        <span class="keywordflow">elif</span> direction == <span class="stringliteral">&#39;down&#39;</span>:</div>
<div class="line"><span class="lineno">  714</span>            y -= 1</div>
<div class="line"><span class="lineno">  715</span>            <span class="keywordflow">if</span> y &lt;= yfirst:</div>
<div class="line"><span class="lineno">  716</span>                yfirst += 1</div>
<div class="line"><span class="lineno">  717</span>                direction = <span class="stringliteral">&#39;right&#39;</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a70f7a568913c86d3644cb72090967e2c" name="a70f7a568913c86d3644cb72090967e2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70f7a568913c86d3644cb72090967e2c">&#9670;&#160;</a></span>_get_integrator()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">matplotlib.streamplot._get_integrator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>minlength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>maxlength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>integration_direction</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  441</span><span class="keyword">def </span>_get_integrator(u, v, dmap, minlength, maxlength, integration_direction):</div>
<div class="line"><span class="lineno">  442</span> </div>
<div class="line"><span class="lineno">  443</span>    <span class="comment"># rescale velocity onto grid-coordinates for integrations.</span></div>
<div class="line"><span class="lineno">  444</span>    u, v = dmap.data2grid(u, v)</div>
<div class="line"><span class="lineno">  445</span> </div>
<div class="line"><span class="lineno">  446</span>    <span class="comment"># speed (path length) will be in axes-coordinates</span></div>
<div class="line"><span class="lineno">  447</span>    u_ax = u / (dmap.grid.nx - 1)</div>
<div class="line"><span class="lineno">  448</span>    v_ax = v / (dmap.grid.ny - 1)</div>
<div class="line"><span class="lineno">  449</span>    speed = np.ma.sqrt(u_ax ** 2 + v_ax ** 2)</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>    <span class="keyword">def </span>forward_time(xi, yi):</div>
<div class="line"><span class="lineno">  452</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> dmap.grid.within_grid(xi, yi):</div>
<div class="line"><span class="lineno">  453</span>            <span class="keywordflow">raise</span> OutOfBounds</div>
<div class="line"><span class="lineno">  454</span>        ds_dt = interpgrid(speed, xi, yi)</div>
<div class="line"><span class="lineno">  455</span>        <span class="keywordflow">if</span> ds_dt == 0:</div>
<div class="line"><span class="lineno">  456</span>            <span class="keywordflow">raise</span> TerminateTrajectory()</div>
<div class="line"><span class="lineno">  457</span>        dt_ds = 1. / ds_dt</div>
<div class="line"><span class="lineno">  458</span>        ui = interpgrid(u, xi, yi)</div>
<div class="line"><span class="lineno">  459</span>        vi = interpgrid(v, xi, yi)</div>
<div class="line"><span class="lineno">  460</span>        <span class="keywordflow">return</span> ui * dt_ds, vi * dt_ds</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>    <span class="keyword">def </span>backward_time(xi, yi):</div>
<div class="line"><span class="lineno">  463</span>        dxi, dyi = forward_time(xi, yi)</div>
<div class="line"><span class="lineno">  464</span>        <span class="keywordflow">return</span> -dxi, -dyi</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>    <span class="keyword">def </span>integrate(x0, y0, broken_streamlines=True):</div>
<div class="line"><span class="lineno">  467</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  468</span><span class="stringliteral">        Return x, y grid-coordinates of trajectory based on starting point.</span></div>
<div class="line"><span class="lineno">  469</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  470</span><span class="stringliteral">        Integrate both forward and backward in time from starting point in</span></div>
<div class="line"><span class="lineno">  471</span><span class="stringliteral">        grid coordinates.</span></div>
<div class="line"><span class="lineno">  472</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  473</span><span class="stringliteral">        Integration is terminated when a trajectory reaches a domain boundary</span></div>
<div class="line"><span class="lineno">  474</span><span class="stringliteral">        or when it crosses into an already occupied cell in the StreamMask. The</span></div>
<div class="line"><span class="lineno">  475</span><span class="stringliteral">        resulting trajectory is None if it is shorter than `minlength`.</span></div>
<div class="line"><span class="lineno">  476</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>        stotal, xy_traj = 0., []</div>
<div class="line"><span class="lineno">  479</span> </div>
<div class="line"><span class="lineno">  480</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  481</span>            dmap.start_trajectory(x0, y0, broken_streamlines)</div>
<div class="line"><span class="lineno">  482</span>        <span class="keywordflow">except</span> InvalidIndexError:</div>
<div class="line"><span class="lineno">  483</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  484</span>        <span class="keywordflow">if</span> integration_direction <span class="keywordflow">in</span> [<span class="stringliteral">&#39;both&#39;</span>, <span class="stringliteral">&#39;backward&#39;</span>]:</div>
<div class="line"><span class="lineno">  485</span>            s, xyt = _integrate_rk12(x0, y0, dmap, backward_time, maxlength,</div>
<div class="line"><span class="lineno">  486</span>                                     broken_streamlines)</div>
<div class="line"><span class="lineno">  487</span>            stotal += s</div>
<div class="line"><span class="lineno">  488</span>            xy_traj += xyt[::-1]</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>        <span class="keywordflow">if</span> integration_direction <span class="keywordflow">in</span> [<span class="stringliteral">&#39;both&#39;</span>, <span class="stringliteral">&#39;forward&#39;</span>]:</div>
<div class="line"><span class="lineno">  491</span>            dmap.reset_start_point(x0, y0)</div>
<div class="line"><span class="lineno">  492</span>            s, xyt = _integrate_rk12(x0, y0, dmap, forward_time, maxlength,</div>
<div class="line"><span class="lineno">  493</span>                                     broken_streamlines)</div>
<div class="line"><span class="lineno">  494</span>            stotal += s</div>
<div class="line"><span class="lineno">  495</span>            xy_traj += xyt[1:]</div>
<div class="line"><span class="lineno">  496</span> </div>
<div class="line"><span class="lineno">  497</span>        <span class="keywordflow">if</span> stotal &gt; minlength:</div>
<div class="line"><span class="lineno">  498</span>            <span class="keywordflow">return</span> np.broadcast_arrays(xy_traj, np.empty((1, 2)))[0]</div>
<div class="line"><span class="lineno">  499</span>        <span class="keywordflow">else</span>:  <span class="comment"># reject short trajectories</span></div>
<div class="line"><span class="lineno">  500</span>            dmap.undo_trajectory()</div>
<div class="line"><span class="lineno">  501</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  502</span> </div>
<div class="line"><span class="lineno">  503</span>    <span class="keywordflow">return</span> integrate</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span> </div>
<div class="line"><span class="lineno">  506</span><span class="preprocessor">@_api.deprecated(&quot;3.5&quot;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a55c9b53d9ba0ecb8d9a222a4a2e9c692" name="a55c9b53d9ba0ecb8d9a222a4a2e9c692"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55c9b53d9ba0ecb8d9a222a4a2e9c692">&#9670;&#160;</a></span>_integrate_rk12()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">matplotlib.streamplot._integrate_rk12 </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>y0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>maxlength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>broken_streamlines</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">2nd-order Runge-Kutta algorithm with adaptive step size.

This method is also referred to as the improved Euler's method, or Heun's
method. This method is favored over higher-order methods because:

1. To get decent looking trajectories and to sample every mask cell
   on the trajectory we need a small timestep, so a lower order
   solver doesn't hurt us unless the data is *very* high resolution.
   In fact, for cases where the user inputs
   data smaller or of similar grid size to the mask grid, the higher
   order corrections are negligible because of the very fast linear
   interpolation used in `interpgrid`.

2. For high resolution input data (i.e. beyond the mask
   resolution), we must reduce the timestep. Therefore, an adaptive
   timestep is more suited to the problem as this would be very hard
   to judge automatically otherwise.

This integrator is about 1.5 - 2x as fast as RK4 and RK45 solvers (using
similar Python implementations) in most setups.
</pre> <div class="fragment"><div class="line"><span class="lineno">  519</span><span class="keyword">def </span>_integrate_rk12(x0, y0, dmap, f, maxlength, broken_streamlines=True):</div>
<div class="line"><span class="lineno">  520</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  521</span><span class="stringliteral">    2nd-order Runge-Kutta algorithm with adaptive step size.</span></div>
<div class="line"><span class="lineno">  522</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  523</span><span class="stringliteral">    This method is also referred to as the improved Euler&#39;s method, or Heun&#39;s</span></div>
<div class="line"><span class="lineno">  524</span><span class="stringliteral">    method. This method is favored over higher-order methods because:</span></div>
<div class="line"><span class="lineno">  525</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  526</span><span class="stringliteral">    1. To get decent looking trajectories and to sample every mask cell</span></div>
<div class="line"><span class="lineno">  527</span><span class="stringliteral">       on the trajectory we need a small timestep, so a lower order</span></div>
<div class="line"><span class="lineno">  528</span><span class="stringliteral">       solver doesn&#39;t hurt us unless the data is *very* high resolution.</span></div>
<div class="line"><span class="lineno">  529</span><span class="stringliteral">       In fact, for cases where the user inputs</span></div>
<div class="line"><span class="lineno">  530</span><span class="stringliteral">       data smaller or of similar grid size to the mask grid, the higher</span></div>
<div class="line"><span class="lineno">  531</span><span class="stringliteral">       order corrections are negligible because of the very fast linear</span></div>
<div class="line"><span class="lineno">  532</span><span class="stringliteral">       interpolation used in `interpgrid`.</span></div>
<div class="line"><span class="lineno">  533</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  534</span><span class="stringliteral">    2. For high resolution input data (i.e. beyond the mask</span></div>
<div class="line"><span class="lineno">  535</span><span class="stringliteral">       resolution), we must reduce the timestep. Therefore, an adaptive</span></div>
<div class="line"><span class="lineno">  536</span><span class="stringliteral">       timestep is more suited to the problem as this would be very hard</span></div>
<div class="line"><span class="lineno">  537</span><span class="stringliteral">       to judge automatically otherwise.</span></div>
<div class="line"><span class="lineno">  538</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  539</span><span class="stringliteral">    This integrator is about 1.5 - 2x as fast as RK4 and RK45 solvers (using</span></div>
<div class="line"><span class="lineno">  540</span><span class="stringliteral">    similar Python implementations) in most setups.</span></div>
<div class="line"><span class="lineno">  541</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  542</span>    <span class="comment"># This error is below that needed to match the RK4 integrator. It</span></div>
<div class="line"><span class="lineno">  543</span>    <span class="comment"># is set for visual reasons -- too low and corners start</span></div>
<div class="line"><span class="lineno">  544</span>    <span class="comment"># appearing ugly and jagged. Can be tuned.</span></div>
<div class="line"><span class="lineno">  545</span>    maxerror = 0.003</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>    <span class="comment"># This limit is important (for all integrators) to avoid the</span></div>
<div class="line"><span class="lineno">  548</span>    <span class="comment"># trajectory skipping some mask cells. We could relax this</span></div>
<div class="line"><span class="lineno">  549</span>    <span class="comment"># condition if we use the code which is commented out below to</span></div>
<div class="line"><span class="lineno">  550</span>    <span class="comment"># increment the location gradually. However, due to the efficient</span></div>
<div class="line"><span class="lineno">  551</span>    <span class="comment"># nature of the interpolation, this doesn&#39;t boost speed by much</span></div>
<div class="line"><span class="lineno">  552</span>    <span class="comment"># for quite a bit of complexity.</span></div>
<div class="line"><span class="lineno">  553</span>    maxds = min(1. / dmap.mask.nx, 1. / dmap.mask.ny, 0.1)</div>
<div class="line"><span class="lineno">  554</span> </div>
<div class="line"><span class="lineno">  555</span>    ds = maxds</div>
<div class="line"><span class="lineno">  556</span>    stotal = 0</div>
<div class="line"><span class="lineno">  557</span>    xi = x0</div>
<div class="line"><span class="lineno">  558</span>    yi = y0</div>
<div class="line"><span class="lineno">  559</span>    xyf_traj = []</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>    <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line"><span class="lineno">  562</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  563</span>            <span class="keywordflow">if</span> dmap.grid.within_grid(xi, yi):</div>
<div class="line"><span class="lineno">  564</span>                xyf_traj.append((xi, yi))</div>
<div class="line"><span class="lineno">  565</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  566</span>                <span class="keywordflow">raise</span> OutOfBounds</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>            <span class="comment"># Compute the two intermediate gradients.</span></div>
<div class="line"><span class="lineno">  569</span>            <span class="comment"># f should raise OutOfBounds if the locations given are</span></div>
<div class="line"><span class="lineno">  570</span>            <span class="comment"># outside the grid.</span></div>
<div class="line"><span class="lineno">  571</span>            k1x, k1y = <a class="code hl_variable" href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a>(xi, yi)</div>
<div class="line"><span class="lineno">  572</span>            k2x, k2y = <a class="code hl_variable" href="__lapack__subroutines_8h.html#af01a903df7bdb7a494f5827e45bf3a2a">f</a>(xi + ds * k1x, yi + ds * k1y)</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>        <span class="keywordflow">except</span> OutOfBounds:</div>
<div class="line"><span class="lineno">  575</span>            <span class="comment"># Out of the domain during this step.</span></div>
<div class="line"><span class="lineno">  576</span>            <span class="comment"># Take an Euler step to the boundary to improve neatness</span></div>
<div class="line"><span class="lineno">  577</span>            <span class="comment"># unless the trajectory is currently empty.</span></div>
<div class="line"><span class="lineno">  578</span>            <span class="keywordflow">if</span> xyf_traj:</div>
<div class="line"><span class="lineno">  579</span>                ds, xyf_traj = _euler_step(xyf_traj, dmap, f)</div>
<div class="line"><span class="lineno">  580</span>                stotal += ds</div>
<div class="line"><span class="lineno">  581</span>            <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  582</span>        <span class="keywordflow">except</span> TerminateTrajectory:</div>
<div class="line"><span class="lineno">  583</span>            <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span>        dx1 = ds * k1x</div>
<div class="line"><span class="lineno">  586</span>        dy1 = ds * k1y</div>
<div class="line"><span class="lineno">  587</span>        dx2 = ds * 0.5 * (k1x + k2x)</div>
<div class="line"><span class="lineno">  588</span>        dy2 = ds * 0.5 * (k1y + k2y)</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>        ny, nx = dmap.grid.shape</div>
<div class="line"><span class="lineno">  591</span>        <span class="comment"># Error is normalized to the axes coordinates</span></div>
<div class="line"><span class="lineno">  592</span>        error = np.hypot((dx2 - dx1) / (nx - 1), (dy2 - dy1) / (ny - 1))</div>
<div class="line"><span class="lineno">  593</span> </div>
<div class="line"><span class="lineno">  594</span>        <span class="comment"># Only save step if within error tolerance</span></div>
<div class="line"><span class="lineno">  595</span>        <span class="keywordflow">if</span> error &lt; maxerror:</div>
<div class="line"><span class="lineno">  596</span>            xi += dx2</div>
<div class="line"><span class="lineno">  597</span>            yi += dy2</div>
<div class="line"><span class="lineno">  598</span>            <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  599</span>                dmap.update_trajectory(xi, yi, broken_streamlines)</div>
<div class="line"><span class="lineno">  600</span>            <span class="keywordflow">except</span> InvalidIndexError:</div>
<div class="line"><span class="lineno">  601</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  602</span>            <span class="keywordflow">if</span> stotal + ds &gt; maxlength:</div>
<div class="line"><span class="lineno">  603</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  604</span>            stotal += ds</div>
<div class="line"><span class="lineno">  605</span> </div>
<div class="line"><span class="lineno">  606</span>        <span class="comment"># recalculate stepsize based on step error</span></div>
<div class="line"><span class="lineno">  607</span>        <span class="keywordflow">if</span> error == 0:</div>
<div class="line"><span class="lineno">  608</span>            ds = maxds</div>
<div class="line"><span class="lineno">  609</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  610</span>            ds = min(maxds, 0.85 * ds * (maxerror / error) ** 0.5)</div>
<div class="line"><span class="lineno">  611</span> </div>
<div class="line"><span class="lineno">  612</span>    <span class="keywordflow">return</span> stotal, xyf_traj</div>
<div class="line"><span class="lineno">  613</span> </div>
<div class="line"><span class="lineno">  614</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a623beac982f9c2b2bd7f1082285b36ae" name="a623beac982f9c2b2bd7f1082285b36ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a623beac982f9c2b2bd7f1082285b36ae">&#9670;&#160;</a></span>get_integrator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">matplotlib.streamplot.get_integrator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>minlength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>maxlength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>integration_direction</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  507</span><span class="keyword">def </span>get_integrator(u, v, dmap, minlength, maxlength, integration_direction):</div>
<div class="line"><span class="lineno">  508</span>    xy_traj = _get_integrator(</div>
<div class="line"><span class="lineno">  509</span>        u, v, dmap, minlength, maxlength, integration_direction)</div>
<div class="line"><span class="lineno">  510</span>    <span class="keywordflow">return</span> (<span class="keywordtype">None</span> <span class="keywordflow">if</span> xy_traj <span class="keywordflow">is</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  511</span>            <span class="keywordflow">else</span> ([], []) <span class="keywordflow">if</span> <span class="keywordflow">not</span> len(xy_traj)</div>
<div class="line"><span class="lineno">  512</span>            <span class="keywordflow">else</span> [*zip(*xy_traj)])</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aeac79c9a1697c70b9bcc3cbf2c904ad8" name="aeac79c9a1697c70b9bcc3cbf2c904ad8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeac79c9a1697c70b9bcc3cbf2c904ad8">&#9670;&#160;</a></span>interpgrid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">matplotlib.streamplot.interpgrid </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>xi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>yi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Fast 2D, linear interpolation on an integer grid</pre> <div class="fragment"><div class="line"><span class="lineno">  640</span><span class="keyword">def </span>interpgrid(a, xi, yi):</div>
<div class="line"><span class="lineno">  641</span>    <span class="stringliteral">&quot;&quot;&quot;Fast 2D, linear interpolation on an integer grid&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span>    Ny, Nx = np.shape(a)</div>
<div class="line"><span class="lineno">  644</span>    <span class="keywordflow">if</span> isinstance(xi, np.ndarray):</div>
<div class="line"><span class="lineno">  645</span>        x = xi.astype(int)</div>
<div class="line"><span class="lineno">  646</span>        y = yi.astype(int)</div>
<div class="line"><span class="lineno">  647</span>        <span class="comment"># Check that xn, yn don&#39;t exceed max index</span></div>
<div class="line"><span class="lineno">  648</span>        xn = np.clip(x + 1, 0, Nx - 1)</div>
<div class="line"><span class="lineno">  649</span>        yn = np.clip(y + 1, 0, Ny - 1)</div>
<div class="line"><span class="lineno">  650</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  651</span>        x = int(xi)</div>
<div class="line"><span class="lineno">  652</span>        y = int(yi)</div>
<div class="line"><span class="lineno">  653</span>        <span class="comment"># conditional is faster than clipping for integers</span></div>
<div class="line"><span class="lineno">  654</span>        <span class="keywordflow">if</span> x == (Nx - 1):</div>
<div class="line"><span class="lineno">  655</span>            xn = x</div>
<div class="line"><span class="lineno">  656</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  657</span>            xn = x + 1</div>
<div class="line"><span class="lineno">  658</span>        <span class="keywordflow">if</span> y == (Ny - 1):</div>
<div class="line"><span class="lineno">  659</span>            yn = y</div>
<div class="line"><span class="lineno">  660</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  661</span>            yn = y + 1</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>    a00 = a[y, x]</div>
<div class="line"><span class="lineno">  664</span>    a01 = a[y, xn]</div>
<div class="line"><span class="lineno">  665</span>    a10 = a[yn, x]</div>
<div class="line"><span class="lineno">  666</span>    a11 = a[yn, xn]</div>
<div class="line"><span class="lineno">  667</span>    xt = xi - x</div>
<div class="line"><span class="lineno">  668</span>    yt = yi - y</div>
<div class="line"><span class="lineno">  669</span>    a0 = a00 * (1 - xt) + a01 * xt</div>
<div class="line"><span class="lineno">  670</span>    a1 = a10 * (1 - xt) + a11 * xt</div>
<div class="line"><span class="lineno">  671</span>    ai = a0 * (1 - yt) + a1 * yt</div>
<div class="line"><span class="lineno">  672</span> </div>
<div class="line"><span class="lineno">  673</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(xi, np.ndarray):</div>
<div class="line"><span class="lineno">  674</span>        <span class="keywordflow">if</span> np.ma.is_masked(ai):</div>
<div class="line"><span class="lineno">  675</span>            <span class="keywordflow">raise</span> TerminateTrajectory</div>
<div class="line"><span class="lineno">  676</span> </div>
<div class="line"><span class="lineno">  677</span>    <span class="keywordflow">return</span> ai</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a4a10373839bb392112a6376bafce24fb" name="a4a10373839bb392112a6376bafce24fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a10373839bb392112a6376bafce24fb">&#9670;&#160;</a></span>streamplot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">matplotlib.streamplot.streamplot </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>axes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>density</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>linewidth</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>color</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cmap</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>norm</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arrowsize</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arrowstyle</em> = <code>'-|&gt;'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>minlength</em> = <code>0.1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>transform</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>zorder</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>start_points</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>maxlength</em> = <code>4.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>integration_direction</em> = <code>'both'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>broken_streamlines</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Draw streamlines of a vector flow.

Parameters
----------
x, y : 1D/2D arrays
    Evenly spaced strictly increasing arrays to make a grid.  If 2D, all
    rows of *x* must be equal and all columns of *y* must be equal; i.e.,
    they must be as if generated by ``np.meshgrid(x_1d, y_1d)``.
u, v : 2D arrays
    *x* and *y*-velocities. The number of rows and columns must match
    the length of *y* and *x*, respectively.
density : float or (float, float)
    Controls the closeness of streamlines. When ``density = 1``, the domain
    is divided into a 30x30 grid. *density* linearly scales this grid.
    Each cell in the grid can have, at most, one traversing streamline.
    For different densities in each direction, use a tuple
    (density_x, density_y).
linewidth : float or 2D array
    The width of the stream lines. With a 2D array the line width can be
    varied across the grid. The array must have the same shape as *u*
    and *v*.
color : color or 2D array
    The streamline color. If given an array, its values are converted to
    colors using *cmap* and *norm*.  The array must have the same shape
    as *u* and *v*.
cmap, norm
    Data normalization and colormapping parameters for *color*; only used
    if *color* is an array of floats. See `~.Axes.imshow` for a detailed
    description.
arrowsize : float
    Scaling factor for the arrow size.
arrowstyle : str
    Arrow style specification.
    See `~matplotlib.patches.FancyArrowPatch`.
minlength : float
    Minimum length of streamline in axes coordinates.
start_points : Nx2 array
    Coordinates of starting points for the streamlines in data coordinates
    (the same coordinates as the *x* and *y* arrays).
zorder : int
    The zorder of the stream lines and arrows.
    Artists with lower zorder values are drawn first.
maxlength : float
    Maximum length of streamline in axes coordinates.
integration_direction : {'forward', 'backward', 'both'}, default: 'both'
    Integrate the streamline in forward, backward or both directions.
data : indexable object, optional
    DATA_PARAMETER_PLACEHOLDER
broken_streamlines : boolean, default: True
    If False, forces streamlines to continue until they
    leave the plot domain.  If True, they may be terminated if they
    come too close to another streamline.

Returns
-------
StreamplotSet
    Container object with attributes

    - ``lines``: `.LineCollection` of streamlines

    - ``arrows``: `.PatchCollection` containing `.FancyArrowPatch`
      objects representing the arrows half-way along stream lines.

    This container will probably change in the future to allow changes
    to the colormap, alpha, etc. for both lines and arrows, but these
    changes should be backward compatible.
</pre> <div class="fragment"><div class="line"><span class="lineno">   22</span>               broken_streamlines=<span class="keyword">True</span>):</div>
<div class="line"><span class="lineno">   23</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   24</span><span class="stringliteral">    Draw streamlines of a vector flow.</span></div>
<div class="line"><span class="lineno">   25</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   26</span><span class="stringliteral">    Parameters</span></div>
<div class="line"><span class="lineno">   27</span><span class="stringliteral">    ----------</span></div>
<div class="line"><span class="lineno">   28</span><span class="stringliteral">    x, y : 1D/2D arrays</span></div>
<div class="line"><span class="lineno">   29</span><span class="stringliteral">        Evenly spaced strictly increasing arrays to make a grid.  If 2D, all</span></div>
<div class="line"><span class="lineno">   30</span><span class="stringliteral">        rows of *x* must be equal and all columns of *y* must be equal; i.e.,</span></div>
<div class="line"><span class="lineno">   31</span><span class="stringliteral">        they must be as if generated by ``np.meshgrid(x_1d, y_1d)``.</span></div>
<div class="line"><span class="lineno">   32</span><span class="stringliteral">    u, v : 2D arrays</span></div>
<div class="line"><span class="lineno">   33</span><span class="stringliteral">        *x* and *y*-velocities. The number of rows and columns must match</span></div>
<div class="line"><span class="lineno">   34</span><span class="stringliteral">        the length of *y* and *x*, respectively.</span></div>
<div class="line"><span class="lineno">   35</span><span class="stringliteral">    density : float or (float, float)</span></div>
<div class="line"><span class="lineno">   36</span><span class="stringliteral">        Controls the closeness of streamlines. When ``density = 1``, the domain</span></div>
<div class="line"><span class="lineno">   37</span><span class="stringliteral">        is divided into a 30x30 grid. *density* linearly scales this grid.</span></div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral">        Each cell in the grid can have, at most, one traversing streamline.</span></div>
<div class="line"><span class="lineno">   39</span><span class="stringliteral">        For different densities in each direction, use a tuple</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">        (density_x, density_y).</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral">    linewidth : float or 2D array</span></div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral">        The width of the stream lines. With a 2D array the line width can be</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">        varied across the grid. The array must have the same shape as *u*</span></div>
<div class="line"><span class="lineno">   44</span><span class="stringliteral">        and *v*.</span></div>
<div class="line"><span class="lineno">   45</span><span class="stringliteral">    color : color or 2D array</span></div>
<div class="line"><span class="lineno">   46</span><span class="stringliteral">        The streamline color. If given an array, its values are converted to</span></div>
<div class="line"><span class="lineno">   47</span><span class="stringliteral">        colors using *cmap* and *norm*.  The array must have the same shape</span></div>
<div class="line"><span class="lineno">   48</span><span class="stringliteral">        as *u* and *v*.</span></div>
<div class="line"><span class="lineno">   49</span><span class="stringliteral">    cmap, norm</span></div>
<div class="line"><span class="lineno">   50</span><span class="stringliteral">        Data normalization and colormapping parameters for *color*; only used</span></div>
<div class="line"><span class="lineno">   51</span><span class="stringliteral">        if *color* is an array of floats. See `~.Axes.imshow` for a detailed</span></div>
<div class="line"><span class="lineno">   52</span><span class="stringliteral">        description.</span></div>
<div class="line"><span class="lineno">   53</span><span class="stringliteral">    arrowsize : float</span></div>
<div class="line"><span class="lineno">   54</span><span class="stringliteral">        Scaling factor for the arrow size.</span></div>
<div class="line"><span class="lineno">   55</span><span class="stringliteral">    arrowstyle : str</span></div>
<div class="line"><span class="lineno">   56</span><span class="stringliteral">        Arrow style specification.</span></div>
<div class="line"><span class="lineno">   57</span><span class="stringliteral">        See `~matplotlib.patches.FancyArrowPatch`.</span></div>
<div class="line"><span class="lineno">   58</span><span class="stringliteral">    minlength : float</span></div>
<div class="line"><span class="lineno">   59</span><span class="stringliteral">        Minimum length of streamline in axes coordinates.</span></div>
<div class="line"><span class="lineno">   60</span><span class="stringliteral">    start_points : Nx2 array</span></div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral">        Coordinates of starting points for the streamlines in data coordinates</span></div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">        (the same coordinates as the *x* and *y* arrays).</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">    zorder : int</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral">        The zorder of the stream lines and arrows.</span></div>
<div class="line"><span class="lineno">   65</span><span class="stringliteral">        Artists with lower zorder values are drawn first.</span></div>
<div class="line"><span class="lineno">   66</span><span class="stringliteral">    maxlength : float</span></div>
<div class="line"><span class="lineno">   67</span><span class="stringliteral">        Maximum length of streamline in axes coordinates.</span></div>
<div class="line"><span class="lineno">   68</span><span class="stringliteral">    integration_direction : {&#39;forward&#39;, &#39;backward&#39;, &#39;both&#39;}, default: &#39;both&#39;</span></div>
<div class="line"><span class="lineno">   69</span><span class="stringliteral">        Integrate the streamline in forward, backward or both directions.</span></div>
<div class="line"><span class="lineno">   70</span><span class="stringliteral">    data : indexable object, optional</span></div>
<div class="line"><span class="lineno">   71</span><span class="stringliteral">        DATA_PARAMETER_PLACEHOLDER</span></div>
<div class="line"><span class="lineno">   72</span><span class="stringliteral">    broken_streamlines : boolean, default: True</span></div>
<div class="line"><span class="lineno">   73</span><span class="stringliteral">        If False, forces streamlines to continue until they</span></div>
<div class="line"><span class="lineno">   74</span><span class="stringliteral">        leave the plot domain.  If True, they may be terminated if they</span></div>
<div class="line"><span class="lineno">   75</span><span class="stringliteral">        come too close to another streamline.</span></div>
<div class="line"><span class="lineno">   76</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   77</span><span class="stringliteral">    Returns</span></div>
<div class="line"><span class="lineno">   78</span><span class="stringliteral">    -------</span></div>
<div class="line"><span class="lineno">   79</span><span class="stringliteral">    StreamplotSet</span></div>
<div class="line"><span class="lineno">   80</span><span class="stringliteral">        Container object with attributes</span></div>
<div class="line"><span class="lineno">   81</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   82</span><span class="stringliteral">        - ``lines``: `.LineCollection` of streamlines</span></div>
<div class="line"><span class="lineno">   83</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   84</span><span class="stringliteral">        - ``arrows``: `.PatchCollection` containing `.FancyArrowPatch`</span></div>
<div class="line"><span class="lineno">   85</span><span class="stringliteral">          objects representing the arrows half-way along stream lines.</span></div>
<div class="line"><span class="lineno">   86</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   87</span><span class="stringliteral">        This container will probably change in the future to allow changes</span></div>
<div class="line"><span class="lineno">   88</span><span class="stringliteral">        to the colormap, alpha, etc. for both lines and arrows, but these</span></div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral">        changes should be backward compatible.</span></div>
<div class="line"><span class="lineno">   90</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   91</span>    grid = Grid(x, y)</div>
<div class="line"><span class="lineno">   92</span>    mask = StreamMask(density)</div>
<div class="line"><span class="lineno">   93</span>    dmap = DomainMap(grid, mask)</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>    <span class="keywordflow">if</span> zorder <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   96</span>        zorder = mlines.Line2D.zorder</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>    <span class="comment"># default to data coordinates</span></div>
<div class="line"><span class="lineno">   99</span>    <span class="keywordflow">if</span> transform <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  100</span>        transform = axes.transData</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>    <span class="keywordflow">if</span> color <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  103</span>        color = axes._get_lines.get_next_color()</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span>    <span class="keywordflow">if</span> linewidth <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  106</span>        linewidth = mpl.rcParams[<span class="stringliteral">&#39;lines.linewidth&#39;</span>]</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    line_kw = {}</div>
<div class="line"><span class="lineno">  109</span>    arrow_kw = dict(arrowstyle=arrowstyle, mutation_scale=10 * arrowsize)</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>    _api.check_in_list([<span class="stringliteral">&#39;both&#39;</span>, <span class="stringliteral">&#39;forward&#39;</span>, <span class="stringliteral">&#39;backward&#39;</span>],</div>
<div class="line"><span class="lineno">  112</span>                       integration_direction=integration_direction)</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>    <span class="keywordflow">if</span> integration_direction == <span class="stringliteral">&#39;both&#39;</span>:</div>
<div class="line"><span class="lineno">  115</span>        maxlength /= 2.</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>    use_multicolor_lines = isinstance(color, np.ndarray)</div>
<div class="line"><span class="lineno">  118</span>    <span class="keywordflow">if</span> use_multicolor_lines:</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordflow">if</span> color.shape != grid.shape:</div>
<div class="line"><span class="lineno">  120</span>            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;If &#39;color&#39; is given, it must match the shape of &quot;</span></div>
<div class="line"><span class="lineno">  121</span>                             <span class="stringliteral">&quot;the (x, y) grid&quot;</span>)</div>
<div class="line"><span class="lineno">  122</span>        line_colors = [[]]  <span class="comment"># Empty entry allows concatenation of zero arrays.</span></div>
<div class="line"><span class="lineno">  123</span>        color = np.ma.masked_invalid(color)</div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  125</span>        line_kw[<span class="stringliteral">&#39;color&#39;</span>] = color</div>
<div class="line"><span class="lineno">  126</span>        arrow_kw[<span class="stringliteral">&#39;color&#39;</span>] = color</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    <span class="keywordflow">if</span> isinstance(linewidth, np.ndarray):</div>
<div class="line"><span class="lineno">  129</span>        <span class="keywordflow">if</span> linewidth.shape != grid.shape:</div>
<div class="line"><span class="lineno">  130</span>            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;If &#39;linewidth&#39; is given, it must match the &quot;</span></div>
<div class="line"><span class="lineno">  131</span>                             <span class="stringliteral">&quot;shape of the (x, y) grid&quot;</span>)</div>
<div class="line"><span class="lineno">  132</span>        line_kw[<span class="stringliteral">&#39;linewidth&#39;</span>] = []</div>
<div class="line"><span class="lineno">  133</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  134</span>        line_kw[<span class="stringliteral">&#39;linewidth&#39;</span>] = linewidth</div>
<div class="line"><span class="lineno">  135</span>        arrow_kw[<span class="stringliteral">&#39;linewidth&#39;</span>] = linewidth</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>    line_kw[<span class="stringliteral">&#39;zorder&#39;</span>] = zorder</div>
<div class="line"><span class="lineno">  138</span>    arrow_kw[<span class="stringliteral">&#39;zorder&#39;</span>] = zorder</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>    <span class="comment"># Sanity checks.</span></div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">if</span> u.shape != grid.shape <span class="keywordflow">or</span> v.shape != grid.shape:</div>
<div class="line"><span class="lineno">  142</span>        <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;&#39;u&#39; and &#39;v&#39; must match the shape of the (x, y) grid&quot;</span>)</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>    u = np.ma.masked_invalid(u)</div>
<div class="line"><span class="lineno">  145</span>    v = np.ma.masked_invalid(v)</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    integrate = _get_integrator(u, v, dmap, minlength, maxlength,</div>
<div class="line"><span class="lineno">  148</span>                                integration_direction)</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>    trajectories = []</div>
<div class="line"><span class="lineno">  151</span>    <span class="keywordflow">if</span> start_points <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  152</span>        <span class="keywordflow">for</span> xm, ym <span class="keywordflow">in</span> _gen_starting_points(mask.shape):</div>
<div class="line"><span class="lineno">  153</span>            <span class="keywordflow">if</span> mask[ym, xm] == 0:</div>
<div class="line"><span class="lineno">  154</span>                xg, yg = dmap.mask2grid(xm, ym)</div>
<div class="line"><span class="lineno">  155</span>                t = integrate(xg, yg, broken_streamlines)</div>
<div class="line"><span class="lineno">  156</span>                <span class="keywordflow">if</span> t <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  157</span>                    trajectories.append(t)</div>
<div class="line"><span class="lineno">  158</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  159</span>        sp2 = np.asanyarray(start_points, dtype=float).copy()</div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span>        <span class="comment"># Check if start_points are outside the data boundaries</span></div>
<div class="line"><span class="lineno">  162</span>        <span class="keywordflow">for</span> xs, ys <span class="keywordflow">in</span> sp2:</div>
<div class="line"><span class="lineno">  163</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> (grid.x_origin &lt;= xs &lt;= grid.x_origin + grid.width <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  164</span>                    grid.y_origin &lt;= ys &lt;= grid.y_origin + grid.height):</div>
<div class="line"><span class="lineno">  165</span>                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&quot;Starting point ({}, {}) outside of data &quot;</span></div>
<div class="line"><span class="lineno">  166</span>                                 <span class="stringliteral">&quot;boundaries&quot;</span>.format(xs, ys))</div>
<div class="line"><span class="lineno">  167</span> </div>
<div class="line"><span class="lineno">  168</span>        <span class="comment"># Convert start_points from data to array coords</span></div>
<div class="line"><span class="lineno">  169</span>        <span class="comment"># Shift the seed points from the bottom left of the data so that</span></div>
<div class="line"><span class="lineno">  170</span>        <span class="comment"># data2grid works properly.</span></div>
<div class="line"><span class="lineno">  171</span>        sp2[:, 0] -= grid.x_origin</div>
<div class="line"><span class="lineno">  172</span>        sp2[:, 1] -= grid.y_origin</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>        <span class="keywordflow">for</span> xs, ys <span class="keywordflow">in</span> sp2:</div>
<div class="line"><span class="lineno">  175</span>            xg, yg = dmap.data2grid(xs, ys)</div>
<div class="line"><span class="lineno">  176</span>            <span class="comment"># Floating point issues can cause xg, yg to be slightly out of</span></div>
<div class="line"><span class="lineno">  177</span>            <span class="comment"># bounds for xs, ys on the upper boundaries. Because we have</span></div>
<div class="line"><span class="lineno">  178</span>            <span class="comment"># already checked that the starting points are within the original</span></div>
<div class="line"><span class="lineno">  179</span>            <span class="comment"># grid, clip the xg, yg to the grid to work around this issue</span></div>
<div class="line"><span class="lineno">  180</span>            xg = np.clip(xg, 0, grid.nx - 1)</div>
<div class="line"><span class="lineno">  181</span>            yg = np.clip(yg, 0, grid.ny - 1)</div>
<div class="line"><span class="lineno">  182</span> </div>
<div class="line"><span class="lineno">  183</span>            t = integrate(xg, yg, broken_streamlines)</div>
<div class="line"><span class="lineno">  184</span>            <span class="keywordflow">if</span> t <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  185</span>                trajectories.append(t)</div>
<div class="line"><span class="lineno">  186</span> </div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">if</span> use_multicolor_lines:</div>
<div class="line"><span class="lineno">  188</span>        <span class="keywordflow">if</span> norm <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  189</span>            norm = mcolors.Normalize(color.min(), color.max())</div>
<div class="line"><span class="lineno">  190</span>        cmap = cm._ensure_cmap(cmap)</div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>    streamlines = []</div>
<div class="line"><span class="lineno">  193</span>    arrows = []</div>
<div class="line"><span class="lineno">  194</span>    <span class="keywordflow">for</span> t <span class="keywordflow">in</span> trajectories:</div>
<div class="line"><span class="lineno">  195</span>        tgx, tgy = t.T</div>
<div class="line"><span class="lineno">  196</span>        <span class="comment"># Rescale from grid-coordinates to data-coordinates.</span></div>
<div class="line"><span class="lineno">  197</span>        tx, ty = dmap.grid2data(tgx, tgy)</div>
<div class="line"><span class="lineno">  198</span>        tx += grid.x_origin</div>
<div class="line"><span class="lineno">  199</span>        ty += grid.y_origin</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>        points = np.transpose([tx, ty]).reshape(-1, 1, 2)</div>
<div class="line"><span class="lineno">  202</span>        streamlines.extend(np.hstack([points[:-1], points[1:]]))</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>        <span class="comment"># Add arrows half way along each trajectory.</span></div>
<div class="line"><span class="lineno">  205</span>        s = np.cumsum(np.hypot(np.diff(tx), np.diff(ty)))</div>
<div class="line"><span class="lineno">  206</span>        n = np.searchsorted(s, s[-1] / 2.)</div>
<div class="line"><span class="lineno">  207</span>        arrow_tail = (tx[n], ty[n])</div>
<div class="line"><span class="lineno">  208</span>        arrow_head = (np.mean(tx[n:n + 2]), np.mean(ty[n:n + 2]))</div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span>        <span class="keywordflow">if</span> isinstance(linewidth, np.ndarray):</div>
<div class="line"><span class="lineno">  211</span>            line_widths = interpgrid(linewidth, tgx, tgy)[:-1]</div>
<div class="line"><span class="lineno">  212</span>            line_kw[<span class="stringliteral">&#39;linewidth&#39;</span>].extend(line_widths)</div>
<div class="line"><span class="lineno">  213</span>            arrow_kw[<span class="stringliteral">&#39;linewidth&#39;</span>] = line_widths[n]</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>        <span class="keywordflow">if</span> use_multicolor_lines:</div>
<div class="line"><span class="lineno">  216</span>            color_values = interpgrid(color, tgx, tgy)[:-1]</div>
<div class="line"><span class="lineno">  217</span>            line_colors.append(color_values)</div>
<div class="line"><span class="lineno">  218</span>            arrow_kw[<span class="stringliteral">&#39;color&#39;</span>] = cmap(norm(color_values[n]))</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>        p = patches.FancyArrowPatch(</div>
<div class="line"><span class="lineno">  221</span>            arrow_tail, arrow_head, transform=transform, **arrow_kw)</div>
<div class="line"><span class="lineno">  222</span>        arrows.append(p)</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>    lc = mcollections.LineCollection(</div>
<div class="line"><span class="lineno">  225</span>        streamlines, transform=transform, **line_kw)</div>
<div class="line"><span class="lineno">  226</span>    lc.sticky_edges.x[:] = [grid.x_origin, grid.x_origin + grid.width]</div>
<div class="line"><span class="lineno">  227</span>    lc.sticky_edges.y[:] = [grid.y_origin, grid.y_origin + grid.height]</div>
<div class="line"><span class="lineno">  228</span>    <span class="keywordflow">if</span> use_multicolor_lines:</div>
<div class="line"><span class="lineno">  229</span>        lc.set_array(np.ma.hstack(line_colors))</div>
<div class="line"><span class="lineno">  230</span>        lc.set_cmap(cmap)</div>
<div class="line"><span class="lineno">  231</span>        lc.set_norm(norm)</div>
<div class="line"><span class="lineno">  232</span>    axes.add_collection(lc)</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>    ac = mcollections.PatchCollection(arrows)</div>
<div class="line"><span class="lineno">  235</span>    <span class="comment"># Adding the collection itself is broken; see #2341.</span></div>
<div class="line"><span class="lineno">  236</span>    <span class="keywordflow">for</span> p <span class="keywordflow">in</span> arrows:</div>
<div class="line"><span class="lineno">  237</span>        axes.add_patch(p)</div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>    axes.autoscale_view()</div>
<div class="line"><span class="lineno">  240</span>    stream_container = StreamplotSet(lc, ac)</div>
<div class="line"><span class="lineno">  241</span>    <span class="keywordflow">return</span> stream_container</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span> </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
