<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tp_Gcs: joblib.externals.loky.backend.context Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tp_Gcs<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacejoblib.html">joblib</a></li><li class="navelem"><a class="el" href="namespacejoblib_1_1externals.html">externals</a></li><li class="navelem"><a class="el" href="namespacejoblib_1_1externals_1_1loky.html">loky</a></li><li class="navelem"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend.html">backend</a></li><li class="navelem"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html">context</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">joblib.externals.loky.backend.context Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjoblib_1_1externals_1_1loky_1_1backend_1_1context_1_1_loky_context.html">LokyContext</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjoblib_1_1externals_1_1loky_1_1backend_1_1context_1_1_loky_init_main_context.html">LokyInitMainContext</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1ae049ad55ce3e5113d8de510ef00eeb" id="r_a1ae049ad55ce3e5113d8de510ef00eeb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a1ae049ad55ce3e5113d8de510ef00eeb">get_context</a> (method=None)</td></tr>
<tr class="separator:a1ae049ad55ce3e5113d8de510ef00eeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11c343e6f3e5b1419c09306882ee076b" id="r_a11c343e6f3e5b1419c09306882ee076b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a11c343e6f3e5b1419c09306882ee076b">set_start_method</a> (method, force=False)</td></tr>
<tr class="separator:a11c343e6f3e5b1419c09306882ee076b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1dc3b37350d0b70c5c905d981d1f0c3" id="r_ac1dc3b37350d0b70c5c905d981d1f0c3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#ac1dc3b37350d0b70c5c905d981d1f0c3">get_start_method</a> ()</td></tr>
<tr class="separator:ac1dc3b37350d0b70c5c905d981d1f0c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64a1667d8d8206bcf3815aaab0aafe1c" id="r_a64a1667d8d8206bcf3815aaab0aafe1c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a64a1667d8d8206bcf3815aaab0aafe1c">cpu_count</a> (only_physical_cores=False)</td></tr>
<tr class="separator:a64a1667d8d8206bcf3815aaab0aafe1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58aacb4e875360fa3fb98f4119468e02" id="r_a58aacb4e875360fa3fb98f4119468e02"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a58aacb4e875360fa3fb98f4119468e02">_cpu_count_cgroup</a> (os_cpu_count)</td></tr>
<tr class="separator:a58aacb4e875360fa3fb98f4119468e02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58ec7d0a912b8ed91331f9b2aa72ce0f" id="r_a58ec7d0a912b8ed91331f9b2aa72ce0f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a58ec7d0a912b8ed91331f9b2aa72ce0f">_cpu_count_user</a> (os_cpu_count)</td></tr>
<tr class="separator:a58ec7d0a912b8ed91331f9b2aa72ce0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98b5c6e7962bd45d62c7e0a31438323f" id="r_a98b5c6e7962bd45d62c7e0a31438323f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a98b5c6e7962bd45d62c7e0a31438323f">_count_physical_cores</a> ()</td></tr>
<tr class="separator:a98b5c6e7962bd45d62c7e0a31438323f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a64f1d6694bb5c248e024ad8e954d0234" id="r_a64f1d6694bb5c248e024ad8e954d0234"><td class="memItemLeft" align="right" valign="top">list&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a64f1d6694bb5c248e024ad8e954d0234">START_METHODS</a> = ['loky', 'loky_init_main', 'spawn']</td></tr>
<tr class="separator:a64f1d6694bb5c248e024ad8e954d0234"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a662a8341207417630c6347be5aed4245" id="r_a662a8341207417630c6347be5aed4245"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a662a8341207417630c6347be5aed4245">_DEFAULT_START_METHOD</a> = None</td></tr>
<tr class="separator:a662a8341207417630c6347be5aed4245"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50cc3e7c2df26e6ec09e2757161237e2" id="r_a50cc3e7c2df26e6ec09e2757161237e2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#a50cc3e7c2df26e6ec09e2757161237e2">physical_cores_cache</a> = None</td></tr>
<tr class="separator:a50cc3e7c2df26e6ec09e2757161237e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac09f2ca6b6e74baa6bb07f086a098552" id="r_ac09f2ca6b6e74baa6bb07f086a098552"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejoblib_1_1externals_1_1loky_1_1backend_1_1context.html#ac09f2ca6b6e74baa6bb07f086a098552">ctx_loky</a> = <a class="el" href="classjoblib_1_1externals_1_1loky_1_1backend_1_1context_1_1_loky_context.html">LokyContext</a>()</td></tr>
<tr class="separator:ac09f2ca6b6e74baa6bb07f086a098552"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a98b5c6e7962bd45d62c7e0a31438323f" name="a98b5c6e7962bd45d62c7e0a31438323f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98b5c6e7962bd45d62c7e0a31438323f">&#9670;&#160;</a></span>_count_physical_cores()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context._count_physical_cores </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Return a tuple (number of physical cores, exception)

If the number of physical cores is found, exception is set to None.
If it has not been found, return ("not found", exception).

The number of physical cores is cached to avoid repeating subprocess calls.
</pre> <div class="fragment"><div class="line"><span class="lineno">  175</span><span class="keyword">def </span>_count_physical_cores():</div>
<div class="line"><span class="lineno">  176</span>    <span class="stringliteral">&quot;&quot;&quot;Return a tuple (number of physical cores, exception)</span></div>
<div class="line"><span class="lineno">  177</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  178</span><span class="stringliteral">    If the number of physical cores is found, exception is set to None.</span></div>
<div class="line"><span class="lineno">  179</span><span class="stringliteral">    If it has not been found, return (&quot;not found&quot;, exception).</span></div>
<div class="line"><span class="lineno">  180</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  181</span><span class="stringliteral">    The number of physical cores is cached to avoid repeating subprocess calls.</span></div>
<div class="line"><span class="lineno">  182</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  183</span>    exception = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>    <span class="comment"># First check if the value is cached</span></div>
<div class="line"><span class="lineno">  186</span>    <span class="keyword">global</span> physical_cores_cache</div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">if</span> physical_cores_cache <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  188</span>        <span class="keywordflow">return</span> physical_cores_cache, exception</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>    <span class="comment"># Not cached yet, find it</span></div>
<div class="line"><span class="lineno">  191</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  192</span>        <span class="keywordflow">if</span> sys.platform == <span class="stringliteral">&quot;linux&quot;</span>:</div>
<div class="line"><span class="lineno">  193</span>            cpu_info = subprocess.run(</div>
<div class="line"><span class="lineno">  194</span>                <span class="stringliteral">&quot;lscpu --parse=core&quot;</span>.split(), capture_output=<span class="keyword">True</span>, text=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  195</span>            cpu_info = cpu_info.stdout.splitlines()</div>
<div class="line"><span class="lineno">  196</span>            cpu_info = {line <span class="keywordflow">for</span> line <span class="keywordflow">in</span> cpu_info <span class="keywordflow">if</span> <span class="keywordflow">not</span> line.startswith(<span class="stringliteral">&quot;#&quot;</span>)}</div>
<div class="line"><span class="lineno">  197</span>            cpu_count_physical = len(cpu_info)</div>
<div class="line"><span class="lineno">  198</span>        <span class="keywordflow">elif</span> sys.platform == <span class="stringliteral">&quot;win32&quot;</span>:</div>
<div class="line"><span class="lineno">  199</span>            cpu_info = subprocess.run(</div>
<div class="line"><span class="lineno">  200</span>                <span class="stringliteral">&quot;wmic CPU Get NumberOfCores /Format:csv&quot;</span>.split(),</div>
<div class="line"><span class="lineno">  201</span>                capture_output=<span class="keyword">True</span>, text=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  202</span>            cpu_info = cpu_info.stdout.splitlines()</div>
<div class="line"><span class="lineno">  203</span>            cpu_info = [l.split(<span class="stringliteral">&quot;,&quot;</span>)[1] <span class="keywordflow">for</span> l <span class="keywordflow">in</span> cpu_info</div>
<div class="line"><span class="lineno">  204</span>                        <span class="keywordflow">if</span> (l <span class="keywordflow">and</span> l != <span class="stringliteral">&quot;Node,NumberOfCores&quot;</span>)]</div>
<div class="line"><span class="lineno">  205</span>            cpu_count_physical = sum(map(int, cpu_info))</div>
<div class="line"><span class="lineno">  206</span>        <span class="keywordflow">elif</span> sys.platform == <span class="stringliteral">&quot;darwin&quot;</span>:</div>
<div class="line"><span class="lineno">  207</span>            cpu_info = subprocess.run(</div>
<div class="line"><span class="lineno">  208</span>                <span class="stringliteral">&quot;sysctl -n hw.physicalcpu&quot;</span>.split(),</div>
<div class="line"><span class="lineno">  209</span>                capture_output=<span class="keyword">True</span>, text=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  210</span>            cpu_info = cpu_info.stdout</div>
<div class="line"><span class="lineno">  211</span>            cpu_count_physical = int(cpu_info)</div>
<div class="line"><span class="lineno">  212</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  213</span>            <span class="keywordflow">raise</span> NotImplementedError(f<span class="stringliteral">&quot;unsupported platform: {sys.platform}&quot;</span>)</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>        <span class="comment"># if cpu_count_physical &lt; 1, we did not find a valid value</span></div>
<div class="line"><span class="lineno">  216</span>        <span class="keywordflow">if</span> cpu_count_physical &lt; 1:</div>
<div class="line"><span class="lineno">  217</span>            <span class="keywordflow">raise</span> ValueError(</div>
<div class="line"><span class="lineno">  218</span>                f<span class="stringliteral">&quot;found {cpu_count_physical} physical cores &lt; 1&quot;</span>)</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><span class="lineno">  221</span>        exception = e</div>
<div class="line"><span class="lineno">  222</span>        cpu_count_physical = <span class="stringliteral">&quot;not found&quot;</span></div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>    <span class="comment"># Put the result in cache</span></div>
<div class="line"><span class="lineno">  225</span>    physical_cores_cache = cpu_count_physical</div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>    <span class="keywordflow">return</span> cpu_count_physical, exception</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a58aacb4e875360fa3fb98f4119468e02" name="a58aacb4e875360fa3fb98f4119468e02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58aacb4e875360fa3fb98f4119468e02">&#9670;&#160;</a></span>_cpu_count_cgroup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context._cpu_count_cgroup </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>os_cpu_count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  121</span><span class="keyword">def </span>_cpu_count_cgroup(os_cpu_count):</div>
<div class="line"><span class="lineno">  122</span>    <span class="comment"># Cgroup CPU bandwidth limit available in Linux since 2.6 kernel</span></div>
<div class="line"><span class="lineno">  123</span>    cpu_max_fname = <span class="stringliteral">&quot;/sys/fs/cgroup/cpu.max&quot;</span></div>
<div class="line"><span class="lineno">  124</span>    cfs_quota_fname = <span class="stringliteral">&quot;/sys/fs/cgroup/cpu/cpu.cfs_quota_us&quot;</span></div>
<div class="line"><span class="lineno">  125</span>    cfs_period_fname = <span class="stringliteral">&quot;/sys/fs/cgroup/cpu/cpu.cfs_period_us&quot;</span></div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordflow">if</span> os.path.exists(cpu_max_fname):</div>
<div class="line"><span class="lineno">  127</span>        <span class="comment"># cgroup v2</span></div>
<div class="line"><span class="lineno">  128</span>        <span class="comment"># https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html</span></div>
<div class="line"><span class="lineno">  129</span>        <span class="keyword">with</span> open(cpu_max_fname) <span class="keyword">as</span> fh:</div>
<div class="line"><span class="lineno">  130</span>            cpu_quota_us, cpu_period_us = fh.read().strip().split()</div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordflow">elif</span> os.path.exists(cfs_quota_fname) <span class="keywordflow">and</span> os.path.exists(cfs_period_fname):</div>
<div class="line"><span class="lineno">  132</span>        <span class="comment"># cgroup v1</span></div>
<div class="line"><span class="lineno">  133</span>        <span class="comment"># https://www.kernel.org/doc/html/latest/scheduler/sched-bwc.html#management</span></div>
<div class="line"><span class="lineno">  134</span>        <span class="keyword">with</span> open(cfs_quota_fname) <span class="keyword">as</span> fh:</div>
<div class="line"><span class="lineno">  135</span>            cpu_quota_us = fh.read().strip()</div>
<div class="line"><span class="lineno">  136</span>        <span class="keyword">with</span> open(cfs_period_fname) <span class="keyword">as</span> fh:</div>
<div class="line"><span class="lineno">  137</span>            cpu_period_us = fh.read().strip()</div>
<div class="line"><span class="lineno">  138</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  139</span>        <span class="comment"># No Cgroup CPU bandwidth limit (e.g. non-Linux platform)</span></div>
<div class="line"><span class="lineno">  140</span>        cpu_quota_us = <span class="stringliteral">&quot;max&quot;</span></div>
<div class="line"><span class="lineno">  141</span>        cpu_period_us = 100_000  <span class="comment"># unused, for consistency with default values</span></div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">if</span> cpu_quota_us == <span class="stringliteral">&quot;max&quot;</span>:</div>
<div class="line"><span class="lineno">  144</span>        <span class="comment"># No active Cgroup quota on a Cgroup-capable platform</span></div>
<div class="line"><span class="lineno">  145</span>        <span class="keywordflow">return</span> os_cpu_count</div>
<div class="line"><span class="lineno">  146</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  147</span>        cpu_quota_us = int(cpu_quota_us)</div>
<div class="line"><span class="lineno">  148</span>        cpu_period_us = int(cpu_period_us)</div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">if</span> cpu_quota_us &gt; 0 <span class="keywordflow">and</span> cpu_period_us &gt; 0:</div>
<div class="line"><span class="lineno">  150</span>            <span class="keywordflow">return</span> math.ceil(cpu_quota_us / cpu_period_us)</div>
<div class="line"><span class="lineno">  151</span>        <span class="keywordflow">else</span>:  <span class="comment"># pragma: no cover</span></div>
<div class="line"><span class="lineno">  152</span>            <span class="comment"># Setting a negative cpu_quota_us value is a valid way to disable</span></div>
<div class="line"><span class="lineno">  153</span>            <span class="comment"># cgroup CPU bandwith limits</span></div>
<div class="line"><span class="lineno">  154</span>            <span class="keywordflow">return</span> os_cpu_count</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a58ec7d0a912b8ed91331f9b2aa72ce0f" name="a58ec7d0a912b8ed91331f9b2aa72ce0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58ec7d0a912b8ed91331f9b2aa72ce0f">&#9670;&#160;</a></span>_cpu_count_user()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context._cpu_count_user </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>os_cpu_count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Number of user defined available CPUs</pre> <div class="fragment"><div class="line"><span class="lineno">  157</span><span class="keyword">def </span>_cpu_count_user(os_cpu_count):</div>
<div class="line"><span class="lineno">  158</span>    <span class="stringliteral">&quot;&quot;&quot;Number of user defined available CPUs&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  159</span>    <span class="comment"># Number of available CPUs given affinity settings</span></div>
<div class="line"><span class="lineno">  160</span>    cpu_count_affinity = os_cpu_count</div>
<div class="line"><span class="lineno">  161</span>    <span class="keywordflow">if</span> hasattr(os, <span class="stringliteral">&#39;sched_getaffinity&#39;</span>):</div>
<div class="line"><span class="lineno">  162</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  163</span>            cpu_count_affinity = len(os.sched_getaffinity(0))</div>
<div class="line"><span class="lineno">  164</span>        <span class="keywordflow">except</span> NotImplementedError:</div>
<div class="line"><span class="lineno">  165</span>            <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>    cpu_count_cgroup = _cpu_count_cgroup(os_cpu_count)</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>    <span class="comment"># User defined soft-limit passed as a loky specific environment variable.</span></div>
<div class="line"><span class="lineno">  170</span>    cpu_count_loky = int(os.environ.get(<span class="stringliteral">&#39;LOKY_MAX_CPU_COUNT&#39;</span>, os_cpu_count))</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordflow">return</span> min(cpu_count_affinity, cpu_count_cgroup, cpu_count_loky)</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a64a1667d8d8206bcf3815aaab0aafe1c" name="a64a1667d8d8206bcf3815aaab0aafe1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64a1667d8d8206bcf3815aaab0aafe1c">&#9670;&#160;</a></span>cpu_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context.cpu_count </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>only_physical_cores</em> = <code>False</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return the number of CPUs the current process can use.

The returned number of CPUs accounts for:
 * the number of CPUs in the system, as given by
   ``multiprocessing.cpu_count``;
 * the CPU affinity settings of the current process
   (available on some Unix systems);
 * Cgroup CPU bandwidth limit (available on Linux only, typically
   set by docker and similar container orchestration systems);
 * the value of the LOKY_MAX_CPU_COUNT environment variable if defined.
and is given as the minimum of these constraints.

If ``only_physical_cores`` is True, return the number of physical cores
instead of the number of logical cores (hyperthreading / SMT). Note that
this option is not enforced if the number of usable cores is controlled in
any other way such as: process affinity, Cgroup restricted CPU bandwidth
or the LOKY_MAX_CPU_COUNT environment variable. If the number of physical
cores is not found, return the number of logical cores.

It is also always larger or equal to 1.
</pre> <div class="fragment"><div class="line"><span class="lineno">   68</span><span class="keyword">def </span>cpu_count(only_physical_cores=False):</div>
<div class="line"><span class="lineno">   69</span>    <span class="stringliteral">&quot;&quot;&quot;Return the number of CPUs the current process can use.</span></div>
<div class="line"><span class="lineno">   70</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   71</span><span class="stringliteral">    The returned number of CPUs accounts for:</span></div>
<div class="line"><span class="lineno">   72</span><span class="stringliteral">     * the number of CPUs in the system, as given by</span></div>
<div class="line"><span class="lineno">   73</span><span class="stringliteral">       ``multiprocessing.cpu_count``;</span></div>
<div class="line"><span class="lineno">   74</span><span class="stringliteral">     * the CPU affinity settings of the current process</span></div>
<div class="line"><span class="lineno">   75</span><span class="stringliteral">       (available on some Unix systems);</span></div>
<div class="line"><span class="lineno">   76</span><span class="stringliteral">     * Cgroup CPU bandwidth limit (available on Linux only, typically</span></div>
<div class="line"><span class="lineno">   77</span><span class="stringliteral">       set by docker and similar container orchestration systems);</span></div>
<div class="line"><span class="lineno">   78</span><span class="stringliteral">     * the value of the LOKY_MAX_CPU_COUNT environment variable if defined.</span></div>
<div class="line"><span class="lineno">   79</span><span class="stringliteral">    and is given as the minimum of these constraints.</span></div>
<div class="line"><span class="lineno">   80</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   81</span><span class="stringliteral">    If ``only_physical_cores`` is True, return the number of physical cores</span></div>
<div class="line"><span class="lineno">   82</span><span class="stringliteral">    instead of the number of logical cores (hyperthreading / SMT). Note that</span></div>
<div class="line"><span class="lineno">   83</span><span class="stringliteral">    this option is not enforced if the number of usable cores is controlled in</span></div>
<div class="line"><span class="lineno">   84</span><span class="stringliteral">    any other way such as: process affinity, Cgroup restricted CPU bandwidth</span></div>
<div class="line"><span class="lineno">   85</span><span class="stringliteral">    or the LOKY_MAX_CPU_COUNT environment variable. If the number of physical</span></div>
<div class="line"><span class="lineno">   86</span><span class="stringliteral">    cores is not found, return the number of logical cores.</span></div>
<div class="line"><span class="lineno">   87</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   88</span><span class="stringliteral">    It is also always larger or equal to 1.</span></div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   90</span>    <span class="comment"># Note: os.cpu_count() is allowed to return None in its docstring</span></div>
<div class="line"><span class="lineno">   91</span>    os_cpu_count = os.cpu_count() <span class="keywordflow">or</span> 1</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>    cpu_count_user = _cpu_count_user(os_cpu_count)</div>
<div class="line"><span class="lineno">   94</span>    aggregate_cpu_count = max(min(os_cpu_count, cpu_count_user), 1)</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> only_physical_cores:</div>
<div class="line"><span class="lineno">   97</span>        <span class="keywordflow">return</span> aggregate_cpu_count</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>    <span class="keywordflow">if</span> cpu_count_user &lt; os_cpu_count:</div>
<div class="line"><span class="lineno">  100</span>        <span class="comment"># Respect user setting</span></div>
<div class="line"><span class="lineno">  101</span>        <span class="keywordflow">return</span> max(cpu_count_user, 1)</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>    cpu_count_physical, exception = _count_physical_cores()</div>
<div class="line"><span class="lineno">  104</span>    <span class="keywordflow">if</span> cpu_count_physical != <span class="stringliteral">&quot;not found&quot;</span>:</div>
<div class="line"><span class="lineno">  105</span>        <span class="keywordflow">return</span> cpu_count_physical</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>    <span class="comment"># Fallback to default behavior</span></div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">if</span> exception <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  109</span>        <span class="comment"># warns only the first time</span></div>
<div class="line"><span class="lineno">  110</span>        warnings.warn(</div>
<div class="line"><span class="lineno">  111</span>            <span class="stringliteral">&quot;Could not find the number of physical cores for the &quot;</span></div>
<div class="line"><span class="lineno">  112</span>            f<span class="stringliteral">&quot;following reason:\n{exception}\n&quot;</span></div>
<div class="line"><span class="lineno">  113</span>            <span class="stringliteral">&quot;Returning the number of logical cores instead. You can &quot;</span></div>
<div class="line"><span class="lineno">  114</span>            <span class="stringliteral">&quot;silence this warning by setting LOKY_MAX_CPU_COUNT to &quot;</span></div>
<div class="line"><span class="lineno">  115</span>            <span class="stringliteral">&quot;the number of cores you want to use.&quot;</span>)</div>
<div class="line"><span class="lineno">  116</span>        traceback.print_tb(exception.__traceback__)</div>
<div class="line"><span class="lineno">  117</span> </div>
<div class="line"><span class="lineno">  118</span>    <span class="keywordflow">return</span> aggregate_cpu_count</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ae049ad55ce3e5113d8de510ef00eeb" name="a1ae049ad55ce3e5113d8de510ef00eeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ae049ad55ce3e5113d8de510ef00eeb">&#9670;&#160;</a></span>get_context()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context.get_context </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>method</em> = <code>None</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   35</span><span class="keyword">def </span>get_context(method=None):</div>
<div class="line"><span class="lineno">   36</span>    <span class="comment"># Try to overload the default context</span></div>
<div class="line"><span class="lineno">   37</span>    method = method <span class="keywordflow">or</span> _DEFAULT_START_METHOD <span class="keywordflow">or</span> <span class="stringliteral">&quot;loky&quot;</span></div>
<div class="line"><span class="lineno">   38</span>    <span class="keywordflow">if</span> method == <span class="stringliteral">&quot;fork&quot;</span>:</div>
<div class="line"><span class="lineno">   39</span>        <span class="comment"># If &#39;fork&#39; is explicitly requested, warn user about potential issues.</span></div>
<div class="line"><span class="lineno">   40</span>        warnings.warn(<span class="stringliteral">&quot;`fork` start method should not be used with &quot;</span></div>
<div class="line"><span class="lineno">   41</span>                      <span class="stringliteral">&quot;`loky` as it does not respect POSIX. Try using &quot;</span></div>
<div class="line"><span class="lineno">   42</span>                      <span class="stringliteral">&quot;`spawn` or `loky` instead.&quot;</span>, UserWarning)</div>
<div class="line"><span class="lineno">   43</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">   44</span>        <span class="keywordflow">return</span> mp_get_context(method)</div>
<div class="line"><span class="lineno">   45</span>    <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><span class="lineno">   46</span>        <span class="keywordflow">raise</span> ValueError(</div>
<div class="line"><span class="lineno">   47</span>            f<span class="stringliteral">&quot;Unknown context &#39;{method}&#39;. Value should be in &quot;</span></div>
<div class="line"><span class="lineno">   48</span>            f<span class="stringliteral">&quot;{START_METHODS}.&quot;</span></div>
<div class="line"><span class="lineno">   49</span>        )</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ac1dc3b37350d0b70c5c905d981d1f0c3" name="ac1dc3b37350d0b70c5c905d981d1f0c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1dc3b37350d0b70c5c905d981d1f0c3">&#9670;&#160;</a></span>get_start_method()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context.get_start_method </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   64</span><span class="keyword">def </span>get_start_method():</div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordflow">return</span> _DEFAULT_START_METHOD</div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a11c343e6f3e5b1419c09306882ee076b" name="a11c343e6f3e5b1419c09306882ee076b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11c343e6f3e5b1419c09306882ee076b">&#9670;&#160;</a></span>set_start_method()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context.set_start_method </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>force</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   52</span><span class="keyword">def </span>set_start_method(method, force=False):</div>
<div class="line"><span class="lineno">   53</span>    <span class="keyword">global</span> _DEFAULT_START_METHOD</div>
<div class="line"><span class="lineno">   54</span>    <span class="keywordflow">if</span> _DEFAULT_START_METHOD <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> force:</div>
<div class="line"><span class="lineno">   55</span>        <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;context has already been set&#39;</span>)</div>
<div class="line"><span class="lineno">   56</span>    <span class="keyword">assert</span> method <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> method <span class="keywordflow">in</span> START_METHODS, (</div>
<div class="line"><span class="lineno">   57</span>        f<span class="stringliteral">&quot;&#39;{method}&#39; is not a valid start_method. It should be in &quot;</span></div>
<div class="line"><span class="lineno">   58</span>        f<span class="stringliteral">&quot;{START_METHODS}&quot;</span></div>
<div class="line"><span class="lineno">   59</span>    )</div>
<div class="line"><span class="lineno">   60</span> </div>
<div class="line"><span class="lineno">   61</span>    _DEFAULT_START_METHOD = method</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a662a8341207417630c6347be5aed4245" name="a662a8341207417630c6347be5aed4245"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a662a8341207417630c6347be5aed4245">&#9670;&#160;</a></span>_DEFAULT_START_METHOD</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context._DEFAULT_START_METHOD = None</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac09f2ca6b6e74baa6bb07f086a098552" name="ac09f2ca6b6e74baa6bb07f086a098552"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac09f2ca6b6e74baa6bb07f086a098552">&#9670;&#160;</a></span>ctx_loky</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context.ctx_loky = <a class="el" href="classjoblib_1_1externals_1_1loky_1_1backend_1_1context_1_1_loky_context.html">LokyContext</a>()</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a50cc3e7c2df26e6ec09e2757161237e2" name="a50cc3e7c2df26e6ec09e2757161237e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50cc3e7c2df26e6ec09e2757161237e2">&#9670;&#160;</a></span>physical_cores_cache</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">joblib.externals.loky.backend.context.physical_cores_cache = None</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a64f1d6694bb5c248e024ad8e954d0234" name="a64f1d6694bb5c248e024ad8e954d0234"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64f1d6694bb5c248e024ad8e954d0234">&#9670;&#160;</a></span>START_METHODS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">list joblib.externals.loky.backend.context.START_METHODS = ['loky', 'loky_init_main', 'spawn']</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
